{"version":3,"file":"index.umd.js","sources":["../../../node_modules/loglevel/lib/loglevel.js","../../core/node_modules/uuid/dist/esm-browser/rng.js","../../core/node_modules/uuid/dist/esm-browser/regex.js","../../core/node_modules/uuid/dist/esm-browser/stringify.js","../../core/node_modules/uuid/dist/esm-browser/v35.js","../../core/node_modules/uuid/dist/esm-browser/parse.js","../../core/node_modules/uuid/dist/esm-browser/validate.js","../../core/node_modules/uuid/dist/esm-browser/md5.js","../../core/node_modules/uuid/dist/esm-browser/v3.js","../../core/node_modules/uuid/dist/esm-browser/native.js","../../core/node_modules/uuid/dist/esm-browser/v4.js","../../core/node_modules/uuid/dist/esm-browser/sha1.js","../../../node_modules/@babel/runtime/helpers/esm/typeof.js","../../../node_modules/@babel/runtime/helpers/esm/defineProperty.js","../../../node_modules/@babel/runtime/helpers/esm/toPropertyKey.js","../../../node_modules/@babel/runtime/helpers/esm/toPrimitive.js","../../../node_modules/@babel/runtime/helpers/esm/objectSpread2.js","../../../node_modules/redux/es/redux.js","../../core/node_modules/uuid/dist/esm-browser/v5.js","../../../node_modules/@redux-saga/symbols/dist/redux-saga-symbols.esm.js","../../../node_modules/@babel/runtime/helpers/esm/extends.js","../../../node_modules/@redux-saga/is/dist/redux-saga-is.esm.js","../../../node_modules/@redux-saga/core/dist/io-c3792963.js","../../../node_modules/@redux-saga/core/dist/redux-saga-core.esm.js","../../../node_modules/@redux-saga/deferred/dist/redux-saga-deferred.esm.js","../../../node_modules/@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js","../../../node_modules/eventemitter3/index.js","../../core/dist/index.esm.js","../../webrtc/dist/mjs/webrtc/src/utils/primitives.js","../../webrtc/dist/mjs/webrtc/src/utils/enumerateDevices.js","../../webrtc/dist/mjs/webrtc/src/utils/permissions.js","../../webrtc/dist/mjs/webrtc/src/utils/getUserMedia.js","../../webrtc/dist/mjs/webrtc/src/utils/getDisplayMedia.js","../../webrtc/dist/mjs/webrtc/src/utils/deviceHelpers.js","../../../node_modules/sdp/sdp.js","../../webrtc/dist/mjs/webrtc/src/utils/sdpHelpers.js","../../webrtc/dist/mjs/webrtc/src/utils/helpers.js","../../webrtc/dist/mjs/webrtc/src/RTCPeer.js","../../webrtc/dist/mjs/webrtc/src/utils/watchRTCPeerMediaPackets.js","../../webrtc/dist/mjs/webrtc/src/workers/vertoEventWorker.js","../../../node_modules/tslib/tslib.es6.js","../../webrtc/dist/mjs/webrtc/src/workers/roomSubscribedWorker.js","../../webrtc/dist/mjs/webrtc/src/workers/promoteDemoteWorker.js","../../webrtc/dist/mjs/webrtc/src/workers/sessionAuthWorker.js","../../webrtc/dist/mjs/webrtc/src/BaseConnection.js","../src/utils/videoElement.ts","../src/utils/audioElement.ts","../src/features/actions.ts","../src/utils/aspectRatioListener.ts","../src/features/mediaElements/mediaElementsSagas.ts","../src/utils/constants.ts","../src/RoomSessionScreenShare.ts","../src/RoomSessionDevice.ts","../src/video/memberListUpdatedWorker.ts","../src/video/childMemberJoinedWorker.ts","../src/video/videoStreamWorker.ts","../src/video/videoRecordWorker.ts","../src/video/videoPlaybackWorker.ts","../src/video/videoWorker.ts","../src/video/videoMemberWorker.ts","../src/BaseRoomSession.ts","../src/cantina/workers/videoManagerRoomsWorker.ts","../src/cantina/workers/videoManagerRoomWorker.ts","../src/cantina/workers/videoManagerWorker.ts","../src/cantina/VideoManager.ts","../src/Client.ts","../../../node_modules/jwt-decode/build/jwt-decode.esm.js","../src/utils/storage.ts","../src/utils/CloseEvent.ts","../src/JWTSession.ts","../src/createClient.ts","../src/chat/Client.ts","../src/pubSub/Client.ts","../src/pubSub/index.ts","../src/fabric/workers/wsClientWorker.ts","../src/fabric/workers/conversationWorker.ts","../src/fabric/workers/callLeftWorker.ts","../src/fabric/workers/callJoinWorker.ts","../src/fabric/workers/callSegmentWorker.ts","../src/fabric/workers/callFabricWorker.ts","../src/fabric/IncomingCallManager.ts","../src/fabric/SATSession.ts","../src/fabric/utils/constants.ts","../src/fabric/CallFabricRoomSession.ts","../src/fabric/buildVideoElement.ts","../src/fabric/Client.ts","../src/fabric/WSClient.ts","../src/fabric/createClient.ts","../src/fabric/createHttpClient.ts","../src/utils/paginatedResult.ts","../src/utils/makeQueryParamsUrl.ts","../src/fabric/HTTPClient.ts","../src/fabric/utils/typeGuard.ts","../src/fabric/ConversationAPI.ts","../src/fabric/Conversation.ts","../src/fabric/SignalWire.ts","../src/createRoomObject.ts","../src/RoomSession.ts","../src/utils/roomSession.ts","../src/joinRoom.ts","../../webrtc/dist/mjs/webrtc/src/utils/requestPermissions.js"],"sourcesContent":["/*\n* loglevel - https://github.com/pimterry/loglevel\n*\n* Copyright (c) 2013 Tim Perry\n* Licensed under the MIT license.\n*/\n(function (root, definition) {\n    \"use strict\";\n    if (typeof define === 'function' && define.amd) {\n        define(definition);\n    } else if (typeof module === 'object' && module.exports) {\n        module.exports = definition();\n    } else {\n        root.log = definition();\n    }\n}(this, function () {\n    \"use strict\";\n\n    // Slightly dubious tricks to cut down minimized file size\n    var noop = function() {};\n    var undefinedType = \"undefined\";\n    var isIE = (typeof window !== undefinedType) && (typeof window.navigator !== undefinedType) && (\n        /Trident\\/|MSIE /.test(window.navigator.userAgent)\n    );\n\n    var logMethods = [\n        \"trace\",\n        \"debug\",\n        \"info\",\n        \"warn\",\n        \"error\"\n    ];\n\n    // Cross-browser bind equivalent that works at least back to IE6\n    function bindMethod(obj, methodName) {\n        var method = obj[methodName];\n        if (typeof method.bind === 'function') {\n            return method.bind(obj);\n        } else {\n            try {\n                return Function.prototype.bind.call(method, obj);\n            } catch (e) {\n                // Missing bind shim or IE8 + Modernizr, fallback to wrapping\n                return function() {\n                    return Function.prototype.apply.apply(method, [obj, arguments]);\n                };\n            }\n        }\n    }\n\n    // Trace() doesn't print the message in IE, so for that case we need to wrap it\n    function traceForIE() {\n        if (console.log) {\n            if (console.log.apply) {\n                console.log.apply(console, arguments);\n            } else {\n                // In old IE, native console methods themselves don't have apply().\n                Function.prototype.apply.apply(console.log, [console, arguments]);\n            }\n        }\n        if (console.trace) console.trace();\n    }\n\n    // Build the best logging method possible for this env\n    // Wherever possible we want to bind, not wrap, to preserve stack traces\n    function realMethod(methodName) {\n        if (methodName === 'debug') {\n            methodName = 'log';\n        }\n\n        if (typeof console === undefinedType) {\n            return false; // No method possible, for now - fixed later by enableLoggingWhenConsoleArrives\n        } else if (methodName === 'trace' && isIE) {\n            return traceForIE;\n        } else if (console[methodName] !== undefined) {\n            return bindMethod(console, methodName);\n        } else if (console.log !== undefined) {\n            return bindMethod(console, 'log');\n        } else {\n            return noop;\n        }\n    }\n\n    // These private functions always need `this` to be set properly\n\n    function replaceLoggingMethods(level, loggerName) {\n        /*jshint validthis:true */\n        for (var i = 0; i < logMethods.length; i++) {\n            var methodName = logMethods[i];\n            this[methodName] = (i < level) ?\n                noop :\n                this.methodFactory(methodName, level, loggerName);\n        }\n\n        // Define log.log as an alias for log.debug\n        this.log = this.debug;\n    }\n\n    // In old IE versions, the console isn't present until you first open it.\n    // We build realMethod() replacements here that regenerate logging methods\n    function enableLoggingWhenConsoleArrives(methodName, level, loggerName) {\n        return function () {\n            if (typeof console !== undefinedType) {\n                replaceLoggingMethods.call(this, level, loggerName);\n                this[methodName].apply(this, arguments);\n            }\n        };\n    }\n\n    // By default, we use closely bound real methods wherever possible, and\n    // otherwise we wait for a console to appear, and then try again.\n    function defaultMethodFactory(methodName, level, loggerName) {\n        /*jshint validthis:true */\n        return realMethod(methodName) ||\n               enableLoggingWhenConsoleArrives.apply(this, arguments);\n    }\n\n    function Logger(name, defaultLevel, factory) {\n      var self = this;\n      var currentLevel;\n      defaultLevel = defaultLevel == null ? \"WARN\" : defaultLevel;\n\n      var storageKey = \"loglevel\";\n      if (typeof name === \"string\") {\n        storageKey += \":\" + name;\n      } else if (typeof name === \"symbol\") {\n        storageKey = undefined;\n      }\n\n      function persistLevelIfPossible(levelNum) {\n          var levelName = (logMethods[levelNum] || 'silent').toUpperCase();\n\n          if (typeof window === undefinedType || !storageKey) return;\n\n          // Use localStorage if available\n          try {\n              window.localStorage[storageKey] = levelName;\n              return;\n          } catch (ignore) {}\n\n          // Use session cookie as fallback\n          try {\n              window.document.cookie =\n                encodeURIComponent(storageKey) + \"=\" + levelName + \";\";\n          } catch (ignore) {}\n      }\n\n      function getPersistedLevel() {\n          var storedLevel;\n\n          if (typeof window === undefinedType || !storageKey) return;\n\n          try {\n              storedLevel = window.localStorage[storageKey];\n          } catch (ignore) {}\n\n          // Fallback to cookies if local storage gives us nothing\n          if (typeof storedLevel === undefinedType) {\n              try {\n                  var cookie = window.document.cookie;\n                  var location = cookie.indexOf(\n                      encodeURIComponent(storageKey) + \"=\");\n                  if (location !== -1) {\n                      storedLevel = /^([^;]+)/.exec(cookie.slice(location))[1];\n                  }\n              } catch (ignore) {}\n          }\n\n          // If the stored level is not valid, treat it as if nothing was stored.\n          if (self.levels[storedLevel] === undefined) {\n              storedLevel = undefined;\n          }\n\n          return storedLevel;\n      }\n\n      function clearPersistedLevel() {\n          if (typeof window === undefinedType || !storageKey) return;\n\n          // Use localStorage if available\n          try {\n              window.localStorage.removeItem(storageKey);\n              return;\n          } catch (ignore) {}\n\n          // Use session cookie as fallback\n          try {\n              window.document.cookie =\n                encodeURIComponent(storageKey) + \"=; expires=Thu, 01 Jan 1970 00:00:00 UTC\";\n          } catch (ignore) {}\n      }\n\n      /*\n       *\n       * Public logger API - see https://github.com/pimterry/loglevel for details\n       *\n       */\n\n      self.name = name;\n\n      self.levels = { \"TRACE\": 0, \"DEBUG\": 1, \"INFO\": 2, \"WARN\": 3,\n          \"ERROR\": 4, \"SILENT\": 5};\n\n      self.methodFactory = factory || defaultMethodFactory;\n\n      self.getLevel = function () {\n          return currentLevel;\n      };\n\n      self.setLevel = function (level, persist) {\n          if (typeof level === \"string\" && self.levels[level.toUpperCase()] !== undefined) {\n              level = self.levels[level.toUpperCase()];\n          }\n          if (typeof level === \"number\" && level >= 0 && level <= self.levels.SILENT) {\n              currentLevel = level;\n              if (persist !== false) {  // defaults to true\n                  persistLevelIfPossible(level);\n              }\n              replaceLoggingMethods.call(self, level, name);\n              if (typeof console === undefinedType && level < self.levels.SILENT) {\n                  return \"No console available for logging\";\n              }\n          } else {\n              throw \"log.setLevel() called with invalid level: \" + level;\n          }\n      };\n\n      self.setDefaultLevel = function (level) {\n          defaultLevel = level;\n          if (!getPersistedLevel()) {\n              self.setLevel(level, false);\n          }\n      };\n\n      self.resetLevel = function () {\n          self.setLevel(defaultLevel, false);\n          clearPersistedLevel();\n      };\n\n      self.enableAll = function(persist) {\n          self.setLevel(self.levels.TRACE, persist);\n      };\n\n      self.disableAll = function(persist) {\n          self.setLevel(self.levels.SILENT, persist);\n      };\n\n      // Initialize with the right level\n      var initialLevel = getPersistedLevel();\n      if (initialLevel == null) {\n          initialLevel = defaultLevel;\n      }\n      self.setLevel(initialLevel, false);\n    }\n\n    /*\n     *\n     * Top-level API\n     *\n     */\n\n    var defaultLogger = new Logger();\n\n    var _loggersByName = {};\n    defaultLogger.getLogger = function getLogger(name) {\n        if ((typeof name !== \"symbol\" && typeof name !== \"string\") || name === \"\") {\n          throw new TypeError(\"You must supply a name when creating a logger.\");\n        }\n\n        var logger = _loggersByName[name];\n        if (!logger) {\n          logger = _loggersByName[name] = new Logger(\n            name, defaultLogger.getLevel(), defaultLogger.methodFactory);\n        }\n        return logger;\n    };\n\n    // Grab the current global log variable in case of overwrite\n    var _log = (typeof window !== undefinedType) ? window.log : undefined;\n    defaultLogger.noConflict = function() {\n        if (typeof window !== undefinedType &&\n               window.log === defaultLogger) {\n            window.log = _log;\n        }\n\n        return defaultLogger;\n    };\n\n    defaultLogger.getLoggers = function getLoggers() {\n        return _loggersByName;\n    };\n\n    // ES6 default export, for compatibility\n    defaultLogger['default'] = defaultLogger;\n\n    return defaultLogger;\n}));\n","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nlet getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nconst byteToHex = [];\n\nfor (let i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).slice(1));\n}\n\nexport function unsafeStringify(arr, offset = 0) {\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  return (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase();\n}\n\nfunction stringify(arr, offset = 0) {\n  const uuid = unsafeStringify(arr, offset); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","import { unsafeStringify } from './stringify.js';\nimport parse from './parse.js';\n\nfunction stringToBytes(str) {\n  str = unescape(encodeURIComponent(str)); // UTF8 escape\n\n  const bytes = [];\n\n  for (let i = 0; i < str.length; ++i) {\n    bytes.push(str.charCodeAt(i));\n  }\n\n  return bytes;\n}\n\nexport const DNS = '6ba7b810-9dad-11d1-80b4-00c04fd430c8';\nexport const URL = '6ba7b811-9dad-11d1-80b4-00c04fd430c8';\nexport default function v35(name, version, hashfunc) {\n  function generateUUID(value, namespace, buf, offset) {\n    var _namespace;\n\n    if (typeof value === 'string') {\n      value = stringToBytes(value);\n    }\n\n    if (typeof namespace === 'string') {\n      namespace = parse(namespace);\n    }\n\n    if (((_namespace = namespace) === null || _namespace === void 0 ? void 0 : _namespace.length) !== 16) {\n      throw TypeError('Namespace must be array-like (16 iterable integer values, 0-255)');\n    } // Compute hash of namespace and value, Per 4.3\n    // Future: Use spread syntax when supported on all platforms, e.g. `bytes =\n    // hashfunc([...namespace, ... value])`\n\n\n    let bytes = new Uint8Array(16 + value.length);\n    bytes.set(namespace);\n    bytes.set(value, namespace.length);\n    bytes = hashfunc(bytes);\n    bytes[6] = bytes[6] & 0x0f | version;\n    bytes[8] = bytes[8] & 0x3f | 0x80;\n\n    if (buf) {\n      offset = offset || 0;\n\n      for (let i = 0; i < 16; ++i) {\n        buf[offset + i] = bytes[i];\n      }\n\n      return buf;\n    }\n\n    return unsafeStringify(bytes);\n  } // Function#name is not settable on some platforms (#270)\n\n\n  try {\n    generateUUID.name = name; // eslint-disable-next-line no-empty\n  } catch (err) {} // For CommonJS default export support\n\n\n  generateUUID.DNS = DNS;\n  generateUUID.URL = URL;\n  return generateUUID;\n}","import validate from './validate.js';\n\nfunction parse(uuid) {\n  if (!validate(uuid)) {\n    throw TypeError('Invalid UUID');\n  }\n\n  let v;\n  const arr = new Uint8Array(16); // Parse ########-....-....-....-............\n\n  arr[0] = (v = parseInt(uuid.slice(0, 8), 16)) >>> 24;\n  arr[1] = v >>> 16 & 0xff;\n  arr[2] = v >>> 8 & 0xff;\n  arr[3] = v & 0xff; // Parse ........-####-....-....-............\n\n  arr[4] = (v = parseInt(uuid.slice(9, 13), 16)) >>> 8;\n  arr[5] = v & 0xff; // Parse ........-....-####-....-............\n\n  arr[6] = (v = parseInt(uuid.slice(14, 18), 16)) >>> 8;\n  arr[7] = v & 0xff; // Parse ........-....-....-####-............\n\n  arr[8] = (v = parseInt(uuid.slice(19, 23), 16)) >>> 8;\n  arr[9] = v & 0xff; // Parse ........-....-....-....-############\n  // (Use \"/\" to avoid 32-bit truncation when bit-shifting high-order bytes)\n\n  arr[10] = (v = parseInt(uuid.slice(24, 36), 16)) / 0x10000000000 & 0xff;\n  arr[11] = v / 0x100000000 & 0xff;\n  arr[12] = v >>> 24 & 0xff;\n  arr[13] = v >>> 16 & 0xff;\n  arr[14] = v >>> 8 & 0xff;\n  arr[15] = v & 0xff;\n  return arr;\n}\n\nexport default parse;","import REGEX from './regex.js';\n\nfunction validate(uuid) {\n  return typeof uuid === 'string' && REGEX.test(uuid);\n}\n\nexport default validate;","/*\n * Browser-compatible JavaScript MD5\n *\n * Modification of JavaScript MD5\n * https://github.com/blueimp/JavaScript-MD5\n *\n * Copyright 2011, Sebastian Tschan\n * https://blueimp.net\n *\n * Licensed under the MIT license:\n * https://opensource.org/licenses/MIT\n *\n * Based on\n * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message\n * Digest Algorithm, as defined in RFC 1321.\n * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n * Distributed under the BSD License\n * See http://pajhome.org.uk/crypt/md5 for more info.\n */\nfunction md5(bytes) {\n  if (typeof bytes === 'string') {\n    const msg = unescape(encodeURIComponent(bytes)); // UTF8 escape\n\n    bytes = new Uint8Array(msg.length);\n\n    for (let i = 0; i < msg.length; ++i) {\n      bytes[i] = msg.charCodeAt(i);\n    }\n  }\n\n  return md5ToHexEncodedArray(wordsToMd5(bytesToWords(bytes), bytes.length * 8));\n}\n/*\n * Convert an array of little-endian words to an array of bytes\n */\n\n\nfunction md5ToHexEncodedArray(input) {\n  const output = [];\n  const length32 = input.length * 32;\n  const hexTab = '0123456789abcdef';\n\n  for (let i = 0; i < length32; i += 8) {\n    const x = input[i >> 5] >>> i % 32 & 0xff;\n    const hex = parseInt(hexTab.charAt(x >>> 4 & 0x0f) + hexTab.charAt(x & 0x0f), 16);\n    output.push(hex);\n  }\n\n  return output;\n}\n/**\n * Calculate output length with padding and bit length\n */\n\n\nfunction getOutputLength(inputLength8) {\n  return (inputLength8 + 64 >>> 9 << 4) + 14 + 1;\n}\n/*\n * Calculate the MD5 of an array of little-endian words, and a bit length.\n */\n\n\nfunction wordsToMd5(x, len) {\n  /* append padding */\n  x[len >> 5] |= 0x80 << len % 32;\n  x[getOutputLength(len) - 1] = len;\n  let a = 1732584193;\n  let b = -271733879;\n  let c = -1732584194;\n  let d = 271733878;\n\n  for (let i = 0; i < x.length; i += 16) {\n    const olda = a;\n    const oldb = b;\n    const oldc = c;\n    const oldd = d;\n    a = md5ff(a, b, c, d, x[i], 7, -680876936);\n    d = md5ff(d, a, b, c, x[i + 1], 12, -389564586);\n    c = md5ff(c, d, a, b, x[i + 2], 17, 606105819);\n    b = md5ff(b, c, d, a, x[i + 3], 22, -1044525330);\n    a = md5ff(a, b, c, d, x[i + 4], 7, -176418897);\n    d = md5ff(d, a, b, c, x[i + 5], 12, 1200080426);\n    c = md5ff(c, d, a, b, x[i + 6], 17, -1473231341);\n    b = md5ff(b, c, d, a, x[i + 7], 22, -45705983);\n    a = md5ff(a, b, c, d, x[i + 8], 7, 1770035416);\n    d = md5ff(d, a, b, c, x[i + 9], 12, -1958414417);\n    c = md5ff(c, d, a, b, x[i + 10], 17, -42063);\n    b = md5ff(b, c, d, a, x[i + 11], 22, -1990404162);\n    a = md5ff(a, b, c, d, x[i + 12], 7, 1804603682);\n    d = md5ff(d, a, b, c, x[i + 13], 12, -40341101);\n    c = md5ff(c, d, a, b, x[i + 14], 17, -1502002290);\n    b = md5ff(b, c, d, a, x[i + 15], 22, 1236535329);\n    a = md5gg(a, b, c, d, x[i + 1], 5, -165796510);\n    d = md5gg(d, a, b, c, x[i + 6], 9, -1069501632);\n    c = md5gg(c, d, a, b, x[i + 11], 14, 643717713);\n    b = md5gg(b, c, d, a, x[i], 20, -373897302);\n    a = md5gg(a, b, c, d, x[i + 5], 5, -701558691);\n    d = md5gg(d, a, b, c, x[i + 10], 9, 38016083);\n    c = md5gg(c, d, a, b, x[i + 15], 14, -660478335);\n    b = md5gg(b, c, d, a, x[i + 4], 20, -405537848);\n    a = md5gg(a, b, c, d, x[i + 9], 5, 568446438);\n    d = md5gg(d, a, b, c, x[i + 14], 9, -1019803690);\n    c = md5gg(c, d, a, b, x[i + 3], 14, -187363961);\n    b = md5gg(b, c, d, a, x[i + 8], 20, 1163531501);\n    a = md5gg(a, b, c, d, x[i + 13], 5, -1444681467);\n    d = md5gg(d, a, b, c, x[i + 2], 9, -51403784);\n    c = md5gg(c, d, a, b, x[i + 7], 14, 1735328473);\n    b = md5gg(b, c, d, a, x[i + 12], 20, -1926607734);\n    a = md5hh(a, b, c, d, x[i + 5], 4, -378558);\n    d = md5hh(d, a, b, c, x[i + 8], 11, -2022574463);\n    c = md5hh(c, d, a, b, x[i + 11], 16, 1839030562);\n    b = md5hh(b, c, d, a, x[i + 14], 23, -35309556);\n    a = md5hh(a, b, c, d, x[i + 1], 4, -1530992060);\n    d = md5hh(d, a, b, c, x[i + 4], 11, 1272893353);\n    c = md5hh(c, d, a, b, x[i + 7], 16, -155497632);\n    b = md5hh(b, c, d, a, x[i + 10], 23, -1094730640);\n    a = md5hh(a, b, c, d, x[i + 13], 4, 681279174);\n    d = md5hh(d, a, b, c, x[i], 11, -358537222);\n    c = md5hh(c, d, a, b, x[i + 3], 16, -722521979);\n    b = md5hh(b, c, d, a, x[i + 6], 23, 76029189);\n    a = md5hh(a, b, c, d, x[i + 9], 4, -640364487);\n    d = md5hh(d, a, b, c, x[i + 12], 11, -421815835);\n    c = md5hh(c, d, a, b, x[i + 15], 16, 530742520);\n    b = md5hh(b, c, d, a, x[i + 2], 23, -995338651);\n    a = md5ii(a, b, c, d, x[i], 6, -198630844);\n    d = md5ii(d, a, b, c, x[i + 7], 10, 1126891415);\n    c = md5ii(c, d, a, b, x[i + 14], 15, -1416354905);\n    b = md5ii(b, c, d, a, x[i + 5], 21, -57434055);\n    a = md5ii(a, b, c, d, x[i + 12], 6, 1700485571);\n    d = md5ii(d, a, b, c, x[i + 3], 10, -1894986606);\n    c = md5ii(c, d, a, b, x[i + 10], 15, -1051523);\n    b = md5ii(b, c, d, a, x[i + 1], 21, -2054922799);\n    a = md5ii(a, b, c, d, x[i + 8], 6, 1873313359);\n    d = md5ii(d, a, b, c, x[i + 15], 10, -30611744);\n    c = md5ii(c, d, a, b, x[i + 6], 15, -1560198380);\n    b = md5ii(b, c, d, a, x[i + 13], 21, 1309151649);\n    a = md5ii(a, b, c, d, x[i + 4], 6, -145523070);\n    d = md5ii(d, a, b, c, x[i + 11], 10, -1120210379);\n    c = md5ii(c, d, a, b, x[i + 2], 15, 718787259);\n    b = md5ii(b, c, d, a, x[i + 9], 21, -343485551);\n    a = safeAdd(a, olda);\n    b = safeAdd(b, oldb);\n    c = safeAdd(c, oldc);\n    d = safeAdd(d, oldd);\n  }\n\n  return [a, b, c, d];\n}\n/*\n * Convert an array bytes to an array of little-endian words\n * Characters >255 have their high-byte silently ignored.\n */\n\n\nfunction bytesToWords(input) {\n  if (input.length === 0) {\n    return [];\n  }\n\n  const length8 = input.length * 8;\n  const output = new Uint32Array(getOutputLength(length8));\n\n  for (let i = 0; i < length8; i += 8) {\n    output[i >> 5] |= (input[i / 8] & 0xff) << i % 32;\n  }\n\n  return output;\n}\n/*\n * Add integers, wrapping at 2^32. This uses 16-bit operations internally\n * to work around bugs in some JS interpreters.\n */\n\n\nfunction safeAdd(x, y) {\n  const lsw = (x & 0xffff) + (y & 0xffff);\n  const msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n  return msw << 16 | lsw & 0xffff;\n}\n/*\n * Bitwise rotate a 32-bit number to the left.\n */\n\n\nfunction bitRotateLeft(num, cnt) {\n  return num << cnt | num >>> 32 - cnt;\n}\n/*\n * These functions implement the four basic operations the algorithm uses.\n */\n\n\nfunction md5cmn(q, a, b, x, s, t) {\n  return safeAdd(bitRotateLeft(safeAdd(safeAdd(a, q), safeAdd(x, t)), s), b);\n}\n\nfunction md5ff(a, b, c, d, x, s, t) {\n  return md5cmn(b & c | ~b & d, a, b, x, s, t);\n}\n\nfunction md5gg(a, b, c, d, x, s, t) {\n  return md5cmn(b & d | c & ~d, a, b, x, s, t);\n}\n\nfunction md5hh(a, b, c, d, x, s, t) {\n  return md5cmn(b ^ c ^ d, a, b, x, s, t);\n}\n\nfunction md5ii(a, b, c, d, x, s, t) {\n  return md5cmn(c ^ (b | ~d), a, b, x, s, t);\n}\n\nexport default md5;","import v35 from './v35.js';\nimport md5 from './md5.js';\nconst v3 = v35('v3', 0x30, md5);\nexport default v3;","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default {\n  randomUUID\n};","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  if (native.randomUUID && !buf && !options) {\n    return native.randomUUID();\n  }\n\n  options = options || {};\n  const rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (let i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return unsafeStringify(rnds);\n}\n\nexport default v4;","// Adapted from Chris Veness' SHA1 code at\n// http://www.movable-type.co.uk/scripts/sha1.html\nfunction f(s, x, y, z) {\n  switch (s) {\n    case 0:\n      return x & y ^ ~x & z;\n\n    case 1:\n      return x ^ y ^ z;\n\n    case 2:\n      return x & y ^ x & z ^ y & z;\n\n    case 3:\n      return x ^ y ^ z;\n  }\n}\n\nfunction ROTL(x, n) {\n  return x << n | x >>> 32 - n;\n}\n\nfunction sha1(bytes) {\n  const K = [0x5a827999, 0x6ed9eba1, 0x8f1bbcdc, 0xca62c1d6];\n  const H = [0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476, 0xc3d2e1f0];\n\n  if (typeof bytes === 'string') {\n    const msg = unescape(encodeURIComponent(bytes)); // UTF8 escape\n\n    bytes = [];\n\n    for (let i = 0; i < msg.length; ++i) {\n      bytes.push(msg.charCodeAt(i));\n    }\n  } else if (!Array.isArray(bytes)) {\n    // Convert Array-like to Array\n    bytes = Array.prototype.slice.call(bytes);\n  }\n\n  bytes.push(0x80);\n  const l = bytes.length / 4 + 2;\n  const N = Math.ceil(l / 16);\n  const M = new Array(N);\n\n  for (let i = 0; i < N; ++i) {\n    const arr = new Uint32Array(16);\n\n    for (let j = 0; j < 16; ++j) {\n      arr[j] = bytes[i * 64 + j * 4] << 24 | bytes[i * 64 + j * 4 + 1] << 16 | bytes[i * 64 + j * 4 + 2] << 8 | bytes[i * 64 + j * 4 + 3];\n    }\n\n    M[i] = arr;\n  }\n\n  M[N - 1][14] = (bytes.length - 1) * 8 / Math.pow(2, 32);\n  M[N - 1][14] = Math.floor(M[N - 1][14]);\n  M[N - 1][15] = (bytes.length - 1) * 8 & 0xffffffff;\n\n  for (let i = 0; i < N; ++i) {\n    const W = new Uint32Array(80);\n\n    for (let t = 0; t < 16; ++t) {\n      W[t] = M[i][t];\n    }\n\n    for (let t = 16; t < 80; ++t) {\n      W[t] = ROTL(W[t - 3] ^ W[t - 8] ^ W[t - 14] ^ W[t - 16], 1);\n    }\n\n    let a = H[0];\n    let b = H[1];\n    let c = H[2];\n    let d = H[3];\n    let e = H[4];\n\n    for (let t = 0; t < 80; ++t) {\n      const s = Math.floor(t / 20);\n      const T = ROTL(a, 5) + f(s, b, c, d) + e + K[s] + W[t] >>> 0;\n      e = d;\n      d = c;\n      c = ROTL(b, 30) >>> 0;\n      b = a;\n      a = T;\n    }\n\n    H[0] = H[0] + a >>> 0;\n    H[1] = H[1] + b >>> 0;\n    H[2] = H[2] + c >>> 0;\n    H[3] = H[3] + d >>> 0;\n    H[4] = H[4] + e >>> 0;\n  }\n\n  return [H[0] >> 24 & 0xff, H[0] >> 16 & 0xff, H[0] >> 8 & 0xff, H[0] & 0xff, H[1] >> 24 & 0xff, H[1] >> 16 & 0xff, H[1] >> 8 & 0xff, H[1] & 0xff, H[2] >> 24 & 0xff, H[2] >> 16 & 0xff, H[2] >> 8 & 0xff, H[2] & 0xff, H[3] >> 24 & 0xff, H[3] >> 16 & 0xff, H[3] >> 8 & 0xff, H[3] & 0xff, H[4] >> 24 & 0xff, H[4] >> 16 & 0xff, H[4] >> 8 & 0xff, H[4] & 0xff];\n}\n\nexport default sha1;","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}","import toPropertyKey from \"./toPropertyKey.js\";\nexport default function _defineProperty(obj, key, value) {\n  key = toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}","import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nexport default function _toPropertyKey(arg) {\n  var key = toPrimitive(arg, \"string\");\n  return _typeof(key) === \"symbol\" ? key : String(key);\n}","import _typeof from \"./typeof.js\";\nexport default function _toPrimitive(input, hint) {\n  if (_typeof(input) !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (_typeof(res) !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}","import defineProperty from \"./defineProperty.js\";\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nexport default function _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}","import _objectSpread from '@babel/runtime/helpers/esm/objectSpread2';\n\n/**\n * Adapted from React: https://github.com/facebook/react/blob/master/packages/shared/formatProdErrorMessage.js\n *\n * Do not require this module directly! Use normal throw error calls. These messages will be replaced with error codes\n * during build.\n * @param {number} code\n */\nfunction formatProdErrorMessage(code) {\n  return \"Minified Redux error #\" + code + \"; visit https://redux.js.org/Errors?code=\" + code + \" for the full message or \" + 'use the non-minified dev environment for full errors. ';\n}\n\n// Inlined version of the `symbol-observable` polyfill\nvar $$observable = (function () {\n  return typeof Symbol === 'function' && Symbol.observable || '@@observable';\n})();\n\n/**\n * These are private action types reserved by Redux.\n * For any unknown actions, you must return the current state.\n * If the current state is undefined, you must return the initial state.\n * Do not reference these action types directly in your code.\n */\nvar randomString = function randomString() {\n  return Math.random().toString(36).substring(7).split('').join('.');\n};\n\nvar ActionTypes = {\n  INIT: \"@@redux/INIT\" + randomString(),\n  REPLACE: \"@@redux/REPLACE\" + randomString(),\n  PROBE_UNKNOWN_ACTION: function PROBE_UNKNOWN_ACTION() {\n    return \"@@redux/PROBE_UNKNOWN_ACTION\" + randomString();\n  }\n};\n\n/**\n * @param {any} obj The object to inspect.\n * @returns {boolean} True if the argument appears to be a plain object.\n */\nfunction isPlainObject(obj) {\n  if (typeof obj !== 'object' || obj === null) return false;\n  var proto = obj;\n\n  while (Object.getPrototypeOf(proto) !== null) {\n    proto = Object.getPrototypeOf(proto);\n  }\n\n  return Object.getPrototypeOf(obj) === proto;\n}\n\n// Inlined / shortened version of `kindOf` from https://github.com/jonschlinkert/kind-of\nfunction miniKindOf(val) {\n  if (val === void 0) return 'undefined';\n  if (val === null) return 'null';\n  var type = typeof val;\n\n  switch (type) {\n    case 'boolean':\n    case 'string':\n    case 'number':\n    case 'symbol':\n    case 'function':\n      {\n        return type;\n      }\n  }\n\n  if (Array.isArray(val)) return 'array';\n  if (isDate(val)) return 'date';\n  if (isError(val)) return 'error';\n  var constructorName = ctorName(val);\n\n  switch (constructorName) {\n    case 'Symbol':\n    case 'Promise':\n    case 'WeakMap':\n    case 'WeakSet':\n    case 'Map':\n    case 'Set':\n      return constructorName;\n  } // other\n\n\n  return type.slice(8, -1).toLowerCase().replace(/\\s/g, '');\n}\n\nfunction ctorName(val) {\n  return typeof val.constructor === 'function' ? val.constructor.name : null;\n}\n\nfunction isError(val) {\n  return val instanceof Error || typeof val.message === 'string' && val.constructor && typeof val.constructor.stackTraceLimit === 'number';\n}\n\nfunction isDate(val) {\n  if (val instanceof Date) return true;\n  return typeof val.toDateString === 'function' && typeof val.getDate === 'function' && typeof val.setDate === 'function';\n}\n\nfunction kindOf(val) {\n  var typeOfVal = typeof val;\n\n  if (process.env.NODE_ENV !== 'production') {\n    typeOfVal = miniKindOf(val);\n  }\n\n  return typeOfVal;\n}\n\n/**\n * @deprecated\n *\n * **We recommend using the `configureStore` method\n * of the `@reduxjs/toolkit` package**, which replaces `createStore`.\n *\n * Redux Toolkit is our recommended approach for writing Redux logic today,\n * including store setup, reducers, data fetching, and more.\n *\n * **For more details, please read this Redux docs page:**\n * **https://redux.js.org/introduction/why-rtk-is-redux-today**\n *\n * `configureStore` from Redux Toolkit is an improved version of `createStore` that\n * simplifies setup and helps avoid common bugs.\n *\n * You should not be using the `redux` core package by itself today, except for learning purposes.\n * The `createStore` method from the core `redux` package will not be removed, but we encourage\n * all users to migrate to using Redux Toolkit for all Redux code.\n *\n * If you want to use `createStore` without this visual deprecation warning, use\n * the `legacy_createStore` import instead:\n *\n * `import { legacy_createStore as createStore} from 'redux'`\n *\n */\n\nfunction createStore(reducer, preloadedState, enhancer) {\n  var _ref2;\n\n  if (typeof preloadedState === 'function' && typeof enhancer === 'function' || typeof enhancer === 'function' && typeof arguments[3] === 'function') {\n    throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(0) : 'It looks like you are passing several store enhancers to ' + 'createStore(). This is not supported. Instead, compose them ' + 'together to a single function. See https://redux.js.org/tutorials/fundamentals/part-4-store#creating-a-store-with-enhancers for an example.');\n  }\n\n  if (typeof preloadedState === 'function' && typeof enhancer === 'undefined') {\n    enhancer = preloadedState;\n    preloadedState = undefined;\n  }\n\n  if (typeof enhancer !== 'undefined') {\n    if (typeof enhancer !== 'function') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(1) : \"Expected the enhancer to be a function. Instead, received: '\" + kindOf(enhancer) + \"'\");\n    }\n\n    return enhancer(createStore)(reducer, preloadedState);\n  }\n\n  if (typeof reducer !== 'function') {\n    throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(2) : \"Expected the root reducer to be a function. Instead, received: '\" + kindOf(reducer) + \"'\");\n  }\n\n  var currentReducer = reducer;\n  var currentState = preloadedState;\n  var currentListeners = [];\n  var nextListeners = currentListeners;\n  var isDispatching = false;\n  /**\n   * This makes a shallow copy of currentListeners so we can use\n   * nextListeners as a temporary list while dispatching.\n   *\n   * This prevents any bugs around consumers calling\n   * subscribe/unsubscribe in the middle of a dispatch.\n   */\n\n  function ensureCanMutateNextListeners() {\n    if (nextListeners === currentListeners) {\n      nextListeners = currentListeners.slice();\n    }\n  }\n  /**\n   * Reads the state tree managed by the store.\n   *\n   * @returns {any} The current state tree of your application.\n   */\n\n\n  function getState() {\n    if (isDispatching) {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(3) : 'You may not call store.getState() while the reducer is executing. ' + 'The reducer has already received the state as an argument. ' + 'Pass it down from the top reducer instead of reading it from the store.');\n    }\n\n    return currentState;\n  }\n  /**\n   * Adds a change listener. It will be called any time an action is dispatched,\n   * and some part of the state tree may potentially have changed. You may then\n   * call `getState()` to read the current state tree inside the callback.\n   *\n   * You may call `dispatch()` from a change listener, with the following\n   * caveats:\n   *\n   * 1. The subscriptions are snapshotted just before every `dispatch()` call.\n   * If you subscribe or unsubscribe while the listeners are being invoked, this\n   * will not have any effect on the `dispatch()` that is currently in progress.\n   * However, the next `dispatch()` call, whether nested or not, will use a more\n   * recent snapshot of the subscription list.\n   *\n   * 2. The listener should not expect to see all state changes, as the state\n   * might have been updated multiple times during a nested `dispatch()` before\n   * the listener is called. It is, however, guaranteed that all subscribers\n   * registered before the `dispatch()` started will be called with the latest\n   * state by the time it exits.\n   *\n   * @param {Function} listener A callback to be invoked on every dispatch.\n   * @returns {Function} A function to remove this change listener.\n   */\n\n\n  function subscribe(listener) {\n    if (typeof listener !== 'function') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(4) : \"Expected the listener to be a function. Instead, received: '\" + kindOf(listener) + \"'\");\n    }\n\n    if (isDispatching) {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(5) : 'You may not call store.subscribe() while the reducer is executing. ' + 'If you would like to be notified after the store has been updated, subscribe from a ' + 'component and invoke store.getState() in the callback to access the latest state. ' + 'See https://redux.js.org/api/store#subscribelistener for more details.');\n    }\n\n    var isSubscribed = true;\n    ensureCanMutateNextListeners();\n    nextListeners.push(listener);\n    return function unsubscribe() {\n      if (!isSubscribed) {\n        return;\n      }\n\n      if (isDispatching) {\n        throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(6) : 'You may not unsubscribe from a store listener while the reducer is executing. ' + 'See https://redux.js.org/api/store#subscribelistener for more details.');\n      }\n\n      isSubscribed = false;\n      ensureCanMutateNextListeners();\n      var index = nextListeners.indexOf(listener);\n      nextListeners.splice(index, 1);\n      currentListeners = null;\n    };\n  }\n  /**\n   * Dispatches an action. It is the only way to trigger a state change.\n   *\n   * The `reducer` function, used to create the store, will be called with the\n   * current state tree and the given `action`. Its return value will\n   * be considered the **next** state of the tree, and the change listeners\n   * will be notified.\n   *\n   * The base implementation only supports plain object actions. If you want to\n   * dispatch a Promise, an Observable, a thunk, or something else, you need to\n   * wrap your store creating function into the corresponding middleware. For\n   * example, see the documentation for the `redux-thunk` package. Even the\n   * middleware will eventually dispatch plain object actions using this method.\n   *\n   * @param {Object} action A plain object representing “what changed”. It is\n   * a good idea to keep actions serializable so you can record and replay user\n   * sessions, or use the time travelling `redux-devtools`. An action must have\n   * a `type` property which may not be `undefined`. It is a good idea to use\n   * string constants for action types.\n   *\n   * @returns {Object} For convenience, the same action object you dispatched.\n   *\n   * Note that, if you use a custom middleware, it may wrap `dispatch()` to\n   * return something else (for example, a Promise you can await).\n   */\n\n\n  function dispatch(action) {\n    if (!isPlainObject(action)) {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(7) : \"Actions must be plain objects. Instead, the actual type was: '\" + kindOf(action) + \"'. You may need to add middleware to your store setup to handle dispatching other values, such as 'redux-thunk' to handle dispatching functions. See https://redux.js.org/tutorials/fundamentals/part-4-store#middleware and https://redux.js.org/tutorials/fundamentals/part-6-async-logic#using-the-redux-thunk-middleware for examples.\");\n    }\n\n    if (typeof action.type === 'undefined') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(8) : 'Actions may not have an undefined \"type\" property. You may have misspelled an action type string constant.');\n    }\n\n    if (isDispatching) {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(9) : 'Reducers may not dispatch actions.');\n    }\n\n    try {\n      isDispatching = true;\n      currentState = currentReducer(currentState, action);\n    } finally {\n      isDispatching = false;\n    }\n\n    var listeners = currentListeners = nextListeners;\n\n    for (var i = 0; i < listeners.length; i++) {\n      var listener = listeners[i];\n      listener();\n    }\n\n    return action;\n  }\n  /**\n   * Replaces the reducer currently used by the store to calculate the state.\n   *\n   * You might need this if your app implements code splitting and you want to\n   * load some of the reducers dynamically. You might also need this if you\n   * implement a hot reloading mechanism for Redux.\n   *\n   * @param {Function} nextReducer The reducer for the store to use instead.\n   * @returns {void}\n   */\n\n\n  function replaceReducer(nextReducer) {\n    if (typeof nextReducer !== 'function') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(10) : \"Expected the nextReducer to be a function. Instead, received: '\" + kindOf(nextReducer));\n    }\n\n    currentReducer = nextReducer; // This action has a similiar effect to ActionTypes.INIT.\n    // Any reducers that existed in both the new and old rootReducer\n    // will receive the previous state. This effectively populates\n    // the new state tree with any relevant data from the old one.\n\n    dispatch({\n      type: ActionTypes.REPLACE\n    });\n  }\n  /**\n   * Interoperability point for observable/reactive libraries.\n   * @returns {observable} A minimal observable of state changes.\n   * For more information, see the observable proposal:\n   * https://github.com/tc39/proposal-observable\n   */\n\n\n  function observable() {\n    var _ref;\n\n    var outerSubscribe = subscribe;\n    return _ref = {\n      /**\n       * The minimal observable subscription method.\n       * @param {Object} observer Any object that can be used as an observer.\n       * The observer object should have a `next` method.\n       * @returns {subscription} An object with an `unsubscribe` method that can\n       * be used to unsubscribe the observable from the store, and prevent further\n       * emission of values from the observable.\n       */\n      subscribe: function subscribe(observer) {\n        if (typeof observer !== 'object' || observer === null) {\n          throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(11) : \"Expected the observer to be an object. Instead, received: '\" + kindOf(observer) + \"'\");\n        }\n\n        function observeState() {\n          if (observer.next) {\n            observer.next(getState());\n          }\n        }\n\n        observeState();\n        var unsubscribe = outerSubscribe(observeState);\n        return {\n          unsubscribe: unsubscribe\n        };\n      }\n    }, _ref[$$observable] = function () {\n      return this;\n    }, _ref;\n  } // When a store is created, an \"INIT\" action is dispatched so that every\n  // reducer returns their initial state. This effectively populates\n  // the initial state tree.\n\n\n  dispatch({\n    type: ActionTypes.INIT\n  });\n  return _ref2 = {\n    dispatch: dispatch,\n    subscribe: subscribe,\n    getState: getState,\n    replaceReducer: replaceReducer\n  }, _ref2[$$observable] = observable, _ref2;\n}\n/**\n * Creates a Redux store that holds the state tree.\n *\n * **We recommend using `configureStore` from the\n * `@reduxjs/toolkit` package**, which replaces `createStore`:\n * **https://redux.js.org/introduction/why-rtk-is-redux-today**\n *\n * The only way to change the data in the store is to call `dispatch()` on it.\n *\n * There should only be a single store in your app. To specify how different\n * parts of the state tree respond to actions, you may combine several reducers\n * into a single reducer function by using `combineReducers`.\n *\n * @param {Function} reducer A function that returns the next state tree, given\n * the current state tree and the action to handle.\n *\n * @param {any} [preloadedState] The initial state. You may optionally specify it\n * to hydrate the state from the server in universal apps, or to restore a\n * previously serialized user session.\n * If you use `combineReducers` to produce the root reducer function, this must be\n * an object with the same shape as `combineReducers` keys.\n *\n * @param {Function} [enhancer] The store enhancer. You may optionally specify it\n * to enhance the store with third-party capabilities such as middleware,\n * time travel, persistence, etc. The only store enhancer that ships with Redux\n * is `applyMiddleware()`.\n *\n * @returns {Store} A Redux store that lets you read the state, dispatch actions\n * and subscribe to changes.\n */\n\nvar legacy_createStore = createStore;\n\n/**\n * Prints a warning in the console if it exists.\n *\n * @param {String} message The warning message.\n * @returns {void}\n */\nfunction warning(message) {\n  /* eslint-disable no-console */\n  if (typeof console !== 'undefined' && typeof console.error === 'function') {\n    console.error(message);\n  }\n  /* eslint-enable no-console */\n\n\n  try {\n    // This error was thrown as a convenience so that if you enable\n    // \"break on all exceptions\" in your console,\n    // it would pause the execution at this line.\n    throw new Error(message);\n  } catch (e) {} // eslint-disable-line no-empty\n\n}\n\nfunction getUnexpectedStateShapeWarningMessage(inputState, reducers, action, unexpectedKeyCache) {\n  var reducerKeys = Object.keys(reducers);\n  var argumentName = action && action.type === ActionTypes.INIT ? 'preloadedState argument passed to createStore' : 'previous state received by the reducer';\n\n  if (reducerKeys.length === 0) {\n    return 'Store does not have a valid reducer. Make sure the argument passed ' + 'to combineReducers is an object whose values are reducers.';\n  }\n\n  if (!isPlainObject(inputState)) {\n    return \"The \" + argumentName + \" has unexpected type of \\\"\" + kindOf(inputState) + \"\\\". Expected argument to be an object with the following \" + (\"keys: \\\"\" + reducerKeys.join('\", \"') + \"\\\"\");\n  }\n\n  var unexpectedKeys = Object.keys(inputState).filter(function (key) {\n    return !reducers.hasOwnProperty(key) && !unexpectedKeyCache[key];\n  });\n  unexpectedKeys.forEach(function (key) {\n    unexpectedKeyCache[key] = true;\n  });\n  if (action && action.type === ActionTypes.REPLACE) return;\n\n  if (unexpectedKeys.length > 0) {\n    return \"Unexpected \" + (unexpectedKeys.length > 1 ? 'keys' : 'key') + \" \" + (\"\\\"\" + unexpectedKeys.join('\", \"') + \"\\\" found in \" + argumentName + \". \") + \"Expected to find one of the known reducer keys instead: \" + (\"\\\"\" + reducerKeys.join('\", \"') + \"\\\". Unexpected keys will be ignored.\");\n  }\n}\n\nfunction assertReducerShape(reducers) {\n  Object.keys(reducers).forEach(function (key) {\n    var reducer = reducers[key];\n    var initialState = reducer(undefined, {\n      type: ActionTypes.INIT\n    });\n\n    if (typeof initialState === 'undefined') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(12) : \"The slice reducer for key \\\"\" + key + \"\\\" returned undefined during initialization. \" + \"If the state passed to the reducer is undefined, you must \" + \"explicitly return the initial state. The initial state may \" + \"not be undefined. If you don't want to set a value for this reducer, \" + \"you can use null instead of undefined.\");\n    }\n\n    if (typeof reducer(undefined, {\n      type: ActionTypes.PROBE_UNKNOWN_ACTION()\n    }) === 'undefined') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(13) : \"The slice reducer for key \\\"\" + key + \"\\\" returned undefined when probed with a random type. \" + (\"Don't try to handle '\" + ActionTypes.INIT + \"' or other actions in \\\"redux/*\\\" \") + \"namespace. They are considered private. Instead, you must return the \" + \"current state for any unknown actions, unless it is undefined, \" + \"in which case you must return the initial state, regardless of the \" + \"action type. The initial state may not be undefined, but can be null.\");\n    }\n  });\n}\n/**\n * Turns an object whose values are different reducer functions, into a single\n * reducer function. It will call every child reducer, and gather their results\n * into a single state object, whose keys correspond to the keys of the passed\n * reducer functions.\n *\n * @param {Object} reducers An object whose values correspond to different\n * reducer functions that need to be combined into one. One handy way to obtain\n * it is to use ES6 `import * as reducers` syntax. The reducers may never return\n * undefined for any action. Instead, they should return their initial state\n * if the state passed to them was undefined, and the current state for any\n * unrecognized action.\n *\n * @returns {Function} A reducer function that invokes every reducer inside the\n * passed object, and builds a state object with the same shape.\n */\n\n\nfunction combineReducers(reducers) {\n  var reducerKeys = Object.keys(reducers);\n  var finalReducers = {};\n\n  for (var i = 0; i < reducerKeys.length; i++) {\n    var key = reducerKeys[i];\n\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof reducers[key] === 'undefined') {\n        warning(\"No reducer provided for key \\\"\" + key + \"\\\"\");\n      }\n    }\n\n    if (typeof reducers[key] === 'function') {\n      finalReducers[key] = reducers[key];\n    }\n  }\n\n  var finalReducerKeys = Object.keys(finalReducers); // This is used to make sure we don't warn about the same\n  // keys multiple times.\n\n  var unexpectedKeyCache;\n\n  if (process.env.NODE_ENV !== 'production') {\n    unexpectedKeyCache = {};\n  }\n\n  var shapeAssertionError;\n\n  try {\n    assertReducerShape(finalReducers);\n  } catch (e) {\n    shapeAssertionError = e;\n  }\n\n  return function combination(state, action) {\n    if (state === void 0) {\n      state = {};\n    }\n\n    if (shapeAssertionError) {\n      throw shapeAssertionError;\n    }\n\n    if (process.env.NODE_ENV !== 'production') {\n      var warningMessage = getUnexpectedStateShapeWarningMessage(state, finalReducers, action, unexpectedKeyCache);\n\n      if (warningMessage) {\n        warning(warningMessage);\n      }\n    }\n\n    var hasChanged = false;\n    var nextState = {};\n\n    for (var _i = 0; _i < finalReducerKeys.length; _i++) {\n      var _key = finalReducerKeys[_i];\n      var reducer = finalReducers[_key];\n      var previousStateForKey = state[_key];\n      var nextStateForKey = reducer(previousStateForKey, action);\n\n      if (typeof nextStateForKey === 'undefined') {\n        var actionType = action && action.type;\n        throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(14) : \"When called with an action of type \" + (actionType ? \"\\\"\" + String(actionType) + \"\\\"\" : '(unknown type)') + \", the slice reducer for key \\\"\" + _key + \"\\\" returned undefined. \" + \"To ignore an action, you must explicitly return the previous state. \" + \"If you want this reducer to hold no value, you can return null instead of undefined.\");\n      }\n\n      nextState[_key] = nextStateForKey;\n      hasChanged = hasChanged || nextStateForKey !== previousStateForKey;\n    }\n\n    hasChanged = hasChanged || finalReducerKeys.length !== Object.keys(state).length;\n    return hasChanged ? nextState : state;\n  };\n}\n\nfunction bindActionCreator(actionCreator, dispatch) {\n  return function () {\n    return dispatch(actionCreator.apply(this, arguments));\n  };\n}\n/**\n * Turns an object whose values are action creators, into an object with the\n * same keys, but with every function wrapped into a `dispatch` call so they\n * may be invoked directly. This is just a convenience method, as you can call\n * `store.dispatch(MyActionCreators.doSomething())` yourself just fine.\n *\n * For convenience, you can also pass an action creator as the first argument,\n * and get a dispatch wrapped function in return.\n *\n * @param {Function|Object} actionCreators An object whose values are action\n * creator functions. One handy way to obtain it is to use ES6 `import * as`\n * syntax. You may also pass a single function.\n *\n * @param {Function} dispatch The `dispatch` function available on your Redux\n * store.\n *\n * @returns {Function|Object} The object mimicking the original object, but with\n * every action creator wrapped into the `dispatch` call. If you passed a\n * function as `actionCreators`, the return value will also be a single\n * function.\n */\n\n\nfunction bindActionCreators(actionCreators, dispatch) {\n  if (typeof actionCreators === 'function') {\n    return bindActionCreator(actionCreators, dispatch);\n  }\n\n  if (typeof actionCreators !== 'object' || actionCreators === null) {\n    throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(16) : \"bindActionCreators expected an object or a function, but instead received: '\" + kindOf(actionCreators) + \"'. \" + \"Did you write \\\"import ActionCreators from\\\" instead of \\\"import * as ActionCreators from\\\"?\");\n  }\n\n  var boundActionCreators = {};\n\n  for (var key in actionCreators) {\n    var actionCreator = actionCreators[key];\n\n    if (typeof actionCreator === 'function') {\n      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch);\n    }\n  }\n\n  return boundActionCreators;\n}\n\n/**\n * Composes single-argument functions from right to left. The rightmost\n * function can take multiple arguments as it provides the signature for\n * the resulting composite function.\n *\n * @param {...Function} funcs The functions to compose.\n * @returns {Function} A function obtained by composing the argument functions\n * from right to left. For example, compose(f, g, h) is identical to doing\n * (...args) => f(g(h(...args))).\n */\nfunction compose() {\n  for (var _len = arguments.length, funcs = new Array(_len), _key = 0; _key < _len; _key++) {\n    funcs[_key] = arguments[_key];\n  }\n\n  if (funcs.length === 0) {\n    return function (arg) {\n      return arg;\n    };\n  }\n\n  if (funcs.length === 1) {\n    return funcs[0];\n  }\n\n  return funcs.reduce(function (a, b) {\n    return function () {\n      return a(b.apply(void 0, arguments));\n    };\n  });\n}\n\n/**\n * Creates a store enhancer that applies middleware to the dispatch method\n * of the Redux store. This is handy for a variety of tasks, such as expressing\n * asynchronous actions in a concise manner, or logging every action payload.\n *\n * See `redux-thunk` package as an example of the Redux middleware.\n *\n * Because middleware is potentially asynchronous, this should be the first\n * store enhancer in the composition chain.\n *\n * Note that each middleware will be given the `dispatch` and `getState` functions\n * as named arguments.\n *\n * @param {...Function} middlewares The middleware chain to be applied.\n * @returns {Function} A store enhancer applying the middleware.\n */\n\nfunction applyMiddleware() {\n  for (var _len = arguments.length, middlewares = new Array(_len), _key = 0; _key < _len; _key++) {\n    middlewares[_key] = arguments[_key];\n  }\n\n  return function (createStore) {\n    return function () {\n      var store = createStore.apply(void 0, arguments);\n\n      var _dispatch = function dispatch() {\n        throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(15) : 'Dispatching while constructing your middleware is not allowed. ' + 'Other middleware would not be applied to this dispatch.');\n      };\n\n      var middlewareAPI = {\n        getState: store.getState,\n        dispatch: function dispatch() {\n          return _dispatch.apply(void 0, arguments);\n        }\n      };\n      var chain = middlewares.map(function (middleware) {\n        return middleware(middlewareAPI);\n      });\n      _dispatch = compose.apply(void 0, chain)(store.dispatch);\n      return _objectSpread(_objectSpread({}, store), {}, {\n        dispatch: _dispatch\n      });\n    };\n  };\n}\n\nexport { ActionTypes as __DO_NOT_USE__ActionTypes, applyMiddleware, bindActionCreators, combineReducers, compose, createStore, legacy_createStore };\n","import v35 from './v35.js';\nimport sha1 from './sha1.js';\nconst v5 = v35('v5', 0x50, sha1);\nexport default v5;","var createSymbol = function createSymbol(name) {\n  return \"@@redux-saga/\" + name;\n};\n\nvar CANCEL =\n/*#__PURE__*/\ncreateSymbol('CANCEL_PROMISE');\nvar CHANNEL_END_TYPE =\n/*#__PURE__*/\ncreateSymbol('CHANNEL_END');\nvar IO =\n/*#__PURE__*/\ncreateSymbol('IO');\nvar MATCH =\n/*#__PURE__*/\ncreateSymbol('MATCH');\nvar MULTICAST =\n/*#__PURE__*/\ncreateSymbol('MULTICAST');\nvar SAGA_ACTION =\n/*#__PURE__*/\ncreateSymbol('SAGA_ACTION');\nvar SELF_CANCELLATION =\n/*#__PURE__*/\ncreateSymbol('SELF_CANCELLATION');\nvar TASK =\n/*#__PURE__*/\ncreateSymbol('TASK');\nvar TASK_CANCEL =\n/*#__PURE__*/\ncreateSymbol('TASK_CANCEL');\nvar TERMINATE =\n/*#__PURE__*/\ncreateSymbol('TERMINATE');\nvar SAGA_LOCATION =\n/*#__PURE__*/\ncreateSymbol('LOCATION');\n\nexport { CANCEL, CHANNEL_END_TYPE, IO, MATCH, MULTICAST, SAGA_ACTION, SAGA_LOCATION, SELF_CANCELLATION, TASK, TASK_CANCEL, TERMINATE };\n","export default function _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}","import { TASK, SAGA_ACTION, MULTICAST, IO } from '@redux-saga/symbols';\n\nvar undef = function undef(v) {\n  return v === null || v === undefined;\n};\nvar notUndef = function notUndef(v) {\n  return v !== null && v !== undefined;\n};\nvar func = function func(f) {\n  return typeof f === 'function';\n};\nvar number = function number(n) {\n  return typeof n === 'number';\n};\nvar string = function string(s) {\n  return typeof s === 'string';\n};\nvar array = Array.isArray;\nvar object = function object(obj) {\n  return obj && !array(obj) && typeof obj === 'object';\n};\nvar promise = function promise(p) {\n  return p && func(p.then);\n};\nvar iterator = function iterator(it) {\n  return it && func(it.next) && func(it.throw);\n};\nvar iterable = function iterable(it) {\n  return it && func(Symbol) ? func(it[Symbol.iterator]) : array(it);\n};\nvar task = function task(t) {\n  return t && t[TASK];\n};\nvar sagaAction = function sagaAction(a) {\n  return Boolean(a && a[SAGA_ACTION]);\n};\nvar observable = function observable(ob) {\n  return ob && func(ob.subscribe);\n};\nvar buffer = function buffer(buf) {\n  return buf && func(buf.isEmpty) && func(buf.take) && func(buf.put);\n};\nvar pattern = function pattern(pat) {\n  return pat && (string(pat) || symbol(pat) || func(pat) || array(pat) && pat.every(pattern));\n};\nvar channel = function channel(ch) {\n  return ch && func(ch.take) && func(ch.close);\n};\nvar stringableFunc = function stringableFunc(f) {\n  return func(f) && f.hasOwnProperty('toString');\n};\nvar symbol = function symbol(sym) {\n  return Boolean(sym) && typeof Symbol === 'function' && sym.constructor === Symbol && sym !== Symbol.prototype;\n};\nvar multicast = function multicast(ch) {\n  return channel(ch) && ch[MULTICAST];\n};\nvar effect = function effect(eff) {\n  return eff && eff[IO];\n};\n\nexport { array, buffer, channel, effect, func, iterable, iterator, multicast, notUndef, number, object, observable, pattern, promise, sagaAction, string, stringableFunc, symbol, task, undef };\n","import { TASK_CANCEL, TERMINATE, SAGA_LOCATION, SAGA_ACTION, IO, SELF_CANCELLATION } from '@redux-saga/symbols';\nimport _extends from '@babel/runtime/helpers/esm/extends';\nimport { array, notUndef, pattern, multicast, channel, undef, effect, task, func, buffer, string, object } from '@redux-saga/is';\nimport delayP from '@redux-saga/delay-p';\n\nvar konst = function konst(v) {\n  return function () {\n    return v;\n  };\n};\nvar kTrue =\n/*#__PURE__*/\nkonst(true);\n\nvar noop = function noop() {};\n\nif (process.env.NODE_ENV !== 'production' && typeof Proxy !== 'undefined') {\n  noop =\n  /*#__PURE__*/\n  new Proxy(noop, {\n    set: function set() {\n      throw internalErr('There was an attempt to assign a property to internal `noop` function.');\n    }\n  });\n}\nvar identity = function identity(v) {\n  return v;\n};\nvar hasSymbol = typeof Symbol === 'function';\nvar asyncIteratorSymbol = hasSymbol && Symbol.asyncIterator ? Symbol.asyncIterator : '@@asyncIterator';\nfunction check(value, predicate, error) {\n  if (!predicate(value)) {\n    throw new Error(error);\n  }\n}\nvar assignWithSymbols = function assignWithSymbols(target, source) {\n  _extends(target, source);\n\n  if (Object.getOwnPropertySymbols) {\n    Object.getOwnPropertySymbols(source).forEach(function (s) {\n      target[s] = source[s];\n    });\n  }\n};\nvar flatMap = function flatMap(mapper, arr) {\n  var _ref;\n\n  return (_ref = []).concat.apply(_ref, arr.map(mapper));\n};\nfunction remove(array, item) {\n  var index = array.indexOf(item);\n\n  if (index >= 0) {\n    array.splice(index, 1);\n  }\n}\nfunction once(fn) {\n  var called = false;\n  return function () {\n    if (called) {\n      return;\n    }\n\n    called = true;\n    fn();\n  };\n}\n\nvar kThrow = function kThrow(err) {\n  throw err;\n};\n\nvar kReturn = function kReturn(value) {\n  return {\n    value: value,\n    done: true\n  };\n};\n\nfunction makeIterator(next, thro, name) {\n  if (thro === void 0) {\n    thro = kThrow;\n  }\n\n  if (name === void 0) {\n    name = 'iterator';\n  }\n\n  var iterator = {\n    meta: {\n      name: name\n    },\n    next: next,\n    throw: thro,\n    return: kReturn,\n    isSagaIterator: true\n  };\n\n  if (typeof Symbol !== 'undefined') {\n    iterator[Symbol.iterator] = function () {\n      return iterator;\n    };\n  }\n\n  return iterator;\n}\nfunction logError(error, _ref2) {\n  var sagaStack = _ref2.sagaStack;\n\n  /*eslint-disable no-console*/\n  console.error(error);\n  console.error(sagaStack);\n}\nvar internalErr = function internalErr(err) {\n  return new Error(\"\\n  redux-saga: Error checking hooks detected an inconsistent state. This is likely a bug\\n  in redux-saga code and not yours. Thanks for reporting this in the project's github repo.\\n  Error: \" + err + \"\\n\");\n};\nvar createSetContextWarning = function createSetContextWarning(ctx, props) {\n  return (ctx ? ctx + '.' : '') + \"setContext(props): argument \" + props + \" is not a plain object\";\n};\nvar FROZEN_ACTION_ERROR = \"You can't put (a.k.a. dispatch from saga) frozen actions.\\nWe have to define a special non-enumerable property on those actions for scheduling purposes.\\nOtherwise you wouldn't be able to communicate properly between sagas & other subscribers (action ordering would become far less predictable).\\nIf you are using redux and you care about this behaviour (frozen actions),\\nthen you might want to switch to freezing actions in a middleware rather than in action creator.\\nExample implementation:\\n\\nconst freezeActions = store => next => action => next(Object.freeze(action))\\n\"; // creates empty, but not-holey array\n\nvar createEmptyArray = function createEmptyArray(n) {\n  return Array.apply(null, new Array(n));\n};\nvar wrapSagaDispatch = function wrapSagaDispatch(dispatch) {\n  return function (action) {\n    if (process.env.NODE_ENV !== 'production') {\n      check(action, function (ac) {\n        return !Object.isFrozen(ac);\n      }, FROZEN_ACTION_ERROR);\n    }\n\n    return dispatch(Object.defineProperty(action, SAGA_ACTION, {\n      value: true\n    }));\n  };\n};\nvar shouldTerminate = function shouldTerminate(res) {\n  return res === TERMINATE;\n};\nvar shouldCancel = function shouldCancel(res) {\n  return res === TASK_CANCEL;\n};\nvar shouldComplete = function shouldComplete(res) {\n  return shouldTerminate(res) || shouldCancel(res);\n};\nfunction createAllStyleChildCallbacks(shape, parentCallback) {\n  var keys = Object.keys(shape);\n  var totalCount = keys.length;\n\n  if (process.env.NODE_ENV !== 'production') {\n    check(totalCount, function (c) {\n      return c > 0;\n    }, 'createAllStyleChildCallbacks: get an empty array or object');\n  }\n\n  var completedCount = 0;\n  var completed;\n  var results = array(shape) ? createEmptyArray(totalCount) : {};\n  var childCallbacks = {};\n\n  function checkEnd() {\n    if (completedCount === totalCount) {\n      completed = true;\n      parentCallback(results);\n    }\n  }\n\n  keys.forEach(function (key) {\n    var chCbAtKey = function chCbAtKey(res, isErr) {\n      if (completed) {\n        return;\n      }\n\n      if (isErr || shouldComplete(res)) {\n        parentCallback.cancel();\n        parentCallback(res, isErr);\n      } else {\n        results[key] = res;\n        completedCount++;\n        checkEnd();\n      }\n    };\n\n    chCbAtKey.cancel = noop;\n    childCallbacks[key] = chCbAtKey;\n  });\n\n  parentCallback.cancel = function () {\n    if (!completed) {\n      completed = true;\n      keys.forEach(function (key) {\n        return childCallbacks[key].cancel();\n      });\n    }\n  };\n\n  return childCallbacks;\n}\nfunction getMetaInfo(fn) {\n  return {\n    name: fn.name || 'anonymous',\n    location: getLocation(fn)\n  };\n}\nfunction getLocation(instrumented) {\n  return instrumented[SAGA_LOCATION];\n}\n\nvar BUFFER_OVERFLOW = \"Channel's Buffer overflow!\";\nvar ON_OVERFLOW_THROW = 1;\nvar ON_OVERFLOW_DROP = 2;\nvar ON_OVERFLOW_SLIDE = 3;\nvar ON_OVERFLOW_EXPAND = 4;\nvar zeroBuffer = {\n  isEmpty: kTrue,\n  put: noop,\n  take: noop\n};\n\nfunction ringBuffer(limit, overflowAction) {\n  if (limit === void 0) {\n    limit = 10;\n  }\n\n  var arr = new Array(limit);\n  var length = 0;\n  var pushIndex = 0;\n  var popIndex = 0;\n\n  var push = function push(it) {\n    arr[pushIndex] = it;\n    pushIndex = (pushIndex + 1) % limit;\n    length++;\n  };\n\n  var take = function take() {\n    if (length != 0) {\n      var it = arr[popIndex];\n      arr[popIndex] = null;\n      length--;\n      popIndex = (popIndex + 1) % limit;\n      return it;\n    }\n  };\n\n  var flush = function flush() {\n    var items = [];\n\n    while (length) {\n      items.push(take());\n    }\n\n    return items;\n  };\n\n  return {\n    isEmpty: function isEmpty() {\n      return length == 0;\n    },\n    put: function put(it) {\n      if (length < limit) {\n        push(it);\n      } else {\n        var doubledLimit;\n\n        switch (overflowAction) {\n          case ON_OVERFLOW_THROW:\n            throw new Error(BUFFER_OVERFLOW);\n\n          case ON_OVERFLOW_SLIDE:\n            arr[pushIndex] = it;\n            pushIndex = (pushIndex + 1) % limit;\n            popIndex = pushIndex;\n            break;\n\n          case ON_OVERFLOW_EXPAND:\n            doubledLimit = 2 * limit;\n            arr = flush();\n            length = arr.length;\n            pushIndex = arr.length;\n            popIndex = 0;\n            arr.length = doubledLimit;\n            limit = doubledLimit;\n            push(it);\n            break;\n\n          default: // DROP\n\n        }\n      }\n    },\n    take: take,\n    flush: flush\n  };\n}\n\nvar none = function none() {\n  return zeroBuffer;\n};\nvar fixed = function fixed(limit) {\n  return ringBuffer(limit, ON_OVERFLOW_THROW);\n};\nvar dropping = function dropping(limit) {\n  return ringBuffer(limit, ON_OVERFLOW_DROP);\n};\nvar sliding = function sliding(limit) {\n  return ringBuffer(limit, ON_OVERFLOW_SLIDE);\n};\nvar expanding = function expanding(initialSize) {\n  return ringBuffer(initialSize, ON_OVERFLOW_EXPAND);\n};\n\nvar buffers = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  none: none,\n  fixed: fixed,\n  dropping: dropping,\n  sliding: sliding,\n  expanding: expanding\n});\n\nvar TAKE = 'TAKE';\nvar PUT = 'PUT';\nvar ALL = 'ALL';\nvar RACE = 'RACE';\nvar CALL = 'CALL';\nvar CPS = 'CPS';\nvar FORK = 'FORK';\nvar JOIN = 'JOIN';\nvar CANCEL = 'CANCEL';\nvar SELECT = 'SELECT';\nvar ACTION_CHANNEL = 'ACTION_CHANNEL';\nvar CANCELLED = 'CANCELLED';\nvar FLUSH = 'FLUSH';\nvar GET_CONTEXT = 'GET_CONTEXT';\nvar SET_CONTEXT = 'SET_CONTEXT';\n\nvar effectTypes = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  TAKE: TAKE,\n  PUT: PUT,\n  ALL: ALL,\n  RACE: RACE,\n  CALL: CALL,\n  CPS: CPS,\n  FORK: FORK,\n  JOIN: JOIN,\n  CANCEL: CANCEL,\n  SELECT: SELECT,\n  ACTION_CHANNEL: ACTION_CHANNEL,\n  CANCELLED: CANCELLED,\n  FLUSH: FLUSH,\n  GET_CONTEXT: GET_CONTEXT,\n  SET_CONTEXT: SET_CONTEXT\n});\n\nvar TEST_HINT = '\\n(HINT: if you are getting these errors in tests, consider using createMockTask from @redux-saga/testing-utils)';\n\nvar makeEffect = function makeEffect(type, payload) {\n  var _ref;\n\n  return _ref = {}, _ref[IO] = true, _ref.combinator = false, _ref.type = type, _ref.payload = payload, _ref;\n};\n\nvar isForkEffect = function isForkEffect(eff) {\n  return effect(eff) && eff.type === FORK;\n};\n\nvar detach = function detach(eff) {\n  if (process.env.NODE_ENV !== 'production') {\n    check(eff, isForkEffect, 'detach(eff): argument must be a fork effect');\n  }\n\n  return makeEffect(FORK, _extends({}, eff.payload, {\n    detached: true\n  }));\n};\nfunction take(patternOrChannel, multicastPattern) {\n  if (patternOrChannel === void 0) {\n    patternOrChannel = '*';\n  }\n\n  if (process.env.NODE_ENV !== 'production' && arguments.length) {\n    check(arguments[0], notUndef, 'take(patternOrChannel): patternOrChannel is undefined');\n  }\n\n  if (pattern(patternOrChannel)) {\n    if (notUndef(multicastPattern)) {\n      /* eslint-disable no-console */\n      console.warn(\"take(pattern) takes one argument but two were provided. Consider passing an array for listening to several action types\");\n    }\n\n    return makeEffect(TAKE, {\n      pattern: patternOrChannel\n    });\n  }\n\n  if (multicast(patternOrChannel) && notUndef(multicastPattern) && pattern(multicastPattern)) {\n    return makeEffect(TAKE, {\n      channel: patternOrChannel,\n      pattern: multicastPattern\n    });\n  }\n\n  if (channel(patternOrChannel)) {\n    if (notUndef(multicastPattern)) {\n      /* eslint-disable no-console */\n      console.warn(\"take(channel) takes one argument but two were provided. Second argument is ignored.\");\n    }\n\n    return makeEffect(TAKE, {\n      channel: patternOrChannel\n    });\n  }\n\n  if (process.env.NODE_ENV !== 'production') {\n    throw new Error(\"take(patternOrChannel): argument \" + patternOrChannel + \" is not valid channel or a valid pattern\");\n  }\n}\nvar takeMaybe = function takeMaybe() {\n  var eff = take.apply(void 0, arguments);\n  eff.payload.maybe = true;\n  return eff;\n};\nfunction put(channel$1, action) {\n  if (process.env.NODE_ENV !== 'production') {\n    if (arguments.length > 1) {\n      check(channel$1, notUndef, 'put(channel, action): argument channel is undefined');\n      check(channel$1, channel, \"put(channel, action): argument \" + channel$1 + \" is not a valid channel\");\n      check(action, notUndef, 'put(channel, action): argument action is undefined');\n    } else {\n      check(channel$1, notUndef, 'put(action): argument action is undefined');\n    }\n  }\n\n  if (undef(action)) {\n    action = channel$1; // `undefined` instead of `null` to make default parameter work\n\n    channel$1 = undefined;\n  }\n\n  return makeEffect(PUT, {\n    channel: channel$1,\n    action: action\n  });\n}\nvar putResolve = function putResolve() {\n  var eff = put.apply(void 0, arguments);\n  eff.payload.resolve = true;\n  return eff;\n};\nfunction all(effects) {\n  var eff = makeEffect(ALL, effects);\n  eff.combinator = true;\n  return eff;\n}\nfunction race(effects) {\n  var eff = makeEffect(RACE, effects);\n  eff.combinator = true;\n  return eff;\n} // this match getFnCallDescriptor logic\n\nvar validateFnDescriptor = function validateFnDescriptor(effectName, fnDescriptor) {\n  check(fnDescriptor, notUndef, effectName + \": argument fn is undefined or null\");\n\n  if (func(fnDescriptor)) {\n    return;\n  }\n\n  var context = null;\n  var fn;\n\n  if (array(fnDescriptor)) {\n    context = fnDescriptor[0];\n    fn = fnDescriptor[1];\n    check(fn, notUndef, effectName + \": argument of type [context, fn] has undefined or null `fn`\");\n  } else if (object(fnDescriptor)) {\n    context = fnDescriptor.context;\n    fn = fnDescriptor.fn;\n    check(fn, notUndef, effectName + \": argument of type {context, fn} has undefined or null `fn`\");\n  } else {\n    check(fnDescriptor, func, effectName + \": argument fn is not function\");\n    return;\n  }\n\n  if (context && string(fn)) {\n    check(context[fn], func, effectName + \": context arguments has no such method - \\\"\" + fn + \"\\\"\");\n    return;\n  }\n\n  check(fn, func, effectName + \": unpacked fn argument (from [context, fn] or {context, fn}) is not a function\");\n};\n\nfunction getFnCallDescriptor(fnDescriptor, args) {\n  var context = null;\n  var fn;\n\n  if (func(fnDescriptor)) {\n    fn = fnDescriptor;\n  } else {\n    if (array(fnDescriptor)) {\n      context = fnDescriptor[0];\n      fn = fnDescriptor[1];\n    } else {\n      context = fnDescriptor.context;\n      fn = fnDescriptor.fn;\n    }\n\n    if (context && string(fn) && func(context[fn])) {\n      fn = context[fn];\n    }\n  }\n\n  return {\n    context: context,\n    fn: fn,\n    args: args\n  };\n}\n\nvar isNotDelayEffect = function isNotDelayEffect(fn) {\n  return fn !== delay;\n};\n\nfunction call(fnDescriptor) {\n  for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    args[_key - 1] = arguments[_key];\n  }\n\n  if (process.env.NODE_ENV !== 'production') {\n    var arg0 = typeof args[0] === 'number' ? args[0] : 'ms';\n    check(fnDescriptor, isNotDelayEffect, \"instead of writing `yield call(delay, \" + arg0 + \")` where delay is an effect from `redux-saga/effects` you should write `yield delay(\" + arg0 + \")`\");\n    validateFnDescriptor('call', fnDescriptor);\n  }\n\n  return makeEffect(CALL, getFnCallDescriptor(fnDescriptor, args));\n}\nfunction apply(context, fn, args) {\n  if (args === void 0) {\n    args = [];\n  }\n\n  var fnDescriptor = [context, fn];\n\n  if (process.env.NODE_ENV !== 'production') {\n    validateFnDescriptor('apply', fnDescriptor);\n  }\n\n  return makeEffect(CALL, getFnCallDescriptor([context, fn], args));\n}\nfunction cps(fnDescriptor) {\n  if (process.env.NODE_ENV !== 'production') {\n    validateFnDescriptor('cps', fnDescriptor);\n  }\n\n  for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n    args[_key2 - 1] = arguments[_key2];\n  }\n\n  return makeEffect(CPS, getFnCallDescriptor(fnDescriptor, args));\n}\nfunction fork(fnDescriptor) {\n  if (process.env.NODE_ENV !== 'production') {\n    validateFnDescriptor('fork', fnDescriptor);\n    check(fnDescriptor, function (arg) {\n      return !effect(arg);\n    }, 'fork: argument must not be an effect');\n  }\n\n  for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n    args[_key3 - 1] = arguments[_key3];\n  }\n\n  return makeEffect(FORK, getFnCallDescriptor(fnDescriptor, args));\n}\nfunction spawn(fnDescriptor) {\n  if (process.env.NODE_ENV !== 'production') {\n    validateFnDescriptor('spawn', fnDescriptor);\n  }\n\n  for (var _len4 = arguments.length, args = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n    args[_key4 - 1] = arguments[_key4];\n  }\n\n  return detach(fork.apply(void 0, [fnDescriptor].concat(args)));\n}\nfunction join(taskOrTasks) {\n  if (process.env.NODE_ENV !== 'production') {\n    if (arguments.length > 1) {\n      throw new Error('join(...tasks) is not supported any more. Please use join([...tasks]) to join multiple tasks.');\n    }\n\n    if (array(taskOrTasks)) {\n      taskOrTasks.forEach(function (t) {\n        check(t, task, \"join([...tasks]): argument \" + t + \" is not a valid Task object \" + TEST_HINT);\n      });\n    } else {\n      check(taskOrTasks, task, \"join(task): argument \" + taskOrTasks + \" is not a valid Task object \" + TEST_HINT);\n    }\n  }\n\n  return makeEffect(JOIN, taskOrTasks);\n}\nfunction cancel(taskOrTasks) {\n  if (taskOrTasks === void 0) {\n    taskOrTasks = SELF_CANCELLATION;\n  }\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (arguments.length > 1) {\n      throw new Error('cancel(...tasks) is not supported any more. Please use cancel([...tasks]) to cancel multiple tasks.');\n    }\n\n    if (array(taskOrTasks)) {\n      taskOrTasks.forEach(function (t) {\n        check(t, task, \"cancel([...tasks]): argument \" + t + \" is not a valid Task object \" + TEST_HINT);\n      });\n    } else if (taskOrTasks !== SELF_CANCELLATION && notUndef(taskOrTasks)) {\n      check(taskOrTasks, task, \"cancel(task): argument \" + taskOrTasks + \" is not a valid Task object \" + TEST_HINT);\n    }\n  }\n\n  return makeEffect(CANCEL, taskOrTasks);\n}\nfunction select(selector) {\n  if (selector === void 0) {\n    selector = identity;\n  }\n\n  for (var _len5 = arguments.length, args = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {\n    args[_key5 - 1] = arguments[_key5];\n  }\n\n  if (process.env.NODE_ENV !== 'production' && arguments.length) {\n    check(arguments[0], notUndef, 'select(selector, [...]): argument selector is undefined');\n    check(selector, func, \"select(selector, [...]): argument \" + selector + \" is not a function\");\n  }\n\n  return makeEffect(SELECT, {\n    selector: selector,\n    args: args\n  });\n}\n/**\n  channel(pattern, [buffer])    => creates a proxy channel for store actions\n**/\n\nfunction actionChannel(pattern$1, buffer$1) {\n  if (process.env.NODE_ENV !== 'production') {\n    check(pattern$1, pattern, 'actionChannel(pattern,...): argument pattern is not valid');\n\n    if (arguments.length > 1) {\n      check(buffer$1, notUndef, 'actionChannel(pattern, buffer): argument buffer is undefined');\n      check(buffer$1, buffer, \"actionChannel(pattern, buffer): argument \" + buffer$1 + \" is not a valid buffer\");\n    }\n  }\n\n  return makeEffect(ACTION_CHANNEL, {\n    pattern: pattern$1,\n    buffer: buffer$1\n  });\n}\nfunction cancelled() {\n  return makeEffect(CANCELLED, {});\n}\nfunction flush(channel$1) {\n  if (process.env.NODE_ENV !== 'production') {\n    check(channel$1, channel, \"flush(channel): argument \" + channel$1 + \" is not valid channel\");\n  }\n\n  return makeEffect(FLUSH, channel$1);\n}\nfunction getContext(prop) {\n  if (process.env.NODE_ENV !== 'production') {\n    check(prop, string, \"getContext(prop): argument \" + prop + \" is not a string\");\n  }\n\n  return makeEffect(GET_CONTEXT, prop);\n}\nfunction setContext(props) {\n  if (process.env.NODE_ENV !== 'production') {\n    check(props, object, createSetContextWarning(null, props));\n  }\n\n  return makeEffect(SET_CONTEXT, props);\n}\nvar delay =\n/*#__PURE__*/\ncall.bind(null, delayP);\n\nexport { apply as $, ALL as A, logError as B, CALL as C, wrapSagaDispatch as D, identity as E, FORK as F, GET_CONTEXT as G, buffers as H, detach as I, JOIN as J, take as K, fork as L, cancel as M, call as N, delay as O, PUT as P, actionChannel as Q, RACE as R, SELECT as S, TAKE as T, sliding as U, race as V, effectTypes as W, takeMaybe as X, put as Y, putResolve as Z, all as _, CPS as a, cps as a0, spawn as a1, join as a2, select as a3, cancelled as a4, flush as a5, getContext as a6, setContext as a7, CANCEL as b, check as c, ACTION_CHANNEL as d, expanding as e, CANCELLED as f, FLUSH as g, SET_CONTEXT as h, internalErr as i, getMetaInfo as j, kTrue as k, createAllStyleChildCallbacks as l, createEmptyArray as m, none as n, once as o, assignWithSymbols as p, makeIterator as q, remove as r, shouldComplete as s, noop as t, flatMap as u, getLocation as v, createSetContextWarning as w, asyncIteratorSymbol as x, shouldCancel as y, shouldTerminate as z };\n","import { CHANNEL_END_TYPE, MULTICAST, MATCH, SAGA_ACTION, CANCEL, SELF_CANCELLATION, TERMINATE, TASK, TASK_CANCEL, IO } from '@redux-saga/symbols';\nexport { CANCEL, SAGA_LOCATION } from '@redux-saga/symbols';\nimport _extends from '@babel/runtime/helpers/esm/extends';\nimport _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\nimport { string as string$1, array as array$1, stringableFunc, func, symbol as symbol$1, buffer, notUndef, promise, iterator, undef, object, channel as channel$1 } from '@redux-saga/is';\nimport { k as kTrue, e as expanding, c as check, o as once, r as remove, n as none, i as internalErr, T as TAKE, P as PUT, A as ALL, R as RACE, C as CALL, a as CPS, F as FORK, J as JOIN, b as CANCEL$1, S as SELECT, d as ACTION_CHANNEL, f as CANCELLED$1, g as FLUSH, G as GET_CONTEXT, h as SET_CONTEXT, j as getMetaInfo, l as createAllStyleChildCallbacks, m as createEmptyArray, p as assignWithSymbols, q as makeIterator, s as shouldComplete, t as noop, u as flatMap, v as getLocation, w as createSetContextWarning, x as asyncIteratorSymbol, y as shouldCancel, z as shouldTerminate, B as logError, D as wrapSagaDispatch, E as identity } from './io-c3792963.js';\nexport { H as buffers, I as detach } from './io-c3792963.js';\nimport { compose } from 'redux';\nimport deferred from '@redux-saga/deferred';\nimport '@redux-saga/delay-p';\n\nvar queue = [];\n/**\n  Variable to hold a counting semaphore\n  - Incrementing adds a lock and puts the scheduler in a `suspended` state (if it's not\n    already suspended)\n  - Decrementing releases a lock. Zero locks puts the scheduler in a `released` state. This\n    triggers flushing the queued tasks.\n**/\n\nvar semaphore = 0;\n/**\n  Executes a task 'atomically'. Tasks scheduled during this execution will be queued\n  and flushed after this task has finished (assuming the scheduler endup in a released\n  state).\n**/\n\nfunction exec(task) {\n  try {\n    suspend();\n    task();\n  } finally {\n    release();\n  }\n}\n/**\n  Executes or queues a task depending on the state of the scheduler (`suspended` or `released`)\n**/\n\n\nfunction asap(task) {\n  queue.push(task);\n\n  if (!semaphore) {\n    suspend();\n    flush();\n  }\n}\n/**\n * Puts the scheduler in a `suspended` state and executes a task immediately.\n */\n\nfunction immediately(task) {\n  try {\n    suspend();\n    return task();\n  } finally {\n    flush();\n  }\n}\n/**\n  Puts the scheduler in a `suspended` state. Scheduled tasks will be queued until the\n  scheduler is released.\n**/\n\nfunction suspend() {\n  semaphore++;\n}\n/**\n  Puts the scheduler in a `released` state.\n**/\n\n\nfunction release() {\n  semaphore--;\n}\n/**\n  Releases the current lock. Executes all queued tasks if the scheduler is in the released state.\n**/\n\n\nfunction flush() {\n  release();\n  var task;\n\n  while (!semaphore && (task = queue.shift()) !== undefined) {\n    exec(task);\n  }\n}\n\nvar array = function array(patterns) {\n  return function (input) {\n    return patterns.some(function (p) {\n      return matcher(p)(input);\n    });\n  };\n};\nvar predicate = function predicate(_predicate) {\n  return function (input) {\n    return _predicate(input);\n  };\n};\nvar string = function string(pattern) {\n  return function (input) {\n    return input.type === String(pattern);\n  };\n};\nvar symbol = function symbol(pattern) {\n  return function (input) {\n    return input.type === pattern;\n  };\n};\nvar wildcard = function wildcard() {\n  return kTrue;\n};\nfunction matcher(pattern) {\n  // prettier-ignore\n  var matcherCreator = pattern === '*' ? wildcard : string$1(pattern) ? string : array$1(pattern) ? array : stringableFunc(pattern) ? string : func(pattern) ? predicate : symbol$1(pattern) ? symbol : null;\n\n  if (matcherCreator === null) {\n    throw new Error(\"invalid pattern: \" + pattern);\n  }\n\n  return matcherCreator(pattern);\n}\n\nvar END = {\n  type: CHANNEL_END_TYPE\n};\nvar isEnd = function isEnd(a) {\n  return a && a.type === CHANNEL_END_TYPE;\n};\nvar CLOSED_CHANNEL_WITH_TAKERS = 'Cannot have a closed channel with pending takers';\nvar INVALID_BUFFER = 'invalid buffer passed to channel factory function';\nvar UNDEFINED_INPUT_ERROR = \"Saga or channel was provided with an undefined action\\nHints:\\n  - check that your Action Creator returns a non-undefined value\\n  - if the Saga was started using runSaga, check that your subscribe source provides the action to its listeners\";\nfunction channel(buffer$1) {\n  if (buffer$1 === void 0) {\n    buffer$1 = expanding();\n  }\n\n  var closed = false;\n  var takers = [];\n\n  if (process.env.NODE_ENV !== 'production') {\n    check(buffer$1, buffer, INVALID_BUFFER);\n  }\n\n  function checkForbiddenStates() {\n    if (closed && takers.length) {\n      throw internalErr(CLOSED_CHANNEL_WITH_TAKERS);\n    }\n\n    if (takers.length && !buffer$1.isEmpty()) {\n      throw internalErr('Cannot have pending takers with non empty buffer');\n    }\n  }\n\n  function put(input) {\n    if (process.env.NODE_ENV !== 'production') {\n      checkForbiddenStates();\n      check(input, notUndef, UNDEFINED_INPUT_ERROR);\n    }\n\n    if (closed) {\n      return;\n    }\n\n    if (takers.length === 0) {\n      return buffer$1.put(input);\n    }\n\n    var cb = takers.shift();\n    cb(input);\n  }\n\n  function take(cb) {\n    if (process.env.NODE_ENV !== 'production') {\n      checkForbiddenStates();\n      check(cb, func, \"channel.take's callback must be a function\");\n    }\n\n    if (closed && buffer$1.isEmpty()) {\n      cb(END);\n    } else if (!buffer$1.isEmpty()) {\n      cb(buffer$1.take());\n    } else {\n      takers.push(cb);\n\n      cb.cancel = function () {\n        remove(takers, cb);\n      };\n    }\n  }\n\n  function flush(cb) {\n    if (process.env.NODE_ENV !== 'production') {\n      checkForbiddenStates();\n      check(cb, func, \"channel.flush' callback must be a function\");\n    }\n\n    if (closed && buffer$1.isEmpty()) {\n      cb(END);\n      return;\n    }\n\n    cb(buffer$1.flush());\n  }\n\n  function close() {\n    if (process.env.NODE_ENV !== 'production') {\n      checkForbiddenStates();\n    }\n\n    if (closed) {\n      return;\n    }\n\n    closed = true;\n    var arr = takers;\n    takers = [];\n\n    for (var i = 0, len = arr.length; i < len; i++) {\n      var taker = arr[i];\n      taker(END);\n    }\n  }\n\n  return {\n    take: take,\n    put: put,\n    flush: flush,\n    close: close\n  };\n}\nfunction eventChannel(subscribe, buffer) {\n  if (buffer === void 0) {\n    buffer = none();\n  }\n\n  var closed = false;\n  var unsubscribe;\n  var chan = channel(buffer);\n\n  var close = function close() {\n    if (closed) {\n      return;\n    }\n\n    closed = true;\n\n    if (func(unsubscribe)) {\n      unsubscribe();\n    }\n\n    chan.close();\n  };\n\n  unsubscribe = subscribe(function (input) {\n    if (isEnd(input)) {\n      close();\n      return;\n    }\n\n    chan.put(input);\n  });\n\n  if (process.env.NODE_ENV !== 'production') {\n    check(unsubscribe, func, 'in eventChannel: subscribe should return a function to unsubscribe');\n  }\n\n  unsubscribe = once(unsubscribe);\n\n  if (closed) {\n    unsubscribe();\n  }\n\n  return {\n    take: chan.take,\n    flush: chan.flush,\n    close: close\n  };\n}\nfunction multicastChannel() {\n  var _ref;\n\n  var closed = false;\n  var currentTakers = [];\n  var nextTakers = currentTakers;\n\n  function checkForbiddenStates() {\n    if (closed && nextTakers.length) {\n      throw internalErr(CLOSED_CHANNEL_WITH_TAKERS);\n    }\n  }\n\n  var ensureCanMutateNextTakers = function ensureCanMutateNextTakers() {\n    if (nextTakers !== currentTakers) {\n      return;\n    }\n\n    nextTakers = currentTakers.slice();\n  };\n\n  var close = function close() {\n    if (process.env.NODE_ENV !== 'production') {\n      checkForbiddenStates();\n    }\n\n    closed = true;\n    var takers = currentTakers = nextTakers;\n    nextTakers = [];\n    takers.forEach(function (taker) {\n      taker(END);\n    });\n  };\n\n  return _ref = {}, _ref[MULTICAST] = true, _ref.put = function put(input) {\n    if (process.env.NODE_ENV !== 'production') {\n      checkForbiddenStates();\n      check(input, notUndef, UNDEFINED_INPUT_ERROR);\n    }\n\n    if (closed) {\n      return;\n    }\n\n    if (isEnd(input)) {\n      close();\n      return;\n    }\n\n    var takers = currentTakers = nextTakers;\n\n    for (var i = 0, len = takers.length; i < len; i++) {\n      var taker = takers[i];\n\n      if (taker[MATCH](input)) {\n        taker.cancel();\n        taker(input);\n      }\n    }\n  }, _ref.take = function take(cb, matcher) {\n    if (matcher === void 0) {\n      matcher = wildcard;\n    }\n\n    if (process.env.NODE_ENV !== 'production') {\n      checkForbiddenStates();\n    }\n\n    if (closed) {\n      cb(END);\n      return;\n    }\n\n    cb[MATCH] = matcher;\n    ensureCanMutateNextTakers();\n    nextTakers.push(cb);\n    cb.cancel = once(function () {\n      ensureCanMutateNextTakers();\n      remove(nextTakers, cb);\n    });\n  }, _ref.close = close, _ref;\n}\nfunction stdChannel() {\n  var chan = multicastChannel();\n  var put = chan.put;\n\n  chan.put = function (input) {\n    if (input[SAGA_ACTION]) {\n      put(input);\n      return;\n    }\n\n    asap(function () {\n      put(input);\n    });\n  };\n\n  return chan;\n}\n\nvar RUNNING = 0;\nvar CANCELLED = 1;\nvar ABORTED = 2;\nvar DONE = 3;\n\nfunction resolvePromise(promise, cb) {\n  var cancelPromise = promise[CANCEL];\n\n  if (func(cancelPromise)) {\n    cb.cancel = cancelPromise;\n  }\n\n  promise.then(cb, function (error) {\n    cb(error, true);\n  });\n}\n\nvar current = 0;\nvar nextSagaId = (function () {\n  return ++current;\n});\n\nvar _effectRunnerMap;\n\nfunction getIteratorMetaInfo(iterator, fn) {\n  if (iterator.isSagaIterator) {\n    return {\n      name: iterator.meta.name\n    };\n  }\n\n  return getMetaInfo(fn);\n}\n\nfunction createTaskIterator(_ref) {\n  var context = _ref.context,\n      fn = _ref.fn,\n      args = _ref.args;\n\n  // catch synchronous failures; see #152 and #441\n  try {\n    var result = fn.apply(context, args); // i.e. a generator function returns an iterator\n\n    if (iterator(result)) {\n      return result;\n    }\n\n    var resolved = false;\n\n    var next = function next(arg) {\n      if (!resolved) {\n        resolved = true; // Only promises returned from fork will be interpreted. See #1573\n\n        return {\n          value: result,\n          done: !promise(result)\n        };\n      } else {\n        return {\n          value: arg,\n          done: true\n        };\n      }\n    };\n\n    return makeIterator(next);\n  } catch (err) {\n    // do not bubble up synchronous failures for detached forks\n    // instead create a failed task. See #152 and #441\n    return makeIterator(function () {\n      throw err;\n    });\n  }\n}\n\nfunction runPutEffect(env, _ref2, cb) {\n  var channel = _ref2.channel,\n      action = _ref2.action,\n      resolve = _ref2.resolve;\n\n  /**\n   Schedule the put in case another saga is holding a lock.\n   The put will be executed atomically. ie nested puts will execute after\n   this put has terminated.\n   **/\n  asap(function () {\n    var result;\n\n    try {\n      result = (channel ? channel.put : env.dispatch)(action);\n    } catch (error) {\n      cb(error, true);\n      return;\n    }\n\n    if (resolve && promise(result)) {\n      resolvePromise(result, cb);\n    } else {\n      cb(result);\n    }\n  }); // Put effects are non cancellables\n}\n\nfunction runTakeEffect(env, _ref3, cb) {\n  var _ref3$channel = _ref3.channel,\n      channel = _ref3$channel === void 0 ? env.channel : _ref3$channel,\n      pattern = _ref3.pattern,\n      maybe = _ref3.maybe;\n\n  var takeCb = function takeCb(input) {\n    if (input instanceof Error) {\n      cb(input, true);\n      return;\n    }\n\n    if (isEnd(input) && !maybe) {\n      cb(TERMINATE);\n      return;\n    }\n\n    cb(input);\n  };\n\n  try {\n    channel.take(takeCb, notUndef(pattern) ? matcher(pattern) : null);\n  } catch (err) {\n    cb(err, true);\n    return;\n  }\n\n  cb.cancel = takeCb.cancel;\n}\n\nfunction runCallEffect(env, _ref4, cb, _ref5) {\n  var context = _ref4.context,\n      fn = _ref4.fn,\n      args = _ref4.args;\n  var task = _ref5.task;\n\n  // catch synchronous failures; see #152\n  try {\n    var result = fn.apply(context, args);\n\n    if (promise(result)) {\n      resolvePromise(result, cb);\n      return;\n    }\n\n    if (iterator(result)) {\n      // resolve iterator\n      proc(env, result, task.context, current, getMetaInfo(fn),\n      /* isRoot */\n      false, cb);\n      return;\n    }\n\n    cb(result);\n  } catch (error) {\n    cb(error, true);\n  }\n}\n\nfunction runCPSEffect(env, _ref6, cb) {\n  var context = _ref6.context,\n      fn = _ref6.fn,\n      args = _ref6.args;\n\n  // CPS (ie node style functions) can define their own cancellation logic\n  // by setting cancel field on the cb\n  // catch synchronous failures; see #152\n  try {\n    var cpsCb = function cpsCb(err, res) {\n      if (undef(err)) {\n        cb(res);\n      } else {\n        cb(err, true);\n      }\n    };\n\n    fn.apply(context, args.concat(cpsCb));\n\n    if (cpsCb.cancel) {\n      cb.cancel = cpsCb.cancel;\n    }\n  } catch (error) {\n    cb(error, true);\n  }\n}\n\nfunction runForkEffect(env, _ref7, cb, _ref8) {\n  var context = _ref7.context,\n      fn = _ref7.fn,\n      args = _ref7.args,\n      detached = _ref7.detached;\n  var parent = _ref8.task;\n  var taskIterator = createTaskIterator({\n    context: context,\n    fn: fn,\n    args: args\n  });\n  var meta = getIteratorMetaInfo(taskIterator, fn);\n  immediately(function () {\n    var child = proc(env, taskIterator, parent.context, current, meta, detached, undefined);\n\n    if (detached) {\n      cb(child);\n    } else {\n      if (child.isRunning()) {\n        parent.queue.addTask(child);\n        cb(child);\n      } else if (child.isAborted()) {\n        parent.queue.abort(child.error());\n      } else {\n        cb(child);\n      }\n    }\n  }); // Fork effects are non cancellables\n}\n\nfunction runJoinEffect(env, taskOrTasks, cb, _ref9) {\n  var task = _ref9.task;\n\n  var joinSingleTask = function joinSingleTask(taskToJoin, cb) {\n    if (taskToJoin.isRunning()) {\n      var joiner = {\n        task: task,\n        cb: cb\n      };\n\n      cb.cancel = function () {\n        if (taskToJoin.isRunning()) remove(taskToJoin.joiners, joiner);\n      };\n\n      taskToJoin.joiners.push(joiner);\n    } else {\n      if (taskToJoin.isAborted()) {\n        cb(taskToJoin.error(), true);\n      } else {\n        cb(taskToJoin.result());\n      }\n    }\n  };\n\n  if (array$1(taskOrTasks)) {\n    if (taskOrTasks.length === 0) {\n      cb([]);\n      return;\n    }\n\n    var childCallbacks = createAllStyleChildCallbacks(taskOrTasks, cb);\n    taskOrTasks.forEach(function (t, i) {\n      joinSingleTask(t, childCallbacks[i]);\n    });\n  } else {\n    joinSingleTask(taskOrTasks, cb);\n  }\n}\n\nfunction cancelSingleTask(taskToCancel) {\n  if (taskToCancel.isRunning()) {\n    taskToCancel.cancel();\n  }\n}\n\nfunction runCancelEffect(env, taskOrTasks, cb, _ref10) {\n  var task = _ref10.task;\n\n  if (taskOrTasks === SELF_CANCELLATION) {\n    cancelSingleTask(task);\n  } else if (array$1(taskOrTasks)) {\n    taskOrTasks.forEach(cancelSingleTask);\n  } else {\n    cancelSingleTask(taskOrTasks);\n  }\n\n  cb(); // cancel effects are non cancellables\n}\n\nfunction runAllEffect(env, effects, cb, _ref11) {\n  var digestEffect = _ref11.digestEffect;\n  var effectId = current;\n  var keys = Object.keys(effects);\n\n  if (keys.length === 0) {\n    cb(array$1(effects) ? [] : {});\n    return;\n  }\n\n  var childCallbacks = createAllStyleChildCallbacks(effects, cb);\n  keys.forEach(function (key) {\n    digestEffect(effects[key], effectId, childCallbacks[key], key);\n  });\n}\n\nfunction runRaceEffect(env, effects, cb, _ref12) {\n  var digestEffect = _ref12.digestEffect;\n  var effectId = current;\n  var keys = Object.keys(effects);\n  var response = array$1(effects) ? createEmptyArray(keys.length) : {};\n  var childCbs = {};\n  var completed = false;\n  keys.forEach(function (key) {\n    var chCbAtKey = function chCbAtKey(res, isErr) {\n      if (completed) {\n        return;\n      }\n\n      if (isErr || shouldComplete(res)) {\n        // Race Auto cancellation\n        cb.cancel();\n        cb(res, isErr);\n      } else {\n        cb.cancel();\n        completed = true;\n        response[key] = res;\n        cb(response);\n      }\n    };\n\n    chCbAtKey.cancel = noop;\n    childCbs[key] = chCbAtKey;\n  });\n\n  cb.cancel = function () {\n    // prevents unnecessary cancellation\n    if (!completed) {\n      completed = true;\n      keys.forEach(function (key) {\n        return childCbs[key].cancel();\n      });\n    }\n  };\n\n  keys.forEach(function (key) {\n    if (completed) {\n      return;\n    }\n\n    digestEffect(effects[key], effectId, childCbs[key], key);\n  });\n}\n\nfunction runSelectEffect(env, _ref13, cb) {\n  var selector = _ref13.selector,\n      args = _ref13.args;\n\n  try {\n    var state = selector.apply(void 0, [env.getState()].concat(args));\n    cb(state);\n  } catch (error) {\n    cb(error, true);\n  }\n}\n\nfunction runChannelEffect(env, _ref14, cb) {\n  var pattern = _ref14.pattern,\n      buffer = _ref14.buffer;\n  var chan = channel(buffer);\n  var match = matcher(pattern);\n\n  var taker = function taker(action) {\n    if (!isEnd(action)) {\n      env.channel.take(taker, match);\n    }\n\n    chan.put(action);\n  };\n\n  var close = chan.close;\n\n  chan.close = function () {\n    taker.cancel();\n    close();\n  };\n\n  env.channel.take(taker, match);\n  cb(chan);\n}\n\nfunction runCancelledEffect(env, data, cb, _ref15) {\n  var task = _ref15.task;\n  cb(task.isCancelled());\n}\n\nfunction runFlushEffect(env, channel, cb) {\n  channel.flush(cb);\n}\n\nfunction runGetContextEffect(env, prop, cb, _ref16) {\n  var task = _ref16.task;\n  cb(task.context[prop]);\n}\n\nfunction runSetContextEffect(env, props, cb, _ref17) {\n  var task = _ref17.task;\n  assignWithSymbols(task.context, props);\n  cb();\n}\n\nvar effectRunnerMap = (_effectRunnerMap = {}, _effectRunnerMap[TAKE] = runTakeEffect, _effectRunnerMap[PUT] = runPutEffect, _effectRunnerMap[ALL] = runAllEffect, _effectRunnerMap[RACE] = runRaceEffect, _effectRunnerMap[CALL] = runCallEffect, _effectRunnerMap[CPS] = runCPSEffect, _effectRunnerMap[FORK] = runForkEffect, _effectRunnerMap[JOIN] = runJoinEffect, _effectRunnerMap[CANCEL$1] = runCancelEffect, _effectRunnerMap[SELECT] = runSelectEffect, _effectRunnerMap[ACTION_CHANNEL] = runChannelEffect, _effectRunnerMap[CANCELLED$1] = runCancelledEffect, _effectRunnerMap[FLUSH] = runFlushEffect, _effectRunnerMap[GET_CONTEXT] = runGetContextEffect, _effectRunnerMap[SET_CONTEXT] = runSetContextEffect, _effectRunnerMap);\n\n/**\n Used to track a parent task and its forks\n In the fork model, forked tasks are attached by default to their parent\n We model this using the concept of Parent task && main Task\n main task is the main flow of the current Generator, the parent tasks is the\n aggregation of the main tasks + all its forked tasks.\n Thus the whole model represents an execution tree with multiple branches (vs the\n linear execution tree in sequential (non parallel) programming)\n\n A parent tasks has the following semantics\n - It completes if all its forks either complete or all cancelled\n - If it's cancelled, all forks are cancelled as well\n - It aborts if any uncaught error bubbles up from forks\n - If it completes, the return value is the one returned by the main task\n **/\n\nfunction forkQueue(mainTask, onAbort, cont) {\n  var tasks = [];\n  var result;\n  var completed = false;\n  addTask(mainTask);\n\n  var getTasks = function getTasks() {\n    return tasks;\n  };\n\n  function abort(err) {\n    onAbort();\n    cancelAll();\n    cont(err, true);\n  }\n\n  function addTask(task) {\n    tasks.push(task);\n\n    task.cont = function (res, isErr) {\n      if (completed) {\n        return;\n      }\n\n      remove(tasks, task);\n      task.cont = noop;\n\n      if (isErr) {\n        abort(res);\n      } else {\n        if (task === mainTask) {\n          result = res;\n        }\n\n        if (!tasks.length) {\n          completed = true;\n          cont(result);\n        }\n      }\n    };\n  }\n\n  function cancelAll() {\n    if (completed) {\n      return;\n    }\n\n    completed = true;\n    tasks.forEach(function (t) {\n      t.cont = noop;\n      t.cancel();\n    });\n    tasks = [];\n  }\n\n  return {\n    addTask: addTask,\n    cancelAll: cancelAll,\n    abort: abort,\n    getTasks: getTasks\n  };\n}\n\n// there can be only a single saga error created at any given moment\n\nfunction formatLocation(fileName, lineNumber) {\n  return fileName + \"?\" + lineNumber;\n}\n\nfunction effectLocationAsString(effect) {\n  var location = getLocation(effect);\n\n  if (location) {\n    var code = location.code,\n        fileName = location.fileName,\n        lineNumber = location.lineNumber;\n    var source = code + \"  \" + formatLocation(fileName, lineNumber);\n    return source;\n  }\n\n  return '';\n}\n\nfunction sagaLocationAsString(sagaMeta) {\n  var name = sagaMeta.name,\n      location = sagaMeta.location;\n\n  if (location) {\n    return name + \"  \" + formatLocation(location.fileName, location.lineNumber);\n  }\n\n  return name;\n}\n\nfunction cancelledTasksAsString(sagaStack) {\n  var cancelledTasks = flatMap(function (i) {\n    return i.cancelledTasks;\n  }, sagaStack);\n\n  if (!cancelledTasks.length) {\n    return '';\n  }\n\n  return ['Tasks cancelled due to error:'].concat(cancelledTasks).join('\\n');\n}\n\nvar crashedEffect = null;\nvar sagaStack = [];\nvar addSagaFrame = function addSagaFrame(frame) {\n  frame.crashedEffect = crashedEffect;\n  sagaStack.push(frame);\n};\nvar clear = function clear() {\n  crashedEffect = null;\n  sagaStack.length = 0;\n}; // this sets crashed effect for the soon-to-be-reported saga frame\n// this slightly streatches the singleton nature of this module into wrong direction\n// as it's even less obvious what's the data flow here, but it is what it is for now\n\nvar setCrashedEffect = function setCrashedEffect(effect) {\n  crashedEffect = effect;\n};\n/**\n  @returns {string}\n\n  @example\n  The above error occurred in task errorInPutSaga {pathToFile}\n  when executing effect put({type: 'REDUCER_ACTION_ERROR_IN_PUT'}) {pathToFile}\n      created by fetchSaga {pathToFile}\n      created by rootSaga {pathToFile}\n*/\n\nvar toString = function toString() {\n  var firstSaga = sagaStack[0],\n      otherSagas = sagaStack.slice(1);\n  var crashedEffectLocation = firstSaga.crashedEffect ? effectLocationAsString(firstSaga.crashedEffect) : null;\n  var errorMessage = \"The above error occurred in task \" + sagaLocationAsString(firstSaga.meta) + (crashedEffectLocation ? \" \\n when executing effect \" + crashedEffectLocation : '');\n  return [errorMessage].concat(otherSagas.map(function (s) {\n    return \"    created by \" + sagaLocationAsString(s.meta);\n  }), [cancelledTasksAsString(sagaStack)]).join('\\n');\n};\n\nfunction newTask(env, mainTask, parentContext, parentEffectId, meta, isRoot, cont) {\n  var _task;\n\n  if (cont === void 0) {\n    cont = noop;\n  }\n\n  var status = RUNNING;\n  var taskResult;\n  var taskError;\n  var deferredEnd = null;\n  var cancelledDueToErrorTasks = [];\n  var context = Object.create(parentContext);\n  var queue = forkQueue(mainTask, function onAbort() {\n    cancelledDueToErrorTasks.push.apply(cancelledDueToErrorTasks, queue.getTasks().map(function (t) {\n      return t.meta.name;\n    }));\n  }, end);\n  /**\n   This may be called by a parent generator to trigger/propagate cancellation\n   cancel all pending tasks (including the main task), then end the current task.\n    Cancellation propagates down to the whole execution tree held by this Parent task\n   It's also propagated to all joiners of this task and their execution tree/joiners\n    Cancellation is noop for terminated/Cancelled tasks tasks\n   **/\n\n  function cancel() {\n    if (status === RUNNING) {\n      // Setting status to CANCELLED does not necessarily mean that the task/iterators are stopped\n      // effects in the iterator's finally block will still be executed\n      status = CANCELLED;\n      queue.cancelAll(); // Ending with a TASK_CANCEL will propagate the Cancellation to all joiners\n\n      end(TASK_CANCEL, false);\n    }\n  }\n\n  function end(result, isErr) {\n    if (!isErr) {\n      // The status here may be RUNNING or CANCELLED\n      // If the status is CANCELLED, then we do not need to change it here\n      if (result === TASK_CANCEL) {\n        status = CANCELLED;\n      } else if (status !== CANCELLED) {\n        status = DONE;\n      }\n\n      taskResult = result;\n      deferredEnd && deferredEnd.resolve(result);\n    } else {\n      status = ABORTED;\n      addSagaFrame({\n        meta: meta,\n        cancelledTasks: cancelledDueToErrorTasks\n      });\n\n      if (task.isRoot) {\n        var sagaStack = toString(); // we've dumped the saga stack to string and are passing it to user's code\n        // we know that it won't be needed anymore and we need to clear it\n\n        clear();\n        env.onError(result, {\n          sagaStack: sagaStack\n        });\n      }\n\n      taskError = result;\n      deferredEnd && deferredEnd.reject(result);\n    }\n\n    task.cont(result, isErr);\n    task.joiners.forEach(function (joiner) {\n      joiner.cb(result, isErr);\n    });\n    task.joiners = null;\n  }\n\n  function setContext(props) {\n    if (process.env.NODE_ENV !== 'production') {\n      check(props, object, createSetContextWarning('task', props));\n    }\n\n    assignWithSymbols(context, props);\n  }\n\n  function toPromise() {\n    if (deferredEnd) {\n      return deferredEnd.promise;\n    }\n\n    deferredEnd = deferred();\n\n    if (status === ABORTED) {\n      deferredEnd.reject(taskError);\n    } else if (status !== RUNNING) {\n      deferredEnd.resolve(taskResult);\n    }\n\n    return deferredEnd.promise;\n  }\n\n  var task = (_task = {}, _task[TASK] = true, _task.id = parentEffectId, _task.meta = meta, _task.isRoot = isRoot, _task.context = context, _task.joiners = [], _task.queue = queue, _task.cancel = cancel, _task.cont = cont, _task.end = end, _task.setContext = setContext, _task.toPromise = toPromise, _task.isRunning = function isRunning() {\n    return status === RUNNING;\n  }, _task.isCancelled = function isCancelled() {\n    return status === CANCELLED || status === RUNNING && mainTask.status === CANCELLED;\n  }, _task.isAborted = function isAborted() {\n    return status === ABORTED;\n  }, _task.result = function result() {\n    return taskResult;\n  }, _task.error = function error() {\n    return taskError;\n  }, _task);\n  return task;\n}\n\nfunction proc(env, iterator$1, parentContext, parentEffectId, meta, isRoot, cont) {\n  if (process.env.NODE_ENV !== 'production' && iterator$1[asyncIteratorSymbol]) {\n    throw new Error(\"redux-saga doesn't support async generators, please use only regular ones\");\n  }\n\n  var finalRunEffect = env.finalizeRunEffect(runEffect);\n  /**\n    Tracks the current effect cancellation\n    Each time the generator progresses. calling runEffect will set a new value\n    on it. It allows propagating cancellation to child effects\n  **/\n\n  next.cancel = noop;\n  /** Creates a main task to track the main flow */\n\n  var mainTask = {\n    meta: meta,\n    cancel: cancelMain,\n    status: RUNNING\n  };\n  /**\n   Creates a new task descriptor for this generator.\n   A task is the aggregation of it's mainTask and all it's forked tasks.\n   **/\n\n  var task = newTask(env, mainTask, parentContext, parentEffectId, meta, isRoot, cont);\n  var executingContext = {\n    task: task,\n    digestEffect: digestEffect\n  };\n  /**\n    cancellation of the main task. We'll simply resume the Generator with a TASK_CANCEL\n  **/\n\n  function cancelMain() {\n    if (mainTask.status === RUNNING) {\n      mainTask.status = CANCELLED;\n      next(TASK_CANCEL);\n    }\n  }\n  /**\n    attaches cancellation logic to this task's continuation\n    this will permit cancellation to propagate down the call chain\n  **/\n\n\n  if (cont) {\n    cont.cancel = task.cancel;\n  } // kicks up the generator\n\n\n  next(); // then return the task descriptor to the caller\n\n  return task;\n  /**\n   * This is the generator driver\n   * It's a recursive async/continuation function which calls itself\n   * until the generator terminates or throws\n   * @param {internal commands(TASK_CANCEL | TERMINATE) | any} arg - value, generator will be resumed with.\n   * @param {boolean} isErr - the flag shows if effect finished with an error\n   *\n   * receives either (command | effect result, false) or (any thrown thing, true)\n   */\n\n  function next(arg, isErr) {\n    try {\n      var result;\n\n      if (isErr) {\n        result = iterator$1.throw(arg); // user handled the error, we can clear bookkept values\n\n        clear();\n      } else if (shouldCancel(arg)) {\n        /**\n          getting TASK_CANCEL automatically cancels the main task\n          We can get this value here\n           - By cancelling the parent task manually\n          - By joining a Cancelled task\n        **/\n        mainTask.status = CANCELLED;\n        /**\n          Cancels the current effect; this will propagate the cancellation down to any called tasks\n        **/\n\n        next.cancel();\n        /**\n          If this Generator has a `return` method then invokes it\n          This will jump to the finally block\n        **/\n\n        result = func(iterator$1.return) ? iterator$1.return(TASK_CANCEL) : {\n          done: true,\n          value: TASK_CANCEL\n        };\n      } else if (shouldTerminate(arg)) {\n        // We get TERMINATE flag, i.e. by taking from a channel that ended using `take` (and not `takem` used to trap End of channels)\n        result = func(iterator$1.return) ? iterator$1.return() : {\n          done: true\n        };\n      } else {\n        result = iterator$1.next(arg);\n      }\n\n      if (!result.done) {\n        digestEffect(result.value, parentEffectId, next);\n      } else {\n        /**\n          This Generator has ended, terminate the main task and notify the fork queue\n        **/\n        if (mainTask.status !== CANCELLED) {\n          mainTask.status = DONE;\n        }\n\n        mainTask.cont(result.value);\n      }\n    } catch (error) {\n      if (mainTask.status === CANCELLED) {\n        throw error;\n      }\n\n      mainTask.status = ABORTED;\n      mainTask.cont(error, true);\n    }\n  }\n\n  function runEffect(effect, effectId, currCb) {\n    /**\n      each effect runner must attach its own logic of cancellation to the provided callback\n      it allows this generator to propagate cancellation downward.\n       ATTENTION! effect runners must setup the cancel logic by setting cb.cancel = [cancelMethod]\n      And the setup must occur before calling the callback\n       This is a sort of inversion of control: called async functions are responsible\n      of completing the flow by calling the provided continuation; while caller functions\n      are responsible for aborting the current flow by calling the attached cancel function\n       Library users can attach their own cancellation logic to promises by defining a\n      promise[CANCEL] method in their returned promises\n      ATTENTION! calling cancel must have no effect on an already completed or cancelled effect\n    **/\n    if (promise(effect)) {\n      resolvePromise(effect, currCb);\n    } else if (iterator(effect)) {\n      // resolve iterator\n      proc(env, effect, task.context, effectId, meta,\n      /* isRoot */\n      false, currCb);\n    } else if (effect && effect[IO]) {\n      var effectRunner = effectRunnerMap[effect.type];\n      effectRunner(env, effect.payload, currCb, executingContext);\n    } else {\n      // anything else returned as is\n      currCb(effect);\n    }\n  }\n\n  function digestEffect(effect, parentEffectId, cb, label) {\n    if (label === void 0) {\n      label = '';\n    }\n\n    var effectId = nextSagaId();\n    env.sagaMonitor && env.sagaMonitor.effectTriggered({\n      effectId: effectId,\n      parentEffectId: parentEffectId,\n      label: label,\n      effect: effect\n    });\n    /**\n      completion callback and cancel callback are mutually exclusive\n      We can't cancel an already completed effect\n      And We can't complete an already cancelled effectId\n    **/\n\n    var effectSettled; // Completion callback passed to the appropriate effect runner\n\n    function currCb(res, isErr) {\n      if (effectSettled) {\n        return;\n      }\n\n      effectSettled = true;\n      cb.cancel = noop; // defensive measure\n\n      if (env.sagaMonitor) {\n        if (isErr) {\n          env.sagaMonitor.effectRejected(effectId, res);\n        } else {\n          env.sagaMonitor.effectResolved(effectId, res);\n        }\n      }\n\n      if (isErr) {\n        setCrashedEffect(effect);\n      }\n\n      cb(res, isErr);\n    } // tracks down the current cancel\n\n\n    currCb.cancel = noop; // setup cancellation logic on the parent cb\n\n    cb.cancel = function () {\n      // prevents cancelling an already completed effect\n      if (effectSettled) {\n        return;\n      }\n\n      effectSettled = true;\n      currCb.cancel(); // propagates cancel downward\n\n      currCb.cancel = noop; // defensive measure\n\n      env.sagaMonitor && env.sagaMonitor.effectCancelled(effectId);\n    };\n\n    finalRunEffect(effect, effectId, currCb);\n  }\n}\n\nvar RUN_SAGA_SIGNATURE = 'runSaga(options, saga, ...args)';\nvar NON_GENERATOR_ERR = RUN_SAGA_SIGNATURE + \": saga argument must be a Generator function!\";\nfunction runSaga(_ref, saga) {\n  var _ref$channel = _ref.channel,\n      channel = _ref$channel === void 0 ? stdChannel() : _ref$channel,\n      dispatch = _ref.dispatch,\n      getState = _ref.getState,\n      _ref$context = _ref.context,\n      context = _ref$context === void 0 ? {} : _ref$context,\n      sagaMonitor = _ref.sagaMonitor,\n      effectMiddlewares = _ref.effectMiddlewares,\n      _ref$onError = _ref.onError,\n      onError = _ref$onError === void 0 ? logError : _ref$onError;\n\n  if (process.env.NODE_ENV !== 'production') {\n    check(saga, func, NON_GENERATOR_ERR);\n  }\n\n  for (var _len = arguments.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n    args[_key - 2] = arguments[_key];\n  }\n\n  var iterator$1 = saga.apply(void 0, args);\n\n  if (process.env.NODE_ENV !== 'production') {\n    check(iterator$1, iterator, NON_GENERATOR_ERR);\n  }\n\n  var effectId = nextSagaId();\n\n  if (sagaMonitor) {\n    // monitors are expected to have a certain interface, let's fill-in any missing ones\n    sagaMonitor.rootSagaStarted = sagaMonitor.rootSagaStarted || noop;\n    sagaMonitor.effectTriggered = sagaMonitor.effectTriggered || noop;\n    sagaMonitor.effectResolved = sagaMonitor.effectResolved || noop;\n    sagaMonitor.effectRejected = sagaMonitor.effectRejected || noop;\n    sagaMonitor.effectCancelled = sagaMonitor.effectCancelled || noop;\n    sagaMonitor.actionDispatched = sagaMonitor.actionDispatched || noop;\n    sagaMonitor.rootSagaStarted({\n      effectId: effectId,\n      saga: saga,\n      args: args\n    });\n  }\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (notUndef(dispatch)) {\n      check(dispatch, func, 'dispatch must be a function');\n    }\n\n    if (notUndef(getState)) {\n      check(getState, func, 'getState must be a function');\n    }\n\n    if (notUndef(effectMiddlewares)) {\n      var MIDDLEWARE_TYPE_ERROR = 'effectMiddlewares must be an array of functions';\n      check(effectMiddlewares, array$1, MIDDLEWARE_TYPE_ERROR);\n      effectMiddlewares.forEach(function (effectMiddleware) {\n        return check(effectMiddleware, func, MIDDLEWARE_TYPE_ERROR);\n      });\n    }\n\n    check(onError, func, 'onError passed to the redux-saga is not a function!');\n  }\n\n  var finalizeRunEffect;\n\n  if (effectMiddlewares) {\n    var middleware = compose.apply(void 0, effectMiddlewares);\n\n    finalizeRunEffect = function finalizeRunEffect(runEffect) {\n      return function (effect, effectId, currCb) {\n        var plainRunEffect = function plainRunEffect(eff) {\n          return runEffect(eff, effectId, currCb);\n        };\n\n        return middleware(plainRunEffect)(effect);\n      };\n    };\n  } else {\n    finalizeRunEffect = identity;\n  }\n\n  var env = {\n    channel: channel,\n    dispatch: wrapSagaDispatch(dispatch),\n    getState: getState,\n    sagaMonitor: sagaMonitor,\n    onError: onError,\n    finalizeRunEffect: finalizeRunEffect\n  };\n  return immediately(function () {\n    var task = proc(env, iterator$1, context, effectId, getMetaInfo(saga),\n    /* isRoot */\n    true, undefined);\n\n    if (sagaMonitor) {\n      sagaMonitor.effectResolved(effectId, task);\n    }\n\n    return task;\n  });\n}\n\nfunction sagaMiddlewareFactory(_temp) {\n  var _ref = _temp === void 0 ? {} : _temp,\n      _ref$context = _ref.context,\n      context = _ref$context === void 0 ? {} : _ref$context,\n      _ref$channel = _ref.channel,\n      channel = _ref$channel === void 0 ? stdChannel() : _ref$channel,\n      sagaMonitor = _ref.sagaMonitor,\n      options = _objectWithoutPropertiesLoose(_ref, [\"context\", \"channel\", \"sagaMonitor\"]);\n\n  var boundRunSaga;\n\n  if (process.env.NODE_ENV !== 'production') {\n    check(channel, channel$1, 'options.channel passed to the Saga middleware is not a channel');\n  }\n\n  function sagaMiddleware(_ref2) {\n    var getState = _ref2.getState,\n        dispatch = _ref2.dispatch;\n    boundRunSaga = runSaga.bind(null, _extends({}, options, {\n      context: context,\n      channel: channel,\n      dispatch: dispatch,\n      getState: getState,\n      sagaMonitor: sagaMonitor\n    }));\n    return function (next) {\n      return function (action) {\n        if (sagaMonitor && sagaMonitor.actionDispatched) {\n          sagaMonitor.actionDispatched(action);\n        }\n\n        var result = next(action); // hit reducers\n\n        channel.put(action);\n        return result;\n      };\n    };\n  }\n\n  sagaMiddleware.run = function () {\n    if (process.env.NODE_ENV !== 'production' && !boundRunSaga) {\n      throw new Error('Before running a Saga, you must mount the Saga middleware on the Store using applyMiddleware');\n    }\n\n    return boundRunSaga.apply(void 0, arguments);\n  };\n\n  sagaMiddleware.setContext = function (props) {\n    if (process.env.NODE_ENV !== 'production') {\n      check(props, object, createSetContextWarning('sagaMiddleware', props));\n    }\n\n    assignWithSymbols(context, props);\n  };\n\n  return sagaMiddleware;\n}\n\nexport default sagaMiddlewareFactory;\nexport { END, channel, eventChannel, isEnd, multicastChannel, runSaga, stdChannel };\n","function deferred() {\n  var def = {};\n  def.promise = new Promise(function (resolve, reject) {\n    def.resolve = resolve;\n    def.reject = reject;\n  });\n  return def;\n}\nfunction arrayOfDeferred(length) {\n  var arr = [];\n\n  for (var i = 0; i < length; i++) {\n    arr.push(deferred());\n  }\n\n  return arr;\n}\n\nexport default deferred;\nexport { arrayOfDeferred };\n","export default function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n  return target;\n}","'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","var __defProp = Object.defineProperty;\nvar __defProps = Object.defineProperties;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropDescs = Object.getOwnPropertyDescriptors;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __getOwnPropSymbols = Object.getOwnPropertySymbols;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __propIsEnum = Object.prototype.propertyIsEnumerable;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __spreadValues = (a, b) => {\n  for (var prop in b || (b = {}))\n    if (__hasOwnProp.call(b, prop))\n      __defNormalProp(a, prop, b[prop]);\n  if (__getOwnPropSymbols)\n    for (var prop of __getOwnPropSymbols(b)) {\n      if (__propIsEnum.call(b, prop))\n        __defNormalProp(a, prop, b[prop]);\n    }\n  return a;\n};\nvar __spreadProps = (a, b) => __defProps(a, __getOwnPropDescs(b));\nvar __objRest = (source, exclude) => {\n  var target = {};\n  for (var prop in source)\n    if (__hasOwnProp.call(source, prop) && exclude.indexOf(prop) < 0)\n      target[prop] = source[prop];\n  if (source != null && __getOwnPropSymbols)\n    for (var prop of __getOwnPropSymbols(source)) {\n      if (exclude.indexOf(prop) < 0 && __propIsEnum.call(source, prop))\n        target[prop] = source[prop];\n    }\n  return target;\n};\nvar __export = (target, all2) => {\n  for (var name in all2)\n    __defProp(target, name, { get: all2[name], enumerable: true });\n};\nvar __copyProps = (to, from, except, desc) => {\n  if (from && typeof from === \"object\" || typeof from === \"function\") {\n    for (let key of __getOwnPropNames(from))\n      if (!__hasOwnProp.call(to, key) && key !== except)\n        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\n  }\n  return to;\n};\nvar __reExport = (target, mod, secondTarget) => (__copyProps(target, mod, \"default\"), secondTarget && __copyProps(secondTarget, mod, \"default\"));\nvar __publicField = (obj, key, value) => {\n  __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\n  return value;\n};\n\n// src/utils/constants.ts\nvar DEFAULT_HOST = \"wss://relay.signalwire.com\";\nvar EVENT_NAMESPACE_DIVIDER = \":\";\nvar LOCAL_EVENT_PREFIX = \"__local__\";\nvar SYNTHETIC_EVENT_PREFIX = \"__synthetic__\";\nvar PRODUCT_PREFIX_VIDEO = \"video\";\nvar PRODUCT_PREFIX_CHAT = \"chat\";\nvar PRODUCT_PREFIX_PUBSUB = \"chat\";\nvar GLOBAL_VIDEO_EVENTS = [\"room.started\", \"room.ended\"];\nvar INTERNAL_GLOBAL_VIDEO_EVENTS = GLOBAL_VIDEO_EVENTS.map((event) => `${PRODUCT_PREFIX_VIDEO}.${event}`);\n\n// src/utils/logger.ts\nimport log from \"loglevel\";\nvar datetime = () => new Date().toISOString();\nvar defaultLogger = log.getLogger(\"signalwire\");\nvar originalFactory = defaultLogger.methodFactory;\ndefaultLogger.methodFactory = (methodName, logLevel, loggerName) => {\n  const rawMethod = originalFactory(methodName, logLevel, loggerName);\n  return function(...args) {\n    args.unshift(datetime(), \"-\");\n    rawMethod.apply(void 0, args);\n  };\n};\nvar defaultLoggerLevel = process.env.NODE_ENV === \"development\" ? defaultLogger.levels.DEBUG : defaultLogger.getLevel();\ndefaultLogger.setLevel(defaultLoggerLevel);\nvar userLogger;\nvar setLogger = (logger) => {\n  userLogger = logger;\n};\nvar debugOptions = {};\nvar setDebugOptions = (options) => {\n  if (options == null) {\n    debugOptions = {};\n    return;\n  }\n  Object.assign(debugOptions, options);\n};\nvar getLoggerInstance = () => {\n  return userLogger != null ? userLogger : defaultLogger;\n};\nvar shouldStringify = (payload) => {\n  if (\"method\" in payload && payload.method === \"signalwire.ping\") {\n    return false;\n  }\n  return true;\n};\nvar wsTraffic = ({ type, payload }) => {\n  const logger = getLoggerInstance();\n  const { logWsTraffic } = debugOptions || {};\n  if (!logWsTraffic) {\n    return void 0;\n  }\n  const msg = shouldStringify(payload) ? JSON.stringify(payload, null, 2) : payload;\n  return logger.info(`${type.toUpperCase()}: \n`, msg, \"\\n\");\n};\nvar getLogger = () => {\n  const logger = getLoggerInstance();\n  return new Proxy(logger, {\n    get(target, prop, receiver) {\n      if (prop === \"wsTraffic\") {\n        return wsTraffic;\n      }\n      return Reflect.get(target, prop, receiver);\n    }\n  });\n};\n\n// src/utils/common.ts\nvar UPPERCASE_REGEX = /[A-Z]/g;\nvar fromCamelToSnakeCase = (event) => {\n  return event.replace(UPPERCASE_REGEX, (letter) => {\n    return `_${letter.toLowerCase()}`;\n  });\n};\nvar WEBRTC_EVENT_TYPES = [\n  \"webrtc.message\"\n];\nvar isWebrtcEventType = (eventType) => {\n  return WEBRTC_EVENT_TYPES.includes(eventType);\n};\n\n// src/utils/index.ts\nimport { v4 } from \"uuid\";\n\n// src/utils/parseRPCResponse.ts\nvar parseRPCResponse = ({\n  response,\n  request\n}) => {\n  const { result = {}, error } = response;\n  if (error) {\n    return {\n      error\n    };\n  }\n  switch (request.method) {\n    case \"signalwire.connect\":\n      return { result };\n    default:\n      return parseResponse(response);\n  }\n};\nvar whitelistCodeRegex = /^2[0-9][0-9]$/;\nvar parseResponse = (response, nodeId) => {\n  const { result = {}, error } = response;\n  if (error) {\n    return { error };\n  }\n  const { code, node_id, result: nestedResult = null } = result;\n  if (code && !whitelistCodeRegex.test(code)) {\n    return { error: result };\n  }\n  if (nestedResult === null) {\n    if (nodeId) {\n      result.node_id = nodeId;\n    }\n    return { result };\n  }\n  if (nestedResult) {\n    if (nestedResult.jsonrpc) {\n      return parseResponse(nestedResult, node_id);\n    }\n    return { result: nestedResult };\n  }\n  return { result };\n};\n\n// src/utils/toExternalJSON.ts\nvar toDateObject = (timestamp) => {\n  if (typeof timestamp === \"undefined\") {\n    return timestamp;\n  }\n  const date = new Date(timestamp * 1e3);\n  if (isNaN(date.getTime())) {\n    return timestamp;\n  }\n  return date;\n};\nvar DEFAULT_OPTIONS = {\n  propsToUpdateValue: [\n    \"updated\",\n    \"layers\",\n    \"members\",\n    \"recordings\",\n    \"playbacks\"\n  ]\n};\nvar isTimestampProperty = (prop) => {\n  return prop.endsWith(\"At\");\n};\nvar toExternalJSON = (input, options = DEFAULT_OPTIONS) => {\n  if ((input == null ? void 0 : input.__sw_symbol) || (input == null ? void 0 : input.__sw_proxy)) {\n    return input;\n  }\n  return Object.entries(input).reduce((reducer, [key, value]) => {\n    const prop = fromSnakeToCamelCase(key);\n    const propType = typeof value;\n    if (propType === \"object\" && value) {\n      if (Array.isArray(value)) {\n        if (options.propsToUpdateValue.includes(key)) {\n          reducer[prop] = value.map((v) => {\n            if (typeof v === \"string\") {\n              return fromSnakeToCamelCase(v);\n            }\n            return toExternalJSON(v);\n          });\n        } else {\n          reducer[prop] = value;\n        }\n      } else {\n        reducer[prop] = toExternalJSON(value);\n      }\n    } else {\n      if (isTimestampProperty(prop)) {\n        reducer[prop] = toDateObject(value);\n      } else {\n        reducer[prop] = value;\n      }\n    }\n    return reducer;\n  }, {});\n};\nvar fromSnakeToCamelCase = (input) => {\n  if (!input.includes(\"_\")) {\n    return input;\n  }\n  return input.split(\"_\").reduce((reducer, part, index) => {\n    const fc = part.trim().charAt(0);\n    const remainingChars = part.substr(1).toLowerCase();\n    return `${reducer}${index === 0 ? fc.toLowerCase() : fc.toUpperCase()}${remainingChars}`;\n  }, \"\");\n};\n\n// src/utils/toInternalEventName.ts\nvar toInternalEventName = ({\n  event,\n  namespace\n}) => {\n  if (typeof event === \"string\") {\n    event = getNamespacedEvent({\n      event,\n      namespace\n    });\n    event = fromCamelToSnakeCase(event);\n  }\n  return event;\n};\nvar getNamespacedEvent = ({\n  namespace,\n  event\n}) => {\n  if (!namespace || event.startsWith(namespace)) {\n    return event;\n  }\n  return `${namespace}${EVENT_NAMESPACE_DIVIDER}${event}`;\n};\n\n// src/utils/toInternalAction.ts\nvar toInternalAction = (event) => {\n  const { event_type, params, node_id } = event;\n  if (event_type === \"queuing.relay.tasks\") {\n    return {\n      type: event_type,\n      payload: event\n    };\n  }\n  if (isWebrtcEventType(event_type) && (params == null ? void 0 : params.jsonrpc)) {\n    const vertoRPC = params;\n    if (vertoRPC.params) {\n      vertoRPC.params.nodeId = node_id;\n    }\n    return {\n      type: event_type,\n      payload: vertoRPC\n    };\n  }\n  return {\n    type: event_type,\n    payload: params\n  };\n};\n\n// src/utils/toSnakeCaseKeys.ts\nvar toSnakeCaseKeys = (obj, transform = (value) => value, result = {}) => {\n  if (Array.isArray(obj)) {\n    result = obj.map((item, index) => {\n      if (typeof item === \"object\") {\n        return toSnakeCaseKeys(item, transform, result[index]);\n      }\n      return item;\n    });\n  } else {\n    Object.keys(obj).forEach((key) => {\n      const newKey = fromCamelToSnakeCase(key);\n      if (obj[key] && typeof obj[key] === \"object\") {\n        result[newKey] = toSnakeCaseKeys(obj[key], transform, result[newKey]);\n      } else {\n        result[newKey] = transform(obj[key]);\n      }\n    });\n  }\n  return result;\n};\n\n// src/utils/extendComponent.ts\nvar extendComponent = (klass, methods) => {\n  Object.keys(methods).forEach((methodName) => {\n    if (klass.prototype.hasOwnProperty(methodName)) {\n      throw new Error(`[extendComponent] Duplicated method name: ${methodName}`);\n    }\n  });\n  Object.defineProperties(klass.prototype, methods);\n  return klass;\n};\n\n// src/utils/debounce.ts\nfunction debounce(fn, wait2 = 0, callFirst) {\n  let timeout = null;\n  let debouncedFn = null;\n  const clear = function() {\n    if (timeout) {\n      clearTimeout(timeout);\n      debouncedFn = null;\n      timeout = null;\n    }\n  };\n  const flush = function() {\n    const call4 = debouncedFn;\n    clear();\n    if (call4) {\n      call4();\n    }\n  };\n  const debounceWrapper = function() {\n    if (!wait2) {\n      return fn.apply(this, arguments);\n    }\n    const context = this;\n    const args = arguments;\n    const callNow = callFirst && !timeout;\n    clear();\n    debouncedFn = function() {\n      fn.apply(context, args);\n    };\n    timeout = setTimeout(function() {\n      timeout = null;\n      if (!callNow) {\n        const call4 = debouncedFn;\n        debouncedFn = null;\n        return call4 == null ? void 0 : call4();\n      }\n    }, wait2);\n    if (callNow && debouncedFn) {\n      return debouncedFn();\n    }\n  };\n  debounceWrapper.cancel = clear;\n  debounceWrapper.flush = flush;\n  return debounceWrapper;\n}\n\n// src/utils/SWCloseEvent.ts\nvar SWCloseEvent = class {\n  constructor(type, options = {}) {\n    this.type = type;\n    __publicField(this, \"code\");\n    __publicField(this, \"reason\");\n    __publicField(this, \"wasClean\");\n    this.code = options.code === void 0 ? 0 : options.code;\n    this.reason = options.reason === void 0 ? \"\" : options.reason;\n    this.wasClean = options.wasClean === void 0 ? false : options.wasClean;\n  }\n};\n\n// src/utils/eventUtils.ts\nvar stripNamespacePrefix = (event, namespace) => {\n  if (namespace && typeof namespace === \"string\") {\n    const regex = new RegExp(`^${namespace}.`);\n    return event.replace(regex, \"\");\n  }\n  const items = event.split(\".\");\n  if (items.length > 1) {\n    items.shift();\n    return items.join(\".\");\n  }\n  return event;\n};\n\n// src/utils/mapObject.ts\nfunction isMappableObject(obj) {\n  return !!obj.type;\n}\nfunction mapObject(template, action) {\n  var _a;\n  const matches = new RegExp(\"^(?<prefix>(\\\\w|\\\\.)*)(\\\\[(?<stateKey>[^\\\\(\\\\)]*)(?<replace>\\\\((?<from>(\\\\w|\\\\.)*):(?<to>\\\\S*)\\\\))?\\\\]){0,1}(?<payloadMap>\\\\{.*\\\\}){0,1}\").exec(template);\n  let result = __spreadProps(__spreadValues({}, action), {\n    type: template\n  });\n  if ((matches == null ? void 0 : matches.groups) && !!action.payload) {\n    const { prefix, stateKey, replace, from, to } = matches.groups;\n    let newType;\n    if (!!replace) {\n      newType = action.payload[stateKey] === from ? `${prefix}${to}` : void 0;\n    } else if (!!stateKey) {\n      newType = !!action.payload[stateKey] ? `${prefix}${action.payload[stateKey]}` : void 0;\n    } else {\n      newType = `${prefix}`;\n    }\n    result = !!newType ? __spreadProps(__spreadValues({}, action), {\n      type: newType\n    }) : void 0;\n  }\n  if ((_a = matches == null ? void 0 : matches.groups) == null ? void 0 : _a.payloadMap) {\n    const { payload } = action;\n    result = __spreadProps(__spreadValues({}, result), {\n      payload\n    });\n  }\n  return result;\n}\n\n// src/utils/index.ts\nvar safeParseJson = (value) => {\n  if (typeof value !== \"string\") {\n    return value;\n  }\n  try {\n    return JSON.parse(value);\n  } catch (error) {\n    return value;\n  }\n};\nvar PROTOCOL_PATTERN = /^(ws|wss):\\/\\//;\nvar checkWebSocketHost = (host) => {\n  const protocol = PROTOCOL_PATTERN.test(host) ? \"\" : \"wss://\";\n  return `${protocol}${host}`;\n};\nvar timeoutPromise = (promise, time, exception) => {\n  let timer = null;\n  return Promise.race([\n    promise,\n    new Promise((_resolve, reject) => timer = setTimeout(reject, time, exception))\n  ]).finally(() => clearTimeout(timer));\n};\nvar isGlobalEvent = (event) => {\n  return GLOBAL_VIDEO_EVENTS.includes(event);\n};\nvar isSyntheticEvent = (event) => {\n  return event.includes(SYNTHETIC_EVENT_PREFIX);\n};\nvar isSessionEvent = (event) => {\n  return event.includes(\"session.\");\n};\nvar cleanupEventNamespace = (event) => {\n  const eventParts = event.split(EVENT_NAMESPACE_DIVIDER);\n  return eventParts[eventParts.length - 1];\n};\nvar WITH_CUSTOM_EVENT_NAMES = [\n  \"video.member.updated\",\n  \"video.member.talking\"\n];\nvar CLIENT_SIDE_EVENT_NAMES = [\n  \"video.room.joined\",\n  \"video.track\",\n  \"video.active\",\n  \"video.answering\",\n  \"video.destroy\",\n  \"video.early\",\n  \"video.hangup\",\n  \"video.held\",\n  \"video.new\",\n  \"video.purge\",\n  \"video.recovering\",\n  \"video.requesting\",\n  \"video.ringing\",\n  \"video.trying\",\n  \"video.media.connected\",\n  \"video.media.reconnecting\",\n  \"video.media.disconnected\",\n  \"video.microphone.updated\",\n  \"video.camera.updated\",\n  \"video.speaker.updated\",\n  \"video.microphone.disconnected\",\n  \"video.camera.disconnected\",\n  \"video.speaker.disconnected\"\n];\nvar validateEventsToSubscribe = (events) => {\n  const valid = events.map((internalEvent) => {\n    if (typeof internalEvent === \"string\") {\n      const event = cleanupEventNamespace(internalEvent);\n      if (CLIENT_SIDE_EVENT_NAMES.includes(event) || isSyntheticEvent(event) || isLocalEvent(event) || isSessionEvent(event)) {\n        return null;\n      }\n      const found = WITH_CUSTOM_EVENT_NAMES.find((withCustomName) => {\n        return event.startsWith(withCustomName);\n      });\n      return found || event;\n    }\n    return internalEvent;\n  });\n  return Array.from(new Set(valid)).filter(Boolean);\n};\nvar isLocalEvent = (event) => {\n  return event.includes(LOCAL_EVENT_PREFIX);\n};\nvar toLocalEvent = (event) => {\n  const eventParts = event.split(\".\");\n  const prefix = eventParts[0];\n  return event.split(\".\").reduce((reducer, item) => {\n    reducer.push(item);\n    if (item === prefix) {\n      reducer.push(LOCAL_EVENT_PREFIX);\n    }\n    return reducer;\n  }, []).join(\".\");\n};\nvar toSyntheticEvent = (event) => {\n  const eventParts = event.split(\".\");\n  const prefix = eventParts[0];\n  return event.split(\".\").reduce((reducer, item) => {\n    reducer.push(item);\n    if (item === prefix) {\n      reducer.push(SYNTHETIC_EVENT_PREFIX);\n    }\n    return reducer;\n  }, []).join(\".\");\n};\nvar isJSONRPCRequest = (e) => {\n  return Boolean(e.method);\n};\nvar isJSONRPCResponse = (e) => {\n  return !isJSONRPCRequest(e);\n};\nvar isSATAuth = (e) => {\n  return typeof e !== \"undefined\" && \"jti\" in e;\n};\n\n// src/RPCMessages/helpers.ts\nvar makeRPCRequest = (params) => {\n  var _a;\n  return __spreadValues({\n    jsonrpc: \"2.0\",\n    id: (_a = params.id) != null ? _a : v4()\n  }, params);\n};\nvar makeRPCResponse = (params) => {\n  return __spreadValues({\n    jsonrpc: \"2.0\"\n  }, params);\n};\n\n// src/RPCMessages/RPCConnect.ts\nvar DEFAULT_CONNECT_VERSION = {\n  major: 3,\n  minor: 0,\n  revision: 0\n};\nvar UNIFIED_CONNECT_VERSION = {\n  major: 4,\n  minor: 0,\n  revision: 0\n};\nvar RPCConnect = (params) => {\n  return makeRPCRequest({\n    method: \"signalwire.connect\",\n    params: __spreadValues({\n      version: DEFAULT_CONNECT_VERSION,\n      event_acks: true\n    }, params)\n  });\n};\n\n// src/RPCMessages/RPCReauthenticate.ts\nvar RPCReauthenticate = (authentication) => {\n  return makeRPCRequest({\n    method: \"signalwire.reauthenticate\",\n    params: {\n      authentication\n    }\n  });\n};\n\n// src/RPCMessages/RPCPing.ts\nvar RPCPing = () => {\n  return makeRPCRequest({\n    method: \"signalwire.ping\",\n    params: {\n      timestamp: Date.now() / 1e3\n    }\n  });\n};\nvar RPCPingResponse = (id, timestamp) => {\n  return makeRPCResponse({\n    id,\n    result: {\n      timestamp: timestamp || Date.now() / 1e3\n    }\n  });\n};\n\n// src/RPCMessages/RPCExecute.ts\nvar RPCExecute = ({ method, params }) => {\n  return makeRPCRequest({\n    method,\n    params\n  });\n};\n\n// src/RPCMessages/RPCDisconnect.ts\nvar RPCDisconnectResponse = (id) => {\n  return makeRPCResponse({\n    id,\n    result: {}\n  });\n};\n\n// src/RPCMessages/VertoMessages.ts\nvar tmpMap = {\n  id: \"callID\",\n  destinationNumber: \"destination_number\",\n  remoteCallerName: \"remote_caller_id_name\",\n  remoteCallerNumber: \"remote_caller_id_number\",\n  callerName: \"caller_id_name\",\n  callerNumber: \"caller_id_number\"\n};\nvar filterVertoParams = (params) => {\n  if (params.hasOwnProperty(\"dialogParams\")) {\n    const _a = params.dialogParams, {\n      remoteSdp,\n      localStream,\n      remoteStream\n    } = _a, dialogParams = __objRest(_a, [\n      \"remoteSdp\",\n      \"localStream\",\n      \"remoteStream\"\n    ]);\n    for (const key in tmpMap) {\n      if (key && dialogParams.hasOwnProperty(key)) {\n        dialogParams[tmpMap[key]] = dialogParams[key];\n        delete dialogParams[key];\n      }\n    }\n    params.dialogParams = dialogParams;\n  }\n  return params;\n};\nvar buildVertoRPCMessage = (method) => {\n  return (params = {}) => {\n    return makeRPCRequest({\n      method,\n      params: filterVertoParams(params)\n    });\n  };\n};\nvar VertoInvite = buildVertoRPCMessage(\"verto.invite\");\nvar VertoBye = buildVertoRPCMessage(\"verto.bye\");\nvar VertoAttach = buildVertoRPCMessage(\"verto.attach\");\nvar VertoModify = buildVertoRPCMessage(\"verto.modify\");\nvar VertoInfo = buildVertoRPCMessage(\"verto.info\");\nvar VertoAnswer = buildVertoRPCMessage(\"verto.answer\");\nvar VertoSubscribe = buildVertoRPCMessage(\"verto.subscribe\");\nvar VertoPong = buildVertoRPCMessage(\"verto.pong\");\nvar VertoResult = (id, method) => {\n  return makeRPCResponse({\n    id,\n    result: {\n      method\n    }\n  });\n};\n\n// src/RPCMessages/RPCEventAck.ts\nvar RPCEventAckResponse = (id) => makeRPCResponse({ id, result: {} });\n\n// src/redux/actions.ts\nvar actions_exports = {};\n__export(actions_exports, {\n  authErrorAction: () => authErrorAction,\n  authExpiringAction: () => authExpiringAction,\n  authSuccessAction: () => authSuccessAction,\n  createAction: () => createAction,\n  destroyAction: () => destroyAction,\n  getCustomSagaActionType: () => getCustomSagaActionType,\n  initAction: () => initAction,\n  makeCustomSagaAction: () => makeCustomSagaAction,\n  reauthAction: () => reauthAction,\n  sessionDisconnectedAction: () => sessionDisconnectedAction,\n  sessionForceCloseAction: () => sessionForceCloseAction,\n  sessionReconnectingAction: () => sessionReconnectingAction,\n  socketMessageAction: () => socketMessageAction\n});\n\n// src/redux/toolkit/index.ts\nvar toolkit_exports = {};\n__export(toolkit_exports, {\n  configureStore: () => configureStore,\n  createAction: () => createAction\n});\n__reExport(toolkit_exports, redux_star);\nimport * as redux_star from \"redux\";\n\n// src/redux/toolkit/createAction.ts\nfunction createAction(type, prepareAction) {\n  function actionCreator(...args) {\n    if (prepareAction) {\n      let prepared = prepareAction(...args);\n      if (!prepared) {\n        throw new Error(\"prepareAction did not return an object\");\n      }\n      return __spreadValues(__spreadValues({\n        type,\n        payload: prepared.payload\n      }, \"meta\" in prepared && { meta: prepared.meta }), \"error\" in prepared && { error: prepared.error });\n    }\n    return { type, payload: args[0] };\n  }\n  actionCreator.toString = () => `${type}`;\n  actionCreator.type = type;\n  actionCreator.match = (action) => action.type === type;\n  return actionCreator;\n}\n\n// src/redux/toolkit/configureStore.ts\nimport { createStore, compose as compose2, applyMiddleware, combineReducers } from \"redux\";\n\n// src/redux/toolkit/devtoolsExtension.ts\nimport { compose } from \"redux\";\nvar composeWithDevTools = typeof window !== \"undefined\" && window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ ? window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ : function() {\n  if (arguments.length === 0)\n    return void 0;\n  if (typeof arguments[0] === \"object\")\n    return compose;\n  return compose.apply(null, arguments);\n};\nvar devToolsEnhancer = typeof window !== \"undefined\" && window.__REDUX_DEVTOOLS_EXTENSION__ ? window.__REDUX_DEVTOOLS_EXTENSION__ : function() {\n  return function(noop) {\n    return noop;\n  };\n};\n\n// src/redux/toolkit/isPlainObject.ts\nfunction isPlainObject(value) {\n  if (typeof value !== \"object\" || value === null)\n    return false;\n  let proto = Object.getPrototypeOf(value);\n  if (proto === null)\n    return true;\n  let baseProto = proto;\n  while (Object.getPrototypeOf(baseProto) !== null) {\n    baseProto = Object.getPrototypeOf(baseProto);\n  }\n  return proto === baseProto;\n}\n\n// src/redux/toolkit/getDefaultMiddleware.ts\nfunction curryGetDefaultMiddleware() {\n  return function curriedGetDefaultMiddleware() {\n    return [];\n  };\n}\n\n// src/redux/toolkit/configureStore.ts\nvar IS_PRODUCTION = process.env.NODE_ENV === \"production\";\nfunction configureStore(options) {\n  const curriedGetDefaultMiddleware = curryGetDefaultMiddleware();\n  const {\n    reducer = void 0,\n    middleware = curriedGetDefaultMiddleware(),\n    devTools = true,\n    preloadedState = void 0,\n    enhancers = void 0\n  } = options || {};\n  let rootReducer2;\n  if (typeof reducer === \"function\") {\n    rootReducer2 = reducer;\n  } else if (isPlainObject(reducer)) {\n    rootReducer2 = combineReducers(reducer);\n  } else {\n    throw new Error('\"reducer\" is a required argument, and must be a function or an object of functions that can be passed to combineReducers');\n  }\n  let finalMiddleware = middleware;\n  if (typeof finalMiddleware === \"function\") {\n    finalMiddleware = finalMiddleware(curriedGetDefaultMiddleware);\n    if (!IS_PRODUCTION && !Array.isArray(finalMiddleware)) {\n      throw new Error(\"when using a middleware builder function, an array of middleware must be returned\");\n    }\n  }\n  if (!IS_PRODUCTION && finalMiddleware.some((item) => typeof item !== \"function\")) {\n    throw new Error(\"each middleware provided to configureStore must be a function\");\n  }\n  const middlewareEnhancer = applyMiddleware(...finalMiddleware);\n  let finalCompose = compose2;\n  if (devTools) {\n    finalCompose = composeWithDevTools(__spreadValues({\n      trace: !IS_PRODUCTION\n    }, typeof devTools === \"object\" && devTools));\n  }\n  let storeEnhancers = [middlewareEnhancer];\n  if (Array.isArray(enhancers)) {\n    storeEnhancers = [middlewareEnhancer, ...enhancers];\n  } else if (typeof enhancers === \"function\") {\n    storeEnhancers = enhancers(storeEnhancers);\n  }\n  const composedEnhancer = finalCompose(...storeEnhancers);\n  return createStore(rootReducer2, preloadedState, composedEnhancer);\n}\n\n// src/redux/actions.ts\nvar initAction = createAction(\"swSdk/init\");\nvar destroyAction = createAction(\"swSdk/destroy\");\nvar reauthAction = createAction(\"swSdk/reauth\");\nvar authErrorAction = createAction(\"auth/error\");\nvar authSuccessAction = createAction(\"auth/success\");\nvar authExpiringAction = createAction(\"auth/expiring\");\nvar socketMessageAction = createAction(\"socket/message\");\nvar sessionDisconnectedAction = createAction(\"session.disconnected\");\nvar sessionReconnectingAction = createAction(\"session.reconnecting\");\nvar sessionForceCloseAction = createAction(\"session.forceClose\");\nvar formatCustomSagaAction = (id, action) => {\n  return `${action.type}/${id}`;\n};\nvar makeCustomSagaAction = (id, action) => {\n  return __spreadProps(__spreadValues({}, action), {\n    type: formatCustomSagaAction(id, action)\n  });\n};\nvar getCustomSagaActionType = (id, action) => {\n  return formatCustomSagaAction(id, action);\n};\n\n// src/redux/toolkit/mapBuilders.ts\nfunction executeReducerBuilderCallback(builderCallback) {\n  const actionsMap = {};\n  const actionMatchers = [];\n  let defaultCaseReducer;\n  const builder = {\n    addCase(typeOrActionCreator, reducer) {\n      if (process.env.NODE_ENV !== \"production\") {\n        if (actionMatchers.length > 0) {\n          throw new Error(\"`builder.addCase` should only be called before calling `builder.addMatcher`\");\n        }\n        if (defaultCaseReducer) {\n          throw new Error(\"`builder.addCase` should only be called before calling `builder.addDefaultCase`\");\n        }\n      }\n      const type = typeof typeOrActionCreator === \"string\" ? typeOrActionCreator : typeOrActionCreator.type;\n      if (type in actionsMap) {\n        throw new Error(\"addCase cannot be called with two reducers for the same action type\");\n      }\n      actionsMap[type] = reducer;\n      return builder;\n    },\n    addMatcher(matcher, reducer) {\n      if (process.env.NODE_ENV !== \"production\") {\n        if (defaultCaseReducer) {\n          throw new Error(\"`builder.addMatcher` should only be called before calling `builder.addDefaultCase`\");\n        }\n      }\n      actionMatchers.push({ matcher, reducer });\n      return builder;\n    },\n    addDefaultCase(reducer) {\n      if (process.env.NODE_ENV !== \"production\") {\n        if (defaultCaseReducer) {\n          throw new Error(\"`builder.addDefaultCase` can only be called once\");\n        }\n      }\n      defaultCaseReducer = reducer;\n      return builder;\n    }\n  };\n  builderCallback(builder);\n  return [actionsMap, actionMatchers, defaultCaseReducer];\n}\n\n// src/redux/toolkit/createReducer.ts\nfunction isStateFunction(x) {\n  return typeof x === \"function\";\n}\nfunction createReducer(initialState, mapOrBuilderCallback, actionMatchers = [], defaultCaseReducer) {\n  let [actionsMap, finalActionMatchers, finalDefaultCaseReducer] = typeof mapOrBuilderCallback === \"function\" ? executeReducerBuilderCallback(mapOrBuilderCallback) : [mapOrBuilderCallback, actionMatchers, defaultCaseReducer];\n  let getInitialState;\n  if (isStateFunction(initialState)) {\n    getInitialState = () => initialState();\n  } else {\n    getInitialState = () => initialState;\n  }\n  function reducer(state = getInitialState(), action) {\n    let caseReducers = [\n      actionsMap[action.type],\n      ...finalActionMatchers.filter(({ matcher }) => matcher(action)).map(({ reducer: reducer2 }) => reducer2)\n    ];\n    if (caseReducers.filter((cr) => !!cr).length === 0) {\n      caseReducers = [finalDefaultCaseReducer];\n    }\n    return caseReducers.reduce((previousState, caseReducer) => {\n      if (caseReducer) {\n        return caseReducer(previousState, action);\n      }\n      return previousState;\n    }, state);\n  }\n  reducer.getInitialState = getInitialState;\n  return reducer;\n}\n\n// src/redux/toolkit/createSlice.ts\nfunction getType(slice, actionKey) {\n  return `${slice}/${actionKey}`;\n}\nfunction createSlice(options) {\n  const { name } = options;\n  if (!name) {\n    throw new Error(\"`name` is a required option for createSlice\");\n  }\n  const initialState = options.initialState;\n  const reducers = options.reducers || {};\n  const reducerNames = Object.keys(reducers);\n  const sliceCaseReducersByName = {};\n  const sliceCaseReducersByType = {};\n  const actionCreators = {};\n  reducerNames.forEach((reducerName) => {\n    const maybeReducerWithPrepare = reducers[reducerName];\n    const type = getType(name, reducerName);\n    let caseReducer;\n    let prepareCallback;\n    if (\"reducer\" in maybeReducerWithPrepare) {\n      caseReducer = maybeReducerWithPrepare.reducer;\n      prepareCallback = maybeReducerWithPrepare.prepare;\n    } else {\n      caseReducer = maybeReducerWithPrepare;\n    }\n    sliceCaseReducersByName[reducerName] = caseReducer;\n    sliceCaseReducersByType[type] = caseReducer;\n    actionCreators[reducerName] = prepareCallback ? createAction(type, prepareCallback) : createAction(type);\n  });\n  function buildReducer() {\n    const [\n      extraReducers = {},\n      actionMatchers = [],\n      defaultCaseReducer = void 0\n    ] = typeof options.extraReducers === \"function\" ? executeReducerBuilderCallback(options.extraReducers) : [options.extraReducers];\n    const finalCaseReducers = __spreadValues(__spreadValues({}, extraReducers), sliceCaseReducersByType);\n    return createReducer(initialState, finalCaseReducers, actionMatchers, defaultCaseReducer);\n  }\n  let _reducer;\n  return {\n    name,\n    reducer(state, action) {\n      if (!_reducer)\n        _reducer = buildReducer();\n      return _reducer(state, action);\n    },\n    actions: actionCreators,\n    caseReducers: sliceCaseReducersByName,\n    getInitialState() {\n      if (!_reducer)\n        _reducer = buildReducer();\n      return _reducer.getInitialState();\n    }\n  };\n}\n\n// src/redux/utils/createDestroyableSlice.ts\nvar createDestroyableSlice = ({\n  name = \"\",\n  initialState,\n  reducers,\n  extraReducers\n}) => {\n  return createSlice({\n    name,\n    initialState,\n    reducers,\n    extraReducers: (builder) => {\n      builder.addCase(destroyAction.type, () => {\n        return initialState;\n      });\n      if (typeof extraReducers === \"function\") {\n        extraReducers(builder);\n      }\n    }\n  });\n};\n\n// src/redux/features/session/sessionSlice.ts\nvar initialSessionState = {\n  protocol: \"\",\n  iceServers: [],\n  authStatus: \"unknown\",\n  authState: void 0,\n  authError: void 0,\n  authCount: 0\n};\nfunction authorizingAction(action) {\n  return [initAction.type, reauthAction.type].includes(action.type);\n}\nvar sessionSlice = createDestroyableSlice({\n  name: \"session\",\n  initialState: initialSessionState,\n  reducers: {\n    connected: (state, { payload }) => {\n      var _a, _b;\n      return __spreadProps(__spreadValues({}, state), {\n        authStatus: \"authorized\",\n        authState: payload == null ? void 0 : payload.authorization,\n        authCount: state.authCount + 1,\n        protocol: (_a = payload == null ? void 0 : payload.protocol) != null ? _a : \"\",\n        iceServers: (_b = payload == null ? void 0 : payload.ice_servers) != null ? _b : []\n      });\n    },\n    authStatus: (state, { payload }) => {\n      return __spreadProps(__spreadValues({}, state), {\n        authStatus: payload\n      });\n    },\n    updateAuthState: (state, { payload }) => {\n      return __spreadProps(__spreadValues({}, state), {\n        authState: payload\n      });\n    }\n  },\n  extraReducers: (builder) => {\n    builder.addCase(authErrorAction.type, (state, { payload }) => {\n      return __spreadProps(__spreadValues({}, state), {\n        authStatus: \"unauthorized\",\n        authError: payload.error\n      });\n    });\n    builder.addMatcher(authorizingAction, (state) => {\n      return __spreadProps(__spreadValues({}, state), {\n        authStatus: \"authorizing\"\n      });\n    });\n  }\n});\nvar {\n  actions: sessionActions,\n  reducer: sessionReducer\n} = sessionSlice;\n\n// src/BaseSession.ts\nvar SW_SYMBOL = Symbol(\"BaseSession\");\nvar randomInt = (min, max) => {\n  return Math.floor(Math.random() * (max - min + 1) + min);\n};\nvar reconnectDelay = () => {\n  return randomInt(1, 4) * 1e3;\n};\nvar BaseSession = class {\n  constructor(options) {\n    this.options = options;\n    __publicField(this, \"__sw_symbol\", SW_SYMBOL);\n    __publicField(this, \"uuid\", v4());\n    __publicField(this, \"WebSocketConstructor\");\n    __publicField(this, \"CloseEventConstructor\");\n    __publicField(this, \"agent\");\n    __publicField(this, \"connectVersion\", DEFAULT_CONNECT_VERSION);\n    __publicField(this, \"_rpcConnectResult\");\n    __publicField(this, \"_requests\", /* @__PURE__ */ new Map());\n    __publicField(this, \"_socket\", null);\n    __publicField(this, \"_host\", DEFAULT_HOST);\n    __publicField(this, \"_executeTimeoutMs\", 10 * 1e3);\n    __publicField(this, \"_executeTimeoutError\", Symbol.for(\"sw-execute-timeout\"));\n    __publicField(this, \"_executeQueue\", /* @__PURE__ */ new Set());\n    __publicField(this, \"_swConnectError\", Symbol.for(\"sw-connect-error\"));\n    __publicField(this, \"_executeConnectionClosed\", Symbol.for(\"sw-execute-connection-closed\"));\n    __publicField(this, \"_checkPingDelay\", 15 * 1e3);\n    __publicField(this, \"_checkPingTimer\", null);\n    __publicField(this, \"_reconnectTimer\");\n    __publicField(this, \"_status\", \"unknown\");\n    __publicField(this, \"_sessionChannel\");\n    __publicField(this, \"wsOpenHandler\");\n    __publicField(this, \"wsCloseHandler\");\n    __publicField(this, \"wsErrorHandler\");\n    var _a, _b;\n    const { host, logLevel = \"info\", sessionChannel } = options;\n    if (host) {\n      this._host = checkWebSocketHost(host);\n    }\n    if (sessionChannel) {\n      this._sessionChannel = sessionChannel;\n    }\n    if (logLevel) {\n      (_b = (_a = this.logger).setLevel) == null ? void 0 : _b.call(_a, logLevel);\n    }\n    this._onSocketOpen = this._onSocketOpen.bind(this);\n    this._onSocketError = this._onSocketError.bind(this);\n    this._onSocketClose = this._onSocketClose.bind(this);\n    this._onSocketMessage = this._onSocketMessage.bind(this);\n    this.execute = this.execute.bind(this);\n    this.connect = this.connect.bind(this);\n    this.wsOpenHandler = (event) => {\n      var _a2;\n      (_a2 = this._socket) == null ? void 0 : _a2.removeEventListener(\"open\", this.wsOpenHandler);\n      this._onSocketOpen(event);\n    };\n    this.wsCloseHandler = (event) => {\n      var _a2;\n      (_a2 = this._socket) == null ? void 0 : _a2.removeEventListener(\"close\", this.wsCloseHandler);\n      this._onSocketClose(event);\n    };\n    this.wsErrorHandler = (event) => {\n      var _a2;\n      (_a2 = this._socket) == null ? void 0 : _a2.removeEventListener(\"error\", this.wsErrorHandler);\n      this._onSocketError(event);\n    };\n  }\n  get host() {\n    return this._host;\n  }\n  get rpcConnectResult() {\n    return this._rpcConnectResult;\n  }\n  get relayProtocol() {\n    var _a, _b;\n    return (_b = (_a = this._rpcConnectResult) == null ? void 0 : _a.protocol) != null ? _b : \"\";\n  }\n  get signature() {\n    if (this._rpcConnectResult) {\n      const { authorization } = this._rpcConnectResult;\n      return authorization.signature;\n    }\n    return void 0;\n  }\n  get logger() {\n    return getLogger();\n  }\n  get connecting() {\n    var _a;\n    return ((_a = this._socket) == null ? void 0 : _a.readyState) === 0 /* CONNECTING */;\n  }\n  get connected() {\n    var _a;\n    return ((_a = this._socket) == null ? void 0 : _a.readyState) === 1 /* OPEN */;\n  }\n  get closing() {\n    var _a;\n    return ((_a = this._socket) == null ? void 0 : _a.readyState) === 2 /* CLOSING */;\n  }\n  get closed() {\n    return this._socket ? this._socket.readyState === 3 /* CLOSED */ : true;\n  }\n  get status() {\n    return this._status;\n  }\n  get idle() {\n    return this._status === \"idle\";\n  }\n  get ready() {\n    return !Boolean(this.idle || !this.connected);\n  }\n  set token(token) {\n    this.options.token = token;\n  }\n  connect() {\n    if (!(this == null ? void 0 : this.WebSocketConstructor)) {\n      throw new Error(\"Missing WebSocketConstructor\");\n    }\n    if (!(this == null ? void 0 : this.CloseEventConstructor)) {\n      throw new Error(\"Missing CloseEventConstructor\");\n    }\n    this._clearTimers();\n    if (this.connecting || this.connected) {\n      this.logger.warn(\"Session already connected.\");\n      return;\n    }\n    this._removeSocketListeners();\n    this.destroySocket();\n    this._clearCheckPingTimer();\n    this._socket = this._createSocket();\n    this._addSocketListeners();\n  }\n  _createSocket() {\n    return new this.WebSocketConstructor(this._host);\n  }\n  destroySocket() {\n    if (this._socket) {\n      this._socket.close();\n      this._socket = null;\n    }\n  }\n  _addSocketListeners() {\n    if (!this._socket) {\n      return this.logger.debug(\"Invalid socket instance to add listeners\");\n    }\n    this._removeSocketListeners();\n    this._socket.addEventListener(\"open\", this.wsOpenHandler);\n    this._socket.addEventListener(\"close\", this.wsCloseHandler);\n    this._socket.addEventListener(\"error\", this.wsErrorHandler);\n    this._socket.addEventListener(\"message\", this._onSocketMessage);\n  }\n  _removeSocketListeners() {\n    if (!this._socket) {\n      return this.logger.debug(\"Invalid socket instance to remove listeners\");\n    }\n    this._socket.removeEventListener(\"open\", this.wsOpenHandler);\n    this._socket.removeEventListener(\"close\", this.wsCloseHandler);\n    this._socket.removeEventListener(\"error\", this.wsErrorHandler);\n    this._socket.removeEventListener(\"message\", this._onSocketMessage);\n  }\n  async disconnect() {\n    if (!this._socket || this.closing) {\n      this.logger.debug(\"Session not connected or already in closing state.\");\n      return;\n    }\n    this._status = \"disconnecting\";\n    this._checkCurrentStatus();\n  }\n  execute(msg) {\n    if (this._status === \"disconnecting\") {\n      this.logger.warn(\"Reject request because the session is disconnecting\", msg);\n      return Promise.reject({\n        code: \"400\",\n        message: \"The SDK session is disconnecting\"\n      });\n    }\n    if (this._status === \"disconnected\") {\n      return Promise.reject({\n        code: \"400\",\n        message: \"The SDK is disconnected\"\n      });\n    }\n    let promise = Promise.resolve();\n    if (\"params\" in msg) {\n      promise = new Promise((resolve, reject) => {\n        this._requests.set(msg.id, { rpcRequest: msg, resolve, reject });\n      });\n    }\n    if (!this.ready) {\n      this._addToExecuteQueue(msg);\n      this.connect();\n      return promise;\n    }\n    this._send(msg);\n    return timeoutPromise(promise, this._executeTimeoutMs, this._executeTimeoutError).catch((error) => {\n      if (error === this._executeConnectionClosed) {\n        throw this._executeConnectionClosed;\n      } else if (error === this._executeTimeoutError) {\n        if (\"method\" in msg && msg.method === \"signalwire.connect\") {\n          throw this._swConnectError;\n        }\n        this._checkCurrentStatus();\n        this.logger.error(\"Request Timeout\", msg);\n        if (this.status === \"disconnected\") {\n          return this.logger.debug(\"Request failed because the session is disconnected\", this.status, this._socket);\n        }\n        this._closeConnection(\"reconnecting\");\n      } else {\n        throw error;\n      }\n    });\n  }\n  get _connectParams() {\n    return {\n      agent: this.agent,\n      version: this.connectVersion,\n      authentication: {\n        project: this.options.project,\n        token: this.options.token\n      }\n    };\n  }\n  async authenticate() {\n    var _a, _b;\n    const params = this._connectParams;\n    if (this._relayProtocolIsValid()) {\n      params.protocol = this.relayProtocol;\n    }\n    if ((_a = this.options.topics) == null ? void 0 : _a.length) {\n      params.contexts = this.options.topics;\n    } else if ((_b = this.options.contexts) == null ? void 0 : _b.length) {\n      params.contexts = this.options.contexts;\n    }\n    this._rpcConnectResult = await this.execute(RPCConnect(params));\n  }\n  authError(error) {\n    this._removeSocketListeners();\n    this.dispatch(authErrorAction({ error }));\n  }\n  forceClose() {\n    this._removeSocketListeners();\n    return this._closeConnection(\"reconnecting\");\n  }\n  async _onSocketOpen(event) {\n    this.logger.debug(\"_onSocketOpen\", event.type);\n    try {\n      this._status = \"unknown\";\n      this._clearTimers();\n      await this.authenticate();\n      this._status = \"connected\";\n      this._flushExecuteQueue();\n      this.dispatch(authSuccessAction());\n    } catch (error) {\n      if (error === this._swConnectError || error === this._executeConnectionClosed) {\n        this.logger.debug(\"Invalid connect or connection closed. Waiting for retry.\");\n        return;\n      }\n      this.logger.error(\"Auth Error\", error);\n      this.authError(error);\n    }\n  }\n  _onSocketError(event) {\n    this.logger.debug(\"_onSocketError\", event);\n  }\n  _onSocketClose(event) {\n    this.logger.debug(\"_onSocketClose\", event.type, event.code, event.reason);\n    if (this._status !== \"disconnected\") {\n      this._status = \"reconnecting\";\n      this.dispatch(sessionReconnectingAction());\n      this._clearTimers();\n      this._clearPendingRequests();\n      this._reconnectTimer = setTimeout(() => {\n        this.connect();\n      }, reconnectDelay());\n    }\n    this._socket = null;\n  }\n  _clearTimers() {\n    clearTimeout(this._reconnectTimer);\n  }\n  _clearPendingRequests() {\n    this.logger.debug(\"_clearPendingRequests\", this._requests.size);\n    this._requests.forEach(({ reject }) => {\n      reject(this._executeConnectionClosed);\n    });\n  }\n  _onSocketMessage(event) {\n    const payload = this.decode(event.data);\n    this.logger.wsTraffic({ type: \"recv\", payload });\n    if (isJSONRPCResponse(payload)) {\n      const request = this._requests.get(payload.id);\n      if (request) {\n        const { rpcRequest, resolve, reject } = request;\n        this._requests.delete(payload.id);\n        const { result, error } = parseRPCResponse({\n          response: payload,\n          request: rpcRequest\n        });\n        this._checkCurrentStatus();\n        return error ? reject(error) : resolve(result);\n      }\n      return this.logger.warn(\"Unknown request for\", payload);\n    }\n    switch (payload.method) {\n      case \"signalwire.ping\":\n        return this._pingHandler(payload);\n      case \"signalwire.disconnect\": {\n        this.execute(RPCDisconnectResponse(payload.id)).catch((error) => {\n          this.logger.error(\"SwDisconnect Error\", error);\n        }).finally(() => {\n          this._status = \"idle\";\n        });\n        break;\n      }\n      default:\n        this._eventAcknowledgingHandler(payload).catch((error) => this.logger.error(\"Event Acknowledging Error\", error));\n        this.dispatch(socketMessageAction(payload));\n    }\n  }\n  dispatch(_payload) {\n    if (!this._sessionChannel) {\n      throw new Error(\"Session channel does not exist\");\n    }\n    this._sessionChannel.put(_payload);\n  }\n  _relayProtocolIsValid() {\n    var _a;\n    return this.signature && ((_a = this == null ? void 0 : this.relayProtocol) == null ? void 0 : _a.split(\"_\")[1]) === this.signature;\n  }\n  encode(input) {\n    return JSON.stringify(input);\n  }\n  decode(input) {\n    return safeParseJson(input);\n  }\n  async onSwAuthorizationState(state) {\n    this.persistSwAuthorizationState(state);\n  }\n  async retrieveSwAuthorizationState() {\n    return \"\";\n  }\n  async persistSwAuthorizationState(_) {\n  }\n  _send(msg) {\n    this.logger.wsTraffic({ type: \"send\", payload: msg });\n    this._socket.send(this.encode(msg));\n  }\n  _addToExecuteQueue(msg) {\n    this.logger.warn(\"Request queued waiting for session to reconnect\", msg);\n    this._executeQueue.add(msg);\n  }\n  _flushExecuteQueue() {\n    if (!this._executeQueue.size) {\n      return;\n    }\n    if (!this.ready) {\n      this.logger.warn(`Session not ready to flush the queue.`);\n      this._closeConnection(\"reconnecting\");\n      return;\n    }\n    this.logger.debug(`${this._executeQueue.size} messages to flush`);\n    this._executeQueue.forEach((msg) => {\n      this._send(msg);\n      this._executeQueue.delete(msg);\n    });\n    this._executeQueue.clear();\n  }\n  _clearCheckPingTimer() {\n    clearTimeout(this._checkPingTimer);\n  }\n  async _pingHandler(payload) {\n    var _a;\n    this._clearCheckPingTimer();\n    this._checkPingTimer = setTimeout(() => {\n      this.logger.debug(\"Timeout waiting for ping\");\n      this._closeConnection(\"reconnecting\");\n    }, this._checkPingDelay);\n    await this.execute(RPCPingResponse(payload.id, (_a = payload == null ? void 0 : payload.params) == null ? void 0 : _a.timestamp));\n  }\n  async _eventAcknowledgingHandler(payload) {\n    const { method, id } = payload;\n    if (method === \"signalwire.event\") {\n      return this.execute(RPCEventAckResponse(id));\n    }\n    return Promise.resolve();\n  }\n  _checkCurrentStatus() {\n    switch (this._status) {\n      case \"disconnecting\":\n        if (this._requests.size > 0) {\n          return;\n        }\n        this._requests.clear();\n        this._closeConnection(\"disconnected\");\n        break;\n      case \"disconnected\":\n        this.dispatch(sessionDisconnectedAction());\n        break;\n      case \"reconnecting\":\n        this.wsCloseHandler(new this.CloseEventConstructor(\"close\", {\n          reason: \"Client-side closed\"\n        }));\n        break;\n    }\n  }\n  _closeConnection(status) {\n    this._clearCheckPingTimer();\n    this.logger.debug(\"Close Connection:\", status);\n    this._status = status;\n    this.dispatch(sessionActions.authStatus(status === \"disconnected\" ? \"unauthorized\" : \"unknown\"));\n    this._removeSocketListeners();\n    this.destroySocket();\n    this._checkCurrentStatus();\n  }\n};\n\n// src/BaseJWTSession.ts\nvar BaseJWTSession = class extends BaseSession {\n  constructor(options) {\n    super(options);\n    this.options = options;\n    __publicField(this, \"_expiredDiffSeconds\", 0);\n    __publicField(this, \"_refreshTokenNotificationDiff\", 120);\n    __publicField(this, \"_checkTokenExpirationDelay\", 20 * 1e3);\n    __publicField(this, \"_checkTokenExpirationTimer\", null);\n    this._checkTokenExpiration = this._checkTokenExpiration.bind(this);\n    this.reauthenticate = this.reauthenticate.bind(this);\n  }\n  get expiresAt() {\n    var _a;\n    if (!(this == null ? void 0 : this._rpcConnectResult)) {\n      return 0;\n    }\n    const { authorization } = this._rpcConnectResult;\n    const expiresAt = (_a = isSATAuth(authorization) ? authorization.fabric_subscriber.expires_at : authorization == null ? void 0 : authorization.expires_at) != null ? _a : 0;\n    if (typeof expiresAt === \"string\") {\n      const parsed = Date.parse(expiresAt);\n      if (!isNaN(parsed)) {\n        return Math.floor(parsed / 1e3);\n      }\n    }\n    return expiresAt;\n  }\n  get expiresIn() {\n    const now = Math.floor(Date.now() / 1e3);\n    return this.expiresAt - now;\n  }\n  get expired() {\n    return this.expiresAt > 0 && this.expiresIn <= this._expiredDiffSeconds;\n  }\n  async authenticate() {\n    const params = __spreadProps(__spreadValues({}, this._connectParams), {\n      authentication: {\n        jwt_token: this.options.token\n      }\n    });\n    if (this._relayProtocolIsValid()) {\n      params.protocol = this.relayProtocol;\n    } else {\n      const prevProtocol = await this.retrieveRelayProtocol();\n      if (prevProtocol) {\n        params.protocol = prevProtocol;\n      }\n    }\n    if (params.protocol) {\n      const authorizationState = await this.retrieveSwAuthorizationState();\n      if (authorizationState) {\n        params.authorization_state = authorizationState;\n      }\n    }\n    try {\n      this._rpcConnectResult = await this.execute(RPCConnect(params));\n      await this.persistRelayProtocol();\n      await this._checkTokenExpiration();\n    } catch (error) {\n      this.logger.debug(\"BaseJWTSession authenticate error\", error);\n      throw error;\n    }\n  }\n  async retrieveRelayProtocol() {\n    return \"\";\n  }\n  async persistRelayProtocol() {\n  }\n  async reauthenticate() {\n    this.logger.debug(\"Session Reauthenticate\", {\n      ready: this.ready,\n      expired: this.expired\n    });\n    if (!this.ready || this.expired) {\n      return this.connect();\n    }\n    const params = {\n      project: this._rpcConnectResult.authorization.project_id,\n      jwt_token: this.options.token\n    };\n    try {\n      this._rpcConnectResult = await this.execute(RPCReauthenticate(params));\n    } catch (error) {\n      clearTimeout(this._checkTokenExpirationTimer);\n      throw error;\n    }\n  }\n  _onSocketClose(event) {\n    clearTimeout(this._checkTokenExpirationTimer);\n    super._onSocketClose(event);\n  }\n  async _checkTokenExpiration() {\n    if (!this.expiresAt) {\n      return;\n    }\n    const refreshTokenFn = this.options.onRefreshToken;\n    if (this.expiresIn <= this._refreshTokenNotificationDiff) {\n      this.dispatch(authExpiringAction());\n      if (typeof refreshTokenFn === \"function\") {\n        try {\n          const token = await refreshTokenFn();\n          this.dispatch(reauthAction({ token }));\n        } catch (error) {\n          this.logger.error(error);\n        }\n      } else {\n        this.logger.warn(\"The token is going to expire!\");\n      }\n    }\n    clearTimeout(this._checkTokenExpirationTimer);\n    if (!this.expired) {\n      this._checkTokenExpirationTimer = setTimeout(this._checkTokenExpiration, this._checkTokenExpirationDelay);\n    }\n  }\n};\n\n// src/redux/index.ts\nvar redux_exports = {};\n__export(redux_exports, {\n  authErrorAction: () => authErrorAction,\n  authExpiringAction: () => authExpiringAction,\n  authSuccessAction: () => authSuccessAction,\n  configureStore: () => configureStore2,\n  connect: () => connect,\n  createAction: () => createAction,\n  createCatchableSaga: () => createCatchableSaga,\n  createRestartableSaga: () => createRestartableSaga,\n  destroyAction: () => destroyAction,\n  eventChannel: () => eventChannel,\n  getCustomSagaActionType: () => getCustomSagaActionType,\n  initAction: () => initAction,\n  makeCustomSagaAction: () => makeCustomSagaAction,\n  reauthAction: () => reauthAction,\n  sessionDisconnectedAction: () => sessionDisconnectedAction,\n  sessionForceCloseAction: () => sessionForceCloseAction,\n  sessionReconnectingAction: () => sessionReconnectingAction,\n  socketMessageAction: () => socketMessageAction\n});\nimport createSagaMiddleware, {\n  channel,\n  multicastChannel\n} from \"@redux-saga/core\";\n\n// src/redux/features/component/componentSlice.ts\nvar initialComponentState = {\n  byId: {}\n};\nvar componentSlice = createDestroyableSlice({\n  name: \"components\",\n  initialState: initialComponentState,\n  reducers: {\n    upsert: (state, { payload }) => {\n      if (payload.id in state.byId) {\n        return __spreadProps(__spreadValues({}, state), {\n          byId: __spreadProps(__spreadValues({}, state.byId), {\n            [payload.id]: __spreadValues(__spreadValues({}, state.byId[payload.id]), payload)\n          })\n        });\n      } else {\n        return __spreadProps(__spreadValues({}, state), {\n          byId: __spreadProps(__spreadValues({}, state.byId), {\n            [payload.id]: payload\n          })\n        });\n      }\n    },\n    cleanup: (state, { payload }) => {\n      return __spreadProps(__spreadValues({}, state), {\n        byId: Object.entries(state.byId).reduce((reducer, [componentId, value]) => {\n          if (!payload.ids.includes(componentId)) {\n            reducer[componentId] = value;\n          }\n          return reducer;\n        }, {})\n      });\n    }\n  }\n});\nvar {\n  actions: componentActions,\n  reducer: componentReducer\n} = componentSlice;\n\n// src/redux/rootReducer.ts\nvar rootReducer = (0, toolkit_exports.combineReducers)({\n  components: componentReducer,\n  session: sessionReducer\n});\n\n// src/redux/rootSaga.ts\nimport { fork as fork2, call as call2, take as take2, put as put2, all, cancelled } from \"@redux-saga/core/effects\";\n\n// src/redux/features/session/sessionSaga.ts\nimport { put, take, fork } from \"@redux-saga/core/effects\";\n\n// src/redux/utils/sagaHelpers.ts\nvar sagaHelpers_exports = {};\n__export(sagaHelpers_exports, {\n  createCatchableSaga: () => createCatchableSaga,\n  createRestartableSaga: () => createRestartableSaga,\n  eventChannel: () => eventChannel\n});\nimport { call, spawn } from \"@redux-saga/core/effects\";\nimport { eventChannel } from \"@redux-saga/core\";\nvar createRestartableSaga = (saga) => {\n  return function* () {\n    spawn(function* () {\n      while (true) {\n        try {\n          getLogger().debug(\"Run a restartable saga\");\n          yield call(saga);\n          getLogger().debug(\"One of the restartable saga has ended. Restarting..\");\n        } catch (error) {\n          getLogger().error(\"Restartable Saga Error\", error);\n        }\n      }\n    });\n  };\n};\nvar defaultCatchHandler = (error) => getLogger().error(\"Catchable Saga Error\", error);\nvar createCatchableSaga = (saga, errorHandler = defaultCatchHandler) => {\n  return function* (...params) {\n    try {\n      yield call(saga, ...params);\n    } catch (error) {\n      errorHandler(error);\n    }\n  };\n};\n\n// src/redux/features/session/sessionSaga.ts\nvar isWebrtcEvent = (e) => {\n  return isWebrtcEventType(e == null ? void 0 : e.event_type);\n};\nvar isVideoEvent = (e) => {\n  var _a;\n  return !!((_a = e == null ? void 0 : e.event_type) == null ? void 0 : _a.startsWith(\"video.\"));\n};\nvar isSwAuthorizationState = (e) => {\n  return (e == null ? void 0 : e.event_type) === \"signalwire.authorization.state\";\n};\nfunction* sessionChannelWatcher({\n  sessionChannel,\n  swEventChannel,\n  session\n}) {\n  function* swEventWorker(broadcastParams) {\n    yield put(swEventChannel, toInternalAction(broadcastParams));\n    if (isWebrtcEvent(broadcastParams) || isVideoEvent(broadcastParams)) {\n      return;\n    }\n    if (isSwAuthorizationState(broadcastParams)) {\n      session.onSwAuthorizationState(broadcastParams.params.authorization_state);\n      return;\n    }\n    yield put({ type: broadcastParams.event_type, payload: broadcastParams });\n  }\n  function* sessionChannelWorker(action) {\n    if (action.type !== socketMessageAction.type) {\n      yield put(action);\n      return;\n    }\n    const { method, params } = action.payload;\n    switch (method) {\n      case \"signalwire.event\":\n        yield fork(swEventWorker, params);\n        break;\n      default:\n        return getLogger().debug(`Unknown message: ${method}`, action);\n    }\n  }\n  const sessionChannelWorkerCatchable = createCatchableSaga(sessionChannelWorker, (error) => {\n    getLogger().error(\"Channel Error\", error);\n  });\n  while (true) {\n    try {\n      while (true) {\n        const action = yield take(sessionChannel);\n        yield fork(sessionChannelWorkerCatchable, action);\n      }\n    } catch (error) {\n      getLogger().error(\"sessionChannelWorker error:\", error);\n    } finally {\n      getLogger().debug(\"sessionChannelWorker finally\");\n    }\n  }\n}\n\n// src/CustomErrors.ts\nvar AuthError = class extends Error {\n  constructor(code, message) {\n    super(message);\n    this.code = code;\n    this.message = message;\n    __publicField(this, \"name\", \"AuthError\");\n    Object.setPrototypeOf(this, AuthError.prototype);\n  }\n};\nvar HttpError = class extends Error {\n  constructor(code, message, response) {\n    super(message);\n    this.code = code;\n    this.message = message;\n    this.response = response;\n    __publicField(this, \"name\", \"HttpError\");\n    Object.setPrototypeOf(this, HttpError.prototype);\n  }\n};\n\n// src/redux/rootSaga.ts\nfunction* initSessionSaga({\n  initSession,\n  sessionEmitter,\n  userOptions,\n  channels\n}) {\n  var _a;\n  const session = initSession();\n  const swEventChannel = channels.swEventChannel;\n  const sessionChannel = channels.sessionChannel;\n  let customTasks = [];\n  if ((_a = userOptions.workers) == null ? void 0 : _a.length) {\n    try {\n      const effects = userOptions.workers.map((saga) => {\n        return call2(createRestartableSaga(saga));\n      });\n      customTasks = yield all(effects);\n    } catch (error) {\n      getLogger().error(\"Error running custom workers\", error);\n    }\n  }\n  yield fork2(sessionChannelWatcher, {\n    session,\n    sessionChannel,\n    swEventChannel\n  });\n  const sessionStatusTask = yield fork2(sessionStatusWatcher, {\n    session,\n    sessionEmitter,\n    sessionChannel,\n    userOptions\n  });\n  session.connect();\n  yield take2(destroyAction.type);\n  session.disconnect();\n  yield take2(sessionDisconnectedAction.type);\n  sessionEmitter.emit(\"session.disconnected\");\n  sessionStatusTask.cancel();\n  customTasks.forEach((task) => task.cancel());\n}\nfunction* reauthenticateWorker({\n  session,\n  token,\n  sessionEmitter\n}) {\n  try {\n    if (session.reauthenticate) {\n      session.token = token;\n      yield call2(session.reauthenticate);\n      yield put2(sessionActions.connected(session.rpcConnectResult));\n      sessionEmitter.emit(\"session.connected\");\n    }\n  } catch (error) {\n    getLogger().error(\"Reauthenticate Error\", error);\n    session.authError(error);\n  }\n}\nfunction* sessionStatusWatcher(options) {\n  getLogger().debug(\"sessionStatusWatcher [started]\");\n  const { session, sessionEmitter } = options;\n  try {\n    while (true) {\n      const action = yield take2([\n        authSuccessAction.type,\n        authErrorAction.type,\n        authExpiringAction.type,\n        reauthAction.type,\n        sessionReconnectingAction.type,\n        sessionForceCloseAction.type\n      ]);\n      getLogger().trace(\"sessionStatusWatcher\", action.type, action.payload);\n      switch (action.type) {\n        case authSuccessAction.type: {\n          yield put2(sessionActions.connected(session.rpcConnectResult));\n          sessionEmitter.emit(\"session.connected\");\n          break;\n        }\n        case authErrorAction.type: {\n          yield fork2(sessionAuthErrorSaga, __spreadProps(__spreadValues({}, options), {\n            action\n          }));\n          break;\n        }\n        case authExpiringAction.type: {\n          sessionEmitter.emit(\"session.expiring\");\n          break;\n        }\n        case reauthAction.type: {\n          yield fork2(reauthenticateWorker, {\n            session,\n            token: action.payload.token,\n            sessionEmitter\n          });\n          break;\n        }\n        case sessionReconnectingAction.type: {\n          sessionEmitter.emit(\"session.reconnecting\");\n          break;\n        }\n        case sessionForceCloseAction.type: {\n          session.forceClose();\n          break;\n        }\n      }\n    }\n  } finally {\n    if (yield cancelled()) {\n      getLogger().debug(\"sessionStatusWatcher [cancelled]\");\n    }\n  }\n}\nfunction* sessionAuthErrorSaga(options) {\n  getLogger().debug(\"sessionAuthErrorSaga [started]\");\n  try {\n    const { action, sessionEmitter } = options;\n    const { error: authError } = action.payload;\n    const error = authError ? new AuthError(authError.code, authError.message) : new Error(\"Unauthorized\");\n    sessionEmitter.emit(\"session.auth_error\", error);\n  } finally {\n    if (yield cancelled()) {\n      getLogger().debug(\"sessionAuthErrorSaga [cancelled]\");\n    }\n  }\n}\nvar rootSaga_default = (options) => {\n  return function* root({\n    userOptions,\n    channels\n  }) {\n    var _a;\n    if (userOptions.logger) {\n      setLogger(userOptions.logger);\n    }\n    if (userOptions.debug) {\n      setDebugOptions(userOptions.debug);\n    }\n    while (true) {\n      const action = yield take2([initAction.type, reauthAction.type]);\n      if ((_a = action == null ? void 0 : action.payload) == null ? void 0 : _a.token) {\n        userOptions.token = action.payload.token;\n      }\n      try {\n        yield call2(initSessionSaga, __spreadProps(__spreadValues({}, options), {\n          userOptions,\n          channels\n        }));\n      } catch (error) {\n        getLogger().error(\"RootSaga Error:\", error);\n      } finally {\n        if (yield cancelled()) {\n          getLogger().debug(\"rootSaga [cancelled]\");\n        }\n        getLogger().debug(\"Reboot rootSaga\");\n      }\n    }\n  };\n};\n\n// src/redux/features/session/sessionSelectors.ts\nvar sessionSelectors_exports = {};\n__export(sessionSelectors_exports, {\n  getAuthError: () => getAuthError,\n  getAuthState: () => getAuthState,\n  getAuthStatus: () => getAuthStatus,\n  getIceServers: () => getIceServers,\n  getSession: () => getSession\n});\nvar getIceServers = ({ session }) => {\n  var _a;\n  return (_a = session == null ? void 0 : session.iceServers) != null ? _a : [];\n};\nvar getSession = (store) => {\n  return store.session;\n};\nvar getAuthStatus = ({ session }) => {\n  return session.authStatus;\n};\nvar getAuthError = ({ session }) => {\n  return session.authError;\n};\nvar getAuthState = ({ session }) => {\n  return session.authState;\n};\n\n// src/redux/connect.ts\nvar connect = (options) => {\n  const { sessionListeners = {}, store, Component, customSagas = [] } = options;\n  const sessionKeys = Object.keys(sessionListeners);\n  return (userOptions) => {\n    const instance = new Component(__spreadProps(__spreadValues({}, userOptions), { store }));\n    const cacheMap = /* @__PURE__ */ new Map();\n    let run = true;\n    const storeUnsubscribe = store.subscribe(() => {\n      const state = store.getState();\n      const session = getSession(state);\n      for (const reduxKey of sessionKeys) {\n        if (run === false) {\n          return;\n        }\n        const cacheKey = `session.${reduxKey}`;\n        const current = cacheMap.get(cacheKey);\n        const updatedValue = session[reduxKey];\n        if (updatedValue !== void 0 && current !== updatedValue) {\n          cacheMap.set(cacheKey, updatedValue);\n          const fnName = sessionListeners[reduxKey];\n          if (typeof fnName === \"string\") {\n            instance[fnName](session);\n          } else if (typeof fnName === \"function\") {\n            fnName(session);\n          }\n        }\n      }\n    });\n    const taskList = customSagas == null ? void 0 : customSagas.map((saga) => {\n      return store.runSaga(saga, { instance, runSaga: store.runSaga });\n    });\n    instance.destroyer = () => {\n      run = false;\n      storeUnsubscribe();\n      cacheMap.clear();\n      if (taskList == null ? void 0 : taskList.length) {\n        taskList.forEach((task) => task.cancel());\n      }\n    };\n    return instance;\n  };\n};\n\n// src/utils/EventEmitter.ts\nimport EventEmitter from \"eventemitter3\";\nvar getEventEmitter = () => {\n  return new EventEmitter();\n};\n\n// src/redux/utils/useSession.ts\nvar useSession = (options) => {\n  const { SessionConstructor, userOptions, sessionChannel } = options;\n  const sessionEmitter = getEventEmitter();\n  let session = null;\n  const initSession = () => {\n    session = new SessionConstructor(__spreadProps(__spreadValues({}, userOptions), {\n      sessionChannel\n    }));\n    return session;\n  };\n  const getSession2 = () => {\n    if (!session) {\n      getLogger().warn(\"Custom worker started without the session\");\n    }\n    return session;\n  };\n  return { session, initSession, getSession: getSession2, sessionEmitter };\n};\n\n// src/redux/utils/useInstanceMap.ts\nvar useInstanceMap = () => {\n  const instanceMap = /* @__PURE__ */ new Map();\n  const getInstance = (key) => {\n    return instanceMap.get(key);\n  };\n  const setInstance = (key, value) => {\n    instanceMap.set(key, value);\n    return instanceMap;\n  };\n  const deleteInstance = (key) => {\n    instanceMap.delete(key);\n    return instanceMap;\n  };\n  const getAllInstances = () => {\n    return Array.from(instanceMap.entries());\n  };\n  const deleteAllInstances = () => {\n    instanceMap.clear();\n    return instanceMap;\n  };\n  return {\n    get: getInstance,\n    set: setInstance,\n    remove: deleteInstance,\n    getAll: getAllInstances,\n    deleteAll: deleteAllInstances\n  };\n};\n\n// src/redux/index.ts\n__reExport(redux_exports, toolkit_exports);\nvar configureStore2 = (options) => {\n  var _a;\n  const {\n    userOptions,\n    SessionConstructor,\n    preloadedState = {},\n    runSagaMiddleware = true\n  } = options;\n  const sagaMiddleware = createSagaMiddleware();\n  const swEventChannel = multicastChannel();\n  const sessionChannel = channel();\n  const channels = {\n    swEventChannel,\n    sessionChannel\n  };\n  const store = configureStore({\n    devTools: (_a = userOptions == null ? void 0 : userOptions.devTools) != null ? _a : true,\n    reducer: rootReducer,\n    preloadedState,\n    middleware: (getDefaultMiddleware) => getDefaultMiddleware().concat(sagaMiddleware)\n  });\n  const instanceMap = useInstanceMap();\n  const { initSession, getSession: getSession2, sessionEmitter } = useSession({\n    userOptions,\n    sessionChannel,\n    SessionConstructor\n  });\n  const runSaga = (saga, args) => {\n    return sagaMiddleware.run(saga, __spreadProps(__spreadValues({}, args), {\n      channels,\n      getSession: getSession2,\n      instanceMap\n    }));\n  };\n  if (runSagaMiddleware) {\n    const saga = rootSaga_default({\n      initSession,\n      sessionEmitter\n    });\n    sagaMiddleware.run(saga, { userOptions, channels });\n  }\n  return __spreadProps(__spreadValues({}, store), {\n    runSaga,\n    channels,\n    instanceMap,\n    sessionEmitter\n  });\n};\n\n// src/workers/executeActionWorker.ts\nimport { call as call3 } from \"@redux-saga/core/effects\";\nvar executeActionWorker = function* (options) {\n  const { initialState, onDone, onFail, getSession: getSession2 } = options;\n  const { requestId: id, method, params } = initialState;\n  const session = getSession2();\n  if (!session) {\n    const error = new Error(\"Session does not exist!\");\n    getLogger().error(error);\n    onFail == null ? void 0 : onFail(error);\n    return;\n  }\n  try {\n    let message = RPCExecute({ id, method, params });\n    const response = yield call3(session.execute, message);\n    onDone == null ? void 0 : onDone(response);\n  } catch (error) {\n    getLogger().warn(\"Execute error: \", error);\n    onFail == null ? void 0 : onFail(error);\n  }\n};\n\n// src/BaseComponent.ts\nvar identity = (payload) => payload;\nvar SW_SYMBOL2 = Symbol(\"BaseComponent\");\nvar BaseComponent = class {\n  constructor(options) {\n    this.options = options;\n    __publicField(this, \"__sw_symbol\", SW_SYMBOL2);\n    __publicField(this, \"uuid\", v4());\n    __publicField(this, \"_customSagaTriggers\", /* @__PURE__ */ new Map());\n    __publicField(this, \"_destroyer\");\n    __publicField(this, \"eventEmitter\");\n    __publicField(this, \"_runningWorkers\", []);\n    __publicField(this, \"_workers\", /* @__PURE__ */ new Map());\n    this.eventEmitter = new EventEmitter();\n  }\n  get __uuid() {\n    return this.uuid;\n  }\n  get logger() {\n    return getLogger();\n  }\n  set destroyer(d) {\n    this._destroyer = d;\n  }\n  get store() {\n    return this.options.store;\n  }\n  get instanceMap() {\n    return this.store.instanceMap;\n  }\n  get emitter() {\n    return this.eventEmitter;\n  }\n  get sessionEmitter() {\n    return this.store.sessionEmitter;\n  }\n  get session() {\n    return this.sessionEmitter;\n  }\n  on(event, fn) {\n    return this.emitter.on(event, fn);\n  }\n  once(event, fn) {\n    return this.emitter.once(event, fn);\n  }\n  off(event, fn) {\n    return this.emitter.off(event, fn);\n  }\n  removeAllListeners(event) {\n    if (event) {\n      return this.off(event);\n    }\n    this.eventNames().forEach((eventName) => {\n      this.off(eventName);\n    });\n    this.sessionEventNames().forEach((eventName) => {\n      this.sessionEmitter.off(eventName);\n    });\n    return this.emitter;\n  }\n  eventNames() {\n    return this.emitter.eventNames();\n  }\n  sessionEventNames() {\n    return this.sessionEmitter.eventNames();\n  }\n  getSubscriptions() {\n    return validateEventsToSubscribe(this.eventNames());\n  }\n  emit(event, ...args) {\n    return this.emitter.emit(event, ...args);\n  }\n  listenerCount(event) {\n    return this.emitter.listenerCount(event);\n  }\n  destroy() {\n    var _a;\n    (_a = this._destroyer) == null ? void 0 : _a.call(this);\n    this.removeAllListeners();\n    this.detachWorkers();\n  }\n  execute({ method, params }, {\n    transformParams = identity,\n    transformResolve = identity,\n    transformReject = identity\n  } = {\n    transformParams: identity,\n    transformResolve: identity,\n    transformReject: identity\n  }) {\n    return new Promise((resolve, reject) => {\n      const requestId = v4();\n      this.runWorker(\"executeActionWorker\", {\n        worker: executeActionWorker,\n        onDone: (data) => resolve(transformResolve(data)),\n        onFail: (error) => reject(transformReject(error)),\n        initialState: {\n          requestId,\n          componentId: this.__uuid,\n          method,\n          params: transformParams(params)\n        }\n      });\n    });\n  }\n  triggerCustomSaga(action) {\n    return new Promise((resolve, reject) => {\n      const dispatchId = v4();\n      this._customSagaTriggers.set(dispatchId, { resolve, reject });\n      this.store.dispatch(__spreadValues({\n        dispatchId\n      }, makeCustomSagaAction(this.__uuid, action)));\n    });\n  }\n  settleCustomSagaTrigger({\n    dispatchId,\n    payload,\n    kind\n  }) {\n    const actions = this._customSagaTriggers.get(dispatchId);\n    if (actions) {\n      actions[kind](payload);\n      this._customSagaTriggers.delete(dispatchId);\n    }\n  }\n  select(selectorFn) {\n    return selectorFn(this.store.getState());\n  }\n  getStateProperty(param) {\n    return this[param];\n  }\n  get _sessionAuthStatus() {\n    return getAuthStatus(this.store.getState());\n  }\n  get _sessionAuthState() {\n    return getAuthState(this.store.getState());\n  }\n  _waitUntilSessionAuthorized() {\n    const authStatus = getAuthStatus(this.store.getState());\n    switch (authStatus) {\n      case \"authorized\":\n        return Promise.resolve(this);\n      case \"unknown\":\n      case \"authorizing\":\n        return new Promise((resolve, reject) => {\n          const unsubscribe = this.store.subscribe(() => {\n            const authStatus2 = getAuthStatus(this.store.getState());\n            const authError = getAuthError(this.store.getState());\n            if (authStatus2 === \"authorized\") {\n              resolve(this);\n              unsubscribe();\n            } else if (authStatus2 === \"unauthorized\") {\n              const error = authError ? new AuthError(authError.code, authError.message) : new Error(\"Unauthorized\");\n              reject(error);\n              unsubscribe();\n            }\n          });\n        });\n      case \"unauthorized\":\n        return Promise.reject(new Error(\"Unauthorized\"));\n    }\n  }\n  runWorker(name, def) {\n    if (this._workers.has(name)) {\n      getLogger().warn(`[runWorker] Worker with name ${name} has already been registerd.`);\n    } else {\n      this._setWorker(name, def);\n    }\n    return this._attachWorker(name, def);\n  }\n  _setWorker(name, def) {\n    this._workers.set(name, def);\n  }\n  _attachWorker(name, _a) {\n    var _b = _a, { worker } = _b, params = __objRest(_b, [\"worker\"]);\n    const task = this.store.runSaga(worker, __spreadValues({\n      instance: this,\n      runSaga: this.store.runSaga\n    }, params));\n    this._runningWorkers.push(task);\n    this._workers.delete(name);\n    return task;\n  }\n  detachWorkers() {\n    this._runningWorkers.forEach((task) => {\n      task.cancel();\n    });\n    this._runningWorkers = [];\n  }\n};\n\n// src/BaseClient.ts\nvar BaseClient = class extends BaseComponent {\n  constructor(options) {\n    super(options);\n    this.options = options;\n  }\n  connect() {\n    const authStatus = getAuthStatus(this.store.getState());\n    if (authStatus === \"unknown\" || authStatus === \"unauthorized\") {\n      this.store.dispatch(initAction());\n    }\n    return this._waitUntilSessionAuthorized();\n  }\n  disconnect() {\n    this.store.dispatch(destroyAction());\n  }\n};\n\n// src/BaseConsumer.ts\nvar BaseConsumer = class extends BaseComponent {\n  constructor(options) {\n    super(options);\n    this.options = options;\n    __publicField(this, \"subscribeMethod\", \"signalwire.subscribe\");\n    __publicField(this, \"subscribeParams\", {});\n    __publicField(this, \"_latestExecuteParams\");\n    const resetLatestExecuteParams = () => {\n      this._latestExecuteParams = void 0;\n    };\n    super.session.on(\"session.connected\", resetLatestExecuteParams);\n    super.session.on(\"session.disconnected\", resetLatestExecuteParams);\n    super.session.on(\"session.reconnecting\", resetLatestExecuteParams);\n  }\n  shouldExecuteSubscribe(execParams) {\n    return !this._latestExecuteParams || JSON.stringify(execParams) !== JSON.stringify(this._latestExecuteParams);\n  }\n  async subscribe() {\n    await this._waitUntilSessionAuthorized();\n    const subscriptions = this.getSubscriptions();\n    if (subscriptions.length === 0) {\n      this.logger.debug(\"`subscribe()` was called without any listeners attached.\");\n      return;\n    }\n    const execParams = {\n      method: this.subscribeMethod,\n      params: __spreadProps(__spreadValues({}, this.subscribeParams), {\n        event_channel: this.getStateProperty(\"eventChannel\"),\n        events: subscriptions\n      })\n    };\n    if (!this.shouldExecuteSubscribe(execParams)) {\n      this.logger.debug(\"BaseConsumer.subscribe() - Skipped .execute() since the execParams are exactly the same as last time\");\n      return;\n    }\n    this._latestExecuteParams = execParams;\n    return new Promise(async (resolve, reject) => {\n      try {\n        await this.execute(execParams);\n        return resolve(void 0);\n      } catch (error) {\n        return reject(error);\n      }\n    });\n  }\n};\n\n// src/redux/features/shared/namespace.ts\nvar isVideoMemberEvent = (action) => {\n  return action.type.startsWith(\"video.member.\") || action.type.startsWith(\"video.__synthetic__.member\");\n};\nvar isVideoRoomEvent = (action) => {\n  return action.type.startsWith(\"video.room.\");\n};\nvar isVideoRoomAudienceCountEvent = (action) => {\n  return action.type === \"video.room.audience_count\" || action.type === \"video.room.audienceCount\";\n};\nvar isVideoLayoutEvent = (action) => {\n  return action.type.startsWith(\"video.layout.\");\n};\nvar isVideoRecordingEvent = (action) => {\n  return action.type.startsWith(\"video.recording.\");\n};\nvar isVideoPlaybackEvent = (action) => {\n  return action.type.startsWith(\"video.playback.\");\n};\nvar isVideoStreamEvent = (action) => {\n  return action.type.startsWith(\"video.stream.\");\n};\nvar isChatEvent = (action) => {\n  return action.type.startsWith(\"chat.\");\n};\nvar isVoiceCallEvent = (action) => {\n  return action.type.startsWith(\"calling.\");\n};\nvar findNamespaceInPayload = (action) => {\n  var _a;\n  if (action.payload === void 0) {\n    return \"\";\n  } else if (isVideoMemberEvent(action) || isVideoLayoutEvent(action) || isVideoRecordingEvent(action) || isVideoPlaybackEvent(action) || isVideoStreamEvent(action) || isVideoRoomAudienceCountEvent(action)) {\n    return action.payload.room_session_id;\n  } else if (isVideoRoomEvent(action)) {\n    return action.payload.room_session.id;\n  } else if (isChatEvent(action)) {\n    return \"\";\n  } else if (isVoiceCallEvent(action)) {\n    return (_a = action.payload.tag) != null ? _a : \"\";\n  }\n  if (process.env.NODE_ENV === \"development\") {\n    getLogger().info(\"Namespace not found for action.type: \", action == null ? void 0 : action.type);\n  }\n  return \"\";\n};\n\n// src/types/videoMember.ts\nvar INTERNAL_MEMBER_UPDATABLE_PROPS = {\n  audio_muted: true,\n  video_muted: true,\n  deaf: true,\n  visible: true,\n  input_volume: 1,\n  output_volume: 1,\n  input_sensitivity: 1\n};\nvar INTERNAL_MEMBER_UPDATED_EVENTS = Object.keys(INTERNAL_MEMBER_UPDATABLE_PROPS).map((key) => {\n  return `${PRODUCT_PREFIX_VIDEO}.member.updated.${key}`;\n});\nvar MEMBER_UPDATABLE_PROPS = toExternalJSON(INTERNAL_MEMBER_UPDATABLE_PROPS);\nvar MEMBER_UPDATED_EVENTS = Object.keys(MEMBER_UPDATABLE_PROPS).map((key) => {\n  return `member.updated.${key}`;\n});\n\n// src/redux/features/component/componentSelectors.ts\nvar componentSelectors_exports = {};\n__export(componentSelectors_exports, {\n  getComponent: () => getComponent,\n  getComponentsById: () => getComponentsById,\n  getComponentsToCleanup: () => getComponentsToCleanup\n});\nvar getComponent = ({ components }, id) => {\n  var _a;\n  return (_a = components.byId) == null ? void 0 : _a[id];\n};\nvar getComponentsById = ({ components }) => {\n  return components.byId;\n};\nvar getComponentsToCleanup = (state) => {\n  const components = getComponentsById(state);\n  let toCleanup = [];\n  Object.keys(components).forEach((id) => {\n    if (components[id].responses || components[id].errors) {\n      toCleanup.push(id);\n    }\n  });\n  return toCleanup;\n};\n\n// src/index.ts\nimport * as sagaEffects from \"@redux-saga/core/effects\";\n\n// src/rooms/index.ts\nvar rooms_exports = {};\n__export(rooms_exports, {\n  RoomSessionMemberAPI: () => RoomSessionMemberAPI,\n  RoomSessionPlaybackAPI: () => RoomSessionPlaybackAPI,\n  RoomSessionRecordingAPI: () => RoomSessionRecordingAPI,\n  RoomSessionStreamAPI: () => RoomSessionStreamAPI,\n  audioMuteMember: () => audioMuteMember,\n  audioUnmuteMember: () => audioUnmuteMember,\n  createRoomSessionMemberObject: () => createRoomSessionMemberObject,\n  createRoomSessionPlaybackObject: () => createRoomSessionPlaybackObject,\n  createRoomSessionRecordingObject: () => createRoomSessionRecordingObject,\n  createRoomSessionStreamObject: () => createRoomSessionStreamObject,\n  deafMember: () => deafMember,\n  deleteMemberMeta: () => deleteMemberMeta,\n  deleteMeta: () => deleteMeta,\n  demote: () => demote,\n  getLayouts: () => getLayouts,\n  getMemberMeta: () => getMemberMeta,\n  getMembers: () => getMembers,\n  getMeta: () => getMeta,\n  getPlaybacks: () => getPlaybacks,\n  getRecordings: () => getRecordings,\n  getStreams: () => getStreams,\n  hideVideoMuted: () => hideVideoMuted,\n  lock: () => lock,\n  play: () => play,\n  promote: () => promote,\n  removeAllMembers: () => removeAllMembers,\n  removeMember: () => removeMember,\n  setDeaf: () => setDeaf,\n  setHideVideoMuted: () => setHideVideoMuted,\n  setInputSensitivityMember: () => setInputSensitivityMember,\n  setInputVolumeMember: () => setInputVolumeMember,\n  setLayout: () => setLayout,\n  setMemberMeta: () => setMemberMeta,\n  setMemberPosition: () => setMemberPosition,\n  setMeta: () => setMeta,\n  setOutputVolumeMember: () => setOutputVolumeMember,\n  setPositions: () => setPositions,\n  setPrioritizeHandraise: () => setPrioritizeHandraise,\n  setRaisedHand: () => setRaisedHand,\n  showVideoMuted: () => showVideoMuted,\n  startRecording: () => startRecording,\n  startStream: () => startStream,\n  undeafMember: () => undeafMember,\n  unlock: () => unlock,\n  updateMemberMeta: () => updateMemberMeta,\n  updateMeta: () => updateMeta,\n  videoMuteMember: () => videoMuteMember,\n  videoUnmuteMember: () => videoUnmuteMember\n});\n\n// src/rooms/methods.ts\nvar baseCodeTransform = () => {\n};\nvar createRoomMethod = (method, options = {}) => ({\n  value: function(params = {}) {\n    return this.execute({\n      method,\n      params: __spreadValues({\n        room_session_id: this.roomSessionId\n      }, params)\n    }, options);\n  }\n});\nvar createRoomMemberMethod = (method, options = {}) => ({\n  value: function(_a = {}) {\n    var _b = _a, { memberId } = _b, rest = __objRest(_b, [\"memberId\"]);\n    return this.execute({\n      method,\n      params: __spreadValues({\n        room_session_id: this.roomSessionId,\n        member_id: memberId || this.memberId\n      }, rest)\n    }, options);\n  }\n});\nvar getLayouts = createRoomMethod(\"video.list_available_layouts\", {\n  transformResolve: (payload) => ({ layouts: payload.layouts })\n});\nvar getMembers = createRoomMethod(\"video.members.get\", {\n  transformResolve: (payload) => ({ members: payload.members })\n});\nvar setLayout = createRoomMethod(\"video.set_layout\", {\n  transformResolve: baseCodeTransform\n});\nvar setPositions = createRoomMethod(\"video.set_position\", {\n  transformResolve: baseCodeTransform\n});\nvar hideVideoMuted = createRoomMethod(\"video.hide_video_muted\", {\n  transformResolve: baseCodeTransform\n});\nvar showVideoMuted = createRoomMethod(\"video.show_video_muted\", {\n  transformResolve: baseCodeTransform\n});\nvar lock = createRoomMethod(\"video.lock\", {\n  transformResolve: baseCodeTransform\n});\nvar unlock = createRoomMethod(\"video.unlock\", {\n  transformResolve: baseCodeTransform\n});\nvar setHideVideoMuted = {\n  value: function(value) {\n    return this.execute({\n      method: value ? \"video.hide_video_muted\" : \"video.show_video_muted\",\n      params: {\n        room_session_id: this.roomSessionId\n      }\n    }, {\n      transformResolve: baseCodeTransform\n    });\n  }\n};\nvar getRecordings = {\n  value: function() {\n    return new Promise(async (resolve, reject) => {\n      try {\n        const { recordings } = await this.execute({\n          method: \"video.recording.list\",\n          params: {\n            room_session_id: this.roomSessionId\n          }\n        });\n        const recordingInstances = [];\n        recordings.forEach((recording) => {\n          let recordingInstance = this.instanceMap.get(recording.id);\n          if (!recordingInstance) {\n            recordingInstance = createRoomSessionRecordingObject({\n              store: this.store,\n              payload: {\n                room_id: this.roomId,\n                room_session_id: this.roomSessionId,\n                recording\n              }\n            });\n          } else {\n            recordingInstance.setPayload({\n              room_id: this.roomId,\n              room_session_id: this.roomSessionId,\n              recording\n            });\n          }\n          recordingInstances.push(recordingInstance);\n          this.instanceMap.set(recordingInstance.id, recordingInstance);\n        });\n        resolve({ recordings: recordingInstances });\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n};\nvar startRecording = {\n  value: function() {\n    return new Promise(async (resolve, reject) => {\n      try {\n        const { recording } = await this.execute({\n          method: \"video.recording.start\",\n          params: {\n            room_session_id: this.roomSessionId\n          }\n        });\n        const recordingInstance = createRoomSessionRecordingObject({\n          store: this.store,\n          payload: {\n            room_id: this.roomId,\n            room_session_id: this.roomSessionId,\n            recording\n          }\n        });\n        this.instanceMap.set(recordingInstance.id, recordingInstance);\n        resolve(recordingInstance);\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n};\nvar getPlaybacks = {\n  value: function() {\n    return new Promise(async (resolve, reject) => {\n      try {\n        const { playbacks } = await this.execute({\n          method: \"video.playback.list\",\n          params: {\n            room_session_id: this.roomSessionId\n          }\n        });\n        const playbackInstances = [];\n        playbacks.forEach((playback) => {\n          let playbackInstance = this.instanceMap.get(playback.id);\n          if (!playbackInstance) {\n            playbackInstance = createRoomSessionPlaybackObject({\n              store: this.store,\n              payload: {\n                room_id: this.roomId,\n                room_session_id: this.roomSessionId,\n                playback\n              }\n            });\n          } else {\n            playbackInstance.setPayload({\n              room_id: this.roomId,\n              room_session_id: this.roomSessionId,\n              playback\n            });\n          }\n          playbackInstances.push(playbackInstance);\n          this.instanceMap.set(playbackInstance.id, playbackInstance);\n        });\n        resolve({ playbacks: playbackInstances });\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n};\nvar play = {\n  value: function(_a) {\n    var _b = _a, { seekPosition, currentTimecode } = _b, params = __objRest(_b, [\"seekPosition\", \"currentTimecode\"]);\n    return new Promise(async (resolve, reject) => {\n      try {\n        const seek_position = seekPosition || currentTimecode;\n        const { playback } = await this.execute({\n          method: \"video.playback.start\",\n          params: __spreadValues({\n            room_session_id: this.roomSessionId,\n            seek_position\n          }, params)\n        });\n        const playbackInstance = createRoomSessionPlaybackObject({\n          store: this.store,\n          payload: {\n            room_id: this.roomId,\n            room_session_id: this.roomSessionId,\n            playback\n          }\n        });\n        this.instanceMap.set(playbackInstance.id, playbackInstance);\n        resolve(playbackInstance);\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n};\nvar createRoomMetaMethod = (method) => {\n  return createRoomMethod(method, {\n    transformResolve: baseCodeTransform,\n    transformParams: (params) => {\n      const _a = params, { room_session_id } = _a, meta = __objRest(_a, [\"room_session_id\"]);\n      return { room_session_id, meta };\n    }\n  });\n};\nvar getMeta = createRoomMethod(\"video.get_meta\", {\n  transformResolve: ({ meta }) => ({ meta })\n});\nvar setMeta = createRoomMetaMethod(\"video.set_meta\");\nvar updateMeta = createRoomMetaMethod(\"video.update_meta\");\nvar deleteMeta = {\n  value: function(params) {\n    return this.execute({\n      method: \"video.delete_meta\",\n      params: {\n        room_session_id: this.roomSessionId,\n        keys: params\n      }\n    });\n  }\n};\nvar getStreams = {\n  value: function() {\n    return new Promise(async (resolve, reject) => {\n      try {\n        const { streams } = await this.execute({\n          method: \"video.stream.list\",\n          params: {\n            room_session_id: this.roomSessionId\n          }\n        });\n        const streamInstances = [];\n        streams.forEach((stream) => {\n          let streamInstance = this.instanceMap.get(stream.id);\n          if (!streamInstance) {\n            streamInstance = createRoomSessionStreamObject({\n              store: this.store,\n              payload: {\n                room_id: this.roomId,\n                room_session_id: this.roomSessionId,\n                stream\n              }\n            });\n          } else {\n            streamInstance.setPayload({\n              room_id: this.roomId,\n              room_session_id: this.roomSessionId,\n              stream\n            });\n          }\n          streamInstances.push(streamInstance);\n          this.instanceMap.set(streamInstance.id, streamInstance);\n        });\n        resolve({ streams: streamInstances });\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n};\nvar startStream = {\n  value: function(params) {\n    return new Promise(async (resolve, reject) => {\n      try {\n        const { stream } = await this.execute({\n          method: \"video.stream.start\",\n          params: __spreadValues({\n            room_session_id: this.roomSessionId\n          }, params)\n        });\n        const streamInstance = createRoomSessionStreamObject({\n          store: this.store,\n          payload: {\n            room_id: this.roomId,\n            room_session_id: this.roomSessionId,\n            stream\n          }\n        });\n        this.instanceMap.set(streamInstance.id, streamInstance);\n        resolve({ stream: streamInstance });\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n};\nvar setPrioritizeHandraise = {\n  value: function(params) {\n    return this.execute({\n      method: \"video.prioritize_handraise\",\n      params: {\n        room_session_id: this.roomSessionId,\n        enable: params\n      }\n    });\n  }\n};\nvar audioMuteMember = createRoomMemberMethod(\"video.member.audio_mute\", {\n  transformResolve: baseCodeTransform\n});\nvar audioUnmuteMember = createRoomMemberMethod(\"video.member.audio_unmute\", {\n  transformResolve: baseCodeTransform\n});\nvar videoMuteMember = createRoomMemberMethod(\"video.member.video_mute\", {\n  transformResolve: baseCodeTransform\n});\nvar videoUnmuteMember = createRoomMemberMethod(\"video.member.video_unmute\", {\n  transformResolve: baseCodeTransform\n});\nvar deafMember = createRoomMemberMethod(\"video.member.deaf\", {\n  transformResolve: baseCodeTransform\n});\nvar undeafMember = createRoomMemberMethod(\"video.member.undeaf\", {\n  transformResolve: baseCodeTransform\n});\nvar setDeaf = {\n  value: function(value) {\n    return this.execute({\n      method: value ? \"video.member.deaf\" : \"video.member.undeaf\",\n      params: {\n        room_session_id: this.roomSessionId,\n        member_id: this.memberId\n      }\n    }, {\n      transformResolve: baseCodeTransform\n    });\n  }\n};\nvar setInputVolumeMember = createRoomMemberMethod(\"video.member.set_input_volume\", {\n  transformResolve: baseCodeTransform\n});\nvar setOutputVolumeMember = createRoomMemberMethod(\"video.member.set_output_volume\", {\n  transformResolve: baseCodeTransform\n});\nvar setInputSensitivityMember = createRoomMemberMethod(\"video.member.set_input_sensitivity\", {\n  transformResolve: baseCodeTransform\n});\nvar promote = {\n  value: function(_a) {\n    var _b = _a, {\n      memberId,\n      mediaAllowed,\n      joinAudioMuted,\n      joinVideoMuted\n    } = _b, rest = __objRest(_b, [\n      \"memberId\",\n      \"mediaAllowed\",\n      \"joinAudioMuted\",\n      \"joinVideoMuted\"\n    ]);\n    return this.execute({\n      method: \"video.member.promote\",\n      params: __spreadValues({\n        room_session_id: this.roomSessionId,\n        member_id: memberId,\n        media_allowed: mediaAllowed,\n        join_audio_muted: joinAudioMuted,\n        join_video_muted: joinVideoMuted\n      }, rest)\n    }, {\n      transformResolve: baseCodeTransform\n    });\n  }\n};\nvar demote = {\n  value: function({ memberId, mediaAllowed }) {\n    return this.execute({\n      method: \"video.member.demote\",\n      params: {\n        room_session_id: this.roomSessionId,\n        member_id: memberId,\n        media_allowed: mediaAllowed\n      }\n    }, {\n      transformResolve: baseCodeTransform\n    });\n  }\n};\nvar setMemberPosition = createRoomMemberMethod(\"video.member.set_position\", {\n  transformResolve: baseCodeTransform\n});\nvar removeMember = {\n  value: function(_a) {\n    var _b = _a, { memberId } = _b, rest = __objRest(_b, [\"memberId\"]);\n    if (!memberId) {\n      throw new TypeError('Invalid or missing \"memberId\" argument');\n    }\n    return this.execute({\n      method: \"video.member.remove\",\n      params: __spreadValues({\n        room_session_id: this.roomSessionId,\n        member_id: memberId\n      }, rest)\n    }, {\n      transformResolve: baseCodeTransform\n    });\n  }\n};\nvar removeAllMembers = {\n  value: function() {\n    return this.execute({\n      method: \"video.member.remove\",\n      params: {\n        room_session_id: this.roomSessionId,\n        member_id: \"all\"\n      }\n    }, {\n      transformResolve: baseCodeTransform\n    });\n  }\n};\nvar getMemberMeta = createRoomMemberMethod(\"video.member.get_meta\", {\n  transformResolve: ({ meta }) => ({ meta })\n});\nvar setMemberMeta = createRoomMemberMethod(\"video.member.set_meta\", {\n  transformResolve: baseCodeTransform\n});\nvar updateMemberMeta = createRoomMemberMethod(\"video.member.update_meta\", {\n  transformResolve: baseCodeTransform\n});\nvar deleteMemberMeta = createRoomMemberMethod(\"video.member.delete_meta\", {\n  transformResolve: baseCodeTransform\n});\nvar setRaisedHand = {\n  value: function(value) {\n    const { raised = true, memberId = this.memberId } = value || {};\n    if (!memberId) {\n      throw new TypeError('Invalid or missing \"memberId\" argument');\n    }\n    return this.execute({\n      method: raised ? \"video.member.raisehand\" : \"video.member.lowerhand\",\n      params: {\n        room_session_id: this.roomSessionId,\n        member_id: memberId\n      }\n    }, {\n      transformResolve: baseCodeTransform\n    });\n  }\n};\n\n// src/rooms/RoomSessionRecording.ts\nvar RoomSessionRecordingAPI = class extends BaseComponent {\n  constructor(options) {\n    super(options);\n    __publicField(this, \"_payload\");\n    this._payload = options.payload;\n  }\n  get id() {\n    return this._payload.recording.id;\n  }\n  get roomId() {\n    return this._payload.room_id;\n  }\n  get roomSessionId() {\n    return this._payload.room_session_id;\n  }\n  get state() {\n    return this._payload.recording.state;\n  }\n  get duration() {\n    return this._payload.recording.duration;\n  }\n  get startedAt() {\n    if (!this._payload.recording.started_at)\n      return void 0;\n    return new Date(this._payload.recording.started_at * 1e3);\n  }\n  get endedAt() {\n    if (!this._payload.recording.ended_at)\n      return void 0;\n    return new Date(this._payload.recording.ended_at * 1e3);\n  }\n  setPayload(payload) {\n    this._payload = payload;\n  }\n  async pause() {\n    await this.execute({\n      method: \"video.recording.pause\",\n      params: {\n        room_session_id: this.getStateProperty(\"roomSessionId\"),\n        recording_id: this.getStateProperty(\"id\")\n      }\n    });\n  }\n  async resume() {\n    await this.execute({\n      method: \"video.recording.resume\",\n      params: {\n        room_session_id: this.getStateProperty(\"roomSessionId\"),\n        recording_id: this.getStateProperty(\"id\")\n      }\n    });\n  }\n  async stop() {\n    await this.execute({\n      method: \"video.recording.stop\",\n      params: {\n        room_session_id: this.getStateProperty(\"roomSessionId\"),\n        recording_id: this.getStateProperty(\"id\")\n      }\n    });\n  }\n};\nvar createRoomSessionRecordingObject = (params) => {\n  const recording = connect({\n    store: params.store,\n    Component: RoomSessionRecordingAPI\n  })(params);\n  return recording;\n};\n\n// src/rooms/RoomSessionPlayback.ts\nvar RoomSessionPlaybackAPI = class extends BaseComponent {\n  constructor(options) {\n    super(options);\n    __publicField(this, \"_payload\");\n    this._payload = options.payload;\n  }\n  get id() {\n    return this._payload.playback.id;\n  }\n  get roomId() {\n    return this._payload.room_id;\n  }\n  get roomSessionId() {\n    return this._payload.room_session_id;\n  }\n  get url() {\n    return this._payload.playback.url;\n  }\n  get state() {\n    return this._payload.playback.state;\n  }\n  get volume() {\n    return this._payload.playback.volume;\n  }\n  get startedAt() {\n    if (!this._payload.playback.started_at)\n      return void 0;\n    return new Date(this._payload.playback.started_at * 1e3);\n  }\n  get endedAt() {\n    if (!this._payload.playback.ended_at)\n      return void 0;\n    return new Date(this._payload.playback.ended_at * 1e3);\n  }\n  get position() {\n    return this._payload.playback.position;\n  }\n  get seekable() {\n    return this._payload.playback.seekable;\n  }\n  setPayload(payload) {\n    this._payload = payload;\n  }\n  async pause() {\n    await this.execute({\n      method: \"video.playback.pause\",\n      params: {\n        room_session_id: this.getStateProperty(\"roomSessionId\"),\n        playback_id: this.getStateProperty(\"id\")\n      }\n    });\n  }\n  async resume() {\n    await this.execute({\n      method: \"video.playback.resume\",\n      params: {\n        room_session_id: this.getStateProperty(\"roomSessionId\"),\n        playback_id: this.getStateProperty(\"id\")\n      }\n    });\n  }\n  async stop() {\n    await this.execute({\n      method: \"video.playback.stop\",\n      params: {\n        room_session_id: this.getStateProperty(\"roomSessionId\"),\n        playback_id: this.getStateProperty(\"id\")\n      }\n    });\n  }\n  async setVolume(volume) {\n    await this.execute({\n      method: \"video.playback.set_volume\",\n      params: {\n        room_session_id: this.getStateProperty(\"roomSessionId\"),\n        playback_id: this.getStateProperty(\"id\"),\n        volume\n      }\n    });\n  }\n  async seek(timecode) {\n    await this.execute({\n      method: \"video.playback.seek_absolute\",\n      params: {\n        room_session_id: this.getStateProperty(\"roomSessionId\"),\n        playback_id: this.getStateProperty(\"id\"),\n        position: Math.abs(timecode)\n      }\n    });\n  }\n  async forward(offset = 5e3) {\n    await this.execute({\n      method: \"video.playback.seek_relative\",\n      params: {\n        room_session_id: this.getStateProperty(\"roomSessionId\"),\n        playback_id: this.getStateProperty(\"id\"),\n        position: Math.abs(offset)\n      }\n    });\n  }\n  async rewind(offset = 5e3) {\n    await this.execute({\n      method: \"video.playback.seek_relative\",\n      params: {\n        room_session_id: this.getStateProperty(\"roomSessionId\"),\n        playback_id: this.getStateProperty(\"id\"),\n        position: -Math.abs(offset)\n      }\n    });\n  }\n};\nvar createRoomSessionPlaybackObject = (params) => {\n  const playback = connect({\n    store: params.store,\n    Component: RoomSessionPlaybackAPI\n  })(params);\n  return playback;\n};\n\n// src/rooms/RoomSessionStream.ts\nvar RoomSessionStreamAPI = class extends BaseComponent {\n  constructor(options) {\n    super(options);\n    __publicField(this, \"_payload\");\n    this._payload = options.payload;\n  }\n  get id() {\n    return this._payload.stream.id;\n  }\n  get roomId() {\n    return this._payload.room_id;\n  }\n  get roomSessionId() {\n    return this._payload.room_session_id;\n  }\n  get state() {\n    return this._payload.stream.state;\n  }\n  get duration() {\n    return this._payload.stream.duration;\n  }\n  get url() {\n    return this._payload.stream.url;\n  }\n  get startedAt() {\n    if (!this._payload.stream.started_at)\n      return void 0;\n    return new Date(this._payload.stream.started_at * 1e3);\n  }\n  get endedAt() {\n    if (!this._payload.stream.ended_at)\n      return void 0;\n    return new Date(this._payload.stream.ended_at * 1e3);\n  }\n  setPayload(payload) {\n    this._payload = payload;\n  }\n  async stop() {\n    await this.execute({\n      method: \"video.stream.stop\",\n      params: {\n        room_session_id: this.getStateProperty(\"roomSessionId\"),\n        stream_id: this.getStateProperty(\"id\")\n      }\n    });\n  }\n};\nvar createRoomSessionStreamObject = (params) => {\n  const stream = connect({\n    store: params.store,\n    Component: RoomSessionStreamAPI\n  })(params);\n  return stream;\n};\n\n// src/rooms/RoomSessionMember.ts\nvar RoomSessionMemberAPI = class extends BaseComponent {\n  constructor(options) {\n    super(options);\n    __publicField(this, \"_payload\");\n    this._payload = options.payload;\n  }\n  get id() {\n    var _a;\n    return (_a = this._payload.member.id) != null ? _a : this._payload.member.member_id;\n  }\n  get callId() {\n    return this._payload.member.call_id;\n  }\n  get nodeId() {\n    return this._payload.member.node_id;\n  }\n  get memberId() {\n    return this.id;\n  }\n  get roomSessionId() {\n    return this._payload.room_session_id;\n  }\n  get roomId() {\n    return this._payload.room_id;\n  }\n  get parentId() {\n    return this._payload.member.parent_id;\n  }\n  get name() {\n    return this._payload.member.name;\n  }\n  get type() {\n    return this._payload.member.type;\n  }\n  get meta() {\n    return this._payload.member.meta;\n  }\n  get requestedPosition() {\n    return this._payload.member.requested_position;\n  }\n  get currentPosition() {\n    return this._payload.member.current_position;\n  }\n  get visible() {\n    return this._payload.member.visible;\n  }\n  get audioMuted() {\n    return this._payload.member.audio_muted;\n  }\n  get videoMuted() {\n    return this._payload.member.video_muted;\n  }\n  get deaf() {\n    return this._payload.member.deaf;\n  }\n  get inputVolume() {\n    return this._payload.member.input_volume;\n  }\n  get outputVolume() {\n    return this._payload.member.output_volume;\n  }\n  get inputSensitivity() {\n    return this._payload.member.input_sensitivity;\n  }\n  get talking() {\n    return this._payload.member.talking;\n  }\n  get handraised() {\n    return this._payload.member.handraised;\n  }\n  setPayload(payload) {\n    const newPayload = __spreadProps(__spreadValues({}, this._payload), {\n      member: __spreadValues(__spreadValues({}, this._payload.member), payload.member)\n    });\n    this._payload = newPayload;\n  }\n};\nvar createRoomSessionMemberObject = (params) => {\n  const member = connect({\n    store: params.store,\n    Component: RoomSessionMemberAPI\n  })(params);\n  return member;\n};\n\n// src/chat/index.ts\nvar chat_exports = {};\n__export(chat_exports, {\n  BaseChatAPI: () => BaseChatAPI,\n  BaseChatConsumer: () => BaseChatConsumer,\n  ChatMember: () => ChatMember,\n  ChatMessage: () => ChatMessage,\n  applyCommonMethods: () => applyCommonMethods,\n  createBaseChatObject: () => createBaseChatObject,\n  getMemberState: () => getMemberState,\n  getMembers: () => getMembers2,\n  getMessages: () => getMessages,\n  publish: () => publish,\n  setMemberState: () => setMemberState\n});\n\n// src/chat/utils/toInternalChatChannels.ts\nvar toInternalChatChannels = (channels) => {\n  const list = !channels || Array.isArray(channels) ? channels : [channels];\n  if (Array.isArray(list)) {\n    return list.map((name) => {\n      return {\n        name\n      };\n    });\n  }\n  return [];\n};\n\n// src/chat/utils/index.ts\nvar isValidChannels = (input) => {\n  return Array.isArray(input) || typeof input === \"string\";\n};\n\n// src/chat/methods.ts\nvar baseCodeTransform2 = () => {\n};\nvar createChatMethod = (method, options = {}) => ({\n  value: function(params = {}) {\n    return this.execute({\n      method,\n      params\n    }, options);\n  }\n});\nvar createChatMemberMethod = (method, options = {}) => ({\n  value: function(_a = {}) {\n    var _b = _a, { memberId } = _b, rest = __objRest(_b, [\"memberId\"]);\n    return this.execute({\n      method,\n      params: __spreadValues({\n        member_id: memberId\n      }, rest)\n    }, options);\n  }\n});\nvar publish = createChatMethod(\"chat.publish\", {\n  transformResolve: baseCodeTransform2\n});\nvar getMessages = createChatMethod(\"chat.messages.get\", {\n  transformResolve: (payload) => ({\n    messages: payload.messages.map((message) => toExternalJSON(message)),\n    cursor: payload.cursor\n  })\n});\nvar getMembers2 = createChatMethod(\"chat.members.get\", {\n  transformResolve: (payload) => ({\n    members: payload.members.map((member) => toExternalJSON(member))\n  })\n});\nvar transformParamChannels = (params) => {\n  const channels = isValidChannels(params == null ? void 0 : params.channels) ? toInternalChatChannels(params.channels) : void 0;\n  return __spreadProps(__spreadValues({}, params), {\n    channels\n  });\n};\nvar setMemberState = createChatMemberMethod(\"chat.member.set_state\", {\n  transformResolve: baseCodeTransform2,\n  transformParams: transformParamChannels\n});\nvar getMemberState = createChatMemberMethod(\"chat.member.get_state\", {\n  transformResolve: (payload) => ({ channels: payload.channels }),\n  transformParams: transformParamChannels\n});\n\n// src/pubSub/index.ts\nvar pubSub_exports = {};\n__export(pubSub_exports, {\n  BasePubSubConsumer: () => BasePubSubConsumer,\n  PubSubMessage: () => PubSubMessage,\n  createBasePubSubObject: () => createBasePubSubObject\n});\n\n// src/pubSub/workers/pubSubWorker.ts\nvar pubSubWorker = function* (options) {\n  getLogger().trace(\"pubSubWorker started\");\n  const {\n    instance: client,\n    channels: { swEventChannel }\n  } = options;\n  function* worker(action) {\n    const { type, payload } = action;\n    switch (type) {\n      case `${PRODUCT_PREFIX_PUBSUB}.channel.message`: {\n        const {\n          channel: channel3,\n          message: _a\n        } = payload, _b = _a, { member } = _b, restMessage = __objRest(_b, [\"member\"]);\n        const externalJSON = toExternalJSON(__spreadProps(__spreadValues({}, restMessage), {\n          channel: channel3\n        }));\n        const pubSubMessage = new PubSubMessage(externalJSON);\n        client.emit(\"message\", pubSubMessage);\n        break;\n      }\n      default:\n        getLogger().warn(`Unknown pubsub event: \"${type}\"`);\n        break;\n    }\n  }\n  const isPubSubEvent = (action) => action.type.startsWith(`${PRODUCT_PREFIX_PUBSUB}.`);\n  while (true) {\n    const action = yield sagaEffects.take(swEventChannel, isPubSubEvent);\n    yield sagaEffects.fork(worker, action);\n  }\n  getLogger().trace(\"pubSubWorker ended\");\n};\n\n// src/pubSub/BasePubSub.ts\nvar toInternalPubSubChannels = (channels) => {\n  return channels.map((name) => {\n    return {\n      name\n    };\n  });\n};\nvar BasePubSubConsumer = class extends BaseConsumer {\n  constructor(options) {\n    super(options);\n    __publicField(this, \"subscribeMethod\", `${PRODUCT_PREFIX_PUBSUB}.subscribe`);\n    this.initWorker();\n  }\n  initWorker() {\n    this.runWorker(\"pubSub\", { worker: pubSubWorker });\n  }\n  _getChannelsParam(channels, method) {\n    const _channels = !channels || Array.isArray(channels) ? channels : [channels];\n    if (!Array.isArray(_channels) || _channels.length === 0) {\n      throw new Error(`Please specify one or more channels when calling .${method}()`);\n    }\n    return {\n      channels: toInternalPubSubChannels(_channels)\n    };\n  }\n  _setSubscribeParams(params) {\n    this.subscribeParams = __spreadValues(__spreadValues({}, this.subscribeParams), params);\n  }\n  _getSubscribeParams({ channels }) {\n    return __spreadValues({}, this._getChannelsParam(channels, \"subscribe\"));\n  }\n  _getUnsubscribeParams({ channels }) {\n    const channelsParam = this._getChannelsParam(channels, \"unsubscribe\");\n    return __spreadValues({}, channelsParam);\n  }\n  _checkMissingSubscriptions() {\n    const subscriptions = this.getSubscriptions();\n    if (subscriptions.length === 0) {\n      this.logger.info(\"Subscribe was called before any listeners were attached. Move `.subscribe()` right after your event listeners to suppress this message.\");\n      this.once(\"message\", () => {\n      });\n    }\n  }\n  getSubscriptions() {\n    const eventNamesWithPrefix = this.eventNames().map((event) => `${PRODUCT_PREFIX_PUBSUB}.${String(event)}`);\n    return validateEventsToSubscribe(eventNamesWithPrefix);\n  }\n  async subscribe(channels) {\n    this._checkMissingSubscriptions();\n    const params = this._getSubscribeParams({ channels });\n    this._setSubscribeParams(params);\n    return super.subscribe();\n  }\n  async unsubscribe(channels) {\n    if (this._sessionAuthStatus === \"unknown\" || this._sessionAuthStatus === \"unauthorized\") {\n      throw new Error(\"You must be authenticated to unsubscribe from a channel\");\n    }\n    const params = this._getUnsubscribeParams({ channels });\n    return new Promise(async (resolve, reject) => {\n      const subscriptions = this.getSubscriptions();\n      if (subscriptions.length > 0) {\n        const execParams = {\n          method: `${PRODUCT_PREFIX_PUBSUB}.unsubscribe`,\n          params: __spreadProps(__spreadValues({}, params), {\n            events: subscriptions\n          })\n        };\n        try {\n          await this.execute(execParams);\n        } catch (error) {\n          return reject(error);\n        }\n      } else {\n        this.logger.warn(\"`unsubscribe()` was called without any listeners attached.\");\n      }\n      return resolve();\n    });\n  }\n  updateToken(token) {\n    return new Promise((resolve, reject) => {\n      this.session.once(\"session.auth_error\", (error) => {\n        reject(error);\n      });\n      this.session.once(\"session.connected\", () => {\n        resolve();\n      });\n      this.store.dispatch(actions_exports.reauthAction({ token }));\n    });\n  }\n  publish(params) {\n    return this.execute({\n      method: `${PRODUCT_PREFIX_PUBSUB}.publish`,\n      params\n    });\n  }\n  async getAllowedChannels() {\n    await this._waitUntilSessionAuthorized();\n    const authState = this.select(getAuthState);\n    if (authState && \"channels\" in authState && authState.channels) {\n      return authState.channels;\n    }\n    return {};\n  }\n};\nvar createBasePubSubObject = (params) => {\n  const pubSub = connect({\n    store: params.store,\n    Component: BasePubSubConsumer\n  })(params);\n  return pubSub;\n};\n\n// src/pubSub/PubSubMessage.ts\nvar PubSubMessage = class {\n  constructor(payload) {\n    this.payload = payload;\n  }\n  get id() {\n    return this.payload.id;\n  }\n  get channel() {\n    return this.payload.channel;\n  }\n  get content() {\n    return this.payload.content;\n  }\n  get meta() {\n    return this.payload.meta;\n  }\n  get publishedAt() {\n    return this.payload.publishedAt;\n  }\n};\n\n// src/chat/workers/chatWorker.ts\nvar chatWorker = function* (options) {\n  getLogger().trace(\"chatWorker started\");\n  const {\n    instance: client,\n    channels: { swEventChannel }\n  } = options;\n  function* worker(action) {\n    const { type, payload } = action;\n    switch (type) {\n      case \"chat.channel.message\": {\n        const { channel: channel3, message } = payload;\n        const externalJSON = toExternalJSON(__spreadProps(__spreadValues({}, message), {\n          channel: channel3\n        }));\n        const chatMessage = new ChatMessage(externalJSON);\n        client.emit(\"message\", chatMessage);\n        break;\n      }\n      case \"chat.member.joined\":\n      case \"chat.member.updated\":\n      case \"chat.member.left\": {\n        const { member } = payload;\n        const externalJSON = toExternalJSON(member);\n        const chatMessage = new ChatMember(externalJSON);\n        const event = stripNamespacePrefix(type);\n        client.emit(event, chatMessage);\n        break;\n      }\n      default:\n        getLogger().warn(`Unknown chat event: \"${type}\"`);\n        break;\n    }\n  }\n  const isChatEvent2 = (action) => action.type.startsWith(\"chat.\");\n  while (true) {\n    const action = yield sagaEffects.take(swEventChannel, isChatEvent2);\n    yield sagaEffects.fork(worker, action);\n  }\n  getLogger().trace(\"chatWorker ended\");\n};\n\n// src/chat/BaseChat.ts\nvar BaseChatConsumer = class extends BasePubSubConsumer {\n  constructor(options) {\n    super(options);\n    __publicField(this, \"subscribeMethod\", `${PRODUCT_PREFIX_CHAT}.subscribe`);\n  }\n  initWorker() {\n    this.runWorker(\"chat\", { worker: chatWorker });\n  }\n};\nvar BaseChatAPI = extendComponent(BaseChatConsumer, {\n  publish,\n  getMembers: getMembers2,\n  getMessages,\n  setMemberState,\n  getMemberState\n});\nvar createBaseChatObject = (params) => {\n  const chat = connect({\n    store: params.store,\n    Component: BaseChatAPI\n  })(params);\n  return chat;\n};\n\n// src/chat/ChatMessage.ts\nvar ChatMessage = class extends PubSubMessage {\n  get member() {\n    return this.payload.member;\n  }\n};\n\n// src/chat/ChatMember.ts\nvar ChatMember = class {\n  constructor(payload) {\n    this.payload = payload;\n  }\n  get id() {\n    return this.payload.id;\n  }\n  get channel() {\n    return this.payload.channel;\n  }\n  get state() {\n    var _a;\n    return (_a = this.payload.state) != null ? _a : {};\n  }\n};\n\n// src/chat/applyCommonMethods.ts\nvar transformParamChannels2 = (params) => {\n  const channels = isValidChannels(params == null ? void 0 : params.channels) ? toInternalChatChannels(params.channels) : void 0;\n  return __spreadProps(__spreadValues({}, params), {\n    channels\n  });\n};\nvar baseCodeTransform3 = () => {\n};\nfunction applyCommonMethods(targetClass) {\n  return class extends targetClass {\n    getMembers(params) {\n      return this._client.execute({\n        method: \"chat.members.get\",\n        params\n      }, {\n        transformResolve: (payload) => ({\n          members: payload.members.map((member) => toExternalJSON(member))\n        })\n      });\n    }\n    getMessages(params) {\n      return this._client.execute({\n        method: \"chat.messages.get\",\n        params\n      }, {\n        transformResolve: (payload) => ({\n          messages: payload.messages.map((message) => toExternalJSON(message)),\n          cursor: payload.cursor\n        })\n      });\n    }\n    setMemberState(_a = {}) {\n      var _b = _a, { memberId } = _b, rest = __objRest(_b, [\"memberId\"]);\n      return this._client.execute({\n        method: \"chat.member.set_state\",\n        params: __spreadValues({\n          member_id: memberId\n        }, rest)\n      }, {\n        transformResolve: baseCodeTransform3,\n        transformParams: transformParamChannels2\n      });\n    }\n    getMemberState(_c = {}) {\n      var _d = _c, { memberId } = _d, rest = __objRest(_d, [\"memberId\"]);\n      return this._client.execute({\n        method: \"chat.member.get_state\",\n        params: __spreadValues({\n          member_id: memberId\n        }, rest)\n      }, {\n        transformResolve: (payload) => ({\n          channels: payload.channels\n        }),\n        transformParams: transformParamChannels2\n      });\n    }\n  };\n}\n\n// src/memberPosition/index.ts\nvar memberPosition_exports = {};\n__export(memberPosition_exports, {\n  MEMBER_POSITION_COMPOUND_EVENTS: () => MEMBER_POSITION_COMPOUND_EVENTS,\n  memberPositionWorker: () => memberPositionWorker,\n  memberUpdatedWorker: () => memberUpdatedWorker\n});\n\n// src/memberPosition/workers.ts\nimport { fork as fork3 } from \"@redux-saga/core/effects\";\nvar defaultDispatcher = function* (type, payload, instance) {\n  const event = stripNamespacePrefix(type);\n  instance.emit(event, payload);\n};\nfunction* memberPositionLayoutChangedWorker(options) {\n  const {\n    action,\n    memberList,\n    instance,\n    dispatcher = defaultDispatcher\n  } = options;\n  const layers = action.payload.layout.layers;\n  const processedMembers = {};\n  layers.forEach((layer) => {\n    var _a;\n    const memberId = layer.member_id;\n    if (!memberId) {\n      return;\n    }\n    const memberEventParams = memberList.get(memberId);\n    if (memberEventParams && layer.position !== ((_a = memberEventParams.member) == null ? void 0 : _a.current_position)) {\n      mutateMemberCurrentPosition({\n        memberList,\n        memberId,\n        currentPosition: layer.position\n      });\n      processedMembers[memberId] = true;\n    } else {\n      processedMembers[memberId] = false;\n    }\n  });\n  for (const [memberId, payload] of memberList) {\n    if (processedMembers[memberId]) {\n      yield dispatcher == null ? void 0 : dispatcher(\"video.member.updated\", payload, instance);\n    } else if (processedMembers[memberId] === void 0) {\n      const updatedMemberEventParams = mutateMemberCurrentPosition({\n        memberList,\n        memberId,\n        currentPosition: \"off-canvas\"\n      });\n      if (!updatedMemberEventParams) {\n        return;\n      }\n      yield dispatcher == null ? void 0 : dispatcher(\"video.member.updated\", updatedMemberEventParams, instance);\n    }\n  }\n}\nfunction* memberUpdatedWorker({\n  action,\n  memberList,\n  instance,\n  dispatcher = defaultDispatcher\n}) {\n  var _a, _b;\n  const memberId = action.payload.member.id;\n  const updatedMemberEventParams = mutateMemberCurrentPosition({\n    memberList,\n    memberId,\n    currentPosition: (_b = (_a = memberList.get(memberId)) == null ? void 0 : _a.member) == null ? void 0 : _b.current_position\n  });\n  if (!updatedMemberEventParams) {\n    return;\n  }\n  const {\n    member: { updated = [] }\n  } = action.payload;\n  const memberUpdatedPayload = __spreadProps(__spreadValues({}, updatedMemberEventParams), {\n    member: __spreadValues(__spreadValues({}, updatedMemberEventParams.member), action.payload.member)\n  });\n  memberList.set(memberId, memberUpdatedPayload);\n  for (const key of updated) {\n    const type = `${action.type}.${key}`;\n    yield dispatcher == null ? void 0 : dispatcher(type, memberUpdatedPayload, instance);\n  }\n  yield dispatcher == null ? void 0 : dispatcher(action.type, memberUpdatedPayload, instance);\n}\nvar MEMBER_POSITION_COMPOUND_EVENTS = /* @__PURE__ */ new Map([\n  [\n    \"video.member.updated\",\n    [\n      \"video.layout.changed\",\n      \"video.member.joined\",\n      \"video.member.left\"\n    ]\n  ]\n]);\nvar memberPositionWorker = function* memberPositionWorker2({\n  instance,\n  channels,\n  initialState,\n  getSession: getSession2,\n  instanceMap,\n  dispatcher = defaultDispatcher\n}) {\n  if (!initialState) {\n    return;\n  }\n  const { swEventChannel } = channels;\n  let memberList = initializeMemberList(initialState);\n  const addToMemberList = (payload) => {\n    if (!memberList.has(payload.member.id)) {\n      memberList.set(payload.member.id, payload);\n    }\n  };\n  while (true) {\n    const action = yield sagaEffects.take(swEventChannel, (action2) => {\n      const istargetEvent = action2.type === \"video.member.updated\" || action2.type === \"video.layout.changed\" || action2.type === \"video.member.joined\" || action2.type === \"video.member.left\";\n      return istargetEvent;\n    });\n    switch (action.type) {\n      case \"video.member.updated\": {\n        addToMemberList(action.payload);\n        yield fork3(memberUpdatedWorker, {\n          action,\n          channels,\n          memberList,\n          instance,\n          getSession: getSession2,\n          instanceMap,\n          dispatcher\n        });\n        break;\n      }\n      case \"video.member.joined\": {\n        addToMemberList(action.payload);\n        break;\n      }\n      case \"video.member.left\": {\n        const member = action.payload.member;\n        memberList.delete(member.id);\n        break;\n      }\n      case \"video.layout.changed\": {\n        yield fork3(memberPositionLayoutChangedWorker, {\n          action,\n          channels,\n          memberList,\n          instance,\n          dispatcher\n        });\n        break;\n      }\n    }\n  }\n};\nvar mutateMemberCurrentPosition = ({\n  memberList,\n  memberId,\n  currentPosition\n}) => {\n  const memberEventParams = memberList.get(memberId);\n  if (!memberEventParams) {\n    return;\n  } else if (!currentPosition) {\n    return memberEventParams;\n  }\n  const updatedMemberEventParams = __spreadProps(__spreadValues({}, memberEventParams), {\n    member: __spreadProps(__spreadValues({}, memberEventParams == null ? void 0 : memberEventParams.member), {\n      current_position: currentPosition\n    })\n  });\n  memberList.set(memberId, updatedMemberEventParams);\n  return updatedMemberEventParams;\n};\nvar initializeMemberList = (payload) => {\n  const members = payload.room_session.members;\n  const memberList = /* @__PURE__ */ new Map();\n  members.forEach((member) => {\n    memberList.set(member.id, {\n      room_id: payload.room_session.room_id,\n      room_session_id: payload.room_session.id,\n      member\n    });\n  });\n  return memberList;\n};\n\n// src/testUtils.ts\nvar testUtils_exports = {};\n__export(testUtils_exports, {\n  configureFullStack: () => configureFullStack,\n  configureJestStore: () => configureJestStore,\n  createMockedLogger: () => createMockedLogger,\n  createSessionChannel: () => createSessionChannel,\n  createSwEventChannel: () => createSwEventChannel,\n  rpcConnectResultVRT: () => rpcConnectResultVRT,\n  wait: () => wait\n});\nimport { channel as channel2, multicastChannel as multicastChannel2 } from \"@redux-saga/core\";\nvar PROJECT_ID = \"8f0a119a-cda7-4497-a47d-c81493b824d4\";\nvar TOKEN = \"<VRT>\";\nvar createMockedLogger = () => ({\n  fatal: jest.fn(),\n  error: jest.fn(),\n  warn: jest.fn(),\n  info: jest.fn(),\n  debug: jest.fn(),\n  trace: jest.fn(),\n  wsTraffic: jest.fn()\n});\nvar configureJestStore = (options) => {\n  return configureStore2(__spreadValues({\n    userOptions: {\n      project: PROJECT_ID,\n      token: TOKEN,\n      devTools: false,\n      emitter: new EventEmitter()\n    },\n    SessionConstructor: BaseSession,\n    runSagaMiddleware: false\n  }, options));\n};\nvar configureFullStack = () => {\n  const session = {\n    dispatch: console.log,\n    connect: jest.fn(),\n    disconnect: jest.fn(),\n    execute: jest.fn()\n  };\n  const emitter = new EventEmitter();\n  const store = configureStore2({\n    userOptions: {\n      project: PROJECT_ID,\n      token: TOKEN,\n      devTools: false,\n      emitter\n    },\n    SessionConstructor: jest.fn().mockImplementation(() => {\n      return session;\n    })\n  });\n  store.dispatch(actions_exports.initAction());\n  store.dispatch(actions_exports.authSuccessAction());\n  return {\n    store,\n    session,\n    emitter,\n    destroy: () => store.dispatch(actions_exports.destroyAction())\n  };\n};\nvar wait = (ms) => {\n  return new Promise((resolve) => {\n    setTimeout(resolve, ms);\n  });\n};\nvar rpcConnectResultVRT = {\n  identity: \"f3bc99df-2c3d-4fa4-b1dc-e8a8ffc579e6@e3fefa44-1bad-4be9-ad9b-1cbb9abd60c7.west-us\",\n  authorization: {\n    type: \"video\",\n    project_id: \"8f0a119a-cda7-4497-a47d-c81493b824d4\",\n    project: \"8f0a119a-cda7-4497-a47d-c81493b824d4\",\n    scopes: [\"video\"],\n    scope_id: \"26675883-8499-4ee9-85eb-691c4aa209f8\",\n    resource: \"9c80f1e8-9430-4070-a043-937eb3a96b38\",\n    join_as: \"member\",\n    user_name: \"Joe\",\n    room: {\n      name: \"lobby\",\n      display_name: \"Lobby\",\n      scopes: [\"room.self.audio_mute\", \"room.self.audio_unmute\"],\n      meta: {}\n    },\n    signature: \"SGZtkRD9fvuBAOUp1UF56zESxdEvGT6qSGZtkRD9fvuBAOUp1UF56zESxdEvGT6q\",\n    media_allowed: \"all\",\n    audio_allowed: \"both\",\n    video_allowed: \"both\",\n    meta: {}\n  },\n  protocol: \"signalwire_SGZtkRD9fvuBAOUp1UF56zESxdEvGT6qSGZtkRD9fvuBAOUp1UF56zESxdEvGT6q_03e8c927-8ea3-4661-86d5-778c3e03296a_8f0a119a-cda7-4497-a47d-c81493b824d4\",\n  ice_servers: [\n    {\n      urls: \"turn.swire.io:443\",\n      credential: \"sFTwvi8ShXcYNOcyYjFy3ATIUpQ=\",\n      credentialType: \"password\",\n      username: \"1619521908:8f0a119a-cda7-4497-a47d-c81493b824d4\"\n    }\n  ]\n};\nvar createSwEventChannel = () => multicastChannel2();\nvar createSessionChannel = () => channel2();\n\n// src/index.ts\nvar selectors = __spreadValues({}, sessionSelectors_exports);\nexport {\n  AuthError,\n  BaseClient,\n  BaseComponent,\n  BaseConsumer,\n  BaseJWTSession,\n  BaseSession,\n  chat_exports as Chat,\n  ChatMember,\n  ChatMessage,\n  DEFAULT_CONNECT_VERSION,\n  EventEmitter,\n  GLOBAL_VIDEO_EVENTS,\n  HttpError,\n  INTERNAL_MEMBER_UPDATABLE_PROPS,\n  INTERNAL_MEMBER_UPDATED_EVENTS,\n  LOCAL_EVENT_PREFIX,\n  MEMBER_UPDATABLE_PROPS,\n  MEMBER_UPDATED_EVENTS,\n  memberPosition_exports as MemberPosition,\n  pubSub_exports as PubSub,\n  PubSubMessage,\n  RPCConnect,\n  RPCDisconnectResponse,\n  RPCEventAckResponse,\n  RPCExecute,\n  RPCPing,\n  RPCPingResponse,\n  RPCReauthenticate,\n  rooms_exports as Rooms,\n  SWCloseEvent,\n  UNIFIED_CONNECT_VERSION,\n  VertoAnswer,\n  VertoAttach,\n  VertoBye,\n  VertoInfo,\n  VertoInvite,\n  VertoModify,\n  VertoPong,\n  VertoResult,\n  VertoSubscribe,\n  WEBRTC_EVENT_TYPES,\n  actions_exports as actions,\n  componentActions,\n  componentReducer,\n  componentSelectors_exports as componentSelectors,\n  configureStore2 as configureStore,\n  connect,\n  debounce,\n  extendComponent,\n  findNamespaceInPayload,\n  fromSnakeToCamelCase,\n  getEventEmitter,\n  getLogger,\n  initialComponentState,\n  initialSessionState,\n  isGlobalEvent,\n  isJSONRPCRequest,\n  isJSONRPCResponse,\n  isMappableObject,\n  isSATAuth,\n  isWebrtcEventType,\n  makeRPCRequest,\n  makeRPCResponse,\n  mapObject,\n  sagaEffects,\n  sagaHelpers_exports as sagaHelpers,\n  selectors,\n  sessionActions,\n  sessionReducer,\n  setLogger,\n  stripNamespacePrefix,\n  testUtils_exports as testUtils,\n  timeoutPromise,\n  toExternalJSON,\n  toInternalAction,\n  toInternalEventName,\n  toLocalEvent,\n  toSnakeCaseKeys,\n  toSyntheticEvent,\n  v4 as uuid,\n  validateEventsToSubscribe\n};\n//# sourceMappingURL=index.esm.js.map\n","import { getLogger } from '@signalwire/core';\nexport const RTCPeerConnection = (config) => {\n    return new window.RTCPeerConnection(config);\n};\n/**\n * Returns whether the current environment supports the media devices API.\n */\nexport const supportsMediaDevices = () => {\n    return typeof navigator !== 'undefined' && !!navigator.mediaDevices;\n};\n/**\n * Returns the mediaDevices object if supported, otherwise throws an error.\n */\nexport const getMediaDevicesApi = () => {\n    if (!supportsMediaDevices()) {\n        throw new Error(\"The media devices API isn't supported in this environment\");\n    }\n    return navigator.mediaDevices;\n};\n/**\n * Returns whether the current environment supports `getUserMedia`.\n */\nexport const supportsGetUserMedia = () => {\n    return typeof getMediaDevicesApi().getUserMedia === 'function';\n};\n/**\n * Returns whether the current environment supports `getDisplayMedia`.\n */\nexport const supportsGetDisplayMedia = () => {\n    return typeof getMediaDevicesApi().getDisplayMedia === 'function';\n};\n/**\n * Returns a dictionary whose fields specify the constrainable properties the user agent understands.\n */\nexport const getSupportedConstraints = () => {\n    return getMediaDevicesApi().getSupportedConstraints();\n};\nexport const streamIsValid = (stream) => stream && stream instanceof MediaStream;\n/**\n * Returns whether the current environment supports the selection of a media output device.\n */\nexport const supportsMediaOutput = () => {\n    return 'sinkId' in HTMLMediaElement.prototype;\n};\n/**\n * Assigns the specified audio output device to the specified HTMLMediaElement.\n * The device with id `deviceId` must be an audio output device. Asynchronously\n * returns whether the operation had success.\n *\n * > 📘\n * > Some browsers do not support output device selection. You can check by\n * > calling [`supportsMediaOutput`](supportsMediaOutput).\n *\n * @param el target element\n * @param deviceId id of the audio output device\n * @returns a promise of whether the operation had success\n *\n * @example\n * ```typescript\n * const el = document.querySelector('video')\n * const outDevices = await SignalWire.WebRTC.getSpeakerDevicesWithPermissions()\n * await SignalWire.WebRTC.setMediaElementSinkId(el, outDevices[0].deviceId)\n * // true\n```\n */\nexport const setMediaElementSinkId = async (el, deviceId) => {\n    if (el === null) {\n        getLogger().warn('No HTMLMediaElement to attach the speakerId');\n        return;\n    }\n    else if (typeof deviceId !== 'string') {\n        getLogger().warn(`Invalid speaker deviceId: '${deviceId}'`);\n        return;\n    }\n    else if (!supportsMediaOutput()) {\n        getLogger().warn('Browser does not support output device selection.');\n        return;\n    }\n    try {\n        // @ts-ignore\n        return await el.setSinkId(deviceId);\n    }\n    catch (error) {\n        if (error.name === 'SecurityError') {\n            getLogger().error(`You need to use HTTPS for selecting audio output device: ${error}`);\n        }\n        else {\n            getLogger().error(`Error: ${error}`);\n        }\n        throw error;\n    }\n};\nexport const sdpToJsonHack = (sdp) => sdp;\nexport const stopStream = (stream) => {\n    var _a;\n    if (streamIsValid(stream)) {\n        (_a = stream === null || stream === void 0 ? void 0 : stream.getTracks()) === null || _a === void 0 ? void 0 : _a.forEach(stopTrack);\n    }\n};\nexport const stopTrack = (track) => {\n    if (track && track.readyState === 'live') {\n        track.stop();\n        track.dispatchEvent(new Event('ended'));\n    }\n};\n/**\n * Maps permission's names from `DevicePermissionDescriptor[\"name\"]`\n * to `MediaDeviceKind`\n */\nconst PERMISSIONS_MAPPING = {\n    camera: 'videoinput',\n    microphone: 'audioinput',\n    speaker: 'audiooutput',\n};\nexport const _getMediaDeviceKindByName = (name) => {\n    if (!name) {\n        return undefined;\n    }\n    return PERMISSIONS_MAPPING[name];\n};\n//# sourceMappingURL=primitives.js.map","import { getMediaDevicesApi } from './primitives';\n/**\n * Enumerates the media input and output devices available on this device.\n *\n * > 📘\n * > Depending on the browser, some information (such as the `label` and\n * > `deviceId` attributes) could be hidden until permission is granted, for\n * > example by calling {@link getUserMedia}.\n *\n * @example\n * ```typescript\n * await SignalWire.WebRTC.enumerateDevices()\n * // [\n * //   {\n * //     \"deviceId\": \"Rug5Bk...4TMhY=\",\n * //     \"kind\": \"videoinput\",\n * //     \"label\": \"HD FaceTime Camera\",\n * //     \"groupId\": \"EEX/N2...AjrOs=\"\n * //   },\n * //   ...\n * // ]\n * ```\n */\nexport const enumerateDevices = () => {\n    return getMediaDevicesApi().enumerateDevices();\n};\nexport const enumerateDevicesByKind = async (filterByKind) => {\n    let devices = await enumerateDevices().catch((_error) => []);\n    if (filterByKind) {\n        devices = devices.filter(({ kind }) => kind === filterByKind);\n    }\n    return devices;\n};\n//# sourceMappingURL=enumerateDevices.js.map","import { getLogger } from '@signalwire/core';\nimport { _getMediaDeviceKindByName } from './primitives';\nimport { enumerateDevicesByKind } from './enumerateDevices';\n/**\n * For browsers not supporting the Permissions API\n * @param {string} kind\n * @returns\n */\nconst _legacyCheckPermissions = async (kind) => {\n    const devices = await enumerateDevicesByKind(kind);\n    if (!devices.length) {\n        getLogger().warn(`No ${kind} devices to check for permissions!`);\n        return null;\n    }\n    return devices.every(({ deviceId, label }) => Boolean(deviceId && label));\n};\n/**\n * Asynchronously returns whether we have permissions to access the specified\n * resource. Some common parameter values for `name` are `\"camera\"`,\n * `\"microphone\"`, and `\"speaker\"`. In those cases, prefer the dedicated methods\n * {@link checkCameraPermissions}, {@link checkMicrophonePermissions}, and\n * {@link checkSpeakerPermissions}.\n * @param name name of the resource\n *\n * @example\n * ```typescript\n * await SignalWire.WebRTC.checkPermissions(\"camera\")\n * // true: we have permission for using the camera\n * ```\n */\nexport const checkPermissions = async (name) => {\n    if ('permissions' in navigator &&\n        typeof navigator.permissions.query === 'function' &&\n        name) {\n        try {\n            /**\n             * `navigator.permissions.query` can throw if `name` is not a\n             * valid enumation value for `PermissionName`. As of today, some\n             * browsers like Fireforx will throw with `name: \"camera\"`\n             */\n            // @ts-expect-error\n            const status = await navigator.permissions.query({ name });\n            return status.state === 'granted';\n        }\n        catch (e) { }\n    }\n    return _legacyCheckPermissions(_getMediaDeviceKindByName(name));\n};\n/**\n * Asynchronously returns whether we have permissions to access the camera.\n *\n * @example\n * ```typescript\n * await SignalWire.WebRTC.checkCameraPermissions()\n * // true\n * ```\n */\nexport const checkCameraPermissions = () => checkPermissions('camera');\n/**\n * Asynchronously returns whether we have permissions to access the microphone.\n *\n * @example\n * ```typescript\n * await SignalWire.WebRTC.checkMicrophonePermissions()\n * // true\n * ```\n */\nexport const checkMicrophonePermissions = () => checkPermissions('microphone');\n/**\n * Asynchronously returns whether we have permissions to access the speakers.\n *\n * @example\n * ```typescript\n * await SignalWire.WebRTC.checkSpeakerPermissions()\n * // true\n * ```\n */\nexport const checkSpeakerPermissions = () => checkPermissions('speaker');\n//# sourceMappingURL=permissions.js.map","import { getLogger, timeoutPromise } from '@signalwire/core';\nimport { getMediaDevicesApi, getSupportedConstraints } from './primitives';\nimport { checkMicrophonePermissions, checkCameraPermissions, } from './permissions';\nconst GUM_TIMEOUT = 5000;\n/**\n * Check if we need to set a timeout on the gUM request.\n * In case the user needs to go through the browser prompt\n * for permissions we can't set a timer but instead just wait for\n * the user and/or the UA to solve the promise.\n * If we have the permissions already, set the timeout because we\n * had some cases where the UA is stuck reading from the device\n * and the gUM request was never resolved.\n *\n * @internal\n * @returns True/False whether the timeout should be used\n */\nconst _useTimeoutForGUM = async (constraints) => {\n    const promises = [];\n    if (constraints === null || constraints === void 0 ? void 0 : constraints.audio) {\n        promises.push(checkMicrophonePermissions());\n    }\n    if (constraints === null || constraints === void 0 ? void 0 : constraints.video) {\n        promises.push(checkCameraPermissions());\n    }\n    if (promises.length) {\n        const results = await Promise.all(promises);\n        return results.every(Boolean);\n    }\n    return false;\n};\n/**\n * Prompts the user to share one or more media devices and asynchronously\n * returns an associated [MediaStream](https://developer.mozilla.org/en-US/docs/Web/API/MediaStream)\n * object.\n *\n * For more information, see [`MediaDevices.getUserMedia()`](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia).\n *\n * @param constraints an optional [MediaStreamConstraints](https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamConstraints)\n *                    object specifying requirements for the returned [MediaStream](https://developer.mozilla.org/en-US/docs/Web/API/MediaStream).\n *\n * @example\n * To only request audio media:\n *\n * ```typescript\n * await SignalWire.WebRTC.getUserMedia({audio: true, video: false})\n * // MediaStream {id: \"HCXy...\", active: true, ...}\n * ```\n *\n * @example\n * To request both audio and video, specifying constraints for the video:\n *\n * ```typescript\n * const constraints = {\n *   audio: true,\n *   video: {\n *     width: { min: 1024, ideal: 1280, max: 1920 },\n *     height: { min: 576, ideal: 720, max: 1080 }\n *   }\n * }\n * await SignalWire.WebRTC.getUserMedia(constraints)\n * // MediaStream {id: \"EDVk...\", active: true, ...}\n * ```\n */\nexport const getUserMedia = async (constraints = { audio: true, video: true }) => {\n    var _a;\n    try {\n        const promise = getMediaDevicesApi().getUserMedia(constraints);\n        const useTimeout = await _useTimeoutForGUM(constraints);\n        if (useTimeout) {\n            const exception = new Error('Timeout reading from your devices');\n            return await timeoutPromise(promise, GUM_TIMEOUT, exception);\n        }\n        return await promise;\n    }\n    catch (error) {\n        switch (error.name) {\n            case 'Error': {\n                getLogger().error((_a = error === null || error === void 0 ? void 0 : error.message) !== null && _a !== void 0 ? _a : \"navigator.mediaDevices.getUserMedia doesn't seem to be supported.\");\n                break;\n            }\n            case 'NotFoundError': {\n                getLogger().error('No media tracks of the type specified were found that satisfy the given constraints.');\n                break;\n            }\n            case 'NotReadableError': {\n                getLogger().error('Hardware error occurred at the operating system, browser, or Web page level which prevented access to the device. This could have been caused by having the Camera or Mic being user by another application.');\n                break;\n            }\n            case 'OverconstrainedError': {\n                getLogger().error(`The constraint: ${error.constraint} cannot be met by the selected device.`);\n                getLogger().info(`List of available constraints:`, getSupportedConstraints());\n                break;\n            }\n            case 'NotAllowedError': {\n                getLogger().error('The user has mostly likely denied access to the device. This could also happen if the browsing context is insecure (using HTTP rather than HTTPS)');\n                break;\n            }\n            case 'TypeError': {\n                if (Object.keys(constraints).length === 0) {\n                    getLogger().error('Constraints can\\'t be empty nor have \"video\" and \"audio\" set to false.');\n                }\n                else {\n                    getLogger().error('Please check that you are calling this method from a secure context (using HTTPS rather than HTTP).');\n                }\n                break;\n            }\n            case 'SecurityError': {\n                getLogger().error('User media support is disabled on the Document on which getUserMedia() was called. The mechanism by which user media support is enabled and disabled is left up to the individual user agent.');\n                break;\n            }\n        }\n        throw error;\n    }\n};\n//# sourceMappingURL=getUserMedia.js.map","import { getMediaDevicesApi } from './primitives';\n/**\n * Prompts the user to share the screen and asynchronously returns a\n * [MediaStream](https://developer.mozilla.org/en-US/docs/Web/API/MediaStream)\n * object associated with a display or part of it.\n *\n * @param constraints an optional\n * [MediaStreamConstraints](https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamConstraints)\n * object specifying requirements for the returned [MediaStream](https://developer.mozilla.org/en-US/docs/Web/API/MediaStream).\n *\n * @example\n *  ```typescript\n * await SignalWire.WebRTC.getDisplayMedia()\n * // MediaStream {id: \"HCXy...\", active: true, ...}\n * ```\n */\nexport const getDisplayMedia = (constraints) => {\n    return getMediaDevicesApi().getDisplayMedia(constraints);\n};\n//# sourceMappingURL=getDisplayMedia.js.map","import { getLogger, EventEmitter } from '@signalwire/core';\nimport { getUserMedia, enumerateDevices, enumerateDevicesByKind, checkPermissions, checkCameraPermissions, checkMicrophonePermissions, checkSpeakerPermissions, _getMediaDeviceKindByName, stopStream, supportsMediaOutput, getMediaDevicesApi, } from './index';\nconst _constraintsByKind = (kind) => {\n    return {\n        audio: !kind || kind === 'all' || kind === 'microphone' || kind === 'speaker',\n        video: !kind || kind === 'all' || kind === 'camera',\n    };\n};\n/**\n * After prompting the user for permission, returns an array of media input and\n * output devices available on this machine. If `kind` is not null, only the\n * devices of the specified kind are returned. Possible values of the `kind`\n * parameters are `\"camera\"`, `\"microphone\"`, and `\"speaker\"`, which\n * respectively correspond to functions\n * {@link getCameraDevicesWithPermissions},\n * {@link getMicrophoneDevicesWithPermissions}, and\n * {@link getSpeakerDevicesWithPermissions}.\n *\n * @param kind filter for this device category\n * @param fullList By default, only devices for which\n * we have been granted permissions are returned. To obtain a list of devices regardless of\n * the permissions, pass `fullList=true`. Note however that some values such as\n * `name` and `deviceId` could be omitted.\n *\n * @example\n * ```typescript\n * await SignalWire.WebRTC.getDevicesWithPermissions(\"camera\")\n * // [\n * //   {\n * //     \"deviceId\": \"Rug5Bk...4TMhY=\",\n * //     \"kind\": \"videoinput\",\n * //     \"label\": \"HD FaceTime Camera\",\n * //     \"groupId\": \"Su/dzw...ccfnY=\"\n * //   }\n * // ]\n * ```\n * @deprecated Use {@link getDevices} for better cross browser compatibility.\n */\nexport const getDevicesWithPermissions = async (kind, fullList = false) => getDevices(kind, fullList);\n/**\n * After prompting the user for permission, returns an array of camera devices.\n *\n * @example\n * ```typescript\n * await SignalWire.WebRTC.getCameraDevicesWithPermissions()\n * // [\n * //   {\n * //     \"deviceId\": \"Rug5Bk...4TMhY=\",\n * //     \"kind\": \"videoinput\",\n * //     \"label\": \"HD FaceTime Camera\",\n * //     \"groupId\": \"Su/dzw...ccfnY=\"\n * //   }\n * // ]\n * ```\n * @deprecated Use {@link getCameraDevices} for better cross browser compatibility.\n */\nexport const getCameraDevicesWithPermissions = () => getDevicesWithPermissions('camera');\n/**\n * After prompting the user for permission, returns an array of microphone devices.\n *\n * @example\n * ```typescript\n * await SignalWire.WebRTC.getMicrophoneDevicesWithPermissions()\n * // [\n * //   {\n * //     \"deviceId\": \"ADciLf...NYgF8=\",\n * //     \"kind\": \"audioinput\",\n * //     \"label\": \"Internal Microphone\",\n * //     \"groupId\": \"rgZgKM...NW1hU=\"\n * //   }\n * // ]\n * ```\n * @deprecated Use {@link getMicrophoneDevices} for better cross browser compatibility.\n */\nexport const getMicrophoneDevicesWithPermissions = () => getDevicesWithPermissions('microphone');\n/**\n * After prompting the user for permission, returns an array of speaker devices.\n *\n * @example\n * ```typescript\n * await SignalWire.WebRTC.getSpeakerDevicesWithPermissions()\n * // [\n * //   {\n * //     \"deviceId\": \"ADciLf...NYgF8=\",\n * //     \"kind\": \"audiooutput\",\n * //     \"label\": \"External Speaker\",\n * //     \"groupId\": \"rgZgKM...NW1hU=\"\n * //   }\n * // ]\n * ```\n * @deprecated Use {@link getSpeakerDevices} for better cross browser compatibility.\n */\nexport const getSpeakerDevicesWithPermissions = () => getDevicesWithPermissions('speaker');\nconst _filterDevices = (devices, options = {}) => {\n    const found = [];\n    return devices.filter(({ deviceId, kind, groupId }) => {\n        var _a;\n        if (!deviceId || (options.targets && !((_a = options.targets) === null || _a === void 0 ? void 0 : _a.includes(kind)))) {\n            return false;\n        }\n        if (!groupId) {\n            return true;\n        }\n        const key = `${kind}-${groupId}`;\n        const checkDefault = (options === null || options === void 0 ? void 0 : options.excludeDefault) ? deviceId !== 'default' : true;\n        if (!found.includes(key) && checkDefault) {\n            found.push(key);\n            return true;\n        }\n        return false;\n    });\n};\n/**\n * Enumerates the media input and output devices available on this machine. If\n * `name` is provided, only the devices of the specified kind are returned.\n * Possible values of the `name` parameters are `\"camera\"`, `\"microphone\"`, and\n * `\"speaker\"`, which respectively correspond to functions\n * {@link getCameraDevices}, {@link getMicrophoneDevices}, and\n * {@link getSpeakerDevices}.\n *\n * @param name filter for this device category\n * @param fullList Default to false. Set to true to retrieve the raw list as returned by\n * the browser, which might include multiple, duplicate deviceIds for the same group.\n *\n * @example\n * ```typescript\n * await SignalWire.WebRTC.getDevices(\"camera\", true)\n * // [\n * //   {\n * //     \"deviceId\": \"3c4f97...\",\n * //     \"kind\": \"videoinput\",\n * //     \"label\": \"HD Camera\",\n * //     \"groupId\": \"828fec...\"\n * //   }\n * // ]\n * ```\n */\nexport const getDevices = async (name, fullList = false) => {\n    const hasPerms = await checkPermissions(name);\n    let stream = undefined;\n    if (hasPerms === false) {\n        const constraints = _constraintsByKind(name);\n        stream = await getUserMedia(constraints);\n    }\n    const devices = await enumerateDevicesByKind(_getMediaDeviceKindByName(name));\n    /**\n     * Firefox requires an active stream at the time of `enumerateDevices`\n     * so we need to stop it after `WebRTC.enumerateDevicesByKind`\n     */\n    if (stream) {\n        stopStream(stream);\n    }\n    if (fullList === true) {\n        return devices;\n    }\n    return _filterDevices(devices);\n};\n/**\n * Returns an array of camera devices that can be accessed on this device (for which we have permissions).\n *\n * @example\n * ```typescript\n * await SignalWire.WebRTC.getCameraDevices()\n * // [\n * //   {\n * //     \"deviceId\": \"Rug5Bk...4TMhY=\",\n * //     \"kind\": \"videoinput\",\n * //     \"label\": \"HD FaceTime Camera\",\n * //     \"groupId\": \"Su/dzw...ccfnY=\"\n * //   }\n * // ]\n * ```\n */\nexport const getCameraDevices = () => getDevices('camera');\n/**\n * Returns an array of microphone devices that can be accessed on this device (for which we have permissions).\n *\n * @example\n * ```typescript\n * await SignalWire.WebRTC.getMicrophoneDevices()\n * // [\n * //   {\n * //     \"deviceId\": \"ADciLf...NYgF8=\",\n * //     \"kind\": \"audioinput\",\n * //     \"label\": \"Internal Microphone\",\n * //     \"groupId\": \"rgZgKM...NW1hU=\"\n * //   }\n * // ]\n * ```\n */\nexport const getMicrophoneDevices = () => getDevices('microphone');\n/**\n * Returns an array of speaker devices that can be accessed on this device (for which we have permissions).\n *\n * @example\n * ```typescript\n * await SignalWire.WebRTC.getSpeakerDevices()\n * // [\n * //   {\n * //     \"deviceId\": \"ADciLf...NYgF8=\",\n * //     \"kind\": \"audiooutput\",\n * //     \"label\": \"External Speaker\",\n * //     \"groupId\": \"rgZgKM...NW1hU=\"\n * //   }\n * // ]\n * ```\n */\nexport const getSpeakerDevices = () => getDevices('speaker');\n/**\n * Assure a deviceId exists in the current device list from the browser.\n * It checks for deviceId or label - in case the UA changed the deviceId randomly\n */\nexport const assureDeviceId = async (id, label, name) => {\n    const devices = await getDevices(name, true);\n    for (let i = 0; i < devices.length; i++) {\n        const { deviceId, label: deviceLabel } = devices[i];\n        if (id === deviceId || label === deviceLabel) {\n            return deviceId;\n        }\n    }\n    return null;\n};\n/**\n * Helper methods to assure a deviceId without asking the user the \"kind\"\n */\nexport const assureVideoDevice = (id, label) => assureDeviceId(id, label, 'camera');\nexport const assureAudioInDevice = (id, label) => assureDeviceId(id, label, 'microphone');\nexport const assureAudioOutDevice = (id, label) => assureDeviceId(id, label, 'speaker');\nconst _deviceInfoToMap = (devices) => {\n    const map = new Map();\n    devices.forEach((deviceInfo) => {\n        if (deviceInfo.deviceId) {\n            map.set(deviceInfo.deviceId, deviceInfo);\n        }\n    });\n    return map;\n};\nconst _getDeviceListDiff = (oldDevices, newDevices) => {\n    const current = _deviceInfoToMap(oldDevices);\n    const removals = _deviceInfoToMap(oldDevices);\n    const updates = [];\n    getLogger().debug('[_getDeviceListDiff] <- oldDevices', oldDevices);\n    getLogger().debug('[_getDeviceListDiff] -> newDevices', newDevices);\n    const additions = newDevices.filter((newDevice) => {\n        const id = newDevice.deviceId;\n        const oldDevice = current.get(id);\n        if (oldDevice) {\n            removals.delete(id);\n            if (newDevice.label !== oldDevice.label) {\n                updates.push(newDevice);\n            }\n        }\n        return oldDevice === undefined;\n    });\n    return {\n        updated: updates.map((value) => {\n            return {\n                type: 'updated',\n                payload: value,\n            };\n        }),\n        // Removed devices\n        removed: Array.from(removals, ([_, value]) => value).map((value) => {\n            return {\n                type: 'removed',\n                payload: value,\n            };\n        }),\n        added: additions.map((value) => {\n            return {\n                type: 'added',\n                payload: value,\n            };\n        }),\n    };\n};\nconst TARGET_PERMISSIONS_MAP = {\n    // FIXME: Replace this object with just checkPermissions(<target>)\n    camera: checkCameraPermissions,\n    microphone: checkMicrophonePermissions,\n    speaker: checkSpeakerPermissions,\n};\nconst DEFAULT_TARGETS = [\n    'camera',\n    'microphone',\n    'speaker',\n];\nconst ALLOWED_TARGETS_MSG = `Allowed targets are: '${DEFAULT_TARGETS.join(\"', '\")}'`;\nconst CHECK_SUPPORT_MAP = {\n    speaker: supportsMediaOutput,\n};\nconst checkTargetPermissions = async (options) => {\n    const targets = options.targets;\n    const permissions = await Promise.all(targets.map((target) => TARGET_PERMISSIONS_MAP[target]()));\n    return permissions.reduce((reducer, permission, index) => {\n        var _a;\n        const target = targets[index];\n        /**\n         * If we don't specify a check for the target we'll assume\n         * there's no need to check for support\n         */\n        const platformSupportStatus = target in CHECK_SUPPORT_MAP ? (_a = CHECK_SUPPORT_MAP[target]) === null || _a === void 0 ? void 0 : _a.call(CHECK_SUPPORT_MAP) : true;\n        const supportStatus = platformSupportStatus\n            ? 'supported'\n            : 'unsupported';\n        reducer[supportStatus].push([target, !!permission]);\n        return reducer;\n    }, { supported: [], unsupported: [] });\n};\nconst validateTargets = async (options) => {\n    var _a;\n    const targets = ((_a = options.targets) !== null && _a !== void 0 ? _a : DEFAULT_TARGETS).filter((target) => {\n        if (!DEFAULT_TARGETS.includes(target)) {\n            getLogger().warn(`We'll ignore the \"${target}\" target as it is not allowed. ${ALLOWED_TARGETS_MSG}.`);\n            return false;\n        }\n        return true;\n    });\n    if (!targets.length) {\n        throw new Error(`At least one \"target\" is required for createDeviceWatcher(). ${ALLOWED_TARGETS_MSG}.`);\n    }\n    const permissions = await checkTargetPermissions({ targets });\n    if (permissions.unsupported.length > 0 &&\n        targets.length === permissions.unsupported.length) {\n        throw new Error(`The platform doesn't support \"${targets.join(', ')}\" as target/s, which means it's not possible to watch for changes on those devices.`);\n    }\n    else if (permissions.supported.every(([_, status]) => !status)) {\n        throw new Error('You must ask the user for permissions before being able to listen for device changes. Try calling getUserMedia() before calling `createDeviceWatcher()`.');\n    }\n    let needPermissionsTarget = [];\n    const filteredTargets = permissions.supported.reduce((reducer, [target, status]) => {\n        if (!status) {\n            needPermissionsTarget.push(target);\n        }\n        else {\n            reducer.push(target);\n        }\n        return reducer;\n    }, []);\n    /**\n     * If the length of these two arrays is different it means whether\n     * we have unsupported devices or that the user hasn't granted the\n     * permissions for certain targets\n     */\n    if (filteredTargets.length !== targets.length) {\n        const unsupportedTargets = permissions.unsupported.length > 0\n            ? `The platform doesn't support \"${permissions.unsupported\n                .map(([t]) => t)\n                .join(', ')}\" as target/s, which means it's not possible to watch for changes on those devices. `\n            : '';\n        const needPermissions = needPermissionsTarget.length > 0\n            ? `The user hasn't granted permissions for the following targets: ${needPermissionsTarget.join(', ')}. `\n            : '';\n        getLogger().warn(`${unsupportedTargets}${needPermissions}We'll be watching for the following targets instead: \"${filteredTargets.join(', ')}\"`);\n    }\n    getLogger().debug(`Watching these targets: \"${filteredTargets.join(', ')}\"`);\n    return filteredTargets;\n};\n// FIXME: Move createDeviceWatcher and all related helpers/derived methods to its own module\n/**\n * Asynchronously returns an event emitter that notifies changes in the devices.\n * The possible events are:\n *\n *  - \"added\": a device has been added\n *  - \"removed\": a device has been removed\n *  - \"updated\": a device has been updated\n *  - \"changed\": any of the previous events occurred\n *\n * In all cases, your event handler gets as parameter an object `e` with the\n * following keys:\n *\n *  - `e.changes`: the changed devices. For \"added\", \"removed\", and \"updated\"\n *    event handlers, you only get the object associated to the respective event\n *    (i.e., only a list of added devices, removed devices, or updated devices).\n *    For \"changed\" event handlers, you get all three lists.\n *  - `e.devices`: the new list of devices\n *\n * For device-specific helpers, see {@link createCameraDeviceWatcher},\n * {@link createMicrophoneDeviceWatcher}, and {@link createSpeakerDeviceWatcher}.\n *\n * @param options if null, the event emitter is associated to all devices for\n * which we have permission. Otherwise, you can pass an object\n * `{targets: string}`, where the value for key targets is a list of categories.\n * Allowed categories are `\"camera\"`, `\"microphone\"`, and `\"speaker\"`.\n *\n * @example\n * Creating an event listener on the \"changed\" event and printing the received parameter after both connecting and disconnecting external headphones:\n * ```typescript\n * await SignalWire.WebRTC.getUserMedia({audio: true, video: false})\n * h = await SignalWire.WebRTC.createDeviceWatcher()\n * h.on('changed', (c) => console.log(c))\n * ```\n *\n * @example\n * Getting notified just for changes about audio input and output devices, ignoring the camera:\n * ```typescript\n * h = await SignalWire.WebRTC.createDeviceWatcher({targets: ['microphone', 'speaker']})\n * h.on('changed', (c) => console.log(c))\n * ```\n */\nexport const createDeviceWatcher = async (options = {}) => {\n    const targets = await validateTargets({ targets: options.targets });\n    const emitter = new EventEmitter();\n    const currentDevices = await enumerateDevices();\n    const kinds = targets === null || targets === void 0 ? void 0 : targets.reduce((reducer, name) => {\n        const kind = _getMediaDeviceKindByName(name);\n        if (kind) {\n            reducer.push(kind);\n        }\n        return reducer;\n    }, []);\n    let knownDevices = _filterDevices(currentDevices, {\n        excludeDefault: true,\n        targets: kinds,\n    });\n    const deviceChangeHandler = async () => {\n        const currentDevices = await enumerateDevices();\n        const oldDevices = knownDevices;\n        const newDevices = _filterDevices(currentDevices, {\n            excludeDefault: true,\n            targets: kinds,\n        });\n        knownDevices = newDevices;\n        const changes = _getDeviceListDiff(oldDevices, newDevices);\n        const hasAddedDevices = changes.added.length > 0;\n        const hasRemovedDevices = changes.removed.length > 0;\n        const hasUpdatedDevices = changes.updated.length > 0;\n        if (hasAddedDevices || hasRemovedDevices || hasUpdatedDevices) {\n            emitter.emit('changed', { changes: changes, devices: newDevices });\n        }\n        if (hasAddedDevices) {\n            emitter.emit('added', {\n                changes: changes.added,\n                devices: newDevices,\n            });\n        }\n        if (hasRemovedDevices) {\n            emitter.emit('removed', {\n                changes: changes.removed,\n                devices: newDevices,\n            });\n        }\n        if (hasUpdatedDevices) {\n            emitter.emit('updated', {\n                changes: changes.updated,\n                devices: newDevices,\n            });\n        }\n    };\n    getMediaDevicesApi().addEventListener('devicechange', deviceChangeHandler);\n    return emitter;\n};\n/**\n * Asynchronously returns an event emitter that notifies changes in all\n * microphone devices. This is equivalent to calling\n * `createDeviceWatcher({ targets: ['microphone'] })`, so refer to\n * {@link createDeviceWatcher} for additional information about the returned\n * event emitter.\n */\nexport const createMicrophoneDeviceWatcher = () => createDeviceWatcher({ targets: ['microphone'] });\n/**\n * Asynchronously returns an event emitter that notifies changes in all speaker\n * devices. This is equivalent to calling\n * `createDeviceWatcher({ targets: ['speaker'] })`, so refer to\n * {@link createDeviceWatcher} for additional information about the returned\n * event emitter.\n */\nexport const createSpeakerDeviceWatcher = () => createDeviceWatcher({ targets: ['speaker'] });\n/**\n * Asynchronously returns an event emitter that notifies changes in all camera\n * devices. This is equivalent to calling\n * `createDeviceWatcher({ targets: ['camera'] })`, so refer to\n * {@link createDeviceWatcher} for additional information about the returned\n * event emitter.\n */\nexport const createCameraDeviceWatcher = () => createDeviceWatcher({ targets: ['camera'] });\nconst isMediaStream = (options) => {\n    return typeof (options === null || options === void 0 ? void 0 : options.getTracks) === 'function';\n};\n// FIXME: Move getMicrophoneAnalyzerMediaStream and all related helpers/derived methods to its own module\nconst getMicrophoneAnalyzerMediaStream = async (options) => {\n    if (isMediaStream(options)) {\n        return options;\n    }\n    let constraints;\n    if (typeof options === 'string') {\n        constraints = {\n            audio: {\n                deviceId: options,\n            },\n        };\n    }\n    else {\n        constraints = {\n            audio: options,\n        };\n    }\n    return getUserMedia(constraints);\n};\nconst createAnalyzer = (audioContext) => {\n    const analyser = audioContext.createAnalyser();\n    analyser.fftSize = 64;\n    analyser.minDecibels = -90;\n    analyser.maxDecibels = -10;\n    analyser.smoothingTimeConstant = 0.85;\n    return analyser;\n};\nconst MAX_VOLUME = 100;\n/**\n * Initializes a microphone analyzer. You can use a MicrophoneAnalyzer to track\n * the input audio volume.\n *\n * To stop the analyzer, plase call the `destroy()` method on the object\n * returned by this method.\n *\n * The returned object emits the following events:\n *\n *   - `volumeChanged`: instantaneous volume from 0 to 100\n *   - `destroyed`: the object has been destroyed. You get a parameter\n *     describing the reason, which can be `null` (if you called `destroy()`),\n *     `\"error\"` (in case of errors), or `\"disconnected\"` (if the device was\n *     disconnected).\n *\n * @example\n *\n * ```js\n * const micAnalyzer = await createMicrophoneAnalyzer('device-id')\n *\n * micAnalyzer.on('volumeChanged', (vol) => {\n *   console.log(\"Volume: \", vol)\n * })\n * micAnalyzer.on('destroyed', (reason) => {\n *   console.log('Microphone analyzer destroyed', reason)\n * })\n *\n * micAnalyzer.destroy()\n * ```\n *\n * @param options either the id of the device to analize, or\n * [MediaStreamConstraints](https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamConstraints),\n * or a\n * [MediaStream](https://developer.mozilla.org/en-US/docs/Web/API/MediaStream).\n *\n * @returns Asynchronously returns a MicrophoneAnalyzer.\n */\nexport const createMicrophoneAnalyzer = async (options) => {\n    const stream = await getMicrophoneAnalyzerMediaStream(options);\n    if (!stream) {\n        throw new Error('Failed to get the audio stream');\n    }\n    const emitter = new EventEmitter();\n    const audioContext = new (window.AudioContext ||\n        window.webkitAudioContext)();\n    const analyser = createAnalyzer(audioContext);\n    let rafId;\n    let volume;\n    try {\n        audioContext.createMediaStreamSource(stream).connect(analyser);\n    }\n    catch (error) {\n        throw new Error('No audio track found');\n    }\n    /**\n     * If the device gets disconnected, we'll notify the user of\n     * the change.\n     */\n    stream.getAudioTracks().forEach((track) => {\n        track.addEventListener('ended', () => {\n            emitter.emit('destroyed', 'disconnected');\n        });\n    });\n    const startMetering = () => {\n        try {\n            const dataArray = new Uint8Array(analyser.frequencyBinCount);\n            analyser.getByteFrequencyData(dataArray);\n            /**\n             * dataArray contains the values of the volume\n             * gathered within a single requestAnimationFrame With\n             * reduce and divide by 20 we translate the array\n             * values into a 0-100 scale to draw the green bars\n             * for the voice/volume energy.\n             */\n            const latestVol = dataArray.reduce((final, value) => final + value, 0) / 20;\n            if (volume !== latestVol) {\n                volume = latestVol;\n                emitter.emit('volumeChanged', Math.min(volume, MAX_VOLUME));\n            }\n            rafId = requestAnimationFrame(startMetering);\n        }\n        catch (e) {\n            emitter.emit('destroyed', 'error');\n        }\n    };\n    rafId = requestAnimationFrame(startMetering);\n    const destroy = () => {\n        if (rafId) {\n            cancelAnimationFrame(rafId);\n        }\n        if (audioContext.state !== 'closed') {\n            audioContext.close().catch((error) => {\n                getLogger().error('Error closing the AudioContext', error);\n            });\n        }\n        /**\n         * If the user provided a MediaStream, we don't need to\n         * close it.\n         */\n        if (!isMediaStream(options)) {\n            stream.getTracks().forEach((track) => track.stop());\n        }\n        emitter.emit('destroyed', null);\n        emitter.removeAllListeners();\n    };\n    return new Proxy(\n    // @ts-expect-error\n    emitter, {\n        get(target, prop, receiver) {\n            if (prop === 'destroy') {\n                return destroy;\n            }\n            return Reflect.get(target, prop, receiver);\n        },\n    });\n};\n/**\n * Returns the speaker based on the given id.\n * @param id string\n * @returns MediaDevices | undefined\n */\nexport const getSpeakerById = async (id) => {\n    const speakers = await getSpeakerDevices();\n    return speakers.find((audio) => audio.deviceId === id ||\n        (audio.deviceId === 'default' && id === '') ||\n        (audio.deviceId === '' && id === 'default'));\n};\n//# sourceMappingURL=deviceHelpers.js.map","/* eslint-env node */\n'use strict';\n\n// SDP helpers.\nconst SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substring(2, 12);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(line => line.trim());\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  const parts = blob.split('\\nm=');\n  return parts.map((part, index) => (index > 0 ?\n    'm=' + part : part).trim() + '\\r\\n');\n};\n\n// Returns the session description.\nSDPUtils.getDescription = function(blob) {\n  const sections = SDPUtils.splitSections(blob);\n  return sections && sections[0];\n};\n\n// Returns the individual media sections.\nSDPUtils.getMediaSections = function(blob) {\n  const sections = SDPUtils.splitSections(blob);\n  sections.shift();\n  return sections;\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(line => line.indexOf(prefix) === 0);\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\n// Input can be prefixed with a=.\nSDPUtils.parseCandidate = function(line) {\n  let parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  const candidate = {\n    foundation: parts[0],\n    component: {1: 'rtp', 2: 'rtcp'}[parts[1]] || parts[1],\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    address: parts[4], // address is an alias for ip.\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7],\n  };\n\n  for (let i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compatibility.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag. Don't overwrite.\n        if (candidate[parts[i]] === undefined) {\n          candidate[parts[i]] = parts[i + 1];\n        }\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\n// This does not include the a= prefix!\nSDPUtils.writeCandidate = function(candidate) {\n  const sdp = [];\n  sdp.push(candidate.foundation);\n\n  const component = candidate.component;\n  if (component === 'rtp') {\n    sdp.push(1);\n  } else if (component === 'rtcp') {\n    sdp.push(2);\n  } else {\n    sdp.push(component);\n  }\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.address || candidate.ip);\n  sdp.push(candidate.port);\n\n  const type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress);\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort);\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.usernameFragment || candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.usernameFragment || candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// Sample input:\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substring(14).split(' ');\n};\n\n// Parses a rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  let parts = line.substring(9).split(' ');\n  const parsed = {\n    payloadType: parseInt(parts.shift(), 10), // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  // legacy alias, got renamed back to channels in ORTC.\n  parsed.numChannels = parsed.channels;\n  return parsed;\n};\n\n// Generates a rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  let pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  const channels = codec.channels || codec.numChannels || 1;\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (channels !== 1 ? '/' + channels : '') + '\\r\\n';\n};\n\n// Parses a extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  const parts = line.substring(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1],\n    attributes: parts.slice(2).join(' '),\n  };\n};\n\n// Generates an extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n        ? '/' + headerExtension.direction\n        : '') +\n      ' ' + headerExtension.uri +\n      (headerExtension.attributes ? ' ' + headerExtension.attributes : '') +\n      '\\r\\n';\n};\n\n// Parses a fmtp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  const parsed = {};\n  let kv;\n  const parts = line.substring(line.indexOf(' ') + 1).split(';');\n  for (let j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates a fmtp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  let line = '';\n  let pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    const params = [];\n    Object.keys(codec.parameters).forEach(param => {\n      if (codec.parameters[param] !== undefined) {\n        params.push(param + '=' + codec.parameters[param]);\n      } else {\n        params.push(param);\n      }\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses a rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  const parts = line.substring(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' '),\n  };\n};\n\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  let lines = '';\n  let pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(fb => {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses a RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  const sp = line.indexOf(' ');\n  const parts = {\n    ssrc: parseInt(line.substring(7, sp), 10),\n  };\n  const colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substring(sp + 1, colon);\n    parts.value = line.substring(colon + 1);\n  } else {\n    parts.attribute = line.substring(sp + 1);\n  }\n  return parts;\n};\n\n// Parse a ssrc-group line (see RFC 5576). Sample input:\n// a=ssrc-group:semantics 12 34\nSDPUtils.parseSsrcGroup = function(line) {\n  const parts = line.substring(13).split(' ');\n  return {\n    semantics: parts.shift(),\n    ssrcs: parts.map(ssrc => parseInt(ssrc, 10)),\n  };\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// Returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  const mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substring(6);\n  }\n};\n\n// Parses a fingerprint line for DTLS-SRTP.\nSDPUtils.parseFingerprint = function(line) {\n  const parts = line.substring(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1].toUpperCase(), // the definition is upper-case in RFC 4572.\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  const lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint),\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  let sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(fp => {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n\n// Parses a=crypto lines into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#dictionary-rtcsrtpsdesparameters-members\nSDPUtils.parseCryptoLine = function(line) {\n  const parts = line.substring(9).split(' ');\n  return {\n    tag: parseInt(parts[0], 10),\n    cryptoSuite: parts[1],\n    keyParams: parts[2],\n    sessionParams: parts.slice(3),\n  };\n};\n\nSDPUtils.writeCryptoLine = function(parameters) {\n  return 'a=crypto:' + parameters.tag + ' ' +\n    parameters.cryptoSuite + ' ' +\n    (typeof parameters.keyParams === 'object'\n      ? SDPUtils.writeCryptoKeyParams(parameters.keyParams)\n      : parameters.keyParams) +\n    (parameters.sessionParams ? ' ' + parameters.sessionParams.join(' ') : '') +\n    '\\r\\n';\n};\n\n// Parses the crypto key parameters into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#rtcsrtpkeyparam*\nSDPUtils.parseCryptoKeyParams = function(keyParams) {\n  if (keyParams.indexOf('inline:') !== 0) {\n    return null;\n  }\n  const parts = keyParams.substring(7).split('|');\n  return {\n    keyMethod: 'inline',\n    keySalt: parts[0],\n    lifeTime: parts[1],\n    mkiValue: parts[2] ? parts[2].split(':')[0] : undefined,\n    mkiLength: parts[2] ? parts[2].split(':')[1] : undefined,\n  };\n};\n\nSDPUtils.writeCryptoKeyParams = function(keyParams) {\n  return keyParams.keyMethod + ':'\n    + keyParams.keySalt +\n    (keyParams.lifeTime ? '|' + keyParams.lifeTime : '') +\n    (keyParams.mkiValue && keyParams.mkiLength\n      ? '|' + keyParams.mkiValue + ':' + keyParams.mkiLength\n      : '');\n};\n\n// Extracts all SDES parameters.\nSDPUtils.getCryptoParameters = function(mediaSection, sessionpart) {\n  const lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=crypto:');\n  return lines.map(SDPUtils.parseCryptoLine);\n};\n\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  const ufrag = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-ufrag:')[0];\n  const pwd = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-pwd:')[0];\n  if (!(ufrag && pwd)) {\n    return null;\n  }\n  return {\n    usernameFragment: ufrag.substring(12),\n    password: pwd.substring(10),\n  };\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  let sdp = 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n  if (params.iceLite) {\n    sdp += 'a=ice-lite\\r\\n';\n  }\n  return sdp;\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  const description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: [],\n  };\n  const lines = SDPUtils.splitLines(mediaSection);\n  const mline = lines[0].split(' ');\n  description.profile = mline[2];\n  for (let i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    const pt = mline[i];\n    const rtpmapline = SDPUtils.matchPrefix(\n      mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      const codec = SDPUtils.parseRtpMap(rtpmapline);\n      const fmtps = SDPUtils.matchPrefix(\n        mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(line => {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  const wildcardRtcpFb = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-fb:* ')\n    .map(SDPUtils.parseRtcpFb);\n  description.codecs.forEach(codec => {\n    wildcardRtcpFb.forEach(fb=> {\n      const duplicate = codec.rtcpFeedback.find(existingFeedback => {\n        return existingFeedback.type === fb.type &&\n          existingFeedback.parameter === fb.parameter;\n      });\n      if (!duplicate) {\n        codec.rtcpFeedback.push(fb);\n      }\n    });\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  let sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' ' + (caps.profile || 'UDP/TLS/RTP/SAVPF') + ' ';\n  sdp += caps.codecs.map(codec => {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(codec => {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  let maxptime = 0;\n  caps.codecs.forEach(codec => {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n\n  if (caps.headerExtensions) {\n    caps.headerExtensions.forEach(extension => {\n      sdp += SDPUtils.writeExtmap(extension);\n    });\n  }\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  const encodingParameters = [];\n  const description = SDPUtils.parseRtpParameters(mediaSection);\n  const hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  const hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  const ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(line => SDPUtils.parseSsrcMedia(line))\n    .filter(parts => parts.attribute === 'cname');\n  const primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  let secondarySsrc;\n\n  const flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n    .map(line => {\n      const parts = line.substring(17).split(' ');\n      return parts.map(part => parseInt(part, 10));\n    });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(codec => {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      let encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10),\n      };\n      if (primarySsrc && secondarySsrc) {\n        encParam.rtx = {ssrc: secondarySsrc};\n      }\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: primarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red',\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc,\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  let bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substring(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substring(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(params => {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  const rtcpParameters = {};\n\n  // Gets the first SSRC. Note that with RTX there might be multiple\n  // SSRCs.\n  const remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(line => SDPUtils.parseSsrcMedia(line))\n    .filter(obj => obj.attribute === 'cname')[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  const rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrіbute.\n  // Note that Edge does not support unmuxed RTCP.\n  const mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\nSDPUtils.writeRtcpParameters = function(rtcpParameters) {\n  let sdp = '';\n  if (rtcpParameters.reducedSize) {\n    sdp += 'a=rtcp-rsize\\r\\n';\n  }\n  if (rtcpParameters.mux) {\n    sdp += 'a=rtcp-mux\\r\\n';\n  }\n  if (rtcpParameters.ssrc !== undefined && rtcpParameters.cname) {\n    sdp += 'a=ssrc:' + rtcpParameters.ssrc +\n      ' cname:' + rtcpParameters.cname + '\\r\\n';\n  }\n  return sdp;\n};\n\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  let parts;\n  const spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substring(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  const planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(line => SDPUtils.parseSsrcMedia(line))\n    .filter(msidParts => msidParts.attribute === 'msid');\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// SCTP\n// parses draft-ietf-mmusic-sctp-sdp-26 first and falls back\n// to draft-ietf-mmusic-sctp-sdp-05\nSDPUtils.parseSctpDescription = function(mediaSection) {\n  const mline = SDPUtils.parseMLine(mediaSection);\n  const maxSizeLine = SDPUtils.matchPrefix(mediaSection, 'a=max-message-size:');\n  let maxMessageSize;\n  if (maxSizeLine.length > 0) {\n    maxMessageSize = parseInt(maxSizeLine[0].substring(19), 10);\n  }\n  if (isNaN(maxMessageSize)) {\n    maxMessageSize = 65536;\n  }\n  const sctpPort = SDPUtils.matchPrefix(mediaSection, 'a=sctp-port:');\n  if (sctpPort.length > 0) {\n    return {\n      port: parseInt(sctpPort[0].substring(12), 10),\n      protocol: mline.fmt,\n      maxMessageSize,\n    };\n  }\n  const sctpMapLines = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:');\n  if (sctpMapLines.length > 0) {\n    const parts = sctpMapLines[0]\n      .substring(10)\n      .split(' ');\n    return {\n      port: parseInt(parts[0], 10),\n      protocol: parts[1],\n      maxMessageSize,\n    };\n  }\n};\n\n// SCTP\n// outputs the draft-ietf-mmusic-sctp-sdp-26 version that all browsers\n// support by now receiving in this format, unless we originally parsed\n// as the draft-ietf-mmusic-sctp-sdp-05 format (indicated by the m-line\n// protocol of DTLS/SCTP -- without UDP/ or TCP/)\nSDPUtils.writeSctpDescription = function(media, sctp) {\n  let output = [];\n  if (media.protocol !== 'DTLS/SCTP') {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.protocol + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctp-port:' + sctp.port + '\\r\\n',\n    ];\n  } else {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.port + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctpmap:' + sctp.port + ' ' + sctp.protocol + ' 65535\\r\\n',\n    ];\n  }\n  if (sctp.maxMessageSize !== undefined) {\n    output.push('a=max-message-size:' + sctp.maxMessageSize + '\\r\\n');\n  }\n  return output.join('');\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 22);\n};\n\n// Write boiler plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\n// sessUser is optional and defaults to 'thisisadapterortc'\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer, sessUser) {\n  let sessionId;\n  const version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  const user = sessUser || 'thisisadapterortc';\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=' + user + ' ' + sessionId + ' ' + version +\n        ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  const lines = SDPUtils.splitLines(mediaSection);\n  for (let i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substring(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  const lines = SDPUtils.splitLines(mediaSection);\n  const mline = lines[0].split(' ');\n  return mline[0].substring(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  const lines = SDPUtils.splitLines(mediaSection);\n  const parts = lines[0].substring(2).split(' ');\n  return {\n    kind: parts[0],\n    port: parseInt(parts[1], 10),\n    protocol: parts[2],\n    fmt: parts.slice(3).join(' '),\n  };\n};\n\nSDPUtils.parseOLine = function(mediaSection) {\n  const line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\n  const parts = line.substring(2).split(' ');\n  return {\n    username: parts[0],\n    sessionId: parts[1],\n    sessionVersion: parseInt(parts[2], 10),\n    netType: parts[3],\n    addressType: parts[4],\n    address: parts[5],\n  };\n};\n\n// a very naive interpretation of a valid SDP.\nSDPUtils.isValidSDP = function(blob) {\n  if (typeof blob !== 'string' || blob.length === 0) {\n    return false;\n  }\n  const lines = SDPUtils.splitLines(blob);\n  for (let i = 0; i < lines.length; i++) {\n    if (lines[i].length < 2 || lines[i].charAt(1) !== '=') {\n      return false;\n    }\n    // TODO: check the modifier a bit more.\n  }\n  return true;\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n","import { getLogger } from '@signalwire/core';\nimport SDPUtils from 'sdp';\nconst _isAudioLine = (line) => /^m=audio/.test(line);\nconst _isVideoLine = (line) => /^m=video/.test(line);\nconst _getCodecPayloadType = (line) => {\n    const pattern = new RegExp('a=rtpmap:(\\\\d+) \\\\w+\\\\/\\\\d+');\n    const result = line.match(pattern);\n    return result && result.length == 2 ? result[1] : null;\n};\n/**\n * test if sdp has a video section\n */\nexport const hasMediaSection = (sdp, media) => {\n    return sdp.includes(`\\r\\nm=${media}`);\n};\n/**\n * Add stereo support hacking the SDP\n * @return the SDP modified\n */\nexport const sdpStereoHack = (sdp) => {\n    const endOfLine = '\\r\\n';\n    const sdpLines = sdp.split(endOfLine);\n    const opusIndex = sdpLines.findIndex((s) => /^a=rtpmap/.test(s) && /opus\\/48000/.test(s));\n    if (opusIndex < 0) {\n        return sdp;\n    }\n    const opusPayload = _getCodecPayloadType(sdpLines[opusIndex]);\n    const pattern = new RegExp(`a=fmtp:${opusPayload}`);\n    const fmtpLineIndex = sdpLines.findIndex((s) => pattern.test(s));\n    if (fmtpLineIndex >= 0) {\n        if (!/stereo=1;/.test(sdpLines[fmtpLineIndex])) {\n            // Append stereo=1 to fmtp line if not already present\n            sdpLines[fmtpLineIndex] += '; stereo=1; sprop-stereo=1';\n        }\n    }\n    else {\n        // create an fmtp line\n        sdpLines[opusIndex] += `${endOfLine}a=fmtp:${opusPayload} stereo=1; sprop-stereo=1`;\n    }\n    return sdpLines.join(endOfLine);\n};\nexport const sdpMediaOrderHack = (answer, localOffer) => {\n    const endOfLine = '\\r\\n';\n    const offerLines = localOffer.split(endOfLine);\n    const offerAudioIndex = offerLines.findIndex(_isAudioLine);\n    const offerVideoIndex = offerLines.findIndex(_isVideoLine);\n    if (offerVideoIndex == -1 ||\n        offerAudioIndex == -1 ||\n        offerAudioIndex < offerVideoIndex) {\n        return answer;\n    }\n    const answerLines = answer.split(endOfLine);\n    const answerAudioIndex = answerLines.findIndex(_isAudioLine);\n    const answerVideoIndex = answerLines.findIndex(_isVideoLine);\n    const audioLines = answerLines.slice(answerAudioIndex, answerVideoIndex);\n    const videoLines = answerLines.slice(answerVideoIndex, answerLines.length - 1);\n    const beginLines = answerLines.slice(0, answerAudioIndex);\n    return [...beginLines, ...videoLines, ...audioLines, ''].join(endOfLine);\n};\n/**\n * Modify the SDP to increase video bitrate\n * @return the SDP modified\n */\nexport const sdpBitrateHack = (sdp, max, min, start) => {\n    const endOfLine = '\\r\\n';\n    const lines = sdp.split(endOfLine);\n    lines.forEach((line, i) => {\n        if (/^a=fmtp:\\d*/.test(line)) {\n            lines[i] += `;x-google-max-bitrate=${max};x-google-min-bitrate=${min};x-google-start-bitrate=${start}`;\n        }\n        else if (/^a=mid:(1|video)/.test(line)) {\n            lines[i] += `\\r\\nb=AS:${max}`;\n        }\n    });\n    return lines.join(endOfLine);\n};\n// const sdpAudioRemoveRTPExtensions = (sdp: string, extensionsToFilter: string[]): string => {\n//   const endOfLine = '\\r\\n'\n//   let beginLines: string[] = []\n//   let audioLines: string[] = []\n//   let videoLines: string[] = []\n//   const newLines = sdp.split(endOfLine)\n//   const offerAudioIndex = newLines.findIndex(_isAudioLine)\n//   const offerVideoIndex = newLines.findIndex(_isVideoLine)\n//   if (offerAudioIndex < offerVideoIndex) {\n//     beginLines = newLines.slice(0, offerAudioIndex)\n//     audioLines = newLines.slice(offerAudioIndex, offerVideoIndex)\n//     videoLines = newLines.slice(offerVideoIndex, (newLines.length - 1))\n//   } else {\n//     beginLines = newLines.slice(0, offerVideoIndex)\n//     audioLines = newLines.slice(offerAudioIndex, (newLines.length - 1))\n//     videoLines = newLines.slice(offerVideoIndex, offerAudioIndex)\n//   }\n//   const newAudioLines = audioLines.filter((line: string) => {\n//     return !(line.includes(extensionsToFilter[0]) || line.includes(extensionsToFilter[1]) || line.includes(extensionsToFilter[2]))\n//   })\n//   return [...beginLines, ...newAudioLines, ...videoLines, ''].join(endOfLine)\n// }\n// const sdpAudioRemoveRidMidExtHack = (sdp: string): string => {\n//   const extensionsToFilter = [\n//     'urn:ietf:params:rtp-hdrext:sdes:mid',\n//     'urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id',\n//     'urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id',\n//   ]\n//   return sdpAudioRemoveRTPExtensions(sdp, extensionsToFilter)\n// }\n/**\n * Check for srflx, prflx or relay candidates\n * TODO: improve the logic check private/public IP for typ host\n *\n * @param sdp string\n * @returns boolean\n */\nexport const sdpHasValidCandidates = (sdp) => {\n    try {\n        const regex = /typ (?:srflx|prflx|relay)/;\n        const sections = SDPUtils.getMediaSections(sdp);\n        for (const section of sections) {\n            const lines = SDPUtils.splitLines(section);\n            const valid = lines.some((line) => {\n                return line.indexOf('a=candidate') === 0 && regex.test(line);\n            });\n            if (!valid) {\n                return false;\n            }\n        }\n        return true;\n    }\n    catch (error) {\n        getLogger().error('Error checking SDP', error);\n        return false;\n    }\n};\n/**\n * Remove \"a=candidate\" lines with local candidates\n * https://bloggeek.me/psa-mdns-and-local-ice-candidates-are-coming/\n */\nexport const sdpRemoveLocalCandidates = (sdp) => {\n    const pattern = /^a=candidate.*.local\\ .*/;\n    const endOfLine = '\\r\\n';\n    return sdp\n        .split(endOfLine)\n        .filter((line) => !pattern.test(line))\n        .join(endOfLine);\n};\n//# sourceMappingURL=sdpHelpers.js.map","import { getLogger } from '@signalwire/core';\nimport { getUserMedia as _getUserMedia } from './getUserMedia';\nimport { assureDeviceId } from './deviceHelpers';\nimport { hasMediaSection } from './sdpHelpers';\n// FIXME: Remove and use getUserMedia directly\nexport const getUserMedia = (constraints) => {\n    getLogger().info('RTCService.getUserMedia', constraints);\n    const { audio, video } = constraints;\n    if (!audio && !video) {\n        return;\n    }\n    return _getUserMedia(constraints);\n};\nexport const getMediaConstraints = async (options, remoteSDP) => {\n    const { audio: optionsAudio, micId } = options;\n    const { micLabel = '' } = options;\n    let audio = (remoteSDP && hasMediaSection(remoteSDP, 'audio')) || !remoteSDP\n        ? optionsAudio !== null && optionsAudio !== void 0 ? optionsAudio : true\n        : false; //should not request audio when the remote SDP don't accept audio\n    if (micId && audio) {\n        const newMicId = await assureDeviceId(micId, micLabel, 'microphone').catch((_error) => null);\n        if (newMicId) {\n            if (typeof audio === 'boolean') {\n                audio = {};\n            }\n            audio.deviceId = { exact: newMicId };\n        }\n    }\n    let { video: optionsVideo, camId } = options;\n    const { camLabel = '' } = options;\n    let video = (remoteSDP && hasMediaSection(remoteSDP, 'video')) || !remoteSDP\n        ? optionsVideo !== null && optionsVideo !== void 0 ? optionsVideo : !!camId\n        : false; //should not request video when the remote SDP don't accept video\n    if (camId && video) {\n        const newCamId = await assureDeviceId(camId, camLabel, 'camera').catch((_error) => null);\n        if (newCamId) {\n            if (typeof video === 'boolean') {\n                video = {};\n            }\n            video.deviceId = { exact: newCamId };\n        }\n    }\n    return { audio, video };\n};\nexport const filterIceServers = (servers, options) => {\n    const { disableUdpIceServers = false } = options;\n    const filterOutUdpUrls = (urls) => {\n        const transportParam = 'transport=udp';\n        if (Array.isArray(urls)) {\n            return urls.filter((url) => !url.includes(transportParam));\n        }\n        return urls.includes(transportParam) ? '' : urls;\n    };\n    return servers.map((server) => (Object.assign(Object.assign({}, server), { urls: disableUdpIceServers ? filterOutUdpUrls(server.urls) : server.urls })));\n};\n//# sourceMappingURL=helpers.js.map","import { getLogger, uuid } from '@signalwire/core';\nimport { getUserMedia, getMediaConstraints, filterIceServers, } from './utils/helpers';\nimport { sdpStereoHack, sdpBitrateHack, sdpMediaOrderHack, sdpHasValidCandidates, } from './utils/sdpHelpers';\nimport { sdpToJsonHack, RTCPeerConnection, streamIsValid, stopTrack, } from './utils';\nimport { watchRTCPeerMediaPackets } from './utils/watchRTCPeerMediaPackets';\nconst RESUME_TIMEOUT = 12000;\nexport default class RTCPeer {\n    constructor(call, type) {\n        this.call = call;\n        this.type = type;\n        this.uuid = uuid();\n        this._negotiating = false;\n        this._processingRemoteSDP = false;\n        this._restartingIce = false;\n        this.logger.debug('New Peer with type:', this.type, 'Options:', this.options);\n        this._onIce = this._onIce.bind(this);\n        this._onEndedTrackHandler = this._onEndedTrackHandler.bind(this);\n        if (this.options.prevCallId) {\n            this.uuid = this.options.prevCallId;\n        }\n        this.options.prevCallId = undefined;\n        if (this.options.localStream && streamIsValid(this.options.localStream)) {\n            this._localStream = this.options.localStream;\n        }\n        this.rtcConfigPolyfill = this.config;\n    }\n    get logger() {\n        return getLogger();\n    }\n    get options() {\n        return this.call.options;\n    }\n    get watchMediaPacketsTimeout() {\n        var _a;\n        return (_a = this.options.watchMediaPacketsTimeout) !== null && _a !== void 0 ? _a : 2000;\n    }\n    get localStream() {\n        return this._localStream;\n    }\n    set localStream(stream) {\n        this._localStream = stream;\n    }\n    get remoteStream() {\n        return this._remoteStream;\n    }\n    get isOffer() {\n        return this.type === 'offer';\n    }\n    get isAnswer() {\n        return this.type === 'answer';\n    }\n    get isSimulcast() {\n        return this.options.simulcast === true;\n    }\n    get isSfu() {\n        return this.options.sfu === true;\n    }\n    get localVideoTrack() {\n        const videoSender = this._getSenderByKind('video');\n        return (videoSender === null || videoSender === void 0 ? void 0 : videoSender.track) || null;\n    }\n    get localAudioTrack() {\n        const audioSender = this._getSenderByKind('audio');\n        return (audioSender === null || audioSender === void 0 ? void 0 : audioSender.track) || null;\n    }\n    get remoteVideoTrack() {\n        const videoReceiver = this._getReceiverByKind('video');\n        return (videoReceiver === null || videoReceiver === void 0 ? void 0 : videoReceiver.track) || null;\n    }\n    get remoteAudioTrack() {\n        const audioReceiver = this._getReceiverByKind('audio');\n        return (audioReceiver === null || audioReceiver === void 0 ? void 0 : audioReceiver.track) || null;\n    }\n    get hasAudioSender() {\n        return this._getSenderByKind('audio') ? true : false;\n    }\n    get hasVideoSender() {\n        return this._getSenderByKind('video') ? true : false;\n    }\n    get hasAudioReceiver() {\n        return this._getReceiverByKind('audio') ? true : false;\n    }\n    get hasVideoReceiver() {\n        return this._getReceiverByKind('video') ? true : false;\n    }\n    get config() {\n        const { rtcPeerConfig = {} } = this.options;\n        const config = Object.assign({ bundlePolicy: 'max-compat', iceServers: filterIceServers(this.call.iceServers, {\n                disableUdpIceServers: this.options.disableUdpIceServers,\n            }), \n            // @ts-ignore\n            sdpSemantics: 'unified-plan' }, rtcPeerConfig);\n        this.logger.debug('RTC config', config);\n        return config;\n    }\n    get localSdp() {\n        var _a, _b;\n        return (_b = (_a = this.instance) === null || _a === void 0 ? void 0 : _a.localDescription) === null || _b === void 0 ? void 0 : _b.sdp;\n    }\n    get remoteSdp() {\n        var _a, _b;\n        return (_b = (_a = this.instance) === null || _a === void 0 ? void 0 : _a.remoteDescription) === null || _b === void 0 ? void 0 : _b.sdp;\n    }\n    get hasIceServers() {\n        if (this.instance) {\n            const { iceServers = [] } = this.getConfiguration();\n            return Boolean(iceServers === null || iceServers === void 0 ? void 0 : iceServers.length);\n        }\n        return false;\n    }\n    stopTrackSender(kind) {\n        var _a;\n        try {\n            const sender = this._getSenderByKind(kind);\n            if (!sender) {\n                return this.logger.info(`There is not a '${kind}' sender to stop.`);\n            }\n            if (sender.track) {\n                stopTrack(sender.track);\n                (_a = this._localStream) === null || _a === void 0 ? void 0 : _a.removeTrack(sender.track);\n            }\n        }\n        catch (error) {\n            this.logger.error('RTCPeer stopTrackSender error', kind, error);\n        }\n    }\n    async restoreTrackSender(kind) {\n        var _a;\n        try {\n            const sender = this._getSenderByKind(kind);\n            if (!sender) {\n                return this.logger.info(`There is not a '${kind}' sender to restore.`);\n            }\n            if (sender.track && sender.track.readyState !== 'ended') {\n                return this.logger.info(`There is already an active ${kind} track.`);\n            }\n            const constraints = await getMediaConstraints(this.options);\n            // @ts-ignore\n            const stream = await getUserMedia({ [kind]: constraints[kind] });\n            if (stream && streamIsValid(stream)) {\n                const newTrack = stream.getTracks().find((t) => t.kind === kind);\n                if (newTrack) {\n                    await sender.replaceTrack(newTrack);\n                    (_a = this._localStream) === null || _a === void 0 ? void 0 : _a.addTrack(newTrack);\n                }\n            }\n        }\n        catch (error) {\n            this.logger.error('RTCPeer restoreTrackSender error', kind, error);\n        }\n    }\n    getDeviceId(kind) {\n        try {\n            const sender = this._getSenderByKind(kind);\n            if (!sender || !sender.track) {\n                return null;\n            }\n            const { deviceId = null } = sender.track.getSettings();\n            return deviceId;\n        }\n        catch (error) {\n            this.logger.error('RTCPeer getDeviceId error', kind, error);\n            return null;\n        }\n    }\n    getTrackSettings(kind) {\n        try {\n            const sender = this._getSenderByKind(kind);\n            if (!sender || !sender.track) {\n                return null;\n            }\n            return sender.track.getSettings();\n        }\n        catch (error) {\n            this.logger.error('RTCPeer getTrackSettings error', kind, error);\n            return null;\n        }\n    }\n    getDeviceLabel(kind) {\n        try {\n            const sender = this._getSenderByKind(kind);\n            if (!sender || !sender.track) {\n                return null;\n            }\n            return sender.track.label;\n        }\n        catch (error) {\n            this.logger.error('RTCPeer getDeviceLabel error', kind, error);\n            return null;\n        }\n    }\n    restartIceWithRelayOnly() {\n        try {\n            if (this.isAnswer) {\n                return this.logger.warn('Skip restartIceWithRelayOnly since we need to generate answer');\n            }\n            const config = this.getConfiguration();\n            if (config.iceTransportPolicy === 'relay') {\n                return this.logger.warn('RTCPeer already with iceTransportPolicy relay only');\n            }\n            const newConfig = Object.assign(Object.assign({}, config), { iceTransportPolicy: 'relay' });\n            this.setConfiguration(newConfig);\n            this.restartIce();\n        }\n        catch (error) {\n            this.logger.error('restartIceWithRelayOnly', error);\n        }\n    }\n    restartIce() {\n        if (this._negotiating || this._restartingIce) {\n            return this.logger.warn('Skip restartIce');\n        }\n        this._restartingIce = true;\n        this.logger.debug('Restart ICE');\n        // Type must be Offer to send reinvite.\n        this.type = 'offer';\n        // @ts-ignore\n        this.instance.restartIce();\n    }\n    triggerResume() {\n        this.logger.info('Probably half-open so force close from client');\n        if (this._resumeTimer) {\n            this.logger.info('[skipped] Already in \"resume\" state');\n            return;\n        }\n        // @ts-expect-error\n        this.call.emit('media.disconnected');\n        // @ts-expect-error\n        this.call.emit('media.reconnecting');\n        this.clearTimers();\n        this._resumeTimer = setTimeout(() => {\n            this.logger.warn('Disconnecting due to RECONNECTION_ATTEMPT_TIMEOUT');\n            // @ts-expect-error\n            this.call.emit('media.disconnected');\n            this.call.leaveReason = 'RECONNECTION_ATTEMPT_TIMEOUT';\n            this.call.setState('hangup');\n        }, RESUME_TIMEOUT); // TODO: read from call verto.invite response\n        this.call._closeWSConnection();\n    }\n    resetNeedResume() {\n        this.clearResumeTimer();\n        if (this.options.watchMediaPackets) {\n            this.startWatchMediaPackets();\n        }\n    }\n    stopWatchMediaPackets() {\n        if (this._mediaWatcher) {\n            this._mediaWatcher.stop();\n        }\n    }\n    startWatchMediaPackets() {\n        var _a;\n        this.stopWatchMediaPackets();\n        this._mediaWatcher = watchRTCPeerMediaPackets(this);\n        (_a = this._mediaWatcher) === null || _a === void 0 ? void 0 : _a.start();\n    }\n    async applyMediaConstraints(kind, constraints) {\n        try {\n            const sender = this._getSenderByKind(kind);\n            if (!sender || !sender.track) {\n                return this.logger.info('No sender to apply constraints', kind, constraints);\n            }\n            if (sender.track.readyState === 'live') {\n                const newConstraints = Object.assign(Object.assign({}, sender.track.getConstraints()), constraints);\n                const deviceId = this.getDeviceId(kind);\n                if (deviceId && !this.options.screenShare) {\n                    newConstraints.deviceId = { exact: deviceId };\n                }\n                this.logger.info(`Apply ${kind} constraints`, this.call.id, newConstraints);\n                await sender.track.applyConstraints(newConstraints);\n            }\n        }\n        catch (error) {\n            this.logger.error('Error applying constraints', kind, constraints);\n        }\n    }\n    _getSenderByKind(kind) {\n        var _a;\n        if (!((_a = this.instance) === null || _a === void 0 ? void 0 : _a.getSenders)) {\n            this.logger.warn('RTCPeerConnection.getSenders() not available.');\n            return null;\n        }\n        return this.instance\n            .getSenders()\n            .find(({ track }) => track && track.kind === kind);\n    }\n    _getReceiverByKind(kind) {\n        var _a;\n        if (!((_a = this.instance) === null || _a === void 0 ? void 0 : _a.getReceivers)) {\n            this.logger.warn('RTCPeerConnection.getReceivers() not available.');\n            return null;\n        }\n        return this.instance\n            .getReceivers()\n            .find(({ track }) => track && track.kind === kind);\n    }\n    async startNegotiation(force = false) {\n        var _a, _b;\n        if (this._negotiating) {\n            return this.logger.warn('Skip twice onnegotiationneeded!');\n        }\n        this._negotiating = true;\n        try {\n            /**\n             * additionalDevice and screenShare are `sendonly`\n             */\n            if (this.options.additionalDevice || this.options.screenShare) {\n                (_b = (_a = this.instance) === null || _a === void 0 ? void 0 : _a.getTransceivers) === null || _b === void 0 ? void 0 : _b.call(_a).forEach((tr) => {\n                    tr.direction = 'sendonly';\n                });\n            }\n            this.instance.removeEventListener('icecandidate', this._onIce);\n            this.instance.addEventListener('icecandidate', this._onIce);\n            if (this.isOffer) {\n                this.logger.debug('Trying to generate offer');\n                const offerOptions = {\n                    /**\n                     * While this property is deprected, on Browsers where this\n                     * is still supported this avoids conflicting with the VAD\n                     * server-side\n                     */\n                    // @ts-ignore\n                    voiceActivityDetection: false,\n                };\n                if (!this._supportsAddTransceiver()) {\n                    offerOptions.offerToReceiveAudio = this.options.negotiateAudio;\n                    offerOptions.offerToReceiveVideo = this.options.negotiateVideo;\n                }\n                console.log('##############################');\n                console.log('##############################');\n                console.log('##############################');\n                console.log(JSON.stringify(offerOptions, null, 2));\n                console.log('##############################');\n                console.log('##############################');\n                console.log('##############################');\n                const offer = await this.instance.createOffer(offerOptions);\n                console.log(offer.sdp);\n                await this._setLocalDescription(offer);\n            }\n            if (this.isAnswer) {\n                this.logger.debug('Trying to generate answer');\n                await this._setRemoteDescription({\n                    sdp: this.options.remoteSdp,\n                    type: 'offer',\n                });\n                const answer = await this.instance.createAnswer({\n                    // Same as above.\n                    // @ts-ignore\n                    voiceActivityDetection: false,\n                });\n                await this._setLocalDescription(answer);\n            }\n            /**\n             * ReactNative Workaround\n             */\n            if (force) {\n                this._sdpReady();\n            }\n            this.logger.info('iceGatheringState', this.instance.iceGatheringState);\n            if (this.instance.iceGatheringState === 'gathering') {\n                this._iceTimeout = setTimeout(() => {\n                    this._onIceTimeout();\n                }, this.options.maxIceGatheringTimeout);\n            }\n        }\n        catch (error) {\n            this.logger.error(`Error creating ${this.type}:`, error);\n        }\n    }\n    onRemoteBye({ code, message }) {\n        var _a;\n        // It could be a negotiation/signaling error so reject the \"startMethod\"\n        (_a = this._rejectStartMethod) === null || _a === void 0 ? void 0 : _a.call(this, {\n            code,\n            message,\n        });\n        this.stop();\n    }\n    async onRemoteSdp(sdp) {\n        if (this._processingRemoteSDP ||\n            (this.remoteSdp && this.remoteSdp === sdp)) {\n            this.logger.warn('Ignore same remote SDP', sdp);\n            return;\n        }\n        try {\n            this._processingRemoteSDP = true;\n            const type = this.isOffer ? 'answer' : 'offer';\n            await this._setRemoteDescription({ sdp, type });\n            this._processingRemoteSDP = false;\n            /**\n             * Resolve the start() method only for Offer because for Answer\n             * we need to reply to the server and wait for the signaling.\n             */\n            if (this.isOffer) {\n                this._resolveStartMethod();\n            }\n            this.resetNeedResume();\n        }\n        catch (error) {\n            this.logger.error(`Error handling remote SDP on call ${this.call.id}:`, error);\n            this.call.hangup();\n            this._rejectStartMethod(error);\n        }\n    }\n    _setupRTCPeerConnection() {\n        if (!this.instance) {\n            this.instance = RTCPeerConnection(this.config);\n            this._attachListeners();\n        }\n    }\n    async start() {\n        return new Promise(async (resolve, reject) => {\n            this._resolveStartMethod = resolve;\n            this._rejectStartMethod = reject;\n            try {\n                this._localStream = await this._retrieveLocalStream();\n            }\n            catch (error) {\n                this._rejectStartMethod(error);\n                return this.call.setState('hangup');\n            }\n            /**\n             * We need to defer the creation of RTCPeerConnection\n             * until we gain gUM access otherwise it will have\n             * private IP addresses in ICE host candidates\n             * replaced by an mDNS hostname\n             * @see https://groups.google.com/g/discuss-webrtc/c/6stQXi72BEU?pli=1\n             */\n            this._setupRTCPeerConnection();\n            let hasLocalTracks = false;\n            if (this._localStream && streamIsValid(this._localStream)) {\n                const audioTracks = this._localStream.getAudioTracks();\n                this.logger.debug('Local audio tracks: ', audioTracks);\n                const videoTracks = this._localStream.getVideoTracks();\n                this.logger.debug('Local video tracks: ', videoTracks);\n                hasLocalTracks = Boolean(audioTracks.length || videoTracks.length);\n                // TODO: use transceivers way only for offer - when answer gotta match mid from the ones from SRD\n                if (this.isOffer &&\n                    typeof this.instance.addTransceiver === 'function') {\n                    const audioTransceiverParams = {\n                        direction: this.options.negotiateAudio ? 'sendrecv' : 'sendonly',\n                        streams: [this._localStream],\n                    };\n                    this.logger.debug('Applying audioTransceiverParams', audioTransceiverParams);\n                    audioTracks.forEach((track) => {\n                        this.instance.addTransceiver(track, audioTransceiverParams);\n                    });\n                    const videoTransceiverParams = {\n                        direction: this.options.negotiateVideo ? 'sendrecv' : 'sendonly',\n                        streams: [this._localStream],\n                    };\n                    if (this.isSimulcast) {\n                        const rids = ['0', '1', '2'];\n                        videoTransceiverParams.sendEncodings = rids.map((rid) => ({\n                            active: true,\n                            rid: rid,\n                            scaleResolutionDownBy: Number(rid) * 6 || 1.0,\n                        }));\n                    }\n                    this.logger.debug('Applying videoTransceiverParams', videoTransceiverParams);\n                    videoTracks.forEach((track) => {\n                        this.instance.addTransceiver(track, videoTransceiverParams);\n                    });\n                    if (this.isSfu) {\n                        const { msStreamsNumber = 5 } = this.options;\n                        this.logger.debug('Add ', msStreamsNumber, 'recvonly MS Streams');\n                        videoTransceiverParams.direction = 'recvonly';\n                        for (let i = 0; i < Number(msStreamsNumber); i++) {\n                            this.instance.addTransceiver('video', videoTransceiverParams);\n                        }\n                    }\n                }\n                else if (typeof this.instance.addTrack === 'function') {\n                    // Use addTrack\n                    // To avoid TS complains in forEach\n                    const stream = this._localStream;\n                    audioTracks.forEach((track) => this.instance.addTrack(track, stream));\n                    videoTracks.forEach((track) => this.instance.addTrack(track, stream));\n                }\n                else {\n                    // Fallback to legacy addStream ..\n                    // @ts-ignore\n                    this.instance.addStream(this._localStream);\n                }\n            }\n            if (this.isOffer) {\n                if (this.options.negotiateAudio) {\n                    this._checkMediaToNegotiate('audio');\n                }\n                if (this.options.negotiateVideo) {\n                    this._checkMediaToNegotiate('video');\n                }\n                /**\n                 * If it does not support unified-plan stuff (senders/receivers/transceivers)\n                 * invoke manually startNegotiation and use the RTCOfferOptions\n                 */\n                if (!this._supportsAddTransceiver() && !hasLocalTracks) {\n                    this.startNegotiation();\n                }\n            }\n            else {\n                this.startNegotiation();\n            }\n        });\n    }\n    detachAndStop() {\n        var _a;\n        if (typeof ((_a = this.instance) === null || _a === void 0 ? void 0 : _a.getTransceivers) === 'function') {\n            this.instance.getTransceivers().forEach((transceiver) => {\n                // Do not use `stopTrack` util to not dispatch the `ended` event\n                if (transceiver.sender.track) {\n                    transceiver.sender.track.stop();\n                }\n                if (transceiver.receiver.track) {\n                    transceiver.receiver.track.stop();\n                }\n            });\n        }\n        this.stop();\n    }\n    stop() {\n        var _a, _b, _c;\n        // Do not use `stopTrack` util to not dispatch the `ended` event\n        (_a = this._localStream) === null || _a === void 0 ? void 0 : _a.getTracks().forEach((track) => track.stop());\n        (_b = this._remoteStream) === null || _b === void 0 ? void 0 : _b.getTracks().forEach((track) => track.stop());\n        (_c = this.instance) === null || _c === void 0 ? void 0 : _c.close();\n        this.stopWatchMediaPackets();\n    }\n    _supportsAddTransceiver() {\n        return typeof this.instance.addTransceiver === 'function';\n    }\n    _checkMediaToNegotiate(kind) {\n        // addTransceiver of 'kind' if not present\n        const sender = this._getSenderByKind(kind);\n        if (!sender && this._supportsAddTransceiver()) {\n            const transceiver = this.instance.addTransceiver(kind, {\n                direction: 'recvonly',\n            });\n            this.logger.debug('Add transceiver', kind, transceiver);\n        }\n    }\n    async _sdpReady() {\n        clearTimeout(this._iceTimeout);\n        if (!this.instance.localDescription) {\n            this.logger.error('Missing localDescription', this.instance);\n            return;\n        }\n        const { sdp } = this.instance.localDescription;\n        if (sdp.indexOf('candidate') === -1) {\n            this.logger.debug('No candidate - retry \\n');\n            this.startNegotiation(true);\n            return;\n        }\n        if (!this._sdpIsValid()) {\n            this.logger.info('SDP ready but not valid');\n            this._onIceTimeout();\n            return;\n        }\n        this.instance.removeEventListener('icecandidate', this._onIce);\n        try {\n            await this.call.onLocalSDPReady(this);\n            if (this.isAnswer) {\n                this._resolveStartMethod();\n            }\n        }\n        catch (error) {\n            this._rejectStartMethod(error);\n        }\n    }\n    _sdpIsValid() {\n        if (this.localSdp && this.hasIceServers) {\n            return sdpHasValidCandidates(this.localSdp);\n        }\n        return Boolean(this.localSdp);\n    }\n    _forceNegotiation() {\n        this.logger.info('Force negotiation again');\n        this._negotiating = false;\n        this.startNegotiation();\n    }\n    _onIceTimeout() {\n        if (this._sdpIsValid()) {\n            this._sdpReady();\n            return;\n        }\n        this.logger.info('ICE gathering timeout');\n        const config = this.getConfiguration();\n        if (config.iceTransportPolicy === 'relay') {\n            this.logger.info('RTCPeer already with \"iceTransportPolicy: relay\"');\n            this._rejectStartMethod({\n                code: 'ICE_GATHERING_FAILED',\n                message: 'Ice gathering timeout',\n            });\n            this.call.setState('destroy');\n            return;\n        }\n        this.setConfiguration(Object.assign(Object.assign({}, config), { iceTransportPolicy: 'relay' }));\n        this._forceNegotiation();\n    }\n    _onIce(event) {\n        /**\n         * Clear _iceTimeout on each single candidate\n         */\n        if (this._iceTimeout) {\n            clearTimeout(this._iceTimeout);\n        }\n        /**\n         * Following spec: no candidate means the gathering is completed.\n         */\n        if (!event.candidate) {\n            this.instance.removeEventListener('icecandidate', this._onIce);\n            this._sdpReady();\n            return;\n        }\n        this.logger.debug('RTCPeer Candidate:', event.candidate);\n        if (event.candidate.type === 'host') {\n            /**\n             * With `host` candidate set timeout to\n             * maxIceGatheringTimeout and then invoke\n             * _onIceTimeout to check if the SDP is valid\n             */\n            this._iceTimeout = setTimeout(() => {\n                this.instance.removeEventListener('icecandidate', this._onIce);\n                this._onIceTimeout();\n            }, this.options.maxIceGatheringTimeout);\n        }\n        else {\n            /**\n             * With `srflx`, `prflx` or `relay` candidates\n             * set timeout to iceGatheringTimeout and then invoke\n             * _sdpReady since at least one candidate is valid.\n             */\n            this._iceTimeout = setTimeout(() => {\n                this.instance.removeEventListener('icecandidate', this._onIce);\n                this._sdpReady();\n            }, this.options.iceGatheringTimeout);\n        }\n    }\n    _setLocalDescription(localDescription) {\n        const { useStereo, googleMaxBitrate, googleMinBitrate, googleStartBitrate, } = this.options;\n        if (localDescription.sdp && useStereo) {\n            localDescription.sdp = sdpStereoHack(localDescription.sdp);\n        }\n        if (localDescription.sdp &&\n            googleMaxBitrate &&\n            googleMinBitrate &&\n            googleStartBitrate) {\n            localDescription.sdp = sdpBitrateHack(localDescription.sdp, googleMaxBitrate, googleMinBitrate, googleStartBitrate);\n        }\n        // this.logger.debug(\n        //   'LOCAL SDP \\n',\n        //   `Type: ${localDescription.type}`,\n        //   '\\n\\n',\n        //   localDescription.sdp\n        // )\n        return this.instance.setLocalDescription(localDescription);\n    }\n    _setRemoteDescription(remoteDescription) {\n        if (remoteDescription.sdp && this.options.useStereo) {\n            remoteDescription.sdp = sdpStereoHack(remoteDescription.sdp);\n        }\n        if (remoteDescription.sdp && this.instance.localDescription) {\n            remoteDescription.sdp = sdpMediaOrderHack(remoteDescription.sdp, this.instance.localDescription.sdp);\n        }\n        const sessionDescr = sdpToJsonHack(remoteDescription);\n        this.logger.debug('REMOTE SDP \\n', `Type: ${remoteDescription.type}`, '\\n\\n', remoteDescription.sdp);\n        return this.instance.setRemoteDescription(sessionDescr);\n    }\n    async _retrieveLocalStream() {\n        var _a;\n        if (streamIsValid(this.options.localStream)) {\n            return this.options.localStream;\n        }\n        const remoteSDP = (_a = this.remoteSdp) !== null && _a !== void 0 ? _a : this.options.remoteSdp;\n        const constraints = await getMediaConstraints(this.options, remoteSDP);\n        return getUserMedia(constraints);\n    }\n    _attachListeners() {\n        this.instance.addEventListener('signalingstatechange', () => {\n            this.logger.debug('signalingState:', this.instance.signalingState);\n            switch (this.instance.signalingState) {\n                case 'stable':\n                    // Workaround to skip nested negotiations\n                    // Chrome bug: https://bugs.chromium.org/p/chromium/issues/detail?id=740501\n                    this._negotiating = false;\n                    this._restartingIce = false;\n                    this.resetNeedResume();\n                    if (this.instance.connectionState === 'connected') {\n                        // An ice restart won't change the connectionState so we emit the same event in here\n                        // since the signalingState is \"stable\" again.\n                        this.emitMediaConnected();\n                    }\n                    break;\n                case 'have-local-offer': {\n                    if (this.instance.iceGatheringState === 'complete') {\n                        this._sdpReady();\n                    }\n                    break;\n                }\n                // case 'have-remote-offer': {}\n                case 'closed':\n                    // @ts-ignore\n                    delete this.instance;\n                    break;\n                default:\n                    this._negotiating = true;\n            }\n        });\n        this.instance.addEventListener('connectionstatechange', () => {\n            this.logger.debug('connectionState:', this.instance.connectionState);\n            switch (this.instance.connectionState) {\n                // case 'new':\n                //   break\n                case 'connecting':\n                    this._connectionStateTimer = setTimeout(() => {\n                        this.logger.warn('connectionState timed out');\n                        this.restartIceWithRelayOnly();\n                    }, this.options.maxConnectionStateTimeout);\n                    break;\n                case 'connected':\n                    this.clearConnectionStateTimer();\n                    this.emitMediaConnected();\n                    break;\n                // case 'closed':\n                //   break\n                case 'disconnected':\n                    this.logger.debug('[test] Prevent reattach!');\n                    break;\n                case 'failed': {\n                    this.triggerResume();\n                    break;\n                }\n            }\n        });\n        this.instance.addEventListener('negotiationneeded', () => {\n            this.logger.debug('Negotiation needed event');\n            this.startNegotiation();\n        });\n        this.instance.addEventListener('iceconnectionstatechange', () => {\n            this.logger.debug('iceConnectionState:', this.instance.iceConnectionState);\n        });\n        this.instance.addEventListener('icegatheringstatechange', () => {\n            this.logger.debug('iceGatheringState:', this.instance.iceGatheringState);\n        });\n        // this.instance.addEventListener('icecandidateerror', (event) => {\n        //   this.logger.warn('IceCandidate Error:', event)\n        // })\n        this.instance.addEventListener('track', (event) => {\n            // @ts-expect-error\n            this.call.emit('track', event);\n            if (this.isSfu) {\n                // const notification = { type: 'trackAdd', event }\n                // this.call._dispatchNotification(notification)\n            }\n            this._remoteStream = event.streams[0];\n        });\n        // @ts-ignore\n        this.instance.addEventListener('addstream', (event) => {\n            if (event.stream) {\n                this._remoteStream = event.stream;\n            }\n        });\n        this._attachAudioTrackListener();\n        this._attachVideoTrackListener();\n    }\n    clearTimers() {\n        this.clearResumeTimer();\n        this.clearWatchMediaPacketsTimer();\n        this.clearConnectionStateTimer();\n    }\n    clearConnectionStateTimer() {\n        clearTimeout(this._connectionStateTimer);\n    }\n    clearWatchMediaPacketsTimer() {\n        clearTimeout(this._watchMediaPacketsTimer);\n    }\n    clearResumeTimer() {\n        clearTimeout(this._resumeTimer);\n        this._resumeTimer = undefined;\n    }\n    emitMediaConnected() {\n        // @ts-expect-error\n        this.call.emit('media.connected');\n    }\n    _onEndedTrackHandler(event) {\n        const mediaTrack = event.target;\n        const evt = mediaTrack.kind === 'audio' ? 'microphone' : 'camera';\n        // @ts-expect-error\n        this.call.emit(`${evt}.disconnected`, {\n            deviceId: mediaTrack.id,\n            label: mediaTrack.label,\n        });\n    }\n    _attachAudioTrackListener() {\n        var _a;\n        (_a = this.localStream) === null || _a === void 0 ? void 0 : _a.getAudioTracks().forEach((track) => {\n            track.addEventListener('ended', this._onEndedTrackHandler);\n        });\n    }\n    _attachVideoTrackListener() {\n        var _a;\n        (_a = this.localStream) === null || _a === void 0 ? void 0 : _a.getVideoTracks().forEach((track) => {\n            track.addEventListener('ended', this._onEndedTrackHandler);\n        });\n    }\n    _detachAudioTrackListener() {\n        var _a;\n        (_a = this.localStream) === null || _a === void 0 ? void 0 : _a.getAudioTracks().forEach((track) => {\n            track.removeEventListener('ended', this._onEndedTrackHandler);\n        });\n    }\n    _detachVideoTrackListener() {\n        var _a;\n        (_a = this.localStream) === null || _a === void 0 ? void 0 : _a.getVideoTracks().forEach((track) => {\n            track.removeEventListener('ended', this._onEndedTrackHandler);\n        });\n    }\n    /**\n     * React Native does not support getConfiguration\n     * so we polyfill it using a local `rtcConfigPolyfill` object.\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/setConfiguration#parameters\n     */\n    setConfiguration(config) {\n        var _a;\n        this.rtcConfigPolyfill = config;\n        if (this.instance &&\n            typeof ((_a = this.instance) === null || _a === void 0 ? void 0 : _a.setConfiguration) === 'function') {\n            this.instance.setConfiguration(config);\n        }\n    }\n    /**\n     * React Native does not support getConfiguration\n     * so we polyfill it using a local config object.\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/getConfiguration\n     */\n    getConfiguration() {\n        var _a;\n        if (this.instance &&\n            typeof ((_a = this.instance) === null || _a === void 0 ? void 0 : _a.getConfiguration) === 'function') {\n            return this.instance.getConfiguration();\n        }\n        return this.rtcConfigPolyfill || this.config;\n    }\n}\n//# sourceMappingURL=RTCPeer.js.map","import { getLogger } from '@signalwire/core';\nexport const watchRTCPeerMediaPackets = (rtcPeer) => {\n    if (!rtcPeer.hasAudioReceiver && !rtcPeer.hasVideoReceiver) {\n        getLogger().warn(`Missing receivers to inspect media for RTCPeer \"${rtcPeer.uuid}\"`);\n        return;\n    }\n    getLogger().debug(`Start watching media for RTCPeer \"${rtcPeer.uuid}\"`);\n    let previousAudioValue = 0;\n    let previousVideoValue = 0;\n    let run = true;\n    let timer;\n    const clearTimer = () => {\n        clearTimeout(timer);\n    };\n    const meter = async () => {\n        var _a, _b;\n        let audioPacketsReceived = 0;\n        let videoPacketsReceived = 0;\n        try {\n            const stats = await rtcPeer.instance.getStats(null);\n            const audioTrackId = (_a = rtcPeer.remoteAudioTrack) === null || _a === void 0 ? void 0 : _a.id;\n            const videoTrackId = (_b = rtcPeer.remoteVideoTrack) === null || _b === void 0 ? void 0 : _b.id;\n            stats.forEach((report) => {\n                if (report.type === 'inbound-rtp' &&\n                    report.kind === 'audio' &&\n                    report.trackIdentifier === audioTrackId) {\n                    getLogger().trace(`audio inbound-rtp: packetsReceived: ${report.packetsReceived} (at ${report.lastPacketReceivedTimestamp})`);\n                    audioPacketsReceived = report.packetsReceived;\n                }\n                if (report.type === 'inbound-rtp' &&\n                    report.kind === 'video' &&\n                    report.trackIdentifier === videoTrackId) {\n                    getLogger().trace(`video inbound-rtp: packetsReceived: ${report.packetsReceived} (at ${report.lastPacketReceivedTimestamp})`);\n                    videoPacketsReceived = report.packetsReceived;\n                }\n            });\n        }\n        catch (error) {\n            getLogger().warn('getStats error', error);\n        }\n        finally {\n            const noAudioChanged = audioPacketsReceived && audioPacketsReceived <= previousAudioValue;\n            const noVideoChanged = videoPacketsReceived && videoPacketsReceived <= previousVideoValue;\n            if (noAudioChanged && noVideoChanged) {\n                getLogger().warn(`audioPacketsReceived: ${audioPacketsReceived} - previousAudioValue: ${previousAudioValue}`);\n                getLogger().warn(`videoPacketsReceived: ${videoPacketsReceived} - previousVideoValue: ${previousVideoValue}`);\n                rtcPeer.triggerResume();\n            }\n            else {\n                previousAudioValue = audioPacketsReceived !== null && audioPacketsReceived !== void 0 ? audioPacketsReceived : previousAudioValue;\n                previousVideoValue = videoPacketsReceived !== null && videoPacketsReceived !== void 0 ? videoPacketsReceived : previousVideoValue;\n                clearTimer();\n                if (run && rtcPeer.instance.connectionState !== 'closed') {\n                    timer = setTimeout(() => meter(), rtcPeer.watchMediaPacketsTimeout);\n                }\n            }\n        }\n    };\n    return {\n        start: () => {\n            clearTimer();\n            meter();\n        },\n        stop: () => {\n            run = false;\n            clearTimer();\n        },\n    };\n};\n//# sourceMappingURL=watchRTCPeerMediaPackets.js.map","import { __rest } from \"tslib\";\nimport { getLogger, sagaEffects, VertoResult, VertoPong, isWebrtcEventType, sagaHelpers, componentActions, } from '@signalwire/core';\nconst isWebrtcAction = (action) => {\n    return isWebrtcEventType(action.type);\n};\nexport const vertoEventWorker = function* (options) {\n    getLogger().debug('vertoEventWorker started');\n    const { channels, instance, initialState } = options;\n    const { swEventChannel } = channels;\n    const { rtcPeerId } = initialState;\n    if (!rtcPeerId) {\n        throw new Error('Missing rtcPeerId for roomSubscribedWorker');\n    }\n    const worker = function* (action) {\n        var _a, _b;\n        const { id: jsonrpcId, method, params = {} } = action.payload;\n        const { callID, nodeId } = params;\n        const peer = instance.getRTCPeerById(callID);\n        if (!peer) {\n            getLogger().warn(`RTCPeer '${callID}' not found for method: '${method}'`, params);\n            return;\n        }\n        const activeRTCPeer = instance.peer;\n        // getLogger().warn('vertoEventWorker', method, params)\n        switch (method) {\n            case 'verto.media':\n            case 'verto.answer': {\n                /**\n                 * verto.media and verto.answer share the same logic\n                 *\n                 * Always invoke peer.onRemoteSdp(params.sdp) on the proper RTCPeer\n                 * If the `params.callID` is the current ACTIVE peer, set the BaseConnection state to 'early' | 'active'\n                 * If the `params.callID` is NOT the current peer just setup the media (ie: promote/demote)\n                 */\n                if (peer.uuid === (activeRTCPeer === null || activeRTCPeer === void 0 ? void 0 : activeRTCPeer.uuid)) {\n                    const state = method === 'verto.media' ? 'early' : 'active';\n                    instance.setState(state);\n                }\n                if (params === null || params === void 0 ? void 0 : params.sdp) {\n                    peer.onRemoteSdp(params.sdp);\n                }\n                yield sagaEffects.put(componentActions.upsert({\n                    id: (_a = action.payload.params) === null || _a === void 0 ? void 0 : _a.callID,\n                    nodeId: (_b = action.payload.params) === null || _b === void 0 ? void 0 : _b.nodeId,\n                }));\n                yield sagaEffects.call([instance, instance.execute], {\n                    method: instance._getRPCMethod(),\n                    params: {\n                        message: VertoResult(jsonrpcId, method),\n                        node_id: nodeId,\n                    },\n                });\n                break;\n            }\n            case 'verto.bye': {\n                /**\n                 * If the `params.callID` is the current ACTIVE peer, stop everything and destroy the BaseConnection\n                 * If the `params.callID` is NOT the current peer, but is there from promote/demote process stop/destroy just the peer\n                 */\n                yield sagaEffects.call([instance, instance.onVertoBye], {\n                    rtcPeerId: callID,\n                    byeCause: params === null || params === void 0 ? void 0 : params.cause,\n                    byeCauseCode: params === null || params === void 0 ? void 0 : params.causeCode,\n                    redirectDestination: params === null || params === void 0 ? void 0 : params.redirectDestination,\n                });\n                yield sagaEffects.call([instance, instance.execute], {\n                    method: instance._getRPCMethod(),\n                    params: {\n                        message: VertoResult(jsonrpcId, method),\n                        node_id: nodeId,\n                    },\n                });\n                break;\n            }\n            case 'verto.ping': {\n                // Remove nodeId from params\n                const { nodeId } = params, pongParams = __rest(params, [\"nodeId\"]);\n                yield sagaEffects.call([instance, instance.execute], {\n                    method: instance._getRPCMethod(),\n                    params: {\n                        message: VertoPong(pongParams),\n                        node_id: nodeId,\n                    },\n                });\n                break;\n            }\n            case 'verto.mediaParams': {\n                if (!callID || !params.mediaParams) {\n                    getLogger().warn(`Invalid mediaParams event`, params);\n                    break;\n                }\n                const { audio, video } = params.mediaParams;\n                if (peer && video) {\n                    peer.applyMediaConstraints('video', video);\n                }\n                if (peer && audio) {\n                    peer.applyMediaConstraints('audio', audio);\n                }\n                break;\n            }\n            case 'verto.display': {\n                /** Call is active so set the RTCPeer */\n                instance.setActiveRTCPeer(rtcPeerId);\n                instance.emit('verto.display', action.payload.params);\n                break;\n            }\n            default:\n                return getLogger().warn(`Unknown Verto method: ${method}`, params);\n        }\n    };\n    const catchableWorker = sagaHelpers.createCatchableSaga(worker, (error) => {\n        getLogger().error('Verto Error', error);\n    });\n    while (true) {\n        const action = yield sagaEffects.take(swEventChannel, (action) => {\n            var _a;\n            if (isWebrtcAction(action)) {\n                return ((_a = action.payload.params) === null || _a === void 0 ? void 0 : _a.callID) === rtcPeerId;\n            }\n            return false;\n        });\n        yield sagaEffects.fork(catchableWorker, action);\n    }\n    getLogger().trace('vertoEventWorker ended');\n};\n//# sourceMappingURL=vertoEventWorker.js.map","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import { getLogger, sagaEffects, componentActions, Rooms, } from '@signalwire/core';\nexport const roomSubscribedWorker = function* (options) {\n    getLogger().debug('roomSubscribedWorker started');\n    const { channels, instance, initialState } = options;\n    const { swEventChannel } = channels;\n    const { rtcPeerId } = initialState;\n    if (!rtcPeerId) {\n        throw new Error('Missing rtcPeerId for roomSubscribedWorker');\n    }\n    const action = yield sagaEffects.take(swEventChannel, (action) => {\n        if (action.type === 'video.room.subscribed' ||\n            action.type === 'call.joined') {\n            return action.payload.call_id === rtcPeerId;\n        }\n        return false;\n    });\n    // New emitter should not change the payload by reference\n    const clonedPayload = JSON.parse(JSON.stringify(action.payload));\n    /**\n     * In here we joined a room_session so we can swap between RTCPeers\n     */\n    instance.setActiveRTCPeer(rtcPeerId);\n    const roomSessionId = action.payload.room_session.id ||\n        action.payload.room_session.room_session_id;\n    /**\n     * TODO: Replace the redux action/component with properties on RTCPeer instance?\n     */\n    yield sagaEffects.put(componentActions.upsert({\n        id: action.payload.call_id,\n        roomId: action.payload.room_session.room_id,\n        roomSessionId: roomSessionId,\n        memberId: action.payload.member_id,\n        previewUrl: action.payload.room_session.preview_url,\n    }));\n    instance.emit('room.subscribed', action.payload);\n    instance.emit('room.joined', transformPayload.call(instance, clonedPayload));\n    getLogger().debug('roomSubscribedWorker ended', rtcPeerId);\n};\nfunction transformPayload(payload) {\n    const keys = ['room_session', 'room'];\n    keys.forEach((key) => {\n        if (payload[key] && payload[key].recordings) {\n            payload[key].recordings = (payload[key].recordings || []).map((recording) => {\n                let recordingInstance = this.instanceMap.get(recording.id);\n                if (!recordingInstance) {\n                    recordingInstance = Rooms.createRoomSessionRecordingObject({\n                        store: this.store,\n                        payload: {\n                            room_id: payload.room.room_id,\n                            room_session_id: payload.room_session.id,\n                            recording,\n                        },\n                    });\n                }\n                else {\n                    recordingInstance.setPayload({\n                        room_id: payload.room.room_id,\n                        room_session_id: payload.room_session.id,\n                        recording,\n                    });\n                }\n                this.instanceMap.set(recording.id, recordingInstance);\n                return recordingInstance;\n            });\n        }\n        if (payload[key] && payload[key].playbacks) {\n            payload[key].playbacks = (payload[key].playbacks || []).map((playback) => {\n                let playbackInstance = this.instanceMap.get(playback.id);\n                if (!playbackInstance) {\n                    playbackInstance = Rooms.createRoomSessionPlaybackObject({\n                        store: this.store,\n                        payload: {\n                            room_id: payload.room.room_id,\n                            room_session_id: payload.room_session.id,\n                            playback,\n                        },\n                    });\n                }\n                else {\n                    playbackInstance.setPayload({\n                        room_id: payload.room.room_id,\n                        room_session_id: payload.room_session.id,\n                        playback,\n                    });\n                }\n                this.instanceMap.set(playback.id, playbackInstance);\n                return playbackInstance;\n            });\n        }\n        if (payload[key] && payload[key].streams) {\n            payload[key].streams = (payload[key].streams || []).map((stream) => {\n                let streamInstance = this.instanceMap.get(stream.id);\n                if (!streamInstance) {\n                    streamInstance = Rooms.createRoomSessionStreamObject({\n                        store: this.store,\n                        payload: {\n                            room_id: payload.room.room_id,\n                            room_session_id: payload.room_session.id,\n                            stream,\n                        },\n                    });\n                }\n                else {\n                    streamInstance.setPayload({\n                        room_id: payload.room.room_id,\n                        room_session_id: payload.room_session.id,\n                        stream,\n                    });\n                }\n                this.instanceMap.set(stream.id, streamInstance);\n                return streamInstance;\n            });\n        }\n    });\n    return payload;\n}\n//# sourceMappingURL=roomSubscribedWorker.js.map","import { getLogger, sagaEffects, sessionActions, selectors, } from '@signalwire/core';\nexport const promoteDemoteWorker = function* (options) {\n    getLogger().debug('promoteDemoteWorker started');\n    const { channels, instance, initialState } = options;\n    const { swEventChannel } = channels;\n    const { rtcPeerId } = initialState;\n    if (!rtcPeerId) {\n        throw new Error('Missing rtcPeerId for promoteDemoteWorker');\n    }\n    const action = yield sagaEffects.take(swEventChannel, (action) => {\n        if (action.type === 'video.member.promoted' ||\n            action.type === 'video.member.demoted') {\n            return action.payload.member_id === instance.memberId;\n        }\n        return false;\n    });\n    getLogger().debug('promoteDemoteWorker:', action.type, action.payload);\n    yield sagaEffects.put(sessionActions.updateAuthState(action.payload.authorization));\n    const authState = yield sagaEffects.select(selectors.getAuthState);\n    if (!authState) {\n        throw new Error(`Invalid authState for '${action.type}'`);\n    }\n    // TODO: use the new getJoinMediaParams in here\n    const { audio_allowed, video_allowed } = authState;\n    switch (action.type) {\n        case 'video.member.promoted':\n            /**\n             * Promote means enable the media allowed and keep the\n             * same recv settings. (do not force recv media)\n             */\n            instance.updateMediaOptions({\n                audio: audio_allowed === 'both',\n                video: video_allowed === 'both',\n                negotiateAudio: audio_allowed !== 'none',\n                negotiateVideo: video_allowed !== 'none',\n            });\n            break;\n        case 'video.member.demoted':\n            /**\n             * Demote means force recvonly and receive only the media allowed.\n             */\n            instance.updateMediaOptions({\n                audio: false,\n                video: false,\n                negotiateAudio: audio_allowed !== 'none',\n                negotiateVideo: video_allowed !== 'none',\n            });\n            break;\n    }\n    instance._triggerNewRTCPeer();\n    getLogger().debug('promoteDemoteWorker ended', rtcPeerId);\n};\n//# sourceMappingURL=promoteDemoteWorker.js.map","import { getLogger, sagaEffects, actions, } from '@signalwire/core';\nexport const sessionAuthWorker = function* (options) {\n    getLogger().debug('sessionAuthWorker started');\n    const { instance } = options;\n    const action = yield sagaEffects.take([\n        actions.authSuccessAction.type,\n        actions.authErrorAction.type,\n    ]);\n    switch (action.type) {\n        case actions.authSuccessAction.type:\n            yield sagaEffects.call([instance, instance.resume]);\n            break;\n        case actions.authErrorAction.type:\n            yield sagaEffects.call([instance, instance.setState], 'hangup');\n            break;\n    }\n    getLogger().debug('sessionAuthWorker ended');\n};\n//# sourceMappingURL=sessionAuthWorker.js.map","import { VertoBye, VertoInfo, VertoInvite, BaseComponent, selectors, VertoModify, componentSelectors, actions, isSATAuth, \n// VertoAttach,\nVertoAnswer, } from '@signalwire/core';\nimport RTCPeer from './RTCPeer';\nimport { stopTrack, getUserMedia, streamIsValid } from './utils';\nimport { sdpRemoveLocalCandidates } from './utils/sdpHelpers';\nimport * as workers from './workers';\nconst INVITE_VERSION = 1000;\nconst AUDIO_CONSTRAINTS = {\n    echoCancellation: true,\n    noiseSuppression: true,\n    autoGainControl: true,\n};\nconst AUDIO_CONSTRAINTS_SCREENSHARE = Object.assign(Object.assign({}, AUDIO_CONSTRAINTS), { noiseSuppression: false, autoGainControl: false, \n    // @ts-expect-error\n    googAutoGainControl: false });\nconst VIDEO_CONSTRAINTS = {\n    width: { ideal: 1280, min: 320 },\n    height: { ideal: 720, min: 180 },\n    aspectRatio: { ideal: 16 / 9 },\n};\nconst DEFAULT_CALL_OPTIONS = {\n    destinationNumber: 'room',\n    remoteCallerName: 'Outbound Call',\n    remoteCallerNumber: '',\n    callerName: '',\n    callerNumber: '',\n    audio: AUDIO_CONSTRAINTS,\n    video: VIDEO_CONSTRAINTS,\n    useStereo: false,\n    attach: false,\n    screenShare: false,\n    additionalDevice: false,\n    userVariables: {},\n    requestTimeout: 10 * 1000,\n    autoApplyMediaParams: true,\n    iceGatheringTimeout: 2 * 1000,\n    maxIceGatheringTimeout: 5 * 1000,\n    maxConnectionStateTimeout: 3 * 1000,\n    watchMediaPackets: true,\n    watchMediaPacketsTimeout: 2 * 1000,\n};\nexport class BaseConnection extends BaseComponent {\n    constructor(options) {\n        super(options);\n        /** @internal */\n        this.leaveReason = undefined;\n        /** @internal */\n        this.gotEarly = false;\n        /** @internal */\n        this.doReinvite = false;\n        this.state = 'new';\n        this.prevState = 'new';\n        this.rtcPeerMap = new Map();\n        this.resuming = false;\n        /** @internal */\n        this.onVertoBye = (params) => {\n            this.logger.debug('onVertoBye', params);\n            const { rtcPeerId, byeCause = 'NORMAL_CLEARING', byeCauseCode = '16', redirectDestination, } = params;\n            this.cause = String(byeCause);\n            this.causeCode = String(byeCauseCode);\n            const rtcPeer = this.getRTCPeerById(rtcPeerId);\n            if (!rtcPeer) {\n                return this.logger.warn('Invalid RTCPeer to hangup', params);\n            }\n            if (redirectDestination && rtcPeer.localSdp) {\n                this.logger.debug('Redirect Destination to:', redirectDestination, 'for RTCPeer:', rtcPeer.uuid);\n                // Force nodeId to redirectDestination\n                this.executeInvite(rtcPeer.localSdp, rtcPeer.uuid, redirectDestination);\n                return;\n            }\n            // Notify RTCPeer for the bad signaling error\n            rtcPeer.onRemoteBye({ code: this.causeCode, message: this.cause });\n            // Set state to hangup only if the rtcPeer is the current one\n            if (this.activeRTCPeerId === (rtcPeer === null || rtcPeer === void 0 ? void 0 : rtcPeer.uuid)) {\n                this.logger.debug('onVertoBye go hangup');\n                this.setState('hangup');\n            }\n        };\n        this.options = Object.assign(Object.assign({}, DEFAULT_CALL_OPTIONS), options);\n        this._checkDefaultMediaConstraints();\n        this.setState('new');\n        this.logger.trace('New Call with Options:', this.options);\n        this._initPeer();\n    }\n    get id() {\n        return this.__uuid;\n    }\n    get active() {\n        return this.state === 'active';\n    }\n    get trying() {\n        return this.state === 'trying';\n    }\n    get memberId() {\n        // @ts-expect-error\n        return this.component.memberId;\n    }\n    get previewUrl() {\n        // @ts-expect-error\n        return this.component.previewUrl;\n    }\n    get roomId() {\n        // @ts-expect-error\n        return this.component.roomId;\n    }\n    get roomSessionId() {\n        // @ts-expect-error\n        return this.component.roomSessionId;\n    }\n    get nodeId() {\n        // @ts-expect-error\n        return this.component.nodeId || this.options.nodeId;\n    }\n    get callId() {\n        var _a;\n        return ((_a = this.peer) === null || _a === void 0 ? void 0 : _a.uuid) || '';\n    }\n    get localStream() {\n        var _a;\n        return (_a = this.peer) === null || _a === void 0 ? void 0 : _a.localStream;\n    }\n    set localStream(stream) {\n        if (this.peer) {\n            this.peer.localStream = stream;\n        }\n    }\n    get remoteStream() {\n        var _a;\n        return (_a = this.peer) === null || _a === void 0 ? void 0 : _a.remoteStream;\n    }\n    get iceServers() {\n        var _a, _b;\n        return (_b = (_a = this.options) === null || _a === void 0 ? void 0 : _a.iceServers) !== null && _b !== void 0 ? _b : this.select(selectors.getIceServers);\n    }\n    get component() {\n        return (this.select((state) => componentSelectors.getComponent(state, this.callId)) || {});\n    }\n    /** @internal */\n    dialogParams(rtcPeerId) {\n        const { destinationNumber, attach, callerName, callerNumber, remoteCallerName, remoteCallerNumber, userVariables, screenShare, additionalDevice, pingSupported = true, } = this.options;\n        return {\n            dialogParams: {\n                id: rtcPeerId,\n                destinationNumber,\n                attach,\n                reattaching: attach,\n                callerName,\n                callerNumber,\n                remoteCallerName,\n                remoteCallerNumber,\n                userVariables,\n                screenShare,\n                additionalDevice,\n                pingSupported,\n                version: INVITE_VERSION,\n            },\n        };\n    }\n    get cameraId() {\n        return this.peer ? this.peer.getDeviceId('video') : null;\n    }\n    get cameraLabel() {\n        return this.peer ? this.peer.getDeviceLabel('video') : null;\n    }\n    get microphoneId() {\n        return this.peer ? this.peer.getDeviceId('audio') : null;\n    }\n    get microphoneLabel() {\n        return this.peer ? this.peer.getDeviceLabel('audio') : null;\n    }\n    /** @internal */\n    get withAudio() {\n        var _a;\n        return Boolean((_a = this.peer) === null || _a === void 0 ? void 0 : _a.hasAudioReceiver);\n    }\n    /** @internal */\n    get withVideo() {\n        var _a;\n        return Boolean((_a = this.peer) === null || _a === void 0 ? void 0 : _a.hasVideoReceiver);\n    }\n    get localVideoTrack() {\n        return this.peer ? this.peer.localVideoTrack : null;\n    }\n    get localAudioTrack() {\n        return this.peer ? this.peer.localAudioTrack : null;\n    }\n    get peer() {\n        return this.getRTCPeerById(this.activeRTCPeerId);\n    }\n    set peer(rtcPeer) {\n        if (!rtcPeer) {\n            this.logger.warn('Invalid RTCPeer', rtcPeer);\n            return;\n        }\n        this.logger.debug('Set RTCPeer', rtcPeer.uuid, rtcPeer);\n        this.rtcPeerMap.set(rtcPeer.uuid, rtcPeer);\n        if (this.peer && this.peer.instance && this.callId !== rtcPeer.uuid) {\n            const oldPeerId = this.peer.uuid;\n            this.logger.debug('>>> Stop old RTCPeer', oldPeerId);\n            // Hangup the previous RTCPeer\n            this.hangup(oldPeerId).catch(console.error);\n            this.peer.detachAndStop();\n            // Remove RTCPeer from local cache to stop answering to ping/pong\n            // this.rtcPeerMap.delete(oldPeerId)\n        }\n        this.logger.debug('>>> Replace RTCPeer with', rtcPeer.uuid);\n        this.activeRTCPeerId = rtcPeer.uuid;\n    }\n    getRTCPeerById(rtcPeerId) {\n        return this.rtcPeerMap.get(rtcPeerId);\n    }\n    appendRTCPeer(rtcPeer) {\n        return this.rtcPeerMap.set(rtcPeer.uuid, rtcPeer);\n    }\n    setActiveRTCPeer(rtcPeerId) {\n        this.peer = this.getRTCPeerById(rtcPeerId);\n    }\n    setLocalStream(stream) {\n        return new Promise(async (resolve, reject) => {\n            try {\n                if (!this.peer || !this.localStream) {\n                    return reject(new Error('Invalid RTCPeerConnection.'));\n                }\n                if (!streamIsValid(stream)) {\n                    return reject(new Error('Invalid stream provided.'));\n                }\n                const prevAudioTracks = this.localStream.getAudioTracks();\n                const newAudioTracks = stream.getAudioTracks();\n                if (newAudioTracks.length <= 0) {\n                    this.logger.info('No audio track found in the stream provided. Audio will be unaffected.');\n                }\n                else {\n                    prevAudioTracks.forEach((track) => {\n                        var _a;\n                        stopTrack(track);\n                        (_a = this.localStream) === null || _a === void 0 ? void 0 : _a.removeTrack(track);\n                    });\n                    newAudioTracks.forEach((track) => {\n                        var _a;\n                        (_a = this.localStream) === null || _a === void 0 ? void 0 : _a.addTrack(track);\n                    });\n                }\n                const prevVideoTracks = this.localStream.getVideoTracks();\n                const newVideoTracks = stream.getVideoTracks();\n                if (newVideoTracks.length <= 0) {\n                    this.logger.info('No video track found in the stream provided. Video will be unaffected.');\n                }\n                else {\n                    prevVideoTracks.forEach((track) => {\n                        var _a;\n                        stopTrack(track);\n                        (_a = this.localStream) === null || _a === void 0 ? void 0 : _a.removeTrack(track);\n                    });\n                    newVideoTracks.forEach((track) => {\n                        var _a;\n                        (_a = this.localStream) === null || _a === void 0 ? void 0 : _a.addTrack(track);\n                    });\n                }\n                await this.updateStream(this.localStream);\n                this.logger.debug('setLocalStream done');\n                resolve(this.localStream);\n            }\n            catch (error) {\n                this.logger.error('setLocalStream', error);\n                reject(error);\n            }\n        });\n    }\n    /**\n     * @internal\n     * Verto messages have to be wrapped into an execute\n     * request and sent using the proper RPC WebRTCMethod.\n     */\n    vertoExecute(params) {\n        return this.execute({\n            method: this._getRPCMethod(),\n            params,\n        });\n    }\n    /** @internal */\n    _getRPCMethod() {\n        const authState = this.select(selectors.getAuthState);\n        if (authState && isSATAuth(authState)) {\n            return 'webrtc.verto';\n        }\n        return 'video.message';\n    }\n    /** @internal */\n    async _triggerNewRTCPeer() {\n        this.logger.debug('_triggerNewRTCPeer Start');\n        try {\n            this.logger.debug('Build a new RTCPeer');\n            const rtcPeer = this._buildPeer('offer');\n            this.logger.debug('Trigger start for the new RTCPeer!');\n            await rtcPeer.start();\n        }\n        catch (error) {\n            this.logger.error('Error building new RTCPeer to promote/demote', error);\n        }\n    }\n    updateCamera(constraints) {\n        return this.updateConstraints({\n            video: Object.assign({ aspectRatio: 16 / 9 }, constraints),\n        });\n    }\n    updateMicrophone(constraints) {\n        return this.updateConstraints({\n            audio: constraints,\n        });\n    }\n    /** @internal */\n    manageSendersWithConstraints(constraints) {\n        if (constraints.audio === false) {\n            this.logger.info('Switching off the microphone');\n            this.stopOutboundAudio();\n        }\n        if (constraints.video === false) {\n            this.logger.info('Switching off the camera');\n            this.stopOutboundVideo();\n        }\n        return constraints.audio || constraints.video;\n    }\n    /**\n     * @internal\n     */\n    updateConstraints(constraints, { attempt = 0 } = {}) {\n        if (attempt > 1) {\n            return Promise.reject(new Error('Failed to update constraints'));\n        }\n        return new Promise(async (resolve, reject) => {\n            var _a, _b, _c;\n            try {\n                if (!this.peer) {\n                    return reject(new Error('Invalid RTCPeerConnection.'));\n                }\n                if (!Object.keys(constraints).length) {\n                    return reject(new Error('Invalid audio/video constraints.'));\n                }\n                this.logger.debug('updateConstraints trying constraints', this.__uuid, constraints);\n                const shouldContinueWithUpdate = this.manageSendersWithConstraints(constraints);\n                if (!shouldContinueWithUpdate) {\n                    this.logger.debug('Either `video` and `audio` (or both) constraints were set to `false` so their corresponding senders (if any) were stopped');\n                    return resolve();\n                }\n                /**\n                 * On some devices/browsers you cannot open more than one MediaStream at\n                 * a time, per process. When this happens we'll try to do the following:\n                 * 1. Stop the current media tracks\n                 * 2. Try to get new media tracks with the new constraints\n                 * 3. If we get an error: restore the media tracks using the previous\n                 *    constraints.\n                 * @see\n                 * https://bugzilla.mozilla.org/show_bug.cgi?id=1238038\n                 *\n                 * Instead of just replace the track, force-stop the current one to free\n                 * up the device\n                 */\n                let oldConstraints = {};\n                (_a = this.localStream) === null || _a === void 0 ? void 0 : _a.getTracks().forEach((track) => {\n                    var _a;\n                    /**\n                     * We'll keep a reference of the original constraints so if something\n                     * fails we should be able to restore them.\n                     */\n                    // @ts-expect-error\n                    oldConstraints[track.kind] = track.getConstraints();\n                    // @ts-expect-error\n                    if (constraints[track.kind] !== undefined) {\n                        this.logger.debug('updateConstraints stop old tracks first?');\n                        this.logger.debug('Track readyState:', track.kind, track.readyState);\n                        stopTrack(track);\n                        track.stop();\n                        (_a = this.localStream) === null || _a === void 0 ? void 0 : _a.removeTrack(track);\n                    }\n                });\n                let newStream;\n                try {\n                    this.logger.info('updateConstraints with', constraints);\n                    newStream = await getUserMedia(constraints);\n                }\n                catch (error) {\n                    this.logger.error('Error updating device constraints:', error.name, error.message, error);\n                    this.logger.info('Restoring previous constraints', oldConstraints);\n                    await this.updateConstraints(oldConstraints, {\n                        attempt: attempt + 1,\n                    });\n                    return reject(error);\n                }\n                await this.updateStream(newStream);\n                this.logger.debug('updateConstraints done');\n                resolve();\n            }\n            catch (error) {\n                this.logger.error('updateConstraints', error);\n                reject(error);\n            }\n            finally {\n                (_b = this.peer) === null || _b === void 0 ? void 0 : _b._attachAudioTrackListener();\n                (_c = this.peer) === null || _c === void 0 ? void 0 : _c._attachVideoTrackListener();\n            }\n        });\n    }\n    async updateStream(stream) {\n        if (!this.peer) {\n            throw new Error('Invalid RTCPeerConnection.');\n        }\n        // Store the previous tracks for device.updated event\n        const prevVideoTrack = this.localVideoTrack;\n        const prevAudioTrack = this.localAudioTrack;\n        // Detach listeners because updateStream will trigger the track ended event\n        this.peer._detachAudioTrackListener();\n        this.peer._detachVideoTrackListener();\n        this.logger.debug('updateStream got stream', stream);\n        if (!this.localStream) {\n            this.localStream = new MediaStream();\n        }\n        const { instance } = this.peer;\n        const tracks = stream.getTracks();\n        this.logger.debug(`updateStream got ${tracks.length} tracks`);\n        for (let i = 0; i < tracks.length; i++) {\n            const newTrack = tracks[i];\n            this.logger.debug('updateStream apply track: ', newTrack);\n            const transceiver = instance\n                .getTransceivers()\n                .find(({ mid, sender, receiver }) => {\n                if (sender.track && sender.track.kind === newTrack.kind) {\n                    this.logger.debug('Found transceiver by sender');\n                    return true;\n                }\n                if (receiver.track && receiver.track.kind === newTrack.kind) {\n                    this.logger.debug('Found transceiver by receiver');\n                    return true;\n                }\n                if (mid === null) {\n                    this.logger.debug('Found disassociated transceiver');\n                    return true;\n                }\n                return false;\n            });\n            if (transceiver && transceiver.sender) {\n                this.logger.debug('updateStream got transceiver', transceiver.currentDirection, transceiver.mid);\n                await transceiver.sender.replaceTrack(newTrack);\n                this.logger.debug('updateStream replaceTrack');\n                transceiver.direction = 'sendrecv';\n                this.logger.debug('updateStream set to sendrecv');\n                this.localStream.getTracks().forEach((track) => {\n                    var _a;\n                    if (track.kind === newTrack.kind && track.id !== newTrack.id) {\n                        this.logger.debug('updateStream stop old track and apply new one - ');\n                        stopTrack(track);\n                        (_a = this.localStream) === null || _a === void 0 ? void 0 : _a.removeTrack(track);\n                    }\n                });\n                this.localStream.addTrack(newTrack);\n            }\n            else {\n                this.logger.debug('updateStream no transceiver found. addTrack and start dancing!');\n                this.peer.type = 'offer';\n                this.doReinvite = true;\n                this.localStream.addTrack(newTrack);\n                instance.addTrack(newTrack, this.localStream);\n            }\n            this.logger.debug('updateStream simply update mic/cam');\n            if (newTrack.kind === 'audio') {\n                // @ts-expect-error\n                this.emit('microphone.updated', {\n                    previous: {\n                        deviceId: prevAudioTrack === null || prevAudioTrack === void 0 ? void 0 : prevAudioTrack.id,\n                        label: prevAudioTrack === null || prevAudioTrack === void 0 ? void 0 : prevAudioTrack.label,\n                    },\n                    current: {\n                        deviceId: newTrack === null || newTrack === void 0 ? void 0 : newTrack.id,\n                        label: newTrack === null || newTrack === void 0 ? void 0 : newTrack.label,\n                    },\n                });\n                this.options.micId = newTrack.getSettings().deviceId;\n            }\n            else if (newTrack.kind === 'video') {\n                // @ts-expect-error\n                this.emit('camera.updated', {\n                    previous: {\n                        deviceId: prevVideoTrack === null || prevVideoTrack === void 0 ? void 0 : prevVideoTrack.id,\n                        label: prevVideoTrack === null || prevVideoTrack === void 0 ? void 0 : prevVideoTrack.label,\n                    },\n                    current: {\n                        deviceId: newTrack === null || newTrack === void 0 ? void 0 : newTrack.id,\n                        label: newTrack === null || newTrack === void 0 ? void 0 : newTrack.label,\n                    },\n                });\n                this.options.camId = newTrack.getSettings().deviceId;\n            }\n        }\n        this.logger.debug('updateStream done');\n    }\n    runRTCPeerWorkers(rtcPeerId) {\n        this.runWorker('vertoEventWorker', {\n            worker: workers.vertoEventWorker,\n            initialState: { rtcPeerId },\n        });\n        const main = !(this.options.additionalDevice || this.options.screenShare);\n        if (main) {\n            this.runWorker('roomSubscribedWorker', {\n                worker: workers.roomSubscribedWorker,\n                initialState: { rtcPeerId },\n            });\n            this.runWorker('promoteDemoteWorker', {\n                worker: workers.promoteDemoteWorker,\n                initialState: { rtcPeerId },\n            });\n        }\n    }\n    /** @internal */\n    invite() {\n        return new Promise(async (resolve, reject) => {\n            this.direction = 'outbound';\n            this.peer = this._buildPeer('offer');\n            try {\n                await this.peer.start();\n                resolve(this);\n            }\n            catch (error) {\n                this.logger.error('Invite error', error);\n                reject(error);\n            }\n        });\n    }\n    /** @internal */\n    answer() {\n        return new Promise(async (resolve, reject) => {\n            this.direction = 'inbound';\n            if (!this.peer) {\n                this.peer = this._buildPeer('answer');\n            }\n            try {\n                await this.peer.start();\n                resolve(this);\n            }\n            catch (error) {\n                this.logger.error('Answer error', error);\n                reject(error);\n            }\n        });\n    }\n    /** @internal */\n    onLocalSDPReady(rtcPeer) {\n        if (!rtcPeer.instance.localDescription) {\n            this.logger.error('Missing localDescription', rtcPeer);\n            throw new Error('Invalid RTCPeerConnection localDescription');\n        }\n        const { type, sdp } = rtcPeer.instance.localDescription;\n        const mungedSDP = this._mungeSDP(sdp);\n        this.logger.debug('LOCAL SDP \\n', `Type: ${type}`, '\\n\\n', mungedSDP);\n        switch (type) {\n            case 'offer':\n                this._watchSessionAuth();\n                // If we have a remoteDescription already, send reinvite\n                if (!this.resuming && rtcPeer.instance.remoteDescription) {\n                    return this.executeUpdateMedia(mungedSDP, rtcPeer.uuid);\n                }\n                else {\n                    return this.executeInvite(mungedSDP, rtcPeer.uuid);\n                }\n            case 'answer':\n                return this.executeAnswer(mungedSDP, rtcPeer.uuid);\n            default:\n                return this.logger.error(`Unknown SDP type: '${type}' on call ${this.id}`);\n        }\n    }\n    /** @internal */\n    _closeWSConnection() {\n        this._watchSessionAuth();\n        this.store.dispatch(actions.sessionForceCloseAction());\n    }\n    _watchSessionAuth() {\n        if (this.sessionAuthTask) {\n            this.sessionAuthTask.cancel();\n        }\n        this.sessionAuthTask = this.runWorker('sessionAuthWorker', {\n            worker: workers.sessionAuthWorker,\n        });\n    }\n    /** @internal */\n    async resume() {\n        var _a;\n        this.logger.warn(`[resume] Call ${this.id}`);\n        if ((_a = this.peer) === null || _a === void 0 ? void 0 : _a.instance) {\n            const { connectionState } = this.peer.instance;\n            this.logger.debug(`[resume] connectionState for ${this.id} is '${connectionState}'`);\n            if (connectionState !== 'closed') {\n                this.resuming = true;\n                this.peer.restartIce();\n            }\n        }\n    }\n    /**\n     * Send the `verto.invite` only if the state is either `new` or `requesting`\n     *   - new: the first time we send out the offer.\n     *   - requesting: we received a redirectDestination so need to send it again\n     *     specifying nodeId.\n     *\n     * @internal\n     */\n    async executeInvite(sdp, rtcPeerId, nodeId) {\n        const rtcPeer = this.getRTCPeerById(rtcPeerId);\n        if (!rtcPeer || (rtcPeer.instance.remoteDescription && !this.resuming)) {\n            throw new Error(`RTCPeer '${rtcPeerId}' already has a remoteDescription. Invalid invite.`);\n        }\n        // Set state to `requesting` only when `new`, otherwise keep it as `requesting`.\n        if (this.state === 'new') {\n            this.setState('requesting');\n        }\n        try {\n            const ssOpts = this.options.screenShare\n                ? {\n                    layout: this.options.layout,\n                    positions: this.options.positions,\n                }\n                : {};\n            const message = VertoInvite(Object.assign(Object.assign(Object.assign({}, this.dialogParams(rtcPeerId)), ssOpts), { sdp }));\n            let subscribe = [];\n            if (this.options.screenShare) {\n                /** @ts-expect-error - Only being used for debugging purposes */\n                subscribe = ['video.room.screenshare'];\n            }\n            else if (this.options.additionalDevice) {\n                /** @ts-expect-error - Only being used for debugging purposes */\n                subscribe = ['video.room.additionaldevice'];\n            }\n            else {\n                subscribe = this.getSubscriptions();\n            }\n            this.logger.debug('Subscribing to', subscribe);\n            const response = await this.vertoExecute({\n                message,\n                callID: rtcPeerId,\n                node_id: nodeId !== null && nodeId !== void 0 ? nodeId : this.options.nodeId,\n                subscribe,\n            });\n            this.logger.debug('Invite response', response);\n            this.resuming = false;\n        }\n        catch (error) {\n            this.setState('hangup');\n            throw error;\n        }\n    }\n    /**\n     * Send the `verto.answer` only if the state is `new`\n     *   - new: the first time we send out the answer.\n     * @internal\n     */\n    async executeAnswer(sdp, rtcPeerId, nodeId) {\n        // Set state to `answering` only when `new`, otherwise keep it as `answering`.\n        if (this.state === 'new') {\n            this.setState('answering');\n        }\n        try {\n            const message = VertoAnswer(Object.assign(Object.assign({}, this.dialogParams(rtcPeerId)), { sdp }));\n            const response = await this.vertoExecute({\n                message,\n                callID: rtcPeerId,\n                node_id: nodeId !== null && nodeId !== void 0 ? nodeId : this.options.nodeId,\n                subscribe: this.getSubscriptions(),\n            });\n            this.logger.debug('Answer response', response);\n            this.resuming = false;\n            /** Call is active so set the RTCPeer */\n            this.setActiveRTCPeer(rtcPeerId);\n        }\n        catch (error) {\n            this.setState('hangup');\n            throw error;\n        }\n    }\n    /** @internal */\n    async executeUpdateMedia(sdp, rtcPeerId) {\n        try {\n            const message = VertoModify(Object.assign(Object.assign({}, this.dialogParams(rtcPeerId)), { sdp, action: 'updateMedia' }));\n            const response = await this.vertoExecute({\n                message,\n                callID: rtcPeerId,\n                node_id: this.nodeId,\n            });\n            if (!response.sdp) {\n                this.logger.error('UpdateMedia invalid SDP answer', response);\n            }\n            this.logger.debug('UpdateMedia response', response);\n            if (!this.peer) {\n                return this.logger.error('Invalid RTCPeer to updateMedia');\n            }\n            await this.peer.onRemoteSdp(response.sdp);\n        }\n        catch (error) {\n            this.logger.error('UpdateMedia error', error);\n            // this.setState('hangup')\n            throw error;\n        }\n    }\n    async hangup(id) {\n        const rtcPeerId = id !== null && id !== void 0 ? id : this.callId;\n        if (!rtcPeerId) {\n            throw new Error('Invalid RTCPeer ID to hangup');\n        }\n        try {\n            const message = VertoBye(this.dialogParams(rtcPeerId));\n            await this.vertoExecute({\n                message,\n                callID: rtcPeerId,\n                node_id: this.nodeId,\n            });\n        }\n        catch (error) {\n            this.logger.error('Hangup error:', error);\n        }\n        finally {\n            if (rtcPeerId !== this.callId) {\n                return this.logger.warn('Prevent setState hangup', rtcPeerId, this.callId);\n            }\n            this.setState('hangup');\n        }\n    }\n    async hangupAll() {\n        const rtcPeerId = this.callId;\n        if (!rtcPeerId) {\n            throw new Error('Invalid RTCPeer ID to hangup');\n        }\n        try {\n            const message = VertoBye(Object.assign({ cause: 'REJECT_ALL', causeCode: '825' }, this.dialogParams(rtcPeerId)));\n            await this.vertoExecute({\n                message,\n                callID: rtcPeerId,\n                node_id: this.nodeId,\n            });\n        }\n        catch (error) {\n            this.logger.error('HangupAll error:', error);\n        }\n        finally {\n            this.setState('hangup');\n        }\n    }\n    async sendDigits(dtmf) {\n        const rtcPeerId = this.callId;\n        if (!rtcPeerId) {\n            throw new Error('Invalid RTCPeer ID to send DTMF');\n        }\n        const message = VertoInfo(Object.assign(Object.assign({}, this.dialogParams(rtcPeerId)), { dtmf }));\n        await this.vertoExecute({\n            message,\n            callID: rtcPeerId,\n            node_id: this.nodeId,\n        });\n    }\n    /** @internal */\n    doReinviteWithRelayOnly() {\n        if (this.peer && this.active) {\n            this.peer.restartIceWithRelayOnly();\n        }\n    }\n    /** @internal */\n    stopOutboundAudio() {\n        if (this.peer && this.active) {\n            this.peer.stopTrackSender('audio');\n        }\n    }\n    /** @internal */\n    restoreOutboundAudio() {\n        if (this.peer && this.active) {\n            this.peer.restoreTrackSender('audio');\n        }\n    }\n    /** @internal */\n    stopOutboundVideo() {\n        if (this.peer && this.active) {\n            this.peer.stopTrackSender('video');\n        }\n    }\n    /** @internal */\n    restoreOutboundVideo() {\n        if (this.peer && this.active) {\n            this.peer.restoreTrackSender('video');\n        }\n    }\n    /** @internal */\n    setState(state) {\n        this.prevState = this.state;\n        this.state = state;\n        this.logger.trace(`Call ${this.id} state change from ${this.prevState} to ${this.state}`);\n        // @ts-expect-error\n        this.emitter.emit(this.state, this);\n        switch (state) {\n            case 'purge': {\n                this._finalize();\n                break;\n            }\n            case 'hangup': {\n                this.setState('destroy');\n                break;\n            }\n            case 'destroy':\n                this._finalize();\n                break;\n        }\n    }\n    /** @internal */\n    updateMediaOptions(options) {\n        this.logger.debug('updateMediaOptions', Object.assign({}, options));\n        this.options = Object.assign(Object.assign({}, this.options), options);\n        this._checkDefaultMediaConstraints();\n    }\n    /**\n     * Allow to define logic to munge the SDP\n     *\n     * @internal\n     * */\n    _mungeSDP(sdp) {\n        return sdpRemoveLocalCandidates(sdp);\n    }\n    /**\n     * Always use VIDEO_CONSTRAINTS if video: true\n     * Always use AUDIO_CONSTRAINTS (or the SS one) if audio: true\n     *\n     * @internal\n     */\n    _checkDefaultMediaConstraints() {\n        if (this.options.video === true) {\n            this.options.video = VIDEO_CONSTRAINTS;\n        }\n        if (this.options.audio === true) {\n            this.options.audio = this.options.screenShare\n                ? AUDIO_CONSTRAINTS_SCREENSHARE\n                : AUDIO_CONSTRAINTS;\n        }\n    }\n    _initPeer() {\n        // Build only for answer to be able to reject\n        if (this.options.remoteSdp) {\n            this.peer = this._buildPeer('answer');\n        }\n    }\n    _buildPeer(type) {\n        const rtcPeer = new RTCPeer(this, type);\n        this.appendRTCPeer(rtcPeer);\n        this.runRTCPeerWorkers(rtcPeer.uuid);\n        return rtcPeer;\n    }\n    /** @internal */\n    _finalize() {\n        this.rtcPeerMap.forEach((rtcPeer) => {\n            rtcPeer.stop();\n        });\n        this.rtcPeerMap.clear();\n    }\n    async renegotiateMedia(renegotiateMediaParams) {\n        var _a;\n        this.updateMediaOptions(renegotiateMediaParams);\n        await ((_a = this.peer) === null || _a === void 0 ? void 0 : _a.start());\n    }\n    async enableVideo(enableVideoParam) {\n        var _a;\n        await this.renegotiateMedia({ video: (_a = enableVideoParam === null || enableVideoParam === void 0 ? void 0 : enableVideoParam.video) !== null && _a !== void 0 ? _a : true, negotiateVideo: !(enableVideoParam === null || enableVideoParam === void 0 ? void 0 : enableVideoParam.sendOnly) });\n    }\n    async disableVideo(disableVideoParam) {\n        await this.renegotiateMedia({ video: false, negotiateVideo: disableVideoParam === null || disableVideoParam === void 0 ? void 0 : disableVideoParam.recvOnly });\n    }\n}\n//# sourceMappingURL=BaseConnection.js.map","import {\n  getLogger,\n  InternalVideoLayoutLayer,\n  InternalVideoLayout,\n  debounce,\n} from '@signalwire/core'\n\nconst addSDKPrefix = (input: string) => {\n  return `sw-sdk-${input}`\n}\n\nconst buildVideo = () => {\n  const video = document.createElement('video')\n  video.muted = true\n  video.autoplay = true\n  video.playsInline = true\n\n  /**\n   * Local and Remov video elements should never be paused\n   * and Safari/Firefox pause the video (ie: enabling PiP, switch cameras etc)\n   * We try to force it to keep playing.\n   */\n  video.addEventListener('pause', () => {\n    video.play().catch((error) => {\n      getLogger().error('Video Element Paused', video, error)\n    })\n  })\n\n  return video\n}\n\nconst waitForVideoReady = ({ element }: { element: HTMLVideoElement }) => {\n  return new Promise<void>((resolve) => {\n    element.addEventListener('canplay', function listener() {\n      element.removeEventListener('canplay', listener)\n      resolve()\n    })\n    element.addEventListener('resize', function listener() {\n      element.removeEventListener('resize', listener)\n      resolve()\n    })\n  })\n}\n\nconst _getLocationStyles = ({\n  x,\n  y,\n  width,\n  height,\n}: InternalVideoLayoutLayer) => {\n  return {\n    top: `${y}%`,\n    left: `${x}%`,\n    width: `${width}%`,\n    height: `${height}%`,\n  }\n}\n\nconst _buildLayer = ({ location }: { location: InternalVideoLayoutLayer }) => {\n  const { top, left, width, height } = _getLocationStyles(location)\n  const layer = document.createElement('div')\n  layer.style.position = 'absolute'\n  layer.style.overflow = 'hidden'\n  layer.style.top = top\n  layer.style.left = left\n  layer.style.width = width\n  layer.style.height = height\n\n  return layer\n}\n\nexport interface LocalOverlay {\n  readonly id: string\n  status: 'hidden' | 'visible'\n  domElement: HTMLDivElement | undefined\n  hide(): void\n  show(): void\n  setLocalOverlayMediaStream(stream: MediaStream): void\n  setLocalOverlayMirror(mirror?: boolean): void\n}\n\ninterface MakeLayoutChangedHandlerParams {\n  localOverlay: LocalOverlay\n  rootElement: HTMLElement\n}\n\ninterface LayoutChangedHandlerParams {\n  layout: InternalVideoLayout\n  myMemberId: string\n  localStream: MediaStream\n}\n\nconst makeLayoutChangedHandler =\n  ({ localOverlay, rootElement }: MakeLayoutChangedHandlerParams) =>\n  async ({ layout, myMemberId, localStream }: LayoutChangedHandlerParams) => {\n    getLogger().debug('Process layout.changed')\n    try {\n      const { layers = [] } = layout\n      const location = layers.find(({ member_id }) => member_id === myMemberId)\n\n      let myLayer = localOverlay.domElement\n      // Update localOverlay.status if a location has been found\n      localOverlay.status = location ? 'visible' : 'hidden'\n      if (!location) {\n        getLogger().debug('Location not found')\n        if (myLayer) {\n          getLogger().debug('Current layer not visible')\n          localOverlay.hide()\n        }\n\n        return\n      }\n\n      if (!myLayer) {\n        getLogger().debug('Build myLayer')\n        myLayer = _buildLayer({ location })\n        myLayer.id = localOverlay.id\n\n        const localVideo = buildVideo()\n        localVideo.srcObject = localStream\n        localVideo.disablePictureInPicture = true\n        localVideo.style.width = '100%'\n        localVideo.style.height = '100%'\n        localVideo.style.pointerEvents = 'none'\n        localVideo.style.objectFit = 'cover'\n\n        myLayer.appendChild(localVideo)\n\n        const mcuLayers = rootElement.querySelector('.mcuLayers')\n        if (mcuLayers) {\n          mcuLayers.innerHTML = ''\n          getLogger().debug('Build myLayer append it')\n          mcuLayers.appendChild(myLayer)\n          localOverlay.domElement = myLayer\n          localOverlay.setLocalOverlayMirror()\n          return\n        }\n\n        getLogger().debug('Build myLayer >> wait next')\n        return\n      }\n\n      const { top, left, width, height } = _getLocationStyles(location)\n      getLogger().debug('Update myLayer:', top, left, width, height)\n      /**\n       * Show myLayer only if the localStream has a valid video track\n       */\n      const hasVideo =\n        localStream\n          .getVideoTracks()\n          .filter((t) => t.enabled && t.readyState === 'live').length > 0\n      if (hasVideo) {\n        localOverlay.setLocalOverlayMediaStream(localStream)\n      }\n      myLayer.style.opacity = hasVideo ? '1' : '0'\n      myLayer.style.top = top\n      myLayer.style.left = left\n      myLayer.style.width = width\n      myLayer.style.height = height\n    } catch (error) {\n      getLogger().error('Layout Changed Error', error)\n    }\n  }\n\nconst cleanupElement = (rootElement: HTMLElement) => {\n  while (rootElement.firstChild) {\n    rootElement.removeChild(rootElement.firstChild)\n  }\n}\n\nconst setVideoMediaTrack = ({\n  track,\n  element,\n}: {\n  track: MediaStreamTrack\n  element: HTMLVideoElement\n}) => {\n  element.srcObject = new MediaStream([track])\n\n  track.addEventListener('ended', () => {\n    element.srcObject = null\n    element.remove()\n  })\n}\n\n/**\n * @deprecated\n * FIXME remove this in the future\n */\nconst createRootElementResizeObserver = ({\n  video,\n  rootElement,\n  paddingWrapper,\n}: {\n  video: HTMLVideoElement\n  rootElement: HTMLElement\n  paddingWrapper: HTMLDivElement\n}) => {\n  const computePaddingWrapperWidth = (width: number, height: number) => {\n    const nativeVideoRatio = video.videoWidth / video.videoHeight\n    const rootElementRatio = width / height\n    if (nativeVideoRatio > rootElementRatio) {\n      return '100%'\n    } else {\n      return `${height * nativeVideoRatio}px`\n    }\n  }\n\n  const maxPaddingBottom = (video.videoHeight / video.videoWidth) * 100\n  // debounce to avoid multiple calls\n  const update = debounce(\n    ({ width, height }: { width: number; height: number }) => {\n      if (paddingWrapper) {\n        const pb = (height / width) * 100\n        paddingWrapper.style.paddingBottom = `${\n          pb > maxPaddingBottom ? maxPaddingBottom : pb\n        }%`\n        paddingWrapper.style.width = computePaddingWrapperWidth(width, height)\n      }\n    },\n    100\n  )\n\n  const observer = new ResizeObserver((entries) => {\n    entries.forEach((entry) => {\n      if (entry.contentBoxSize) {\n        // Firefox implements `contentBoxSize` as a single content rect, rather than an array\n        const { inlineSize, blockSize } = Array.isArray(entry.contentBoxSize)\n          ? entry.contentBoxSize[0]\n          : entry.contentBoxSize\n        update({ width: inlineSize, height: blockSize })\n      } else if (entry.contentRect) {\n        update({\n          width: entry.contentRect.width,\n          height: entry.contentRect.height,\n        })\n      }\n    })\n  })\n\n  return {\n    start: () => observer.observe(rootElement),\n    stop: () => observer.disconnect(),\n  }\n}\n\nexport {\n  buildVideo,\n  cleanupElement,\n  makeLayoutChangedHandler,\n  setVideoMediaTrack,\n  waitForVideoReady,\n  addSDKPrefix,\n  createRootElementResizeObserver,\n}\n","const setAudioMediaTrack = ({\n  track,\n  element,\n}: {\n  track: MediaStreamTrack\n  element: HTMLAudioElement\n}) => {\n  element.autoplay = true\n  // @ts-ignore\n  element.playsinline = true\n  element.srcObject = new MediaStream([track])\n\n  track.addEventListener('ended', () => {\n    element.srcObject = null\n    element.remove()\n  })\n\n  return element\n}\n\nexport { setAudioMediaTrack }\n","import { actions } from '@signalwire/core'\n\nexport const audioSetSpeakerAction = actions.createAction<string>(\n  'swJs/audioSetSpeakerAction'\n)\n","const VIDEO_SIZING_EVENTS = ['loadedmetadata', 'resize']\n\nexport function aspectRatioListener({videoElement, paddingWrapper, fixInLandscapeOrientation = false, debugDivElementId = 'videoDimensionsDebug', samplingInterval = 0}: {videoElement: HTMLVideoElement, paddingWrapper: HTMLDivElement, fixInLandscapeOrientation: boolean, debugDivElementId?: string, samplingInterval?: number}) {\n    const buildHtmlContent = (event:string, width: number, height: number) => `Video dimensions on <strong>${event} event</strong>:</strong> ${width}x${height}px - fixInLandscapeOrientation: ${fixInLandscapeOrientation}`\n    const appendDebugInfo = (containerElement: HTMLElement, event:string) => {\n        const pEl = document.createElement('p')\n        pEl.innerHTML = buildHtmlContent(event, videoElement.videoWidth, videoElement.videoHeight);    \n        containerElement.appendChild(pEl);\n    }\n\n    let debugElement: HTMLElement|null;\n    try {\n        debugElement = document.getElementById(debugDivElementId);\n    } catch {}\n    \n    VIDEO_SIZING_EVENTS.forEach(event => videoElement.addEventListener(event, () => {\n            const paddingBottom = fixInLandscapeOrientation ? '56.25' : \n                (videoElement.videoHeight / videoElement.videoWidth) * 100\n            paddingWrapper.style.paddingBottom = `${paddingBottom}%`\n            if(debugElement) {\n                appendDebugInfo(debugElement, event)\n            }\n        }));\n\n        if(samplingInterval > 0) {\n            setInterval(() => {\n                const paddingBottom = (videoElement.videoHeight / videoElement.videoWidth) * 100\n                paddingWrapper.style.paddingBottom = `${paddingBottom}%`\n                if(debugElement) {\n                    let statsElement = debugElement.querySelector('.timer-values')\n                    if(!statsElement) {\n                        statsElement = document.createElement('div');\n                        statsElement.className = 'timer-values'\n                        debugElement.appendChild(statsElement);\n                    }\n                    appendDebugInfo(debugElement, 'timer')\n                }\n            });            \n        }   \n}","import {\n  getLogger,\n  CustomSagaParams,\n  actions,\n  sagaEffects,\n  LOCAL_EVENT_PREFIX,\n} from '@signalwire/core'\nimport type { SagaIterator, Task } from '@signalwire/core'\nimport { setMediaElementSinkId } from '@signalwire/webrtc'\nimport {\n  buildVideo,\n  cleanupElement,\n  makeLayoutChangedHandler,\n  setVideoMediaTrack,\n  waitForVideoReady,\n  LocalOverlay,\n  addSDKPrefix,\n} from '../../utils/videoElement'\nimport { setAudioMediaTrack } from '../../utils/audioElement'\nimport { audioSetSpeakerAction } from '../actions'\nimport type { RoomSessionConnection } from '../../BaseRoomSession'\nimport { aspectRatioListener } from '../../utils/aspectRatioListener'\n\nexport const makeVideoElementSaga = ({\n  rootElement,\n  applyLocalVideoOverlay,\n}: {\n  rootElement: HTMLElement\n  applyLocalVideoOverlay?: boolean\n}) => {\n  return function* videoElementSaga({\n    instance: room,\n    runSaga,\n  }: CustomSagaParams<RoomSessionConnection>): SagaIterator {\n    try {\n      const layerMap = new Map<string, HTMLDivElement>()\n      const videoEl = buildVideo()\n\n      /**\n       * We used this `LocalOverlay` interface to interact with the localVideo\n       * overlay DOM element in here and in the `layoutChangedHandler`.\n       * The idea is to avoid APIs like `document.getElementById` because it\n       * won't work if the SDK is used within a Shadow DOM tree.\n       * Instead of querying the `document`, let's use our `layerMap`.\n       */\n      const localOverlay: LocalOverlay = {\n        // Each `layout.changed` event will update `status`\n        status: 'hidden',\n        get id() {\n          // FIXME: Use `id` until the `memberId` is stable between promote/demote\n          return addSDKPrefix(room.id)\n        },\n        get domElement() {\n          return layerMap.get(this.id)\n        },\n        set domElement(element: HTMLDivElement | undefined) {\n          if (element) {\n            getLogger().debug('Set localOverlay', element)\n            layerMap.set(this.id, element)\n          } else {\n            getLogger().debug('Remove localOverlay')\n            layerMap.delete(this.id)\n          }\n        },\n        hide() {\n          if (!this.domElement) {\n            return getLogger().warn('Missing localOverlay to hide')\n          }\n          this.domElement.style.opacity = '0'\n        },\n        show() {\n          if (!this.domElement) {\n            return getLogger().warn('Missing localOverlay to show')\n          }\n          if (this.status === 'hidden') {\n            return getLogger().info('localOverlay not visible')\n          }\n          this.domElement.style.opacity = '1'\n        },\n        setLocalOverlayMediaStream(stream: MediaStream) {\n          if (!this.domElement) {\n            return getLogger().warn(\n              'Missing localOverlay to set the local overlay stream'\n            )\n          }\n          const localVideo = this.domElement.querySelector('video')\n          if (localVideo) {\n            localVideo.srcObject = stream\n          }\n        },\n        setLocalOverlayMirror(mirror: boolean) {\n          if (!this.domElement || !this.domElement.firstChild) {\n            return getLogger().warn('Missing localOverlay to set the mirror')\n          }\n          const videoEl = this.domElement.firstChild as HTMLVideoElement\n          if (mirror ?? room.localOverlay.mirrored) {\n            videoEl.style.transform = 'scale(-1, 1)'\n            videoEl.style.webkitTransform = 'scale(-1, 1)'\n          } else {\n            videoEl.style.transform = 'scale(1, 1)'\n            videoEl.style.webkitTransform = 'scale(1, 1)'\n          }\n        },\n      }\n\n      const layoutChangedHandler = makeLayoutChangedHandler({\n        rootElement,\n        localOverlay,\n      })\n\n      let hasVideoTrack = false\n      let lastLayoutChanged: any = null\n\n      const _processLayoutChanged = (params: any) => {\n        // FIXME: expose a method on BaseConnection\n        if (room.peer?.hasVideoSender && room.localStream) {\n          layoutChangedHandler({\n            layout: params.layout,\n            localStream: room.localStream,\n            myMemberId: room.memberId,\n          })\n        } else {\n          localOverlay.hide()\n        }\n      }\n\n      // @ts-expect-error\n      room.on(`${LOCAL_EVENT_PREFIX}.mirror.video`, (value: boolean) => {\n        localOverlay.setLocalOverlayMirror(value)\n      })\n\n      room.on('layout.changed', (params) => {\n        getLogger().debug('Received layout.changed - videoTrack', hasVideoTrack)\n        if (hasVideoTrack) {\n          _processLayoutChanged(params)\n          return\n        }\n\n        lastLayoutChanged = params\n      })\n\n      room.on('member.updated.video_muted', (params) => {\n        try {\n          const { member } = params\n          if (member.id === room.memberId && 'video_muted' in member) {\n            member.video_muted ? localOverlay.hide() : localOverlay.show()\n          }\n        } catch (error) {\n          getLogger().error('Error handling video_muted', error)\n        }\n      })\n\n      let videoTask: Task | undefined\n\n      const trackHandler = function (event: RTCTrackEvent) {\n        switch (event.track.kind) {\n          case 'video': {\n            videoTask = runSaga(videoElementSetupWorker, {\n              applyLocalVideoOverlay,\n              rootElement,\n              track: event.track,\n              element: videoEl,\n            })\n\n            hasVideoTrack = true\n            if (lastLayoutChanged) {\n              _processLayoutChanged(lastLayoutChanged)\n            }\n            break\n          }\n        }\n      }\n      /**\n       * Using `on` instead of `once` (or `off` within trackHandler) because\n       * there are cases (promote/demote) where we need to handle multiple `track`\n       * events and update the videoEl with the new track.\n       */\n      room.on('track', trackHandler)\n\n      room.once('destroy', () => {\n        cleanupElement(rootElement)\n        layerMap.clear()\n        videoTask?.cancel()\n      })\n    } catch (error) {\n      getLogger().error('videoElementSaga', error)\n    }\n  }\n}\n\nexport const makeAudioElementSaga = ({ speakerId }: { speakerId?: string }) => {\n  return function* audioElementSaga({\n    instance: room,\n    runSaga,\n  }: CustomSagaParams<RoomSessionConnection>): SagaIterator {\n    if (typeof Audio === 'undefined') {\n      getLogger().warn('`Audio` is not supported on this environment.')\n      return\n    }\n\n    try {\n      const audioEl = room.getAudioEl()\n      let audioTask: Task | undefined\n\n      const trackHandler = function (event: RTCTrackEvent) {\n        switch (event.track.kind) {\n          case 'audio': {\n            audioTask = runSaga(audioElementSetupWorker, {\n              track: event.track,\n              element: audioEl,\n              speakerId,\n              room,\n            })\n            break\n          }\n        }\n      }\n      /**\n       * Using `on` instead of `once` (or `off` within trackHandler) because\n       * there are cases (promote/demote) where we need to handle multiple `track`\n       * events and update the audioEl with the new track.\n       */\n      room.on('track', trackHandler)\n\n      room.once('destroy', () => {\n        audioTask?.cancel()\n      })\n    } catch (error) {\n      getLogger().error('audioElementSaga', error)\n    }\n  }\n}\n\nfunction* audioElementActionsWatcher({\n  element,\n  room,\n}: {\n  element: HTMLAudioElement\n  room: RoomSessionConnection\n}): SagaIterator {\n  // TODO: For now we're handling individual actions but in the future\n  // we might want to have a single action per custom saga and use it\n  // in a similar fashion to `executeAction`\n  const setSpeakerActionType = actions.getCustomSagaActionType(\n    room.__uuid,\n    audioSetSpeakerAction\n  )\n\n  while (true) {\n    const action = yield sagaEffects.take([setSpeakerActionType])\n\n    try {\n      switch (action.type) {\n        case setSpeakerActionType:\n          const response = yield sagaEffects.call(\n            setMediaElementSinkId,\n            element,\n            action.payload\n          )\n\n          room.emit(\n            // @ts-expect-error\n            `${LOCAL_EVENT_PREFIX}.speaker.updated`,\n            action.payload\n          )\n\n          room.settleCustomSagaTrigger({\n            dispatchId: action.dispatchId,\n            payload: response,\n            kind: 'resolve',\n          })\n          break\n      }\n    } catch (error) {\n      room.settleCustomSagaTrigger({\n        dispatchId: action.dispatchId,\n        payload: error,\n        kind: 'reject',\n      })\n      getLogger().error(error)\n    }\n  }\n}\n\nfunction* audioElementSetupWorker({\n  track,\n  element,\n  speakerId,\n  room,\n}: {\n  track: MediaStreamTrack\n  element: HTMLAudioElement\n  speakerId?: string\n  room: RoomSessionConnection\n}): SagaIterator {\n  setAudioMediaTrack({ track, element })\n  if (speakerId) {\n    // Catch no-op since setMediaElementSinkId already provides logs\n    setMediaElementSinkId(element, speakerId).catch(() => {})\n  }\n\n  yield sagaEffects.fork(audioElementActionsWatcher, {\n    element,\n    room,\n  })\n}\n\nfunction* videoElementSetupWorker({\n  rootElement,\n  applyLocalVideoOverlay = true,\n  track,\n  element,\n}: {\n  // TODO: we'll move this to a separate type once we define how to\n  // dispatch action that only target unique sagas\n  rootElement: HTMLElement\n  applyLocalVideoOverlay?: boolean\n  track: MediaStreamTrack\n  element: HTMLVideoElement\n}): SagaIterator {\n  try {\n    setVideoMediaTrack({ element, track })\n\n    element.style.width = '100%'\n    element.style.maxHeight = '100%'\n\n    if (!applyLocalVideoOverlay) {\n      rootElement.appendChild(element)\n      return\n    }\n    if (rootElement.querySelector('.mcuContent')) {\n      getLogger().debug('MCU Content already there')\n      return\n    }\n\n    const mcuWrapper = document.createElement('div')\n    mcuWrapper.style.position = 'absolute'\n    mcuWrapper.style.top = '0'\n    mcuWrapper.style.left = '0'\n    mcuWrapper.style.right = '0'\n    mcuWrapper.style.bottom = '0'\n    mcuWrapper.appendChild(element)\n\n    const paddingWrapper = document.createElement('div')\n    paddingWrapper.classList.add('paddingWrapper')\n    paddingWrapper.style.position = 'relative'\n    paddingWrapper.style.width = '100%'\n    paddingWrapper.appendChild(mcuWrapper)\n\n    //for less then 3 participants video call, the video aspect ratio can change\n    aspectRatioListener({\n      videoElement: element,\n      paddingWrapper,\n      fixInLandscapeOrientation:\n        rootElement.classList.contains('landscape-only'),\n    })\n\n    const layersWrapper = document.createElement('div')\n    layersWrapper.classList.add('mcuLayers')\n    layersWrapper.style.display = 'none'\n    paddingWrapper.appendChild(layersWrapper)\n\n    const relativeWrapper = document.createElement('div')\n    relativeWrapper.classList.add('mcuContent')\n    relativeWrapper.style.position = 'relative'\n    relativeWrapper.style.width = '100%'\n    relativeWrapper.style.height = '100%'\n    relativeWrapper.style.margin = '0 auto'\n    relativeWrapper.style.display = 'flex'\n    relativeWrapper.style.alignItems = 'center'\n    relativeWrapper.style.justifyContent = 'center'\n    relativeWrapper.appendChild(paddingWrapper)\n\n    rootElement.style.width = '100%'\n    rootElement.style.height = '100%'\n    rootElement.appendChild(relativeWrapper)\n\n    getLogger().debug('MCU readyState 1 >>', element.readyState)\n    if (element.readyState === HTMLMediaElement.HAVE_NOTHING) {\n      getLogger().debug('Wait for the MCU to be ready')\n      yield sagaEffects.call(waitForVideoReady, { element })\n    }\n    getLogger().debug('MCU is ready..')\n\n    layersWrapper.style.display = 'block'\n  } catch (error) {\n    getLogger().error('Handle video track error', error)\n  }\n}\n","export const SCREENSHARE_AUDIO_CONSTRAINTS: MediaTrackConstraints = {\n  echoCancellation: true,\n  noiseSuppression: false,\n  autoGainControl: false,\n  // @ts-expect-error\n  googAutoGainControl: false,\n}\n","import {\n  Rooms,\n  extendComponent,\n  BaseConnectionContract,\n  BaseConnectionState,\n  RoomLeft,\n  RoomLeftEventParams,\n} from '@signalwire/core'\nimport { BaseConnection, MediaEvent } from '@signalwire/webrtc'\nimport { RoomScreenShareMethods } from './utils/interfaces'\n\ntype RoomSessionScreenShareEventsHandlerMap = Record<\n  BaseConnectionState,\n  (params: RoomSessionScreenShare) => void\n> &\n  Record<RoomLeft, (params?: RoomLeftEventParams) => void> &\n  Record<MediaEvent, () => void>\n\nexport type RoomSessionScreenShareEvents = {\n  [k in keyof RoomSessionScreenShareEventsHandlerMap]: RoomSessionScreenShareEventsHandlerMap[k]\n}\n\n/** @deprecated Use {@link RoomSessionScreenShare} instead */\nexport interface RoomScreenShare extends RoomSessionScreenShare {}\nexport interface RoomSessionScreenShare\n  extends RoomScreenShareMethods,\n    BaseConnectionContract<RoomSessionScreenShareEvents> {\n  join(): Promise<void>\n  leave(): Promise<void>\n  /** @internal */\n  runWorker: BaseConnection<RoomSessionScreenShareEvents>['runWorker']\n}\n\nexport class RoomSessionScreenShareConnection extends BaseConnection<RoomSessionScreenShareEvents> {\n  join() {\n    return super.invite()\n  }\n\n  leave() {\n    return super.hangup()\n  }\n}\n\n/**\n * Represents a screen sharing.\n */\nexport const RoomSessionScreenShareAPI = extendComponent<\n  RoomSessionScreenShareConnection,\n  RoomScreenShareMethods\n>(RoomSessionScreenShareConnection, {\n  audioMute: Rooms.audioMuteMember,\n  audioUnmute: Rooms.audioUnmuteMember,\n  videoMute: Rooms.videoMuteMember,\n  videoUnmute: Rooms.videoUnmuteMember,\n  setMicrophoneVolume: Rooms.setInputVolumeMember,\n  setInputVolume: Rooms.setInputVolumeMember,\n  setInputSensitivity: Rooms.setInputSensitivityMember,\n})\n","import {\n  Rooms,\n  extendComponent,\n  BaseConnectionContract,\n  BaseConnectionState,\n  RoomLeft,\n  RoomLeftEventParams,\n} from '@signalwire/core'\nimport { BaseConnection, MediaEvent } from '@signalwire/webrtc'\nimport { RoomSessionDeviceMethods } from './utils/interfaces'\n\ntype RoomSessionDeviceEventsHandlerMap = Record<\n  BaseConnectionState,\n  (params: RoomSessionDevice) => void\n> &\n  Record<RoomLeft, (params?: RoomLeftEventParams) => void> &\n  Record<MediaEvent, () => void>\n\nexport type RoomSessionDeviceEvents = {\n  [k in keyof RoomSessionDeviceEventsHandlerMap]: RoomSessionDeviceEventsHandlerMap[k]\n}\n\n/** @deprecated Use {@link RoomSessionDevice} instead */\nexport interface RoomDevice extends RoomSessionDevice {}\nexport interface RoomSessionDevice\n  extends RoomSessionDeviceMethods,\n    BaseConnectionContract<RoomSessionDeviceEvents> {\n  join(): Promise<void>\n  leave(): Promise<void>\n  /** @internal */\n  runWorker: BaseConnection<RoomSessionDeviceEvents>['runWorker']\n}\n\nexport class RoomSessionDeviceConnection extends BaseConnection<RoomSessionDeviceEvents> {\n  join() {\n    return super.invite()\n  }\n\n  leave() {\n    return super.hangup()\n  }\n}\n\n/**\n * A RoomSessionDevice represents a device (such as a microphone or a camera)\n * that is at some point in its lifetime part of a {@link RoomSession}. You can\n * obtain a RoomSessionDevice from the {@link RoomSession} methods\n * {@link RoomSession.addCamera}, {@link RoomSession.addMicrophone}, and\n * {@link RoomSession.addDevice}.\n */\nexport const RoomSessionDeviceAPI = extendComponent<\n  RoomSessionDeviceConnection,\n  RoomSessionDeviceMethods\n>(RoomSessionDeviceConnection, {\n  audioMute: Rooms.audioMuteMember,\n  audioUnmute: Rooms.audioUnmuteMember,\n  videoMute: Rooms.videoMuteMember,\n  videoUnmute: Rooms.videoUnmuteMember,\n  setInputVolume: Rooms.setInputVolumeMember,\n  setMicrophoneVolume: Rooms.setInputVolumeMember,\n  setInputSensitivity: Rooms.setInputSensitivityMember,\n})\n","import {\n  sagaEffects,\n  SagaIterator,\n  SDKWorker,\n  toSyntheticEvent,\n  validateEventsToSubscribe,\n  toInternalEventName,\n  SwEventChannel,\n  InternalVideoMemberEntity,\n  InternalVideoMemberUpdatedEvent,\n  VideoMemberJoinedEvent,\n  VideoMemberLeftEvent,\n  VideoMemberUpdatedEvent,\n  InternalVideoRoomJoinedEvent,\n  MapToPubSubShape,\n} from '@signalwire/core'\nimport type { RoomSession } from '../RoomSession'\nimport type { VideoMemberListUpdatedParams } from '../utils/interfaces'\n\nconst noop = () => {}\n\nconst EXTERNAL_MEMBER_LIST_UPDATED_EVENT = 'memberList.updated'\n\nconst INTERNAL_MEMBER_LIST_UPDATED_EVENT = toInternalEventName({\n  event: EXTERNAL_MEMBER_LIST_UPDATED_EVENT,\n})\n\nconst SYNTHETIC_MEMBER_LIST_UPDATED_EVENT = toSyntheticEvent(\n  INTERNAL_MEMBER_LIST_UPDATED_EVENT\n)\n\n/**\n * List of action types this worker cares about.\n */\ntype MemberListUpdatedTargetActions = MapToPubSubShape<\n  | InternalVideoRoomJoinedEvent\n  | InternalVideoMemberUpdatedEvent\n  | VideoMemberJoinedEvent\n  | VideoMemberLeftEvent\n  | VideoMemberUpdatedEvent\n>\n\nconst MEMBER_LIST_EVENTS: Array<MemberListUpdatedTargetActions['type']> = [\n  /** Alias to `video.room.subscribed` */\n  'video.room.joined',\n  'video.member.joined',\n  'video.member.left',\n  'video.member.updated',\n]\n\ntype MemberList = Map<string, InternalVideoMemberEntity>\n\nconst isMemberListEvent = (\n  event: string\n): event is MemberListUpdatedTargetActions['type'] => {\n  // @ts-expect-error\n  return MEMBER_LIST_EVENTS.includes(event)\n}\n\nconst getMemberListEventsToSubscribe = (\n  subscriptions: MemberListUpdatedTargetActions['type'][]\n) => {\n  return validateEventsToSubscribe(MEMBER_LIST_EVENTS).filter((event) => {\n    return !subscriptions.includes(event)\n  })\n}\n\nconst shouldHandleMemberList = (subscriptions: string[]) => {\n  return subscriptions.some((event) =>\n    event.includes(EXTERNAL_MEMBER_LIST_UPDATED_EVENT)\n  )\n}\n\nconst getMembersFromAction = (action: MemberListUpdatedTargetActions) => {\n  if (action.type === 'video.room.joined') {\n    return action.payload.room_session.members\n  }\n\n  return [action.payload.member]\n}\n\nexport const getUpdatedMembers = ({\n  action,\n  memberList,\n}: {\n  action: MemberListUpdatedTargetActions\n  memberList: MemberList\n}) => {\n  const actionMembers = getMembersFromAction(action)\n\n  switch (action.type) {\n    case 'video.member.left':\n      actionMembers.forEach((member: InternalVideoMemberEntity) => {\n        memberList.delete(member.id)\n      })\n      break\n    default:\n      actionMembers.forEach((member: InternalVideoMemberEntity) => {\n        memberList.set(member.id, member)\n      })\n  }\n\n  return Array.from(memberList.values())\n}\n\nconst initMemberListSubscriptions = (\n  room: RoomSession,\n  subscriptions: MemberListUpdatedTargetActions['type'][]\n) => {\n  const events = getMemberListEventsToSubscribe(subscriptions)\n\n  events.forEach((event) => {\n    /**\n     * Params to `subscribe` come from the event handlers\n     * the user has attached so to make sure we subscribe to\n     * all the appropiate events needed for\n     * `memberList.updated` to work, we must subscribe to\n     * the required events. We don't need to act upon the\n     * event (that's why we attach a `noop`), just to\n     * register it (`subscribe` gets its values from\n     * `BaseComponent.getSubscriptions`, which gets\n     * populated by each of the  event handlers the user\n     * attached).\n     */\n    room.once(event as any, noop)\n  })\n\n  /**\n   * This handler will act as a simple bridge between\n   * synthetic events and external events.\n   */\n  const eventBridgeHandler = ({ members }: VideoMemberListUpdatedParams) => {\n    room.emit(EXTERNAL_MEMBER_LIST_UPDATED_EVENT, { members })\n  }\n\n  // @ts-expect-error\n  room.on(SYNTHETIC_MEMBER_LIST_UPDATED_EVENT, eventBridgeHandler)\n\n  /**\n   * Any events attached by the saga should be specified\n   * here so it can be cleaned up when needed.\n   */\n  const cleanup = () => {\n    // @ts-expect-error\n    room.off(SYNTHETIC_MEMBER_LIST_UPDATED_EVENT, eventBridgeHandler)\n  }\n\n  return {\n    cleanup,\n  }\n}\n\nfunction* membersListUpdatedWatcher({\n  swEventChannel,\n  instance,\n}: {\n  swEventChannel: SwEventChannel\n  instance: any\n}): SagaIterator {\n  const memberList: MemberList = new Map()\n\n  function* worker(pubSubAction: MemberListUpdatedTargetActions) {\n    const roomSessionId =\n      pubSubAction.type === 'video.room.joined'\n        ? pubSubAction.payload.room_session.id\n        : pubSubAction.payload.room_session_id\n\n    const members = getUpdatedMembers({ action: pubSubAction, memberList })\n    const memberListPayload = {\n      /**\n       * At this point it's needed to send the\n       * `room_session_id` so the pubSubSaga can properly\n       * infer the namespace for emitting the events to the\n       * appropiate room.\n       */\n      room_session_id: roomSessionId,\n      members,\n    }\n\n    instance.emit(SYNTHETIC_MEMBER_LIST_UPDATED_EVENT, memberListPayload)\n  }\n\n  while (true) {\n    const pubSubAction: MemberListUpdatedTargetActions = yield sagaEffects.take(\n      swEventChannel,\n      ({ type }: any) => {\n        return isMemberListEvent(type)\n      }\n    )\n\n    yield sagaEffects.fork(worker, pubSubAction)\n  }\n}\n\nexport const memberListUpdatedWorker: SDKWorker<RoomSession> =\n  function* membersChangedWorker({\n    channels: { swEventChannel },\n    instance,\n  }): SagaIterator {\n    // @ts-expect-error\n    const subscriptions = instance.getSubscriptions()\n\n    if (!shouldHandleMemberList(subscriptions)) {\n      return\n    }\n\n    const { cleanup } = initMemberListSubscriptions(instance, subscriptions)\n\n    yield sagaEffects.fork(membersListUpdatedWatcher, {\n      swEventChannel,\n      instance,\n    })\n\n    instance.once('destroy', () => {\n      cleanup()\n    })\n  }\n","import {\n  getLogger,\n  sagaEffects,\n  SagaIterator,\n  SDKWorker,\n  SDKActions,\n  MapToPubSubShape,\n  SDKWorkerHooks,\n  VideoMemberJoinedEvent,\n  componentSelectors,\n  componentActions,\n  type ReduxComponent,\n} from '@signalwire/core'\n\nimport type { BaseConnection } from '@signalwire/webrtc'\n\ntype ChildMemberJoinedWorkerOnDone = () => void\ntype ChildMemberJoinedWorkerOnFail = (args: { error: Error }) => void\n\nexport type ChildMemberJoinedWorkerHooks = SDKWorkerHooks<\n  ChildMemberJoinedWorkerOnDone,\n  ChildMemberJoinedWorkerOnFail\n>\n\nexport const childMemberJoinedWorker: SDKWorker<\n  BaseConnection<any>,\n  ChildMemberJoinedWorkerHooks\n> = function* (options): SagaIterator {\n  getLogger().trace('childMemberJoinedWorker started')\n  const { channels, instance, initialState, onDone, onFail } = options\n  const { swEventChannel } = channels\n  const { parentId } = initialState\n  if (!parentId) {\n    throw new Error('Missing parentId for childMemberJoinedWorker')\n  }\n\n  const action: MapToPubSubShape<VideoMemberJoinedEvent> =\n    yield sagaEffects.take(swEventChannel, (action: SDKActions) => {\n      if (action.type === 'video.member.joined') {\n        return action.payload.member.parent_id === parentId\n      }\n      return false\n    })\n\n  /**\n   * On video.member.joined with a parent_id, check if we are the\n   * owner of the object comparing parent_id in the state.\n   * If so update the state with the room values to update the\n   * object.\n   */\n  const { member } = action.payload\n  if (member?.parent_id) {\n    const byId: Record<string, ReduxComponent> = yield sagaEffects.select(\n      componentSelectors.getComponentsById\n    )\n    const parent = Object.values(byId).find((row) => {\n      return 'memberId' in row && row.memberId === member.parent_id\n    })\n    if (parent) {\n      yield sagaEffects.put(\n        componentActions.upsert({\n          id: instance.callId,\n          roomId: action.payload.room_id,\n          roomSessionId: action.payload.room_session_id,\n          memberId: member.id || member.member_id,\n        })\n      )\n\n      onDone?.()\n    } else {\n      onFail?.({ error: new Error('Unknown parent_id') })\n    }\n  }\n  getLogger().trace('childMemberJoinedWorker ended')\n}\n","import {\n  getLogger,\n  SagaIterator,\n  MapToPubSubShape,\n  VideoStreamEvent,\n  RoomSessionStream,\n  Rooms,\n} from '@signalwire/core'\nimport { VideoWorkerParams } from './videoWorker'\n\nexport const videoStreamWorker = function* (\n  options: VideoWorkerParams<MapToPubSubShape<VideoStreamEvent>>\n): SagaIterator {\n  getLogger().trace('videoStreamWorker started')\n  const {\n    instance: roomSession,\n    action: { type, payload },\n    instanceMap: { get, set, remove },\n  } = options\n\n  // For now, we are not storing the RoomSession object in the instance map\n\n  let streamInstance = get<RoomSessionStream>(payload.stream.id)\n  if (!streamInstance) {\n    streamInstance = Rooms.createRoomSessionStreamObject({\n      store: roomSession.store,\n      payload,\n    })\n  } else {\n    streamInstance.setPayload(payload)\n  }\n  set<RoomSessionStream>(payload.stream.id, streamInstance)\n\n  switch (type) {\n    case 'video.stream.started':\n      roomSession.emit('stream.started', streamInstance)\n      break\n    case 'video.stream.ended':\n      roomSession.emit('stream.ended', streamInstance)\n      remove<RoomSessionStream>(payload.stream.id)\n      break\n    default:\n      getLogger().warn(`Unknown video.stream event: \"${type}\"`)\n      break\n  }\n\n  getLogger().trace('videoStreamWorker ended')\n}\n","import {\n  getLogger,\n  SagaIterator,\n  MapToPubSubShape,\n  RoomSessionRecording,\n  Rooms,\n  VideoRecordingEvent,\n  VideoRecordingEventNames,\n  stripNamespacePrefix,\n} from '@signalwire/core'\nimport { VideoWorkerParams } from './videoWorker'\n\nexport const videoRecordWorker = function* (\n  options: VideoWorkerParams<MapToPubSubShape<VideoRecordingEvent>>\n): SagaIterator {\n  getLogger().trace('videoRecordWorker started')\n  const {\n    instance: roomSession,\n    action: { type, payload },\n    instanceMap: { get, set, remove },\n  } = options\n\n  // For now, we are not storing the RoomSession object in the instance map\n\n  let recordingInstance = get<RoomSessionRecording>(payload.recording.id)\n  if (!recordingInstance) {\n    recordingInstance = Rooms.createRoomSessionRecordingObject({\n      store: roomSession.store,\n      payload,\n    })\n  } else {\n    recordingInstance.setPayload(payload)\n  }\n  set<RoomSessionRecording>(payload.recording.id, recordingInstance)\n\n  const event = stripNamespacePrefix(type) as VideoRecordingEventNames\n\n  switch (type) {\n    case 'video.recording.started':\n    case 'video.recording.updated': {\n      roomSession.emit(event, recordingInstance)\n      break\n    }\n    case 'video.recording.ended':\n      roomSession.emit(event, recordingInstance)\n      remove<RoomSessionRecording>(payload.recording.id)\n      break\n    default:\n      getLogger().warn(`Unknown video.stream event: \"${type}\"`)\n      break\n  }\n\n  getLogger().trace('videoRecordWorker ended')\n}\n","import {\n  getLogger,\n  SagaIterator,\n  MapToPubSubShape,\n  RoomSessionPlayback,\n  Rooms,\n  VideoPlaybackEvent,\n  VideoPlaybackEventNames,\n  stripNamespacePrefix,\n} from '@signalwire/core'\nimport { VideoWorkerParams } from './videoWorker'\n\nexport const videoPlaybackWorker = function* (\n  options: VideoWorkerParams<MapToPubSubShape<VideoPlaybackEvent>>\n): SagaIterator {\n  getLogger().trace('videoPlaybackWorker started')\n  const {\n    instance: roomSession,\n    action: { type, payload },\n    instanceMap: { get, set, remove },\n  } = options\n\n  // For now, we are not storing the RoomSession object in the instance map\n\n  let playbackInstance = get<RoomSessionPlayback>(payload.playback.id)\n  if (!playbackInstance) {\n    playbackInstance = Rooms.createRoomSessionPlaybackObject({\n      store: roomSession.store,\n      payload,\n    })\n  } else {\n    playbackInstance.setPayload(payload)\n  }\n  set<RoomSessionPlayback>(payload.playback.id, playbackInstance)\n\n  const event = stripNamespacePrefix(type) as VideoPlaybackEventNames\n\n  switch (type) {\n    case 'video.playback.started':\n    case 'video.playback.updated': {\n      roomSession.emit(event, playbackInstance)\n      break\n    }\n    case 'video.playback.ended':\n      roomSession.emit(event, playbackInstance)\n      remove<RoomSessionPlayback>(payload.playback.id)\n      break\n    default:\n      getLogger().warn(`Unknown video.stream event: \"${type}\"`)\n      break\n  }\n\n  getLogger().trace('videoPlaybackWorker ended')\n}\n","import {\n  MapToPubSubShape,\n  SDKActions,\n  SDKWorker,\n  SagaIterator,\n  VideoAPIEventParams,\n  getLogger,\n  sagaEffects,\n  SDKWorkerParams,\n  MemberPosition,\n  VideoAPIEventNames,\n  stripNamespacePrefix,\n} from '@signalwire/core'\nimport { RoomSessionConnection } from '../BaseRoomSession'\nimport { videoStreamWorker } from './videoStreamWorker'\nimport { videoRecordWorker } from './videoRecordWorker'\nimport { videoPlaybackWorker } from './videoPlaybackWorker'\n\nexport type VideoWorkerParams<T> = SDKWorkerParams<RoomSessionConnection> & {\n  action: T\n}\n\nexport const videoWorker: SDKWorker<RoomSessionConnection> = function* (\n  options\n): SagaIterator {\n  getLogger().trace('videoWorker started')\n\n  const { channels, instance: roomSession } = options\n  const { swEventChannel } = channels\n\n  function* worker(action: MapToPubSubShape<VideoAPIEventParams>) {\n    const { type, payload } = action\n\n    switch (type) {\n      case 'video.room.subscribed':\n        yield sagaEffects.spawn(MemberPosition.memberPositionWorker, {\n          ...options,\n          instance: roomSession,\n          initialState: payload,\n        })\n        return\n      case 'video.playback.started':\n      case 'video.playback.updated':\n      case 'video.playback.ended':\n        yield sagaEffects.fork(videoPlaybackWorker, {\n          action,\n          ...options,\n        })\n        return // Return since we don't need to handle the raw event for this\n      case 'video.recording.started':\n      case 'video.recording.updated':\n      case 'video.recording.ended':\n        yield sagaEffects.fork(videoRecordWorker, {\n          action,\n          ...options,\n        })\n        return\n      case 'video.stream.ended':\n      case 'video.stream.started':\n        yield sagaEffects.fork(videoStreamWorker, {\n          action,\n          ...options,\n        })\n        return\n      case 'video.room.audience_count': {\n        roomSession.emit('room.audienceCount', payload)\n        return\n      }\n      case 'video.member.talking': {\n        const { member } = payload\n        if ('talking' in member) {\n          const suffix = member.talking ? 'started' : 'ended'\n          roomSession.emit(`member.talking.${suffix}`, payload)\n\n          // Keep for backwards compat.\n          const deprecatedSuffix = member.talking ? 'start' : 'stop'\n          roomSession.emit(`member.talking.${deprecatedSuffix}`, payload)\n        }\n        break // Break here since we do need the raw event sent to the client\n      }\n      default:\n        break\n    }\n\n    const event = stripNamespacePrefix(type, 'video') as VideoAPIEventNames\n    roomSession.emit(event, payload)\n  }\n\n  const isVideoOrCallEvent = (action: SDKActions) => {\n    return action.type.startsWith('video.') || action.type.startsWith('call.')\n  }\n\n  while (true) {\n    const action: MapToPubSubShape<VideoAPIEventParams> =\n      yield sagaEffects.take(swEventChannel, isVideoOrCallEvent)\n\n    yield sagaEffects.fork(worker, action)\n  }\n\n  getLogger().trace('videoWorker ended')\n}\n","import {\n  InternalVideoMemberUpdatedEvent,\n  MapToPubSubShape,\n  MemberTalkingEventNames,\n  RoomSessionMember,\n  Rooms,\n  SagaIterator,\n  VideoMemberEventNames,\n  VideoMemberJoinedEvent,\n  VideoMemberLeftEvent,\n  VideoMemberTalkingEvent,\n  VideoMemberUpdatedEvent,\n  getLogger,\n  stripNamespacePrefix,\n} from '@signalwire/core'\nimport { VideoWorkerParams } from './videoWorker'\n\ntype VideoMemberEvents = MapToPubSubShape<\n  | VideoMemberJoinedEvent\n  | VideoMemberLeftEvent\n  | VideoMemberUpdatedEvent\n  | VideoMemberTalkingEvent\n  | InternalVideoMemberUpdatedEvent\n>\n\nexport const videoMemberWorker = function* (\n  options: VideoWorkerParams<VideoMemberEvents>\n): SagaIterator {\n  getLogger().trace('videoMemberWorker started')\n  const {\n    instance: roomSession,\n    action: { type, payload },\n    instanceMap: { get, set, remove },\n  } = options\n\n  // For now, we are not storing the RoomSession object in the instance map\n\n  const memberId = payload.member?.id || payload.member?.member_id\n\n  let memberInstance = get<RoomSessionMember>(memberId!)\n  if (!memberInstance) {\n    memberInstance = Rooms.createRoomSessionMemberObject({\n      store: roomSession.store,\n      payload: payload as Rooms.RoomSessionMemberEventParams,\n    })\n  } else {\n    memberInstance.setPayload(payload as Rooms.RoomSessionMemberEventParams)\n  }\n  set<RoomSessionMember>(memberId!, memberInstance)\n\n\n  const event = stripNamespacePrefix(type) as VideoMemberEventNames\n\n  if (type.startsWith('video.member.updated.')) {\n    roomSession.emit(event, payload)\n  }\n\n  switch (type) {\n    case 'video.member.joined':\n    case 'video.member.updated':\n      roomSession.emit(event, payload)\n      break\n    case 'video.member.left':\n      roomSession.emit(event, payload)\n      remove<RoomSessionMember>(memberId!)\n      break\n    case 'video.member.talking':\n      roomSession.emit(event, payload)\n      if ('talking' in payload.member) {\n        const suffix = payload.member.talking ? 'started' : 'ended'\n        roomSession.emit(\n          `${event}.${suffix}` as MemberTalkingEventNames,\n          payload\n        )\n\n        // Keep for backwards compatibility\n        const deprecatedSuffix = payload.member.talking ? 'start' : 'stop'\n        roomSession.emit(\n          `${event}.${deprecatedSuffix}` as MemberTalkingEventNames,\n          payload\n        )\n      }\n      break\n    default:\n      break\n  }\n  getLogger().trace('videoMemberWorker ended')\n}\n","import {\n  connect,\n  Rooms,\n  extendComponent,\n  BaseComponentContract,\n  BaseComponentOptions,\n  BaseConnectionContract,\n  VideoAuthorization,\n  LOCAL_EVENT_PREFIX,\n  validateEventsToSubscribe,\n  EventEmitter,\n  SDKWorker,\n} from '@signalwire/core'\nimport {\n  getDisplayMedia,\n  BaseConnection,\n  BaseConnectionOptions,\n  BaseConnectionStateEventTypes,\n  supportsMediaOutput,\n  createSpeakerDeviceWatcher,\n  getSpeakerById,\n} from '@signalwire/webrtc'\nimport type {\n  RoomSessionObjectEvents,\n  CreateScreenShareObjectOptions,\n  AddDeviceOptions,\n  AddCameraOptions,\n  AddMicrophoneOptions,\n  BaseRoomInterface,\n  RoomMethods,\n  StartScreenShareOptions,\n  RoomSessionConnectionContract,\n  BaseRoomSessionJoinParams,\n  LocalOverlay,\n  AudioElement,\n} from './utils/interfaces'\nimport { SCREENSHARE_AUDIO_CONSTRAINTS } from './utils/constants'\nimport { audioSetSpeakerAction } from './features/actions'\nimport {\n  RoomSessionScreenShareAPI,\n  RoomSessionScreenShareConnection,\n  RoomSessionScreenShare,\n  RoomSessionScreenShareEvents,\n} from './RoomSessionScreenShare'\nimport {\n  RoomSessionDeviceAPI,\n  RoomSessionDeviceConnection,\n  RoomSessionDevice,\n  RoomSessionDeviceEvents,\n} from './RoomSessionDevice'\nimport * as workers from './video/workers'\n\nexport interface BaseRoomSession<T>\n  extends RoomMethods,\n    RoomSessionConnectionContract,\n    BaseComponentContract,\n    BaseConnectionContract<RoomSessionObjectEvents> {\n  /**\n   * Joins the room session.\n   */\n  join(options?: BaseRoomSessionJoinParams): Promise<T>\n\n  /**\n   * Leaves the room. This detaches all the locally originating streams from the\n   * room.\n   */\n  leave(): Promise<void>\n}\n\nexport interface BaseRoomSessionOptions\n  extends BaseConnection<RoomSessionObjectEvents> {\n  mirrorLocalVideoOverlay: boolean\n  eventsWatcher?: SDKWorker<RoomSessionConnection>\n}\n\nexport class RoomSessionConnection\n  extends BaseConnection<RoomSessionObjectEvents>\n  implements BaseRoomInterface, RoomSessionConnectionContract\n{\n  private _screenShareList = new Set<RoomSessionScreenShare>()\n  private _deviceList = new Set<RoomSessionDevice>()\n  private _mirrored: LocalOverlay['mirrored']\n  private _audioEl: AudioElement\n\n  constructor(options: BaseRoomSessionOptions) {\n    super(options)\n    this._mirrored = options.mirrorLocalVideoOverlay\n\n    this.initWorker()\n  }\n\n  protected initWorker() {\n    this.runWorker('videoWorker', {\n      worker: workers.videoWorker,\n    })\n  }\n\n  get screenShareList() {\n    return Array.from(this._screenShareList)\n  }\n\n  get deviceList() {\n    return Array.from(this._deviceList)\n  }\n\n  get interactivityMode() {\n    return this.select(({ session }) => {\n      const { authState } = session\n      return (authState as VideoAuthorization)?.join_as ?? ''\n    })\n  }\n\n  get permissions() {\n    return this.select(({ session }) => {\n      const { authState } = session\n      return (authState as VideoAuthorization)?.room?.scopes ?? []\n    })\n  }\n\n  /**\n   * This method will be called by `join()` right before the\n   * `connect()` happens and it's a way for us to control\n   * exactly when the workers are attached.\n   * @internal\n   */\n  protected attachPreConnectWorkers() {\n    this.runWorker('memberListUpdated', {\n      worker: workers.memberListUpdatedWorker,\n    })\n  }\n\n  /** @deprecated Use {@link startScreenShare} instead. */\n  async createScreenShareObject(opts: CreateScreenShareObjectOptions = {}) {\n    return this.startScreenShare(opts)\n  }\n\n  /**\n   * Allow sharing the screen within the room.\n   */\n  async startScreenShare(opts: StartScreenShareOptions = {}) {\n    return new Promise<RoomSessionScreenShare>(async (resolve, reject) => {\n      const {\n        autoJoin = true,\n        audio = false,\n        video = true,\n        layout,\n        positions,\n      } = opts\n      try {\n        const displayStream: MediaStream = await getDisplayMedia({\n          audio: audio === true ? SCREENSHARE_AUDIO_CONSTRAINTS : audio,\n          video,\n        })\n        const options: BaseConnectionOptions = {\n          ...this.options,\n          screenShare: true,\n          recoverCall: false,\n          localStream: displayStream,\n          remoteStream: undefined,\n          userVariables: {\n            ...(this.options?.userVariables || {}),\n            memberCallId: this.callId,\n            memberId: this.memberId,\n          },\n          layout,\n          positions,\n        }\n\n        const screenShare = connect<\n          RoomSessionScreenShareEvents,\n          RoomSessionScreenShareConnection,\n          RoomSessionScreenShare\n        >({\n          store: this.store,\n          Component: RoomSessionScreenShareAPI,\n        })(options)\n\n        /**\n         * Hangup if the user stop the screenShare from the\n         * native browser button or if the videoTrack ends.\n         */\n        displayStream.getVideoTracks().forEach((t) => {\n          t.addEventListener('ended', () => {\n            if (screenShare && screenShare.active) {\n              screenShare.leave()\n            }\n          })\n        })\n\n        screenShare.once('destroy', () => {\n          screenShare.emit('room.left')\n          this._screenShareList.delete(screenShare)\n        })\n\n        screenShare.runWorker('childMemberJoinedWorker', {\n          worker: workers.childMemberJoinedWorker,\n          onDone: () => resolve(screenShare),\n          onFail: reject,\n          initialState: {\n            parentId: this.memberId,\n          },\n        })\n\n        this._screenShareList.add(screenShare)\n        if (autoJoin) {\n          return await screenShare.join()\n        }\n        return resolve(screenShare)\n      } catch (error) {\n        this.logger.error('ScreenShare Error', error)\n        reject(error)\n      }\n    })\n  }\n\n  /**\n   * Allow to add a camera to the room.\n   */\n  addCamera(opts: AddCameraOptions = {}) {\n    const { autoJoin = true, ...video } = opts\n    return this.addDevice({\n      autoJoin,\n      video,\n    })\n  }\n\n  /**\n   * Allow to add a microphone to the room.\n   */\n  addMicrophone(opts: AddMicrophoneOptions = {}) {\n    const { autoJoin = true, ...audio } = opts\n    return this.addDevice({\n      autoJoin,\n      audio,\n    })\n  }\n\n  /**\n   * Allow to add additional devices to the room like cameras or microphones.\n   */\n  async addDevice(opts: AddDeviceOptions = {}) {\n    return new Promise<RoomSessionDevice>(async (resolve, reject) => {\n      const { autoJoin = true, audio = false, video = false } = opts\n      if (!audio && !video) {\n        throw new TypeError(\n          'At least one of `audio` or `video` must be requested.'\n        )\n      }\n\n      const options: BaseConnectionOptions = {\n        ...this.options,\n        localStream: undefined,\n        remoteStream: undefined,\n        audio,\n        video,\n        additionalDevice: true,\n        recoverCall: false,\n        userVariables: {\n          ...(this.options?.userVariables || {}),\n          memberCallId: this.callId,\n          memberId: this.memberId,\n        },\n      }\n\n      const roomDevice = connect<\n        RoomSessionDeviceEvents,\n        RoomSessionDeviceConnection,\n        RoomSessionDevice\n      >({\n        store: this.store,\n        Component: RoomSessionDeviceAPI,\n      })(options)\n\n      roomDevice.once('destroy', () => {\n        roomDevice.emit('room.left')\n        this._deviceList.delete(roomDevice)\n      })\n\n      try {\n        roomDevice.runWorker('childMemberJoinedWorker', {\n          worker: workers.childMemberJoinedWorker,\n          onDone: () => resolve(roomDevice),\n          onFail: reject,\n          initialState: {\n            parentId: this.memberId,\n          },\n        })\n\n        this._deviceList.add(roomDevice)\n        if (autoJoin) {\n          return await roomDevice.join()\n        }\n        return resolve(roomDevice)\n      } catch (error) {\n        this.logger.error('RoomDevice Error', error)\n        reject(error)\n      }\n    })\n  }\n\n  join() {\n    return super.invite<BaseRoomSession<this>>()\n  }\n\n  leave() {\n    return this.hangup()\n  }\n\n  updateSpeaker({ deviceId }: { deviceId: string }) {\n    const prevId = this._audioEl.sinkId as string\n    this.once(\n      // @ts-expect-error\n      `${LOCAL_EVENT_PREFIX}.speaker.updated`,\n      async (newId: string) => {\n        const prevSpeaker = await getSpeakerById(prevId)\n        const newSpeaker = await getSpeakerById(newId)\n\n        const isSame = newSpeaker?.deviceId === prevSpeaker?.deviceId\n        if (!newSpeaker?.deviceId || isSame) return\n\n        this.emit('speaker.updated', {\n          previous: {\n            deviceId: prevSpeaker?.deviceId,\n            label: prevSpeaker?.label,\n          },\n          current: {\n            deviceId: newSpeaker.deviceId,\n            label: newSpeaker.label,\n          },\n        })\n      }\n    )\n\n    return this.triggerCustomSaga<undefined>(audioSetSpeakerAction(deviceId))\n  }\n\n  private _attachSpeakerTrackListener() {\n    if (!supportsMediaOutput()) return\n\n    // @TODO: Stop the watcher when user leave/disconnects\n    createSpeakerDeviceWatcher().then((deviceWatcher) => {\n      deviceWatcher.on('removed', async (data) => {\n        const sinkId = this._audioEl.sinkId\n        const disconnectedSpeaker = data.changes.find((device) => {\n          const payloadDeviceId = device.payload.deviceId\n\n          return (\n            payloadDeviceId === sinkId ||\n            (payloadDeviceId === '' && sinkId === 'default') ||\n            (payloadDeviceId === 'default' && sinkId === '')\n          )\n        })\n        if (disconnectedSpeaker) {\n          this.emit('speaker.disconnected', {\n            deviceId: disconnectedSpeaker.payload.deviceId,\n            label: disconnectedSpeaker.payload.label,\n          })\n\n          /**\n           * In case the currently in-use speaker disconnects, OS by default fallbacks to the default speaker\n           * Set the sink id here to make the SDK consistent with the OS\n           */\n          await this._audioEl.setSinkId?.('')\n\n          const defaultSpeakers = await getSpeakerById('default')\n\n          if (!defaultSpeakers?.deviceId) return\n\n          // Emit the speaker.updated event since the OS will fallback to the default speaker\n          this.emit('speaker.updated', {\n            previous: {\n              deviceId: disconnectedSpeaker.payload.deviceId,\n              label: disconnectedSpeaker.payload.label,\n            },\n            current: {\n              deviceId: defaultSpeakers.deviceId,\n              label: defaultSpeakers.label,\n            },\n          })\n        }\n      })\n    })\n  }\n\n  getAudioEl() {\n    if (this._audioEl) return this._audioEl\n    this._audioEl = new Audio()\n    this._attachSpeakerTrackListener()\n    return this._audioEl\n  }\n\n  /** @internal */\n  override async hangup(id?: string) {\n    this._screenShareList.forEach((screenShare) => {\n      screenShare.leave()\n    })\n    this._deviceList.forEach((device) => {\n      device.leave()\n    })\n\n    return super.hangup(id)\n  }\n\n  /** @internal */\n  protected _finalize() {\n    this._screenShareList.clear()\n    this._deviceList.clear()\n\n    super._finalize()\n  }\n\n  /**\n   * @deprecated Use {@link getLayouts} instead. `getLayoutList` will\n   * be removed in v3.0.0\n   */\n  getLayoutList() {\n    // @ts-expect-error\n    return this.getLayouts()\n  }\n\n  /**\n   * @deprecated Use {@link getMembers} instead. `getMemberList` will\n   * be removed in v3.0.0\n   */\n  getMemberList() {\n    // @ts-expect-error\n    return this.getMembers()\n  }\n\n  /**\n   * Local video stream overlay\n   */\n  get localOverlay() {\n    return {\n      mirrored: this._mirrored,\n      setMirrored: (value: boolean) => {\n        this._mirrored = value\n        this.emit(\n          // @ts-expect-error\n          `${LOCAL_EVENT_PREFIX}.mirror.video`,\n          this._mirrored\n        )\n      },\n    }\n  }\n\n  /** @internal */\n  protected override getSubscriptions() {\n    const eventNamesWithPrefix = this.eventNames().map(\n      (event) => `video.${event}`\n    ) as EventEmitter.EventNames<RoomSessionObjectEvents>[]\n    return validateEventsToSubscribe(eventNamesWithPrefix)\n  }\n}\n\nexport const RoomSessionAPI = extendComponent<\n  RoomSessionConnection,\n  RoomMethods\n>(RoomSessionConnection, {\n  audioMute: Rooms.audioMuteMember,\n  audioUnmute: Rooms.audioUnmuteMember,\n  videoMute: Rooms.videoMuteMember,\n  videoUnmute: Rooms.videoUnmuteMember,\n  deaf: Rooms.deafMember,\n  undeaf: Rooms.undeafMember,\n  setInputVolume: Rooms.setInputVolumeMember,\n  setOutputVolume: Rooms.setOutputVolumeMember,\n  setMicrophoneVolume: Rooms.setInputVolumeMember,\n  setSpeakerVolume: Rooms.setOutputVolumeMember,\n  setInputSensitivity: Rooms.setInputSensitivityMember,\n  removeMember: Rooms.removeMember,\n  removeAllMembers: Rooms.removeAllMembers,\n  getMembers: Rooms.getMembers,\n  getLayouts: Rooms.getLayouts,\n  setLayout: Rooms.setLayout,\n  setPositions: Rooms.setPositions,\n  setMemberPosition: Rooms.setMemberPosition,\n  hideVideoMuted: Rooms.hideVideoMuted,\n  showVideoMuted: Rooms.showVideoMuted,\n  getRecordings: Rooms.getRecordings,\n  startRecording: Rooms.startRecording,\n  getPlaybacks: Rooms.getPlaybacks,\n  play: Rooms.play,\n  setHideVideoMuted: Rooms.setHideVideoMuted,\n  getMeta: Rooms.getMeta,\n  setMeta: Rooms.setMeta,\n  updateMeta: Rooms.updateMeta,\n  deleteMeta: Rooms.deleteMeta,\n  getMemberMeta: Rooms.getMemberMeta,\n  setMemberMeta: Rooms.setMemberMeta,\n  updateMemberMeta: Rooms.updateMemberMeta,\n  deleteMemberMeta: Rooms.deleteMemberMeta,\n  promote: Rooms.promote,\n  demote: Rooms.demote,\n  getStreams: Rooms.getStreams,\n  startStream: Rooms.startStream,\n  lock: Rooms.lock,\n  unlock: Rooms.unlock,\n  setRaisedHand: Rooms.setRaisedHand,\n  setPrioritizeHandraise: Rooms.setPrioritizeHandraise,\n})\n\nexport type RoomSessionObjectEventsHandlerMapping = RoomSessionObjectEvents &\n  BaseConnectionStateEventTypes\n\n/** @internal */\nexport const createBaseRoomSessionObject = <RoomSessionType>(\n  params: BaseComponentOptions\n): BaseRoomSession<RoomSessionType> => {\n  const room = connect<\n    RoomSessionObjectEventsHandlerMapping,\n    RoomSessionConnection,\n    BaseRoomSession<RoomSessionType>\n  >({\n    store: params.store,\n    customSagas: params.customSagas,\n    Component: RoomSessionAPI,\n  })(params)\n\n  return room\n}\n","import {\n  getLogger,\n  SagaIterator,\n  MapToPubSubShape,\n  VideoManagerRoomsSubscribedEvent,\n  toExternalJSON,\n  VideoManagerRoomEventNames,\n  stripNamespacePrefix,\n} from '@signalwire/core'\nimport { VideoManagerWorkerParams } from './videoManagerWorker'\n\nexport const videoManagerRoomsWorker = function* (\n  options: VideoManagerWorkerParams<\n    MapToPubSubShape<VideoManagerRoomsSubscribedEvent>\n  >\n): SagaIterator {\n  getLogger().trace('videoManagerRoomsWorker started')\n  const {\n    instance: client,\n    action: { type, payload },\n  } = options\n\n  // For now we expose the transformed payload and not a RoomSession\n  const modPayload = {\n    rooms: payload.rooms.map((row) => toExternalJSON(row)),\n  }\n  client.emit(\n    stripNamespacePrefix(type) as VideoManagerRoomEventNames,\n    modPayload\n  )\n\n  getLogger().trace('videoManagerRoomsWorker ended')\n}\n","import {\n  getLogger,\n  SagaIterator,\n  MapToPubSubShape,\n  VideoManagerRoomEvent,\n  toExternalJSON,\n  VideoManagerRoomEventNames,\n  stripNamespacePrefix,\n} from '@signalwire/core'\nimport { VideoManagerWorkerParams } from './videoManagerWorker'\n\nexport const videoManagerRoomWorker = function* (\n  options: VideoManagerWorkerParams<MapToPubSubShape<VideoManagerRoomEvent>>\n): SagaIterator {\n  getLogger().trace('videoManagerRoomWorker started')\n  const {\n    instance: client,\n    action: { type, payload },\n  } = options\n\n  // For now we expose the transformed payload and not a RoomSession\n  client.emit(\n    stripNamespacePrefix(type) as VideoManagerRoomEventNames,\n    toExternalJSON(payload)\n  )\n\n  getLogger().trace('videoManagerRoomWorker ended')\n}\n","import { getLogger, sagaEffects } from '@signalwire/core'\nimport type {\n  SagaIterator,\n  MapToPubSubShape,\n  VideoManagerEvent,\n  SDKWorker,\n  SDKActions,\n  SDKWorkerParams,\n} from '@signalwire/core'\nimport type { VideoManager } from '../VideoManager'\nimport { videoManagerRoomsWorker } from './videoManagerRoomsWorker'\nimport { videoManagerRoomWorker } from './videoManagerRoomWorker'\n\nexport type VideoManagerWorkerParams<T> = SDKWorkerParams<VideoManager> & {\n  action: T\n}\n\nexport const videoManagerWorker: SDKWorker<VideoManager> = function* (\n  options\n): SagaIterator {\n  getLogger().trace('videoManagerWorker started')\n  const {\n    channels: { swEventChannel },\n  } = options\n\n  function* worker(action: MapToPubSubShape<VideoManagerEvent>) {\n    const { type } = action\n\n    switch (type) {\n      case 'video-manager.rooms.subscribed':\n        yield sagaEffects.fork(videoManagerRoomsWorker, {\n          action,\n          ...options,\n        })\n        break\n      case 'video-manager.room.added':\n      case 'video-manager.room.deleted':\n      case 'video-manager.room.ended':\n      case 'video-manager.room.started':\n      case 'video-manager.room.updated':\n        yield sagaEffects.fork(videoManagerRoomWorker, {\n          action,\n          ...options,\n        })\n        break\n      default:\n        getLogger().warn(`Unknown video-manager event: \"${type}\"`)\n        break\n    }\n  }\n\n  while (true) {\n    const action: MapToPubSubShape<VideoManagerEvent> = yield sagaEffects.take(\n      swEventChannel,\n      (action: SDKActions) => {\n        return action.type.startsWith('video-manager.')\n      }\n    )\n\n    yield sagaEffects.fork(worker, action)\n  }\n\n  getLogger().trace('videoManagerWorker ended')\n}\n","import {\n  BaseComponentOptions,\n  VideoManagerRoomEventNames,\n  connect,\n  ConsumerContract,\n  VideoManagerRoomEntity,\n  validateEventsToSubscribe,\n  EventEmitter,\n  BaseConsumer,\n} from '@signalwire/core'\nimport { videoManagerWorker } from './workers'\n\n/** @internal */\nexport type VideoManagerEvents = Record<\n  VideoManagerRoomEventNames,\n  (room: VideoManagerRoomEntity) => void\n>\n\n/** @internal */\nexport interface VideoManager extends ConsumerContract<VideoManagerEvents> {}\n\n/** @internal */\nexport class VideoManagerAPI extends BaseConsumer<VideoManagerEvents> {\n  constructor(options: BaseComponentOptions) {\n    super(options)\n\n    this.runWorker('videoManagerWorker', {\n      worker: videoManagerWorker,\n    })\n  }\n\n  /** @internal */\n  protected override getSubscriptions() {\n    const eventNamesWithPrefix = this.eventNames().map(\n      (event) => `video-manager.${event}`\n    ) as EventEmitter.EventNames<VideoManagerEvents>[]\n    return validateEventsToSubscribe(eventNamesWithPrefix)\n  }\n}\n\nexport const createVideoManagerObject = (params: BaseComponentOptions) => {\n  const manager = connect<VideoManagerEvents, VideoManagerAPI, VideoManager>({\n    store: params.store,\n    Component: VideoManagerAPI,\n  })(params)\n\n  const proxy = new Proxy<VideoManager>(manager, {\n    get(\n      target: VideoManager,\n      property: string | symbol,\n      receiver: ProxyHandler<VideoManager>\n    ) {\n      if (property === '_eventsNamespace') {\n        return ''\n      } else if (property === 'eventChannel') {\n        return 'video-manager.rooms'\n      }\n\n      return Reflect.get(target, property, receiver)\n    },\n  })\n  return proxy\n}\n","import {\n  BaseClient,\n  ClientEvents,\n  ClientContract,\n  actions,\n  Chat as ChatNamespace,\n  PubSub as PubSubNamespace,\n} from '@signalwire/core'\nimport type { CustomSaga } from '@signalwire/core'\nimport { ConnectionOptions } from '@signalwire/webrtc'\nimport {\n  makeVideoElementSaga,\n  makeAudioElementSaga,\n} from './features/mediaElements/mediaElementsSagas'\nimport {\n  createBaseRoomSessionObject,\n  RoomSessionConnection,\n} from './BaseRoomSession'\nimport { VideoManager, createVideoManagerObject } from './cantina'\nimport type { Client as ChatClient } from './chat/Client'\nimport type { Client as PubSubClient } from './pubSub/Client'\nimport type { RoomSession } from './RoomSession'\n\nexport interface Client<RoomSessionType = RoomSession>\n  extends ClientContract<Client<RoomSessionType>, ClientEvents> {\n  rooms: ClientAPI<RoomSessionType>['rooms']\n  chat: ClientAPI<RoomSessionType>['chat']\n  pubSub: ClientAPI<RoomSessionType>['pubSub']\n}\n\nexport interface MakeRoomOptions extends ConnectionOptions {\n  /** HTML element in which to display the video stream */\n  rootElement?: HTMLElement\n  /** Whether to apply the local-overlay on top of your video. Default: `true`. */\n  applyLocalVideoOverlay?: boolean\n  /** Whether to mirror the local video overlay. Default: `false`. */\n  mirrorLocalVideoOverlay?: boolean\n  /** Whether to stop the camera when the member is muted. Default: `true`. */\n  stopCameraWhileMuted?: boolean\n  /** Whether to stop the microphone when the member is muted. Default: `true`. */\n  stopMicrophoneWhileMuted?: boolean\n  /** Local media stream to override the local video and audio stream tracks */\n  localStream?: MediaStream\n}\n\nexport class ClientAPI<\n  RoomSessionType = RoomSession\n> extends BaseClient<ClientEvents> {\n  private _videoManager: VideoManager\n  private _chat: ChatClient\n  private _pubSub: PubSubClient\n\n  get rooms() {\n    return {\n      makeRoomObject: (makeRoomOptions: MakeRoomOptions) => {\n        const {\n          rootElement,\n          applyLocalVideoOverlay = true,\n          stopCameraWhileMuted = true,\n          stopMicrophoneWhileMuted = true,\n          ...options\n        } = makeRoomOptions\n\n        // TODO: This might not be needed here. We can initiate these sagas in the BaseRoomSession constructor.\n        const customSagas: Array<CustomSaga<RoomSessionConnection>> = []\n\n        /**\n         * By default the SDK will attach the audio to\n         * an Audio element (regardless of \"rootElement\")\n         */\n        customSagas.push(\n          makeAudioElementSaga({\n            speakerId: options.speakerId,\n          })\n        )\n\n        /**\n         * If the user provides a `rootElement` we'll\n         * automatically handle the Video element for them\n         */\n        if (rootElement) {\n          customSagas.push(\n            makeVideoElementSaga({\n              rootElement,\n              applyLocalVideoOverlay,\n            })\n          )\n        }\n\n        const room = createBaseRoomSessionObject<RoomSessionType>({\n          ...options,\n          store: this.store,\n          customSagas,\n        })\n\n        /**\n         * If the user joins with `join_video_muted: true` or\n         * `join_audio_muted: true` we'll stop the streams\n         * right away.\n         */\n        room.on('room.subscribed', (params) => {\n          const member = params.room_session.members?.find(\n            (m) => m.id === room.memberId\n          )\n\n          if (member?.audio_muted) {\n            try {\n              room.stopOutboundAudio()\n            } catch (error) {\n              this.logger.error('Error handling audio_muted', error)\n            }\n          }\n\n          if (member?.video_muted) {\n            try {\n              room.stopOutboundVideo()\n            } catch (error) {\n              this.logger.error('Error handling video_muted', error)\n            }\n          }\n        })\n\n        /**\n         * Stop and Restore outbound audio on audio_muted event\n         */\n        if (stopMicrophoneWhileMuted) {\n          room.on('member.updated.audio_muted', ({ member }) => {\n            try {\n              if (member.id === room.memberId && 'audio_muted' in member) {\n                member.audio_muted\n                  ? room.stopOutboundAudio()\n                  : room.restoreOutboundAudio()\n              }\n            } catch (error) {\n              this.logger.error('Error handling audio_muted', error)\n            }\n          })\n        }\n\n        /**\n         * Stop and Restore outbound video on video_muted event\n         */\n        if (stopCameraWhileMuted) {\n          room.on('member.updated.video_muted', ({ member }) => {\n            try {\n              if (member.id === room.memberId && 'video_muted' in member) {\n                member.video_muted\n                  ? room.stopOutboundVideo()\n                  : room.restoreOutboundVideo()\n              }\n            } catch (error) {\n              this.logger.error('Error handling video_muted', error)\n            }\n          })\n        }\n\n        return room\n      },\n    }\n  }\n\n  get chat() {\n    if (!this._chat) {\n      this._chat = ChatNamespace.createBaseChatObject<ChatClient>({\n        store: this.store,\n      })\n    }\n    return this._chat\n  }\n\n  get pubSub() {\n    if (!this._pubSub) {\n      this._pubSub = PubSubNamespace.createBasePubSubObject<PubSubClient>({\n        store: this.store,\n      })\n    }\n    return this._pubSub\n  }\n\n  /** @internal */\n  get videoManager() {\n    if (!this._videoManager) {\n      this._videoManager = createVideoManagerObject(this.options)\n    }\n    return this._videoManager\n  }\n\n  /**\n   * Reauthenticate with the SignalWire network using a new token\n   * For now it returns void since with an invalid token the server\n   * will close the connection right away so we can hook on the session\n   * events in case. Need to improve it.\n   *\n   * @internal\n   */\n  reauthenticate(token: string) {\n    this.store.dispatch(actions.reauthAction({ token }))\n  }\n}\n","function e(e){this.message=e}e.prototype=new Error,e.prototype.name=\"InvalidCharacterError\";var r=\"undefined\"!=typeof window&&window.atob&&window.atob.bind(window)||function(r){var t=String(r).replace(/=+$/,\"\");if(t.length%4==1)throw new e(\"'atob' failed: The string to be decoded is not correctly encoded.\");for(var n,o,a=0,i=0,c=\"\";o=t.charAt(i++);~o&&(n=a%4?64*n+o:o,a++%4)?c+=String.fromCharCode(255&n>>(-2*a&6)):0)o=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\".indexOf(o);return c};function t(e){var t=e.replace(/-/g,\"+\").replace(/_/g,\"/\");switch(t.length%4){case 0:break;case 2:t+=\"==\";break;case 3:t+=\"=\";break;default:throw\"Illegal base64url string!\"}try{return function(e){return decodeURIComponent(r(e).replace(/(.)/g,(function(e,r){var t=r.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t=\"0\"+t),\"%\"+t})))}(t)}catch(e){return r(t)}}function n(e){this.message=e}function o(e,r){if(\"string\"!=typeof e)throw new n(\"Invalid token specified\");var o=!0===(r=r||{}).header?0:1;try{return JSON.parse(t(e.split(\".\")[o]))}catch(e){throw new n(\"Invalid token specified: \"+e.message)}}n.prototype=new Error,n.prototype.name=\"InvalidTokenError\";export default o;export{n as InvalidTokenError};\n//# sourceMappingURL=jwt-decode.esm.js.map\n","import jwtDecode from 'jwt-decode'\nimport { getLogger } from '@signalwire/core'\n\n/**\n * Note: ready to support RN with a \"storage.native.ts\" file.\n */\nexport const getStorage = () => {\n  if (window && window.sessionStorage) {\n    return window.sessionStorage\n  }\n  return undefined\n}\n\nexport const sessionStorageManager = (token: string) => {\n  let roomName: string = ''\n  try {\n    const jwtPayload = jwtDecode<{ r: string; ja: string }>(token)\n    roomName = jwtPayload?.r ?? ''\n  } catch (e) {\n    try {\n      const jwtPayload = jwtDecode<{ typ: string}>(token, {header: true})\n      roomName = jwtPayload.typ || ''\n    } catch {\n      if (process.env.NODE_ENV !== 'production') {\n        getLogger().error('[sessionStorageManager] error decoding JWT', token)\n      }\n      roomName = ''\n    }\n  }\n\n  const valid = Boolean(roomName)\n  return {\n    authStateKey: valid && `as-${roomName}`,\n    protocolKey: valid && `pt-${roomName}`,\n    callIdKey: valid && `ci-${roomName}`,\n  }\n}\n","import { SWCloseEvent as CoreCloseEvent } from '@signalwire/core'\n\nconst SwCloseEvent =\n  typeof CloseEvent === 'function' ? CloseEvent : CoreCloseEvent\n\nexport { SwCloseEvent }\n","import jwtDecode from 'jwt-decode'\nimport {\n  BaseJWTSession,\n  getLogger,\n  SessionOptions,\n  SwAuthorizationState,\n  type SWCloseEvent,\n} from '@signalwire/core'\nimport { getStorage, sessionStorageManager } from './utils/storage'\nimport { SwCloseEvent } from './utils/CloseEvent'\n\ntype JWTHeader = { ch?: string; typ?: string }\n\nexport class JWTSession extends BaseJWTSession {\n  public WebSocketConstructor = WebSocket\n  public CloseEventConstructor = SwCloseEvent\n  public agent = process.env.SDK_PKG_AGENT!\n\n  private tokenTyp: string\n\n  constructor(public options: SessionOptions) {\n    let decodedJwt: JWTHeader = {}\n    try {\n      decodedJwt = jwtDecode<{ ch?: string; typ: string }>(options.token, {\n        header: true,\n      })\n    } catch (e) {\n      if (process.env.NODE_ENV !== 'production') {\n        getLogger().debug('[JWTSession] error decoding the JWT')\n      }\n    }\n\n    super({\n      ...options,\n      host: decodedJwt?.ch || options.host,\n    })\n    this.tokenTyp = decodedJwt.typ ?? 'VRT'\n  }\n\n  get allowReattach() {\n    // @ts-expect-error\n    return this.options?.reattach !== false && (this.isVRT() || this.isSAT())\n  }\n\n  override async retrieveRelayProtocol() {\n    if (!this.allowReattach) {\n      return ''\n    }\n\n    const { protocolKey } = sessionStorageManager(this.options.token)\n    if (protocolKey) {\n      this.logger.trace('Search protocol for', protocolKey)\n      return getStorage()?.getItem(protocolKey) ?? ''\n    }\n    return ''\n  }\n\n  override async persistRelayProtocol() {\n    if (!this.allowReattach) {\n      return\n    }\n\n    const { protocolKey } = sessionStorageManager(this.options.token)\n    if (protocolKey) {\n      this.logger.trace('Persist protocol', protocolKey, this.relayProtocol)\n      getStorage()?.setItem(protocolKey, this.relayProtocol)\n    }\n  }\n\n  protected override async retrieveSwAuthorizationState() {\n    const { authStateKey } = sessionStorageManager(this.options.token)\n    if (authStateKey) {\n      return getStorage()?.getItem(authStateKey) ?? ''\n    }\n    return ''\n  }\n\n  protected override async persistSwAuthorizationState(\n    state: SwAuthorizationState\n  ) {\n    if (!this.allowReattach) {\n      return\n    }\n\n    const { authStateKey } = sessionStorageManager(this.options.token)\n    if (authStateKey) {\n      this.logger.trace('Persist auth state', authStateKey, state)\n      getStorage()?.setItem(authStateKey, state)\n    }\n  }\n\n  protected override _onSocketClose(event: SWCloseEvent) {\n    if (this.status === 'unknown') {\n      const { protocolKey, authStateKey, callIdKey } = sessionStorageManager(\n        this.options.token\n      )\n      this.logger.debug('Cleaning up storage')\n      if (protocolKey) {\n        this.logger.debug('Remove protocolKey', protocolKey)\n        getStorage()?.removeItem(protocolKey)\n      }\n      if (authStateKey) {\n        this.logger.debug('Remove authStateKey', authStateKey)\n        getStorage()?.removeItem(authStateKey)\n      }\n      if (callIdKey) {\n        this.logger.debug('Remove callIdKey', callIdKey)\n        getStorage()?.removeItem(callIdKey)\n      }\n    }\n\n    super._onSocketClose(event)\n  }\n\n  private isVRT() {\n    return this.tokenTyp === 'VRT'\n  }\n\n  private isSAT() {\n    return this.tokenTyp === 'SAT'\n  }\n}\n","import {\n  ClientEvents,\n  configureStore,\n  connect,\n  getEventEmitter,\n  UserOptions,\n} from '@signalwire/core'\nimport { ClientAPI, Client } from './Client'\nimport { JWTSession } from './JWTSession'\n\n/**\n * With Video.createClient() you can establish a WebSocket connection\n * with SignalWire and interact with the client.\n *\n * ## Examples\n * Create a client\n *\n * @example\n * ```js\n * try {\n *   const client = Video.createClient({\n *     token: '<YourJWT>',\n *   })\n *\n *   await client.connect()\n *   // Your client is ready now..\n * } catch (error) {\n *   console.error('Error', error)\n * }\n * ```\n * @internal\n */\nexport const createClient = <RoomSessionType>(userOptions: UserOptions) => {\n  const baseUserOptions = {\n    ...userOptions,\n    emitter: getEventEmitter<ClientEvents>(),\n  }\n  const store = configureStore({\n    userOptions: baseUserOptions,\n    SessionConstructor: JWTSession,\n  })\n  const client = connect<\n    ClientEvents,\n    ClientAPI<RoomSessionType>,\n    Client<RoomSessionType>\n  >({\n    store,\n    Component: ClientAPI,\n  })(baseUserOptions)\n\n  return client\n}\n","import type {\n  ChatContract,\n  ConsumerContract,\n  UserOptions,\n  Chat as ChatNamespace,\n} from '@signalwire/core'\nimport { createClient } from '../createClient'\n\nexport interface ClientApiEvents extends ChatNamespace.BaseChatApiEvents {}\n\n/** @ignore */\nexport interface ClientFullState extends Client {}\nexport interface Client\n  extends ChatContract,\n    Omit<ConsumerContract<ClientApiEvents, ClientFullState>, 'subscribe'> {}\n\n/** @ignore */\nexport interface ClientOptions extends UserOptions {}\n\ntype ClientMethods = keyof Client\nconst INTERCEPTED_METHODS: ClientMethods[] = [\n  'subscribe',\n  'publish',\n  'getMessages',\n  'getMembers',\n  'getMemberState',\n  'getAllowedChannels',\n  'setMemberState',\n]\n\n/**\n * You can use the Client object to build a messaging system into the browser.\n *\n * Example usage:\n *\n * ```js\n * import { Chat } from '@signalwire/js'\n *\n * const chatClient = new Chat.Client({\n *   token: '<your_chat_token>',  // get this from the REST APIs\n * })\n *\n * await chatClient.subscribe([ 'mychannel1', 'mychannel2' ])\n *\n * chatClient.on('message', (message) => {\n *   console.log(\"Received\", message.content,\n *               \"on\", message.channel,\n *               \"at\", message.publishedAt)\n * })\n *\n * await chatClient.publish({\n *   channel: 'mychannel1',\n *   content: 'hello world'\n * })\n * ```\n *\n * ## Events\n *\n * Please see {@link ClientApiEvents} for the list of events emitted by a chat\n * Client object.\n */\nexport const Client = function (chatOptions: ClientOptions) {\n  const client = createClient<Client>(chatOptions)\n\n  const createInterceptor = <K extends keyof Client>(prop: K) => {\n    return async (...params: Parameters<Client[K]>) => {\n      await client.connect()\n\n      // @ts-expect-error\n      return client.chat[prop](...params)\n    }\n  }\n\n  const interceptors = {\n    _session: client,\n    disconnect: () => client.disconnect(),\n  } as const\n\n  return new Proxy<Client>(client.chat, {\n    get(target: Client, prop: keyof Client, receiver: any) {\n      if (prop in interceptors) {\n        // @ts-expect-error\n        return interceptors[prop]\n      }\n\n      if (INTERCEPTED_METHODS.includes(prop)) {\n        return createInterceptor(prop)\n      }\n\n      return Reflect.get(target, prop, receiver)\n    },\n  })\n  // For consistency with other constructors we'll make TS force the use of `new`\n} as unknown as { new (chatOptions: ClientOptions): Client }\n","import type {\n  PubSubContract,\n  ConsumerContract,\n  UserOptions,\n  PubSub as PubSubNamespace,\n} from '@signalwire/core'\nimport { createClient } from '../createClient'\n\nexport interface ClientApiEvents extends PubSubNamespace.BasePubSubApiEvents {}\n\n/** @ignore */\nexport interface ClientFullState extends Client {}\nexport interface Client\n  extends PubSubContract,\n    Omit<ConsumerContract<ClientApiEvents, ClientFullState>, 'subscribe'> {}\n\n/** @ignore */\nexport interface ClientOptions extends UserOptions {}\n\ntype ClientMethods = keyof Client\nconst INTERCEPTED_METHODS: ClientMethods[] = [\n  'getAllowedChannels',\n  'subscribe',\n  'publish',\n]\n\n/**\n * You can use the Client object to build a messaging system into the browser.\n *\n * Example usage:\n *\n * ```js\n * import { PubSub } from '@signalwire/js'\n *\n * const pubSubClient = new PubSub.Client({\n *   token: '<your pubSub token>', // get this from the REST APIs\n * })\n *\n * await pubSubClient.subscribe([ 'mychannel1', 'mychannel2' ])\n *\n * pubSubClient.on('message', (message) => {\n *   console.log(\"Received\", message.content,\n *               \"on\", message.channel,\n *               \"at\", message.publishedAt)\n * })\n *\n * await pubSubClient.publish({\n *   channel: 'mychannel1',\n *   content: 'hello world'\n * })\n * ```\n *\n * ## Events\n *\n * Please see {@link ClientApiEvents} for the list of events emitted by a pubSub\n * Client object.\n */\nexport const Client = function (pubSubOptions: ClientOptions) {\n  const client = createClient<Client>(pubSubOptions)\n\n  const createInterceptor = <K extends keyof Client>(prop: K) => {\n    return async (...params: Parameters<Client[K]>) => {\n      await client.connect()\n\n      // @ts-expect-error\n      return client.pubSub[prop](...params)\n    }\n  }\n\n  const interceptors = {\n    _session: client,\n    disconnect: () => client.disconnect(),\n  } as const\n\n  return new Proxy<Client>(client.pubSub, {\n    get(target: Client, prop: keyof Client, receiver: any) {\n      if (prop in interceptors) {\n        // @ts-expect-error\n        return interceptors[prop]\n      }\n\n      if (INTERCEPTED_METHODS.includes(prop)) {\n        return createInterceptor(prop)\n      }\n\n      return Reflect.get(target, prop, receiver)\n    },\n  })\n  // For consistency with other constructors we'll make TS force the use of `new`\n} as unknown as { new (pubSubOptions: ClientOptions): Client }\n","import { PubSub } from '@signalwire/core'\nimport { PagingCursor } from '../utils/interfaces'\nimport PubSubMessage = PubSub.PubSubMessage\n\nexport * from './Client'\n\nexport {\n  PubSubMessage,\n  PagingCursor\n}\n","import {\n  getLogger,\n  sagaEffects,\n  SagaIterator,\n  SDKWorker,\n  SDKActions,\n  MapToPubSubShape,\n  SDKWorkerHooks,\n  WebRTCMessageParams,\n} from '@signalwire/core'\nimport type { BaseConnection } from '@signalwire/webrtc'\nimport { createClient } from '../../createClient'\n\ntype WSClientWorkerOnDone = () => void\ntype WSClientWorkerOnFail = (args: { error: Error }) => void\n\nexport type WSClientWorkerHooks = SDKWorkerHooks<\n  WSClientWorkerOnDone,\n  WSClientWorkerOnFail\n>\n\nexport const wsClientWorker: SDKWorker<\n  ReturnType<typeof createClient<BaseConnection<any>>>,\n  WSClientWorkerHooks\n> = function* (options): SagaIterator {\n  getLogger().trace('wsClientWorker started')\n  const { channels, initialState } = options\n  const { swEventChannel } = channels\n  const { buildInboundCall } = initialState\n\n  while (true) {\n    const action: MapToPubSubShape<WebRTCMessageParams> =\n      yield sagaEffects.take(swEventChannel, (action: SDKActions) => {\n        if (action.type === 'webrtc.message') {\n          return action.payload.method === 'verto.invite'\n        }\n        return false\n      })\n    getLogger().debug('Receiving a new call over WebSocket', action)\n\n    // Invoke WSClient function to build and answer the invite\n    buildInboundCall(action.payload.params)\n  }\n\n  getLogger().trace('wsClientWorker ended')\n}\n","import {\n  getLogger,\n  sagaEffects,\n  SagaIterator,\n  SDKWorker,\n  SDKActions,\n  MapToPubSubShape,\n  ConversationEvent,\n} from '@signalwire/core'\nimport { Conversation } from '../Conversation'\nimport { WSClient } from '../WSClient'\n\ninterface ConversationWorkerInitialState {\n  conversation: Conversation\n}\n\nexport const conversationWorker: SDKWorker<WSClient> = function* (\n  options\n): SagaIterator {\n  getLogger().debug('conversationWorker started')\n  const {\n    channels: { swEventChannel },\n    initialState,\n  } = options\n\n  const { conversation } = initialState as ConversationWorkerInitialState\n\n  const isConversationEvent = (action: SDKActions) => {\n    return action.type === 'conversation.message'\n  }\n\n  while (true) {\n    const action: MapToPubSubShape<ConversationEvent> = yield sagaEffects.take(\n      swEventChannel,\n      isConversationEvent\n    )\n    conversation.handleEvent(action.payload)\n  }\n\n  getLogger().trace('conversationWorker ended')\n}\n","import {\n  getLogger,\n  SagaIterator,\n  MapToPubSubShape,\n  CallLeftEvent,\n  RoomSessionMember,\n  Rooms,\n} from '@signalwire/core'\nimport { CallFabricWorkerParams } from './callFabricWorker'\n\nexport const callLeftWorker = function* (\n  options: CallFabricWorkerParams<MapToPubSubShape<CallLeftEvent>>\n): SagaIterator {\n  getLogger().trace('callLeftWorker started')\n\n  const {\n    action: { payload },\n    instance: cfRoomSession,\n    instanceMap,\n  } = options\n\n  const { room_session_id } = payload\n\n  // Remove all the member instance where roomSessionId matches\n  instanceMap.getAll<RoomSessionMember>().forEach(([key, obj]) => {\n    if (\n      obj instanceof Rooms.RoomSessionMemberAPI &&\n      obj.roomSessionId === room_session_id\n    ) {\n      instanceMap.remove(key)\n    }\n  })\n\n  // @ts-expect-error\n  cfRoomSession.emit('call.left', payload)\n\n  getLogger().trace('callLeftWorker ended')\n}\n","import {\n  getLogger,\n  SagaIterator,\n  MapToPubSubShape,\n  CallJoinedEvent,\n  sagaEffects,\n  RoomSessionMember,\n  Rooms,\n  MemberPosition,\n  InternalMemberUpdatedEventNames,\n} from '@signalwire/core'\nimport { CallFabricWorkerParams } from './callFabricWorker'\nimport { videoMemberWorker } from '../../video/videoMemberWorker'\n\nexport const callJoinWorker = function* (\n  options: CallFabricWorkerParams<MapToPubSubShape<CallJoinedEvent>>\n): SagaIterator {\n  getLogger().trace('callJoinWorker started')\n  const { action, instanceMap, instance: cfRoomSession } = options\n  const { payload } = action\n  const { get, set } = instanceMap\n\n  payload.room_session.members?.forEach((member: any) => {\n    let memberInstance = get<RoomSessionMember>(member.member_id!)\n    if (!memberInstance) {\n      memberInstance = Rooms.createRoomSessionMemberObject({\n        store: cfRoomSession.store,\n        payload: {\n          room_id: payload.room_id,\n          room_session_id: payload.room_session_id,\n          member,\n        },\n      })\n    } else {\n      memberInstance.setPayload({\n        room_id: payload.room_id,\n        room_session_id: payload.room_session_id,\n        member: member,\n      })\n    }\n    set<RoomSessionMember>(member.member_id, memberInstance)\n  })\n\n  cfRoomSession.member = get<RoomSessionMember>(payload.member_id)\n\n  cfRoomSession.runWorker('memberPositionWorker', {\n    worker: MemberPosition.memberPositionWorker,\n    ...options,\n    // @ts-expect-error\n    instance: cfRoomSession,\n    initialState: payload,\n    dispatcher: function* (\n      subType: InternalMemberUpdatedEventNames,\n      // @ts-expect-error\n      subPayload\n    ) {\n      yield sagaEffects.fork(videoMemberWorker, {\n        ...options,\n        action: { type: subType, payload: subPayload },\n      })\n    },\n  })\n\n\n  // @ts-expect-error\n  cfRoomSession.emit('call.joined', payload)\n\n  getLogger().trace('callJoinWorker ended')\n}\n","import {\n  CallFabricAction,\n  SDKWorker,\n  SagaIterator,\n  VideoMemberEventNames,\n  VideoRoomSessionEventNames,\n  getLogger,\n  sagaEffects,\n} from '@signalwire/core'\nimport { callLeftWorker } from './callLeftWorker'\nimport { callJoinWorker } from './callJoinWorker'\nimport { CallFabricRoomSessionConnection } from '../CallFabricRoomSession'\nimport { videoMemberWorker } from '../../video/videoMemberWorker'\n\nexport const callSegmentWorker: SDKWorker<CallFabricRoomSessionConnection> =\n  function* (options): SagaIterator {\n    const {\n      initialState: bootstrapAction,\n      channels: { swEventChannel },\n      instance: cfRoomSession,\n    } = options\n\n    const segmentRoutingRoomSessionId = bootstrapAction.payload.room_session_id\n    const segmentRoutingCallId = bootstrapAction.payload.call_id\n\n    getLogger().debug(\n      `callSegmentWorker started for: callId ${segmentRoutingCallId} roomSessionId segmentRoutingRoomSessionId`\n    )\n\n    //handles the `call.joined` event before the worker loop\n    yield sagaEffects.fork(callJoinWorker, {\n      ...options,\n      action: bootstrapAction,\n    })\n\n    const isSegmentEvent = (action: CallFabricAction) => {\n      const shouldWatch = () =>\n        action.type.startsWith('call.') ||\n        action.type.startsWith('member.') ||\n        action.type.startsWith('layout.')\n\n      return (\n        shouldWatch() &&\n        (segmentRoutingRoomSessionId === action.payload.room_session_id ||\n          segmentRoutingCallId === action.payload.call_id)\n      )\n    }\n\n    while (true) {\n      // @ts-expect-error swEventChannel created in core is unware CallFabric types\n      const action = yield sagaEffects.take(swEventChannel, isSegmentEvent)\n\n      const { type, payload } = action\n\n      switch (type) {\n        case 'call.joined':\n          getLogger().warn('got a repeated call.joined event', action)\n          break\n        case 'call.left':\n          yield sagaEffects.fork(callLeftWorker, {\n            ...options,\n            action,\n          })\n          break\n        case 'call.started':\n        case 'call.updated':\n        case 'call.ended':\n          const suffix = type.split('.')[1]\n          const newEventName = `room.${suffix}` as VideoRoomSessionEventNames\n          cfRoomSession.emit(newEventName, payload)\n          cfRoomSession.emit(type, payload)\n          break\n\n        case 'member.joined':\n        case 'member.left':\n        case 'member.updated':\n        case 'member.talking':\n          {\n            const updatedAction = {\n              ...action,\n              payload: {\n                ...action.payload,\n                id: action.payload.member_id,\n              },\n              type: `video.${type}` as VideoMemberEventNames,\n            }\n\n            yield sagaEffects.fork(videoMemberWorker, {\n              action: updatedAction,\n              ...options,\n            })\n\n            yield sagaEffects.put(swEventChannel, updatedAction)\n          }\n          break\n        case 'layout.changed':\n          {\n            // Upsert the layout event which is needed for rootElement\n            cfRoomSession.lastLayoutEvent = action.payload\n            const updatedAction = {\n              ...action,\n              type: `video.${type}` as 'video.layout.changed',\n            }\n            // TODO stop send layout events to legacy workers\n            yield sagaEffects.put(swEventChannel, updatedAction)\n            cfRoomSession.emit(type, payload)\n          }\n          break\n        case 'member.demoted':\n        case 'member.promoted':\n          getLogger().warn('promoted/demoted events not supported')\n          cfRoomSession.emit(type, payload)\n          break\n        default:\n          cfRoomSession.emit(type, payload)\n      }\n    }\n  }\n","import {\n  SDKWorker,\n  SagaIterator,\n  getLogger,\n  sagaEffects,\n  SDKWorkerParams,\n  Rooms,\n  SDKActions,\n  CallFabricAction,\n} from '@signalwire/core'\nimport { CallFabricRoomSessionConnection } from '../CallFabricRoomSession'\nimport { callSegmentWorker } from './callSegmentWorker'\n\nexport type CallFabricWorkerParams<T> =\n  SDKWorkerParams<CallFabricRoomSessionConnection> & {\n    action: T\n  }\n\nexport const callFabricWorker: SDKWorker<CallFabricRoomSessionConnection> =\n  function* (options): SagaIterator {\n    getLogger().trace('callFabricWorker started')\n\n    const {\n      channels: { swEventChannel },\n      instance: cfRoomSessionConnection,\n    } = options\n\n    const isCallJoinedOrCallStateEvent = (action: SDKActions) => {\n      const cfAction = action as CallFabricAction\n\n      // We should only start to handling call.joined events after\n      // we receive the 1st call.joined event where eventRoutingId === action.origin_call_id\n      const segmentRoutingRoomSessionId = cfAction.payload.room_session_id \n      const segmentRoutingCallId = cfAction.payload.call_id\n      const originCallId = cfAction.payload.origin_call_id\n      const isCallJoinedEvent = cfAction.type === 'call.joined'\n      const discardEventsDone = !!cfRoomSessionConnection.selfMember\n      const isCallStateEvent = cfAction.type === 'call.state'\n\n      return (\n        // FIXME call.state events are not beeing fired after the call.joined as expected\n        isCallStateEvent ||\n        (isCallJoinedEvent &&\n          (discardEventsDone ||\n            (segmentRoutingRoomSessionId === originCallId || segmentRoutingCallId === originCallId)))\n      )\n    }\n\n    while (true) {\n      \n      const action = yield sagaEffects.take(\n        swEventChannel,\n        isCallJoinedOrCallStateEvent\n      )\n      const { type, payload } = action\n      switch (type) {\n        case 'call.joined':\n\n          // since we depend on `cfRoomSessionConnection.selfMember` on the take logic\n          // we need to make sure we update the `cfRoomSessionConnection.selfMember`\n          // in this worker or have a race condition.\n          if (!cfRoomSessionConnection.selfMember) {\n            const memberInstance = Rooms.createRoomSessionMemberObject({\n              store: cfRoomSessionConnection.store,\n              payload: {\n                room_id: action.payload.room_id,\n                room_session_id: action.payload.room_session_id,\n                member: action.payload.room_session.members.find(\n                  (m: { member_id: string }) =>\n                    m.member_id === action.payload.member_id\n                ),\n              },\n            })\n            cfRoomSessionConnection.selfMember = memberInstance\n          }\n          cfRoomSessionConnection.runWorker('callSegmentWorker', {\n            worker: callSegmentWorker,\n            ...options,\n            initialState: action,\n          })\n          break\n        case 'call.state':\n          cfRoomSessionConnection.emit(type, payload)\n          break\n      }\n    }\n  }\n","import { CallFabricRoomSession } from './CallFabricRoomSession'\nimport {\n  CallParams,\n  IncomingCallHandlers,\n  IncomingCallNotification,\n  IncomingInvite,\n} from './types'\n\nexport class IncomingCallManager {\n  private _pendingInvites: Record<string, IncomingInvite> = {}\n  private _handlers: IncomingCallHandlers = {}\n\n  constructor(\n    private _buildCallObject: (\n      invite: IncomingInvite,\n      params: CallParams\n    ) => CallFabricRoomSession,\n    private _executeReject: (callId: string, nodeId: string) => Promise<void>\n  ) {}\n\n  private _buildNotification(invite: IncomingInvite): IncomingCallNotification {\n    const accept = async (params: CallParams) => {\n      return new Promise<CallFabricRoomSession>((resolve, reject) => {\n        delete this._pendingInvites[invite.callID]\n        try {\n          const call = this._buildCallObject(invite, params)\n          call.answer()\n\n          resolve(call)\n        } catch (e) {\n          reject(e)\n        }\n      })\n    }\n\n    const reject = () => {\n      delete this._pendingInvites[invite.callID]\n      return this._executeReject(invite.callID, invite.nodeId)\n    }\n\n    return {\n      invite: {\n        details: invite,\n        accept: (params) => accept(params),\n        reject: () => reject(),\n      },\n    }\n  }\n\n  setNotificationHandlers(handlers: IncomingCallHandlers) {\n    this._handlers.all = handlers.all\n    if (\n      (handlers.pushNotification &&\n        this._handlers.all != handlers.pushNotification) ||\n      !handlers.pushNotification\n    ) {\n      this._handlers.pushNotification = handlers.pushNotification\n    }\n    if (\n      (handlers.websocket && this._handlers.all != handlers.websocket) ||\n      !handlers.websocket\n    ) {\n      this._handlers.websocket = handlers.websocket\n    }\n  }\n\n  handleIncomingInvite(incomingInvite: IncomingInvite) {\n    if (incomingInvite.callID in this._pendingInvites) {\n      console.log(\n        `skiping nottification for pending invite to callID: ${incomingInvite.callID}`\n      )\n      return\n    }\n    this._pendingInvites[incomingInvite.callID] = incomingInvite\n\n    if (!(this._handlers.all || this._handlers[incomingInvite.source])) {\n      console.log('skiping nottification no listeners:')\n      return\n    }\n\n    const notification = this._buildNotification(incomingInvite)\n\n    this._handlers.all?.(notification)\n    const handler = this._handlers[incomingInvite.source]\n    handler?.(notification)\n  }\n}\n","import {\n  RPCReauthenticate,\n  RPCReauthenticateParams,\n  SATAuthorization,\n  SessionOptions,\n  UNIFIED_CONNECT_VERSION,\n} from '@signalwire/core'\nimport { JWTSession } from '../JWTSession'\n\nexport class SATSession extends JWTSession {\n  public connectVersion = UNIFIED_CONNECT_VERSION\n\n  constructor(public options: SessionOptions) {\n    super(options)\n  }\n\n  override get signature() {\n    if (this._rpcConnectResult) {\n      const { authorization } = this._rpcConnectResult\n      return (authorization as SATAuthorization).jti\n    }\n    return undefined\n  }\n\n  override async _checkTokenExpiration() {\n    // no-op\n  }\n\n  /**\n   * Reauthenticate with the SignalWire Network\n   * using a newer SAT. If the session has expired\n   * will reconnect it.\n   * @return Promise<void>\n   */\n  override async reauthenticate() {\n    this.logger.debug('Session Reauthenticate', {\n      ready: this.ready,\n      expired: this.expired,\n    })\n    if (!this.ready || this.expired) {\n      return this.connect()\n    }\n\n    const params: RPCReauthenticateParams = {\n      project: this._rpcConnectResult.authorization.project_id,\n      jwt_token: this.options.token,\n    }\n\n    try {\n      const reauthResponse = await this.execute(RPCReauthenticate(params))\n\n      this._rpcConnectResult = {\n        ...this._rpcConnectResult,\n        ...reauthResponse,\n      }\n    } catch (error) {\n      throw error\n    }\n  }\n}\n","export const PREVIOUS_CALLID_STORAGE_KEY = 'ci-SAT';","import {\n  BaseComponentOptions,\n  BaseRPCResult,\n  connect,\n  ExecuteExtendedOptions,\n  JSONRPCMethod,\n  VideoMemberEntity,\n  Rooms,\n  VideoRoomSubscribedEventParams,\n  RoomSessionMember,\n  getLogger,\n  VideoLayoutChangedEvent,\n} from '@signalwire/core'\nimport {\n  BaseRoomSession,\n  RoomSessionConnection,\n  RoomSessionObjectEventsHandlerMapping,\n} from '../BaseRoomSession'\nimport { callFabricWorker } from './workers'\nimport {\n  MemberCommandWithVolumeParams,\n  MemberCommandWithValueParams,\n} from '../video'\nimport { getStorage } from '../utils/storage'\nimport { PREVIOUS_CALLID_STORAGE_KEY } from './utils/constants'\nimport { CallFabricRoomSessionConnectionContract } from '../utils/interfaces'\n\ninterface ExecuteActionParams {\n  method: JSONRPCMethod\n  extraParams?: Record<string, any>\n}\n\ninterface ExecuteMemberActionParams extends ExecuteActionParams {\n  channel?: 'audio' | 'video'\n  memberId?: string\n}\n\ntype CallFabricBaseRoomSession = Omit<\n  BaseRoomSession<CallFabricRoomSession>,\n  'join'\n>\n\nexport interface CallFabricRoomSession\n  extends CallFabricRoomSessionConnectionContract,\n    CallFabricBaseRoomSession {}\n\nexport class CallFabricRoomSessionConnection extends RoomSessionConnection {\n  // this is \"self\" parameter required by the RPC, and is always \"the member\" on the 1st call segment\n  private _self?: RoomSessionMember\n  // this is \"the member\" on the last/active call segment\n  private _member?: RoomSessionMember\n  private _lastLayoutEvent: VideoLayoutChangedEvent\n\n  override async hangup(id?: string): Promise<void> {\n    this._self = undefined\n    this._member = undefined\n    const result = await super.hangup(id)\n    return result\n  }\n\n  get selfMember(): RoomSessionMember | undefined {\n    return this._self\n  }\n\n  set selfMember(member: RoomSessionMember | undefined) {\n    this._self = member\n  }\n\n  set member(member: RoomSessionMember) {\n    this._member = member\n  }\n\n  get member(): RoomSessionMember {\n    return this._member!\n  }\n\n  override get memberId() {\n    return this._member?.memberId\n  }\n\n  set lastLayoutEvent(event: VideoLayoutChangedEvent) {\n    this._lastLayoutEvent = event\n  }\n\n  get lastLayoutEvent() {\n    return this._lastLayoutEvent\n  }\n\n  get currentLayout() {\n    return this._lastLayoutEvent?.params.layout\n  }\n\n  private executeAction<\n    InputType,\n    OutputType = InputType,\n    ParamsType extends Rooms.RoomMemberMethodParams = Rooms.RoomMemberMethodParams\n  >(\n    params: ExecuteMemberActionParams,\n    options: ExecuteExtendedOptions<InputType, OutputType, ParamsType> = {}\n  ) {\n    const { method, channel, memberId, extraParams = {} } = params\n\n    const targetMember = memberId\n      ? this.instanceMap.get<RoomSessionMember>(memberId)\n      : this.member\n    if (!targetMember) throw new Error('No target param found to execute')\n\n    return this.execute<InputType, OutputType, ParamsType>(\n      {\n        method,\n        params: {\n          ...(channel && { channels: [channel] }),\n          self: {\n            member_id: this.selfMember?.id,\n            call_id: this.selfMember?.callId,\n            node_id: this.selfMember?.nodeId,\n          },\n          target: {\n            member_id: targetMember.id,\n            call_id: targetMember.callId,\n            node_id: targetMember.nodeId,\n          },\n          ...extraParams,\n        },\n      },\n      options\n    )\n  }\n\n  protected override initWorker() {\n    /**\n     * The unified eventing or CallFabric worker creates/stores member instances in the instance map\n     * For now, the member instances are only required in the CallFabric SDK.\n     */\n    this.runWorker('callFabricWorker', {\n      worker: callFabricWorker,\n    })\n  }\n\n  public async start() {\n    return new Promise<void>(async (resolve, reject) => {\n      try {\n        this.once(\n          'room.subscribed',\n          ({ call_id }: VideoRoomSubscribedEventParams) => {\n            getStorage()?.setItem(PREVIOUS_CALLID_STORAGE_KEY, call_id)\n            resolve()\n          }\n        )\n\n        this.once('destroy', () => {\n          getStorage()?.removeItem(PREVIOUS_CALLID_STORAGE_KEY)\n        })\n\n        await this.join()\n      } catch (error) {\n        this.logger.error('WSClient call start', error)\n        reject(error)\n      }\n    })\n  }\n\n  override async join() {\n    if (this.options.attach) {\n      this.options.prevCallId =\n        getStorage()?.getItem(PREVIOUS_CALLID_STORAGE_KEY) ?? undefined\n    }\n    getLogger().debug(\n      `Tying to reattach to previuos call? ${!!this.options\n        .prevCallId} - prevCallId: ${this.options.prevCallId}`\n    )\n\n    return super.join()\n  }\n\n  /** @internal */\n  public override async resume() {\n    this.logger.warn(`[resume] Call ${this.id}`)\n    if (this.peer?.instance) {\n      const { connectionState } = this.peer.instance\n      this.logger.debug(\n        `[resume] connectionState for ${this.id} is '${connectionState}'`\n      )\n      if (['closed', 'failed', 'disconnected'].includes(connectionState)) {\n        this.resuming = true\n        this.peer.restartIce()\n      }\n    }\n  }\n\n  public audioMute(params: Rooms.RoomMemberMethodParams) {\n    return this.executeAction<BaseRPCResult>({\n      method: 'call.mute',\n      channel: 'audio',\n      memberId: params?.memberId,\n    })\n  }\n\n  public audioUnmute(params: Rooms.RoomMemberMethodParams) {\n    return this.executeAction<BaseRPCResult>({\n      method: 'call.unmute',\n      channel: 'audio',\n      memberId: params?.memberId,\n    })\n  }\n\n  public videoMute(params: Rooms.RoomMemberMethodParams) {\n    return this.executeAction<BaseRPCResult>({\n      method: 'call.mute',\n      channel: 'video',\n      memberId: params?.memberId,\n    })\n  }\n\n  public videoUnmute(params: Rooms.RoomMemberMethodParams) {\n    return this.executeAction<BaseRPCResult>({\n      method: 'call.unmute',\n      channel: 'video',\n      memberId: params?.memberId,\n    })\n  }\n\n  public deaf(params: Rooms.RoomMemberMethodParams) {\n    return this.executeAction<BaseRPCResult>({\n      method: 'call.deaf',\n      memberId: params?.memberId,\n    })\n  }\n\n  public undeaf(params: Rooms.RoomMemberMethodParams) {\n    return this.executeAction<BaseRPCResult>({\n      method: 'call.undeaf',\n      memberId: params?.memberId,\n    })\n  }\n\n  public getLayouts() {\n    return this.executeAction<{ layouts: string[] }>(\n      {\n        method: 'call.layout.list',\n      },\n      {\n        transformResolve: (payload) => ({\n          layouts: payload.layouts,\n        }),\n      }\n    )\n  }\n\n  public getMembers() {\n    return this.executeAction<{ members: VideoMemberEntity[] }>(\n      {\n        method: 'call.member.list',\n      },\n      {\n        transformResolve: (payload) => ({\n          members: payload.members,\n        }),\n      }\n    )\n  }\n\n  public removeMember(params: Required<Rooms.RoomMemberMethodParams>) {\n    if (!params?.memberId) {\n      throw new TypeError('Invalid or missing \"memberId\" argument')\n    }\n    return this.executeAction<BaseRPCResult>({\n      method: 'call.member.remove',\n      memberId: params.memberId,\n    })\n  }\n\n  public setRaisedHand(params?: Rooms.SetRaisedHandRoomParams) {\n    const { raised = true, memberId } = params || {}\n    return this.executeAction<BaseRPCResult>({\n      method: raised ? 'call.raisehand' : 'call.lowerhand',\n      memberId,\n    })\n  }\n\n  public setLayout(params: Rooms.SetLayoutParams) {\n    const extraParams = {\n      layout: params.name,\n      positions: params.positions,\n    }\n    return this.executeAction<BaseRPCResult>({\n      method: 'call.layout.set',\n      extraParams,\n    })\n  }\n\n  public setInputVolume(params: MemberCommandWithVolumeParams) {\n    return this.executeAction<BaseRPCResult>({\n      method: 'call.microphone.volume.set',\n      memberId: params?.memberId,\n      extraParams: {\n        volume: params?.volume,\n      },\n    })\n  }\n\n  public setOutputVolume(params: MemberCommandWithVolumeParams) {\n    return this.executeAction<BaseRPCResult>({\n      method: 'video.member.set_output_volume',\n      memberId: params?.memberId,\n      extraParams: {\n        volume: params?.volume,\n      },\n    })\n  }\n\n  public setInputSensitivity(params: MemberCommandWithValueParams) {\n    return this.executeAction<BaseRPCResult>({\n      method: 'call.microphone.sensitivity.set',\n      memberId: params?.memberId,\n      extraParams: {\n        value: params?.value,\n      },\n    })\n  }\n\n  public lock() {\n    return this.executeAction<BaseRPCResult>({\n      method: 'call.lock',\n    })\n  }\n\n  public unlock() {\n    return this.executeAction<BaseRPCResult>({\n      method: 'call.unlock',\n    })\n  }\n}\n\nexport const createCallFabricRoomSessionObject = (\n  params: BaseComponentOptions\n): CallFabricRoomSession => {\n  const room = connect<\n    RoomSessionObjectEventsHandlerMapping,\n    CallFabricRoomSessionConnection,\n    CallFabricRoomSession\n  >({\n    store: params.store,\n    customSagas: params.customSagas,\n    Component: CallFabricRoomSessionConnection,\n  })(params)\n\n  return room\n}\n","import {\n  InternalVideoLayout,\n  LOCAL_EVENT_PREFIX,\n  getLogger,\n  uuid,\n} from '@signalwire/core'\nimport { CallFabricRoomSession } from './CallFabricRoomSession'\nimport {\n  LocalOverlay,\n  addSDKPrefix,\n  buildVideo,\n  cleanupElement,\n  makeLayoutChangedHandler,\n  setVideoMediaTrack,\n  waitForVideoReady,\n} from '../utils/videoElement'\nimport { DeprecatedVideoMemberHandlerParams } from '../video'\n\nexport interface BuildVideoElementParams {\n  room: CallFabricRoomSession\n  rootElement?: HTMLElement\n  applyLocalVideoOverlay?: boolean\n}\n\nexport interface BuildVideoElementReturnType {\n  element: HTMLElement\n  unsubscribe(): void\n}\n\nconst VIDEO_SIZING_EVENTS = ['loadedmetadata', 'resize']\n\nexport const buildVideoElement = async (\n  params: BuildVideoElementParams\n): Promise<BuildVideoElementReturnType> => {\n  try {\n    const { room, rootElement: element, applyLocalVideoOverlay = true } = params\n\n    const id = uuid()\n\n    let rootElement: HTMLElement\n    if (element) {\n      rootElement = element\n    } else {\n      rootElement = document.createElement('div')\n      rootElement.id = `rootElement-${id}`\n    }\n\n    // Create a video element\n    const videoEl = buildVideo()\n    const layerMap = new Map<string, HTMLDivElement>()\n    let hasVideoTrack = false\n\n    /**\n     * We used this `LocalOverlay` interface to interact with the localVideo\n     * overlay DOM element in here and in the ``.\n     * The idea is to avoid APIs like `document.getElementById` because it\n     * won't work if the SDK is used within a Shadow DOM tree.\n     * Instead of querying the `document`, let's use our `layerMap`.\n     */\n    const localOverlay: LocalOverlay = {\n      // Each `layout.changed` event will update `status`\n      status: 'hidden',\n      get id() {\n        // FIXME: Use `id` until the `memberId` is stable between promote/demote\n        return addSDKPrefix(id)\n      },\n      get domElement() {\n        return layerMap.get(this.id)\n      },\n      set domElement(element: HTMLDivElement | undefined) {\n        if (element) {\n          getLogger().debug('Set localOverlay', element)\n          layerMap.set(this.id, element)\n        } else {\n          getLogger().debug('Remove localOverlay')\n          layerMap.delete(this.id)\n        }\n      },\n      hide() {\n        if (!this.domElement) {\n          return getLogger().warn('Missing localOverlay to hide')\n        }\n        this.domElement.style.opacity = '0'\n      },\n      show() {\n        if (!this.domElement) {\n          return getLogger().warn('Missing localOverlay to show')\n        }\n        if (this.status === 'hidden') {\n          return getLogger().info('localOverlay not visible')\n        }\n        this.domElement.style.opacity = '1'\n      },\n      setLocalOverlayMediaStream(stream: MediaStream) {\n        if (!this.domElement) {\n          return getLogger().warn(\n            'Missing localOverlay to set the local overlay stream'\n          )\n        }\n        const localVideo = this.domElement.querySelector('video')\n        if (localVideo) {\n          localVideo.srcObject = stream\n        }\n      },\n      setLocalOverlayMirror(mirror: boolean) {\n        if (!this.domElement || !this.domElement.firstChild) {\n          return getLogger().warn('Missing localOverlay to set the mirror')\n        }\n        const videoEl = this.domElement.firstChild as HTMLVideoElement\n        if (mirror ?? room.localOverlay.mirrored) {\n          videoEl.style.transform = 'scale(-1, 1)'\n          videoEl.style.webkitTransform = 'scale(-1, 1)'\n        } else {\n          videoEl.style.transform = 'scale(1, 1)'\n          videoEl.style.webkitTransform = 'scale(1, 1)'\n        }\n      },\n    }\n\n    const makeLayoutHandler = makeLayoutChangedHandler({\n      rootElement,\n      localOverlay,\n    })\n\n    const processLayoutChanged = (params: any) => {\n      // @ts-expect-error\n      if (room.peer?.hasVideoSender && room.localStream) {\n        makeLayoutHandler({\n          layout: params.layout,\n          localStream: room.localStream,\n          myMemberId: room.memberId,\n        })\n      } else {\n        localOverlay.hide()\n      }\n    }\n\n    const layoutChangedHandler = (params: { layout: InternalVideoLayout }) => {\n      getLogger().debug('Received layout.changed - videoTrack', hasVideoTrack)\n      if (hasVideoTrack) {\n        processLayoutChanged(params)\n        return\n      }\n    }\n\n    room.on('layout.changed', layoutChangedHandler)\n\n    const processVideoTrack = async (track: MediaStreamTrack) => {\n      hasVideoTrack = true\n\n      await videoElementSetup({\n        applyLocalVideoOverlay,\n        rootElement,\n        track,\n        videoElement: videoEl,\n      })\n\n      // @ts-expect-error\n      const roomCurrentLayoutEvent = room.lastLayoutEvent\n      // If the `layout.changed` has already been received, process the layout\n      if (roomCurrentLayoutEvent) {\n        processLayoutChanged(roomCurrentLayoutEvent)\n      }\n    }\n\n    // If the remote video already exist, inject the remote stream to the video element\n    // @ts-expect-error\n    const videoTrack = room.peer?.remoteVideoTrack as MediaStreamTrack | null\n    if (videoTrack) {\n      await processVideoTrack(videoTrack)\n    }\n\n    // Handle the RTCPeer `track` event\n    const trackHandler = async function (event: RTCTrackEvent) {\n      if (event.track.kind === 'video') {\n        await processVideoTrack(event.track)\n      }\n    }\n\n    /**\n     * Using `on` instead of `once` (or `off` within trackHandler) because\n     * there are cases (promote/demote) where we need to handle multiple `track`\n     * events and update the videoEl with the new track.\n     */\n    room.on('track', trackHandler)\n\n    const mirrorVideoHandler = (value: boolean) => {\n      localOverlay.setLocalOverlayMirror(value)\n    }\n\n    // @ts-expect-error\n    room.on(`${LOCAL_EVENT_PREFIX}.mirror.video`, mirrorVideoHandler)\n\n    const memberVideoMutedHandler = (\n      params: DeprecatedVideoMemberHandlerParams\n    ) => {\n      try {\n        const { member } = params\n        if (member.id === room.memberId && 'video_muted' in member) {\n          member.video_muted ? localOverlay.hide() : localOverlay.show()\n        }\n      } catch (error) {\n        getLogger().error('Error handling video_muted', error)\n      }\n    }\n\n    room.on('member.updated.video_muted', memberVideoMutedHandler)\n\n    const destroyHander = () => {\n      cleanupElement(rootElement)\n      layerMap.clear()\n    }\n\n    room.once('destroy', destroyHander)\n\n    const unsubscribe = () => {\n      room.off('track', trackHandler)\n      room.off('layout.changed', layoutChangedHandler)\n      room.off('member.updated.video_muted', memberVideoMutedHandler)\n      // @ts-expect-error\n      room.off(`${LOCAL_EVENT_PREFIX}.mirror.video`, mirrorVideoHandler)\n      room.off('destroy', destroyHander)\n      destroyHander()\n    }\n\n    return { unsubscribe, element: rootElement }\n  } catch (error) {\n    getLogger().error('Unable to build the video element')\n    throw error\n  }\n}\n\ninterface VideoElementSetupWorkerParams {\n  rootElement: HTMLElement\n  track: MediaStreamTrack\n  videoElement: HTMLVideoElement\n  applyLocalVideoOverlay?: boolean\n}\n\nconst videoElementSetup = async (options: VideoElementSetupWorkerParams) => {\n  try {\n    const { applyLocalVideoOverlay, track, videoElement, rootElement } = options\n\n    setVideoMediaTrack({ element: videoElement, track })\n\n    videoElement.style.width = '100%'\n    videoElement.style.maxHeight = '100%'\n\n    if (!applyLocalVideoOverlay) {\n      rootElement.appendChild(videoElement)\n      return\n    }\n    if (rootElement.querySelector('.mcuContent')) {\n      getLogger().debug('MCU Content already there')\n      return\n    }\n\n    const mcuWrapper = document.createElement('div')\n    mcuWrapper.style.position = 'absolute'\n    mcuWrapper.style.top = '0'\n    mcuWrapper.style.left = '0'\n    mcuWrapper.style.right = '0'\n    mcuWrapper.style.bottom = '0'\n    mcuWrapper.appendChild(videoElement)\n\n    const paddingWrapper = document.createElement('div')\n    paddingWrapper.classList.add('paddingWrapper')\n    paddingWrapper.style.position = 'relative'\n    paddingWrapper.style.width = '100%'\n    paddingWrapper.appendChild(mcuWrapper)\n\n    // For less than 3 participants video call, the video aspect ratio can change\n    const fixInLandscapeOrientation =\n      rootElement.classList.contains('landscape-only')\n    VIDEO_SIZING_EVENTS.forEach((event) =>\n      videoElement.addEventListener(event, () => {\n        const paddingBottom = fixInLandscapeOrientation\n          ? '56.25'\n          : (videoElement.videoHeight / videoElement.videoWidth) * 100\n        paddingWrapper.style.paddingBottom = `${paddingBottom}%`\n      })\n    )\n\n    const layersWrapper = document.createElement('div')\n    layersWrapper.classList.add('mcuLayers')\n    layersWrapper.style.display = 'none'\n    paddingWrapper.appendChild(layersWrapper)\n\n    const relativeWrapper = document.createElement('div')\n    relativeWrapper.classList.add('mcuContent')\n    relativeWrapper.style.position = 'relative'\n    relativeWrapper.style.width = '100%'\n    relativeWrapper.style.height = '100%'\n    relativeWrapper.style.margin = '0 auto'\n    relativeWrapper.style.display = 'flex'\n    relativeWrapper.style.alignItems = 'center'\n    relativeWrapper.style.justifyContent = 'center'\n    relativeWrapper.appendChild(paddingWrapper)\n\n    rootElement.style.width = '100%'\n    rootElement.style.height = '100%'\n    rootElement.appendChild(relativeWrapper)\n\n    getLogger().debug('MCU readyState 1 >>', videoElement.readyState)\n    if (videoElement.readyState === HTMLMediaElement.HAVE_NOTHING) {\n      getLogger().debug('Wait for the MCU to be ready')\n      await waitForVideoReady({ element: videoElement })\n    }\n    getLogger().debug('MCU is ready..')\n\n    layersWrapper.style.display = 'block'\n  } catch (error) {\n    getLogger().error('Handle video track error', error)\n  }\n}\n","import { BaseClient, ClientEvents, actions } from '@signalwire/core'\nimport type { CustomSaga } from '@signalwire/core'\nimport { MakeRoomOptions } from '../video'\nimport { createCallFabricRoomSessionObject } from './CallFabricRoomSession'\nimport { makeAudioElementSaga } from '../features/mediaElements/mediaElementsSagas'\nimport { RoomSessionConnection } from '../BaseRoomSession'\nimport { buildVideoElement } from './buildVideoElement'\n\nexport class Client extends BaseClient<ClientEvents> {\n  makeCallFabricObject(makeRoomOptions: MakeRoomOptions) {\n    const {\n      rootElement,\n      applyLocalVideoOverlay = true,\n      stopCameraWhileMuted = true,\n      stopMicrophoneWhileMuted = true,\n      ...options\n    } = makeRoomOptions\n\n    // TODO: This might not be needed here. We can initiate these sagas in the BaseRoomSession constructor.\n    const customSagas: Array<CustomSaga<RoomSessionConnection>> = []\n\n    /**\n     * By default the SDK will attach the audio to\n     * an Audio element (regardless of \"rootElement\")\n     */\n    customSagas.push(\n      makeAudioElementSaga({\n        speakerId: options.speakerId,\n      })\n    )\n\n    const room = createCallFabricRoomSessionObject({\n      ...options,\n      store: this.store,\n      customSagas,\n    })\n\n    /**\n     * If the user provides a `rootElement` we'll\n     * automatically handle the Video element for them\n     */\n    if (rootElement) {\n      try {\n        buildVideoElement({ room, rootElement, applyLocalVideoOverlay })\n      } catch (error) {\n        this.logger.error('Unable to build the video element automatically')\n      }\n    }\n\n    /**\n     * If the user joins with `join_video_muted: true` or\n     * `join_audio_muted: true` we'll stop the streams\n     * right away.\n     */\n    room.on('room.subscribed', (params) => {\n      const member = params.room_session.members?.find(\n        (m) => m.id === room.memberId\n      )\n\n      if (member?.audio_muted) {\n        try {\n          room.stopOutboundAudio()\n        } catch (error) {\n          this.logger.error('Error handling audio_muted', error)\n        }\n      }\n\n      if (member?.video_muted) {\n        try {\n          room.stopOutboundVideo()\n        } catch (error) {\n          this.logger.error('Error handling video_muted', error)\n        }\n      }\n    })\n\n    /**\n     * Stop and Restore outbound audio on audio_muted event\n     */\n    if (stopMicrophoneWhileMuted) {\n      room.on('member.updated.audio_muted', ({ member }) => {\n        try {\n          if (member.member_id === room.memberId && 'audio_muted' in member) {\n            member.audio_muted\n              ? room.stopOutboundAudio()\n              : room.restoreOutboundAudio()\n          }\n        } catch (error) {\n          this.logger.error('Error handling audio_muted', error)\n        }\n      })\n    }\n\n    /**\n     * Stop and Restore outbound video on video_muted event\n     */\n    if (stopCameraWhileMuted) {\n      room.on('member.updated.video_muted', ({ member }) => {\n        try {\n          if (member.member_id === room.memberId && 'video_muted' in member) {\n            member.video_muted\n              ? room.stopOutboundVideo()\n              : room.restoreOutboundVideo()\n          }\n        } catch (error) {\n          this.logger.error('Error handling video_muted', error)\n        }\n      })\n    }\n\n    return room\n  }\n\n  /**\n   * Reauthenticate with the SignalWire network using a new token\n   * For now it returns void since with an invalid token the server\n   * will close the connection right away so we can hook on the session\n   * events in case. Need to improve it.\n   *\n   * @internal\n   */\n  reauthenticate(token: string) {\n    this.store.dispatch(actions.reauthAction({ token }))\n  }\n}\n","import { getLogger, VertoSubscribe, VertoBye } from '@signalwire/core'\nimport { wsClientWorker } from './workers'\nimport {\n  CallParams,\n  DialParams,\n  InboundCallSource,\n  IncomingInvite,\n  OnlineParams,\n  PushNotificationPayload,\n  WSClientOptions,\n} from './types'\nimport { IncomingCallManager } from './IncomingCallManager'\nimport { CallFabricRoomSession } from './CallFabricRoomSession'\nimport { createClient } from './createClient'\nimport { Client } from './Client'\n\ntype BuildRoomParams = Omit<DialParams, 'to'> & {\n  attach: boolean\n  callID?: string\n  nodeId?: string\n  sdp?: string\n  to?: string\n}\n\nexport class WSClient {\n  private wsClient: Client\n  private logger = getLogger()\n  private _incomingCallManager: IncomingCallManager\n\n  constructor(public options: WSClientOptions) {\n    this.wsClient = createClient(this.options)\n    this._incomingCallManager = new IncomingCallManager(\n      (payload: IncomingInvite, params: CallParams) =>\n        this.buildInboundCall(payload, params),\n      (callId: string, nodeId: string) => this.executeVertoBye(callId, nodeId)\n    )\n  }\n\n  /** @internal */\n  get clientApi() {\n    return this.wsClient\n  }\n\n  async connect() {\n    // @ts-ignore\n    if (!this.wsClient.connected) {\n      // @ts-ignore\n      this.wsClient.runWorker('wsClientWorker', {\n        worker: wsClientWorker,\n        initialState: {\n          buildInboundCall: (incomingInvite: Omit<IncomingInvite, 'source'>) =>\n            this.notifyIncomingInvite('websocket', incomingInvite),\n        },\n      })\n      await this.wsClient.connect()\n    }\n  }\n\n  disconnect() {\n    return this.wsClient.disconnect()\n  }\n\n  async dial(params: DialParams) {\n    return this.connectAndbuildRoomSession({ ...params, attach: false })\n  }\n\n  async reattach(params: DialParams) {\n    return this.connectAndbuildRoomSession({ ...params, attach: true })\n  }\n\n  private async connectAndbuildRoomSession(params: BuildRoomParams) {\n    return new Promise<CallFabricRoomSession>(async (resolve, reject) => {\n      try {\n        await this.connect()\n        const call = this.buildRoomSession(params)\n        resolve(call)\n      } catch (error) {\n        getLogger().error('WSClient', error)\n        reject(error)\n      }\n    })\n  }\n\n  private buildRoomSession(params: BuildRoomParams) {\n    const { to, callID, nodeId, sdp } = params\n\n    let video = params.video ?? true\n    let negotiateVideo = true\n\n    const toURL = new URL(`address:${to}`)\n\n    if (to && toURL.searchParams.get('channel') === 'audio') {\n      video = false\n      negotiateVideo = false\n    }\n\n    const call = this.wsClient.makeCallFabricObject({\n      audio: params.audio ?? true,\n      video,\n      negotiateAudio: params.negotiateAudio ?? true,\n      negotiateVideo: params.negotiateVideo ?? negotiateVideo,\n      rootElement: params.rootElement || this.options.rootElement,\n      applyLocalVideoOverlay: true,\n      stopCameraWhileMuted: true,\n      stopMicrophoneWhileMuted: true,\n      destinationNumber: toURL.pathname,\n      watchMediaPackets: false,\n      remoteSdp: sdp,\n      prevCallId: callID,\n      nodeId,\n      disableUdpIceServers: params.disableUdpIceServers || false,\n      attach: params.attach,\n      userVariables: params.userVariables || this.options.userVariables,\n    })\n\n    // WebRTC connection left the room.\n    call.once('destroy', () => {\n      this.logger.debug('RTC Connection Destroyed')\n      call.destroy()\n    })\n\n    this.wsClient.once('session.disconnected', () => {\n      this.logger.debug('Session Disconnected')\n    })\n\n    // @ts-expect-error\n    call.attachPreConnectWorkers()\n    return call\n  }\n\n  handlePushNotification(payload: PushNotificationPayload) {\n    return new Promise(async (resolve, reject) => {\n      const { decrypted, type } = payload\n      if (type !== 'call_invite') {\n        this.logger.warn('Unknown notification type', payload)\n        return\n      }\n      this.logger.debug('handlePushNotification', payload)\n      const { params: jsonrpc, node_id: nodeId } = decrypted\n      const {\n        params: {\n          callID,\n          sdp,\n          caller_id_name,\n          caller_id_number,\n          callee_id_name,\n          callee_id_number,\n          display_direction,\n        },\n      } = jsonrpc\n      try {\n        // Connect the client first\n        await this.connect()\n\n        // Catch the error temporarly\n        try {\n          // Send verto.subscribe\n          await this.executeVertoSubscribe(callID, nodeId)\n        } catch (error) {\n          this.logger.warn('Verto Subscribe', error)\n        }\n\n        this.notifyIncomingInvite('pushNotification', {\n          callID,\n          sdp,\n          caller_id_name,\n          caller_id_number,\n          callee_id_name,\n          callee_id_number,\n          display_direction,\n          nodeId,\n        })\n        resolve({ resultType: 'inboundCall' })\n      } catch (error) {\n        reject(error)\n      }\n    })\n  }\n\n  private notifyIncomingInvite(\n    source: InboundCallSource,\n    buildCallParams: Omit<IncomingInvite, 'source'>\n  ) {\n    this._incomingCallManager.handleIncomingInvite({\n      source,\n      ...buildCallParams,\n    })\n  }\n\n  private async executeVertoBye(callId: string, nodeId: string) {\n    try {\n      return await this.wsClient.execute<unknown, void>({\n        method: 'webrtc.verto',\n        params: {\n          callID: callId,\n          node_id: nodeId,\n          message: VertoBye({\n            cause: 'USER_BUSY',\n            causeCode: '17',\n            dialogParams: { callID: callId },\n          }),\n        },\n      })\n    } catch (error) {\n      this.logger.warn('The call is not available anymore', callId)\n      throw error\n    }\n  }\n\n  private async executeVertoSubscribe(callId: string, nodeId: string) {\n    try {\n      return await this.wsClient.execute<unknown, void>({\n        method: 'webrtc.verto',\n        params: {\n          callID: callId,\n          node_id: nodeId,\n          subscribe: [],\n          message: VertoSubscribe({\n            sessid: callId,\n            eventChannel: [],\n          }),\n        },\n      })\n    } catch (error) {\n      this.logger.warn('The call is not available anymore', callId)\n      throw error\n    }\n  }\n\n  private buildInboundCall(payload: IncomingInvite, params: CallParams) {\n    getLogger().debug('Build new call to answer')\n\n    const { callID, nodeId, sdp } = payload\n    return this.buildRoomSession({\n      ...params,\n      attach: false,\n      callID,\n      nodeId,\n      sdp,\n    })\n  }\n\n  /**\n   * Allow user to update the auth token\n   */\n  updateToken(token: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.wsClient.once('session.auth_error', (error) => {\n        reject(error)\n      })\n      this.wsClient.once('session.connected', () => {\n        resolve()\n      })\n      this.wsClient.reauthenticate(token)\n    })\n  }\n\n  /**\n   * Mark the client as 'online' to receive calls over WebSocket\n   */\n  async online({ incomingCallHandlers }: OnlineParams) {\n    this._incomingCallManager.setNotificationHandlers(incomingCallHandlers)\n    await this.connect()\n    return this.wsClient.execute<unknown, void>({\n      method: 'subscriber.online',\n      params: {},\n    })\n  }\n\n  /**\n   * Mark the client as 'offline' to receive calls over WebSocket\n   */\n  offline() {\n    this._incomingCallManager.setNotificationHandlers({})\n    return this.wsClient.execute<unknown, void>({\n      method: 'subscriber.offline',\n      params: {},\n    })\n  }\n}\n","import {\n  ClientEvents,\n  configureStore,\n  connect,\n  getEventEmitter,\n  UserOptions,\n} from '@signalwire/core'\nimport { SATSession } from './SATSession'\nimport { Client } from './Client'\n\n/**\n * With `await SignalWire()` you can establish a WebSocket connection\n * with SignalWire and interact with the client.\n *\n * ## Examples\n * Create a client\n *\n * @example\n * ```js\n * try {\n *   const client = new SignalWire({\n *     token: '<YourJWT>',\n *   })\n *\n *   await client.connect()\n *   // Your client is ready now..\n * } catch (error) {\n *   console.error('Error', error)\n * }\n * ```\n * @internal\n */\nexport const createClient = (userOptions: UserOptions) => {\n  const baseUserOptions = {\n    ...userOptions,\n    emitter: getEventEmitter<ClientEvents>(),\n  }\n  const store = configureStore({\n    userOptions: baseUserOptions,\n    SessionConstructor: SATSession,\n  })\n  const client = connect<ClientEvents, Client, Client>({\n    store,\n    Component: Client,\n  })(baseUserOptions)\n\n  return client\n}\n","import { AuthError, HttpError } from '@signalwire/core'\n\ninterface InternalHttpResponse<T> extends Response {\n  parsedBody?: T\n}\n\nasync function http<T>(\n  input: string,\n  init: RequestInit | undefined\n): Promise<InternalHttpResponse<T>> {\n  const response: InternalHttpResponse<T> = await fetch(input, init)\n\n  if (!response.ok) {\n    if (response.status === 401) {\n      throw new AuthError(response.status, 'Unauthorized')\n    }\n\n    let errorResponse\n    try {\n      errorResponse = await response.json()\n    } catch (e) {}\n\n    const errorMessage = errorResponse?.errors\n      ? JSON.stringify(errorResponse.errors)\n      : 'Not Found'\n\n    throw new HttpError(response.status, errorMessage, errorResponse)\n  }\n\n  try {\n    // might throw if body is empty\n    response.parsedBody = await response.json()\n  } catch (e) {}\n\n  return response\n}\n\ninterface CreateHttpClientOptions extends RequestInit {\n  baseUrl: string\n  /**\n   * Timeout in milliseconds\n   */\n  timeout?: number\n}\n\ninterface HttpClientRequestInit extends Omit<RequestInit, 'body'> {\n  body?: Record<string, unknown>\n  searchParams?: Record<string, any>\n}\n\nexport type CreateHttpClient = ReturnType<typeof createHttpClient>\n\nexport const createHttpClient = (\n  { baseUrl, timeout = 30000, ...globalOptions }: CreateHttpClientOptions,\n  fetcher = http\n) => {\n  const apiClient = async <T>(\n    path: string,\n    options?: HttpClientRequestInit\n  ): Promise<{ body: T }> => {\n    const headers = {\n      ...(options?.body ? { 'Content-Type': 'application/json' } : {}),\n      ...globalOptions.headers,\n      ...options?.headers,\n    }\n\n    const reqInit = getRequestInit({\n      ...globalOptions,\n      ...options,\n      headers,\n    })\n    // reqInit.mode = 'no-cors'\n    // reqInit.credentials = 'include'\n\n    let timerId\n    if (timeout) {\n      const controller = new AbortController()\n      const signal = controller.signal\n\n      reqInit.signal = signal\n\n      timerId = setTimeout(() => {\n        controller.abort()\n      }, timeout)\n    }\n\n    try {\n      const response = await fetcher<T>(\n        getUrl({\n          path,\n          baseUrl,\n          searchParams: options?.searchParams,\n        }),\n        reqInit\n      )\n\n      return { body: response.parsedBody as T }\n    } catch (e) {\n      throw e\n    } finally {\n      timerId && clearTimeout(timerId)\n    }\n  }\n\n  return apiClient\n}\n\nconst getBody = (body: unknown) => {\n  return typeof body === 'string' ? body : JSON.stringify(body)\n}\n\nconst getRequestInit = (options: any): RequestInit => {\n  return Object.entries(options).reduce((reducer, [key, value]) => {\n    if (key === 'body') {\n      return {\n        ...reducer,\n        body: getBody(value),\n      }\n    } else if (value != undefined) {\n      return {\n        ...reducer,\n        [key]: value,\n      }\n    }\n\n    return reducer\n  }, {} as RequestInit)\n}\n\nconst getUrl = ({\n  path,\n  baseUrl,\n  searchParams,\n}: {\n  baseUrl: string\n  path: string\n  searchParams?: Record<string, any>\n}) => {\n  const url = new URL(path, baseUrl)\n\n  if (searchParams) {\n    Object.entries(searchParams).forEach(([key, value]) => {\n      if (value != undefined) {\n        url.searchParams.append(key, value)\n      }\n    })\n  }\n  return url.toString()\n}\n","import { PaginatedResponse } from '../fabric/types'\nimport { CreateHttpClient } from '../fabric/createHttpClient'\n\nexport function buildPaginatedResult<T>(\n  body: PaginatedResponse<T>,\n  client: CreateHttpClient\n) {\n  const anotherPage = async (url?: string) => {\n    if (!url) return Promise.resolve(undefined)\n    const { body } = await client<PaginatedResponse<T>>(url)\n    return buildPaginatedResult<T>(body, client)\n  }\n\n  return {\n    data: body.data,\n    self: async () => {\n      const { self } = body.links\n      return anotherPage(self)\n    },\n    nextPage: async () => {\n      const { next } = body.links\n      return anotherPage(next)\n    },\n    prevPage: async () => {\n      const { prev } = body.links\n      return anotherPage(prev)\n    },\n    firstPage: async () => {\n      const { first } = body.links\n      return anotherPage(first)\n    },\n    hasNext: Boolean(body.links.next),\n    hasPrev: Boolean(body.links.prev),\n  }\n}\n","/**\n * Constructs a URL with query parameters.\n *\n * @param path The base path of the URL.\n * @param queryParams An instance of URLSearchParams containing all query parameters.\n * @returns The constructed URL with query parameters.\n */\nexport function makeQueryParamsUrls(\n  path: string,\n  queryParams: URLSearchParams\n): string {\n  const queryString = queryParams.toString()\n  return queryString ? `${path}?${queryString}` : path\n}\n","import jwtDecode from 'jwt-decode'\nimport { getLogger, type UserOptions } from '@signalwire/core'\nimport type {\n  GetAddressResponse,\n  GetAddressesParams,\n  RegisterDeviceParams,\n  UnregisterDeviceParams,\n  RegisterDeviceResponse,\n  GetAddressParams,\n  GetAddressResult,\n  GetAddressesResponse,\n  GetAddressesResult,\n  RegisterDeviceResult,\n  GetSubscriberInfoResponse,\n} from './types'\nimport { CreateHttpClient, createHttpClient } from './createHttpClient'\nimport { buildPaginatedResult } from '../utils/paginatedResult'\nimport { makeQueryParamsUrls } from '../utils/makeQueryParamsUrl'\nimport {\n  isGetAddressByIdParams,\n  isGetAddressByNameParams,\n  isGetAddressesResponse,\n} from './utils/typeGuard'\n\ntype JWTHeader = { ch?: string; typ?: string }\n\n// TODO: extends from a Base class to share from core\nexport class HTTPClient {\n  private httpClient: CreateHttpClient\n\n  constructor(public options: UserOptions) {\n    this.httpClient = createHttpClient({\n      baseUrl: `https://${this.httpHost}`,\n      headers: {\n        Authorization: `Bearer ${this.options.token}`,\n      },\n    })\n  }\n\n  get fetch(): CreateHttpClient {\n    return this.httpClient\n  }\n\n  get httpHost() {\n    let decodedJwt: JWTHeader = {}\n    try {\n      decodedJwt = jwtDecode<JWTHeader>(this.options.token, {\n        header: true,\n      })\n    } catch (e) {\n      if (process.env.NODE_ENV !== 'production') {\n        getLogger().debug('[JWTSession] error decoding the JWT')\n      }\n    }\n    const host = this.options.host || decodedJwt?.ch\n    if (!host) {\n      return 'fabric.signalwire.com'\n    }\n    return `fabric.${host.split('.').splice(1).join('.')}`\n  }\n\n  public async getAddress(\n    params: GetAddressParams\n  ): Promise<GetAddressResult | undefined> {\n    let path = '/api/fabric/addresses'\n    if (isGetAddressByNameParams(params)) {\n      path = `${path}?name=${params.name}`\n    } else if (isGetAddressByIdParams(params)) {\n      path = `${path}/${params.id}`\n    }\n\n    const { body } = await this.httpClient<\n      GetAddressResponse | GetAddressesResponse\n    >(path)\n    if (isGetAddressesResponse(body)) {\n      // FIXME until the server handles a index lookup by name we need to handle it as a search result\n      return body.data[0]\n    }\n    return body\n  }\n\n  public async getAddresses(\n    params?: GetAddressesParams\n  ): Promise<GetAddressesResult> {\n    const { type, displayName, pageSize, sortBy, sortOrder } = params || {}\n\n    let path = '/api/fabric/addresses'\n\n    const queryParams = new URLSearchParams()\n    if (type) {\n      queryParams.append('type', type)\n    }\n    if (displayName) {\n      queryParams.append('display_name', displayName)\n    }\n    if (pageSize) {\n      queryParams.append('page_size', pageSize.toString())\n    }\n\n    if (sortBy) {\n      queryParams.append('sort_by', sortBy)\n    }\n\n    if (sortOrder) {\n      queryParams.append('sort_order', sortOrder)\n    }\n\n    const queryUrl = makeQueryParamsUrls(path, queryParams)\n    getLogger().debug(`[getAddresses] query URL ${queryUrl}`)\n    const { body } = await this.httpClient<GetAddressesResponse>(\n      queryUrl\n    )\n\n    return buildPaginatedResult(body, this.httpClient)\n  }\n\n  public async registerDevice(\n    params: RegisterDeviceParams\n  ): Promise<RegisterDeviceResult> {\n    const { deviceType, deviceToken } = params\n\n    const path = '/subscriber/devices' as const\n    const { body } = await this.httpClient<RegisterDeviceResponse>(path, {\n      method: 'POST',\n      body: {\n        device_type: deviceType,\n        device_token: deviceToken,\n      },\n    })\n\n    return body\n  }\n\n  public async unregisterDevice(params: UnregisterDeviceParams) {\n    const { id } = params\n\n    const path = `/subscriber/devices/${id}` as const\n    return await this.httpClient<void>(path, {\n      method: 'DELETE',\n    })\n  }\n\n  public async getSubscriberInfo() {\n    let path = '/api/fabric/subscriber/info'\n\n    const { body } = await this.httpClient<GetSubscriberInfoResponse>(path)\n\n    return body\n  }\n}\n","import {\n  GetAddressParams,\n  GetAddressByNameParams,\n  GetAddressByIdParams,\n  GetAddressResponse,\n  GetAddressesResponse,\n} from '../types'\n\nexport const isGetAddressByNameParams = (\n  obj: GetAddressParams\n): obj is GetAddressByNameParams => {\n  return obj && 'name' in obj\n}\n\nexport const isGetAddressByIdParams = (\n  obj: GetAddressParams\n): obj is GetAddressByIdParams => {\n  return obj && 'id' in obj\n}\n\nexport const isGetAddressResponse = (\n  obj: GetAddressResponse | GetAddressesResponse\n): obj is GetAddressResponse => {\n  return obj && 'id' in obj && 'name' in obj\n}\n\nexport const isGetAddressesResponse = (\n  obj: GetAddressResponse | GetAddressesResponse\n): obj is GetAddressesResponse => {\n  return obj && 'data' in obj\n}\n","import { Conversation } from './Conversation'\nimport {\n  ConversationAPIGetMessagesParams,\n  ConversationAPISendMessageParams,\n  ConversationContract,\n  ConversationResponse,\n} from './types'\n\nexport class ConversationAPI implements ConversationContract {\n  constructor(\n    private conversation: Conversation,\n    private payload: ConversationResponse\n  ) {}\n\n  get id() {\n    return this.payload.id\n  }\n\n  get addressId() {\n    return this.payload.address_id\n  }\n\n  get createdAt() {\n    return this.payload.created_at\n  }\n\n  get lastMessageAt() {\n    return this.payload.last_message_at\n  }\n\n  get metadata() {\n    return this.payload.metadata\n  }\n\n  get name() {\n    return this.payload.name\n  }\n\n  sendMessage(params: ConversationAPISendMessageParams) {\n    return this.conversation.sendMessage({\n      addressId: this.id,\n      text: params.text,\n    })\n  }\n\n  getMessages(params?: ConversationAPIGetMessagesParams) {\n    return this.conversation.getConversationMessages({\n      addressId: this.id,\n      ...params,\n    })\n  }\n}\n","import { type ConversationEventParams } from '@signalwire/core'\nimport { HTTPClient } from './HTTPClient'\nimport { WSClient } from './WSClient'\nimport type {\n  GetConversationsResponse,\n  GetMessagesParams,\n  GetConversationsParams,\n  GetConversationMessagesParams,\n  GetConversationMessagesResponse,\n  ConversationMessage,\n  SendConversationMessageParams,\n  SendConversationMessageResponse,\n  ConversationChatMessage,\n  GetMessagesResult,\n  GetConversationMessagesResult,\n  SendConversationMessageResult,\n  GetConversationChatMessageParams,\n  GetConversationsResult,\n  CoversationSubscribeCallback,\n  ConversationChatMessagesSubscribeParams,\n  ConversationChatMessagesSubscribeResult,\n  GetConversationChatMessageResult,\n  JoinConversationParams,\n  JoinConversationResponse,\n  JoinConversationResult,\n  CoversationSubscribeResult,\n} from './types'\nimport { conversationWorker } from './workers'\nimport { buildPaginatedResult } from '../utils/paginatedResult'\nimport { makeQueryParamsUrls } from '../utils/makeQueryParamsUrl'\nimport { ConversationAPI } from './ConversationAPI'\n\nconst DEFAULT_CHAT_MESSAGES_PAGE_SIZE = 10\n\ninterface ConversationOptions {\n  httpClient: HTTPClient\n  wsClient: WSClient\n}\n\nexport class Conversation {\n  private httpClient: HTTPClient\n  private wsClient: WSClient\n  private callbacks = new Set<CoversationSubscribeCallback>()\n  private chatSubscriptions: Record<string, Set<CoversationSubscribeCallback>> =\n    {}\n\n  constructor(options: ConversationOptions) {\n    this.httpClient = options.httpClient\n    this.wsClient = options.wsClient\n\n    this.wsClient.clientApi.runWorker('conversationWorker', {\n      worker: conversationWorker,\n      initialState: {\n        conversation: this,\n      },\n    })\n  }\n\n  /** @internal */\n  public handleEvent(event: ConversationEventParams) {\n    if (event.subtype === 'chat') {\n      const chatCallbacks = this.chatSubscriptions[event.conversation_id]\n      if (chatCallbacks?.size) {\n        chatCallbacks.forEach((cb) => cb(event))\n      }\n    }\n\n    if (this.callbacks.size) {\n      this.callbacks.forEach((callback) => {\n        callback(event)\n      })\n    }\n  }\n\n  public async sendMessage(\n    params: SendConversationMessageParams\n  ): Promise<SendConversationMessageResult> {\n    try {\n      const { addressId, text } = params\n      const path = '/api/fabric/messages'\n      const { body } =\n        await this.httpClient.fetch<SendConversationMessageResponse>(path, {\n          method: 'POST',\n          body: {\n            conversation_id: addressId,\n            text,\n          },\n        })\n      return body\n    } catch (error) {\n      throw new Error('Error sending message to conversation!', error)\n    }\n  }\n\n  public async getConversations(\n    params?: GetConversationsParams\n  ): Promise<GetConversationsResult> {\n    try {\n      const { pageSize } = params || {}\n\n      const path = '/api/fabric/conversations'\n      const queryParams = new URLSearchParams()\n      if (pageSize) {\n        queryParams.append('page_size', pageSize.toString())\n      }\n\n      const { body } = await this.httpClient.fetch<GetConversationsResponse>(\n        makeQueryParamsUrls(path, queryParams)\n      )\n      const self = this\n      const data = body.data.map(\n        (conversation) => new ConversationAPI(self, conversation)\n      )\n      return buildPaginatedResult({ ...body, data }, this.httpClient.fetch)\n    } catch (error) {\n      throw new Error('Error fetching the conversation history!', error)\n    }\n  }\n\n  public async getMessages(\n    params?: GetMessagesParams\n  ): Promise<GetMessagesResult> {\n    try {\n      const { pageSize } = params || {}\n\n      const path = '/api/fabric/messages'\n      const queryParams = new URLSearchParams()\n      if (pageSize) {\n        queryParams.append('page_size', pageSize.toString())\n      }\n\n      const { body } =\n        await this.httpClient.fetch<GetConversationMessagesResponse>(\n          makeQueryParamsUrls(path, queryParams)\n        )\n\n      return buildPaginatedResult<ConversationMessage>(\n        body,\n        this.httpClient.fetch\n      )\n    } catch (error) {\n      throw new Error('Error fetching the conversation messages!', error)\n    }\n  }\n\n  public async getConversationMessages(\n    params: GetConversationMessagesParams\n  ): Promise<GetConversationMessagesResult> {\n    try {\n      const { addressId, pageSize } = params || {}\n\n      const path = `/api/fabric/conversations/${addressId}/messages`\n      const queryParams = new URLSearchParams()\n      if (pageSize) {\n        queryParams.append('page_size', pageSize.toString())\n      }\n\n      const { body } =\n        await this.httpClient.fetch<GetConversationMessagesResponse>(\n          makeQueryParamsUrls(path, queryParams)\n        )\n\n      return buildPaginatedResult<ConversationMessage>(\n        body,\n        this.httpClient.fetch\n      )\n    } catch (error) {\n      throw new Error('Error fetching the conversation messages!', error)\n    }\n  }\n\n  public async getChatMessages(\n    params: GetConversationChatMessageParams\n  ): Promise<GetConversationChatMessageResult> {\n    const { addressId, pageSize = DEFAULT_CHAT_MESSAGES_PAGE_SIZE } = params\n    const chatMessages = []\n    const isValid = (item: ConversationMessage) => (item.conversation_id === addressId && item.subtype === 'chat')\n\n    let conversationMessages: Awaited<ReturnType<typeof this.getConversationMessages>> | undefined\n    conversationMessages = await this.getConversationMessages({addressId, pageSize});\n     chatMessages.push(...conversationMessages.data.filter(isValid))\n     while(chatMessages.length < pageSize && conversationMessages?.hasNext) {\n      conversationMessages = await conversationMessages?.nextPage() \n      if(!!conversationMessages) {\n        chatMessages.push(...conversationMessages.data.filter(isValid))\n      }\n     }\n    \n    return { \n      data: chatMessages as ConversationChatMessage[],\n      hasNext: !!conversationMessages?.hasNext,\n      hasPrev: !!conversationMessages?.hasPrev,\n      // @ts-expect-error\n      nextPage: conversationMessages?.nextPage,\n      // @ts-expect-error\n      prevPage: conversationMessages?.prevPage,\n    }\n  }\n\n  public async subscribe(\n    callback: CoversationSubscribeCallback\n  ): Promise<CoversationSubscribeResult> {\n    // Connect the websocket client first\n    this.wsClient.connect()\n\n    this.callbacks.add(callback)\n\n    return {\n      unsubscribe: () => this.callbacks.delete(callback),\n    }\n  }\n\n  public async subscribeChatMessages(\n    params: ConversationChatMessagesSubscribeParams\n  ): Promise<ConversationChatMessagesSubscribeResult> {\n    const { addressId, onMessage } = params\n\n    // Connect the websocket client first\n    await this.wsClient.connect()\n\n    if (!(addressId in this.chatSubscriptions)) {\n      this.chatSubscriptions[addressId] = new Set()\n    }\n\n    this.chatSubscriptions[addressId].add(onMessage)\n    return {\n      unsubscribe: () => this.chatSubscriptions[addressId].delete(onMessage),\n    }\n  }\n\n  public async joinConversation(\n    params: JoinConversationParams\n  ): Promise<JoinConversationResult> {\n    try {\n      const { addressId } = params\n      const path = '/api/fabric/conversations/join'\n      const { body } = await this.httpClient.fetch<JoinConversationResponse>(\n        path,\n        {\n          method: 'POST',\n          body: {\n            conversation_id: addressId,\n          },\n        }\n      )\n      return body\n    } catch (error) {\n      throw new Error('Error joining a conversation!', error)\n    }\n  }\n}\n","import { HTTPClient } from './HTTPClient'\nimport { WSClient } from './WSClient'\nimport { Conversation } from './Conversation'\nimport { SignalWireContract, SignalWireOptions } from './types'\n\nexport const SignalWire = (\n  options: SignalWireOptions\n): Promise<SignalWireContract> => {\n  return new Promise(async (resolve, reject) => {\n    try {\n      const httpClient = new HTTPClient(options)\n      const wsClient = new WSClient(options)\n\n      const conversation = new Conversation({ httpClient, wsClient })\n\n      resolve({\n        httpHost: httpClient.httpHost,\n        registerDevice: httpClient.registerDevice.bind(httpClient),\n        unregisterDevice: httpClient.unregisterDevice.bind(httpClient),\n        getSubscriberInfo: httpClient.getSubscriberInfo.bind(httpClient),\n        connect: wsClient.connect.bind(wsClient),\n        disconnect: wsClient.disconnect.bind(wsClient),\n        online: wsClient.online.bind(wsClient),\n        offline: wsClient.offline.bind(wsClient),\n        dial: wsClient.dial.bind(wsClient),\n        reattach: wsClient.reattach.bind(wsClient), \n        handlePushNotification: wsClient.handlePushNotification.bind(wsClient),\n        updateToken: wsClient.updateToken.bind(wsClient),\n        address: {\n          getAddresses: httpClient.getAddresses.bind(httpClient),\n          getAddress: httpClient.getAddress.bind(httpClient),\n        },\n        conversation: {\n          getConversations: conversation.getConversations.bind(conversation),\n          getMessages: conversation.getMessages.bind(conversation),\n          getConversationMessages:\n            conversation.getConversationMessages.bind(conversation),\n          subscribe: conversation.subscribe.bind(conversation),\n          sendMessage: conversation.sendMessage.bind(conversation),\n          join: conversation.joinConversation.bind(conversation),\n        },\n        chat: {\n          getMessages: conversation.getChatMessages.bind(conversation),\n          subscribe: conversation.subscribeChatMessages.bind(conversation),\n          sendMessage: conversation.sendMessage.bind(conversation),\n          join: conversation.joinConversation.bind(conversation),\n        },\n        // @ts-expect-error\n        __httpClient: httpClient,\n        __wsClient: wsClient,\n      })\n    } catch (error) {\n      reject(error)\n    }\n  })\n}\n","import { UserOptions, getLogger } from '@signalwire/core'\nimport { createClient } from './createClient'\nimport { MakeRoomOptions } from './Client'\nimport { BaseRoomSession } from './BaseRoomSession'\n\n/**\n * @internal\n * @deprecated Use {@link RoomSession} instead.\n **/\nexport interface Room extends BaseRoomSession<Room> {}\n\nexport interface CreateRoomObjectOptions\n  extends UserOptions,\n    Omit<MakeRoomOptions, 'rootElement'> {\n  /** Id of the HTML element in which to display the video stream */\n  rootElementId?: string\n  /** Whether to automatically join the room session. */\n  autoJoin?: boolean\n}\n\nconst VIDEO_CONSTRAINTS: MediaTrackConstraints = {\n  aspectRatio: { ideal: 16 / 9 },\n}\n\n/**\n * Using Video.createRoomObject() you can create a `RoomObject` to join a room.\n *\n * @example\n * With an HTMLDivElement with id=\"root\" in the DOM.\n * ```js\n * // <div id=\"root\"></div>\n *\n * try {\n *   const roomObj = await Video.createRoomObject({\n *     token: '<YourJWT>',\n *     rootElementId: 'root',\n *   })\n *\n *   roomObj.join()\n * } catch (error) {\n *   console.error('Error', error)\n * }\n * ```\n * @deprecated Use {@link RoomSession} instead.\n */\nexport const createRoomObject = (\n  roomOptions: CreateRoomObjectOptions\n): Promise<Room> => {\n  return new Promise(async (resolve, reject) => {\n    const {\n      audio = true,\n      video = true,\n      iceServers,\n      rootElementId,\n      applyLocalVideoOverlay = true,\n      autoJoin = false,\n      stopCameraWhileMuted = true,\n      stopMicrophoneWhileMuted = true,\n      speakerId,\n      ...userOptions\n    } = roomOptions\n\n    const client = createClient<Room>({\n      ...userOptions,\n    })\n    await client.connect()\n\n    if (!client) {\n      return\n    }\n\n    /**\n     * Since `makeRoomObject` now only accepts a\n     * `rootElement` the following is to preserve backwards\n     * compatibility with the previous syntax\n     */\n    let rootElement: HTMLElement | undefined\n    if (rootElementId) {\n      const el = document.getElementById(rootElementId)\n\n      if (el) {\n        rootElement = el\n      } else {\n        rootElement = document.body\n\n        getLogger().warn(\n          `We couldn't find an element with id: ${rootElementId}: using 'document.body' instead.`\n        )\n      }\n    }\n\n    const roomObject = client.rooms.makeRoomObject({\n      audio,\n      video: video === true ? VIDEO_CONSTRAINTS : video,\n      negotiateAudio: true,\n      negotiateVideo: true,\n      iceServers,\n      rootElement,\n      applyLocalVideoOverlay,\n      stopCameraWhileMuted,\n      stopMicrophoneWhileMuted,\n      speakerId,\n    })\n\n    // WebRTC connection left the room.\n    roomObject.once('destroy', () => {\n      roomObject.emit('room.left')\n      client.disconnect()\n    })\n\n    const join = () => {\n      return new Promise(async (resolve, reject) => {\n        try {\n          roomObject.once('room.subscribed', (_payload) => {\n            resolve(roomObject)\n          })\n\n          await roomObject.join()\n        } catch (error) {\n          getLogger().error('Join', error)\n          // Disconnect the underlay client in case of media/signaling errors\n          client.disconnect()\n\n          reject(error)\n        }\n      })\n    }\n\n    const room = new Proxy(roomObject, {\n      get(target: any, prop: any, receiver: any) {\n        if (prop === 'join') {\n          return join\n        }\n        return Reflect.get(target, prop, receiver)\n      },\n    })\n\n    if (autoJoin) {\n      try {\n        await room.join()\n        resolve(room)\n      } catch (error) {\n        reject(error)\n      }\n    } else {\n      resolve(room)\n    }\n  })\n}\n","import {\n  UserOptions,\n  getLogger,\n  VideoAuthorization,\n  VideoRoomSubscribedEventParams,\n} from '@signalwire/core'\nimport { createClient } from './createClient'\nimport { BaseRoomSession } from './BaseRoomSession'\nimport { checkMediaParams, getJoinMediaParams } from './utils/roomSession'\nimport type { MakeRoomOptions } from './Client'\nimport type {\n  BaseRoomSessionJoinParams,\n  RoomSessionObjectEvents,\n} from './utils/interfaces'\nimport { getStorage, sessionStorageManager } from './utils/storage'\n\n/**\n * List of properties/methods the user shouldn't be able to\n * use until they sucessfully call `roomSession.join()`.\n */\nexport const UNSAFE_PROP_ACCESS = [\n  'audioMute',\n  'audioUnmute',\n  'deaf',\n  'getLayouts',\n  'getMembers',\n  'getRecordings',\n  'hideVideoMuted',\n  'leave',\n  'removerMember',\n  'restoreOutboundAudio',\n  'restoreOutboundVideo',\n  'setInputSensitivity',\n  'setInputVolume',\n  'setLayout',\n  'setPositions',\n  'setMemberPosition',\n  'setOutputVolume',\n  'showVideoMuted',\n  'startRecording',\n  'stopOutboundAudio',\n  'stopOutboundVideo',\n  'undeaf',\n  'videoMute',\n  'videoUnmute',\n  'setMicrophoneVolume',\n  'setSpeakerVolume',\n  'getMeta',\n  'setMeta',\n  'updateMeta',\n  'deleteMeta',\n  'getMemberMeta',\n  'setMemberMeta',\n  'updateMemberMeta',\n  'deleteMemberMeta',\n  'promote',\n  'demote',\n  'lock',\n  'unlock',\n]\n\n/**\n * List of events that the SDK must subscribe at the invite time.\n * ie. ScreenShare/AdditionaDevice are based on the member.joined logic.\n */\nconst REQUIRED_EVENTS: (keyof RoomSessionObjectEvents)[] = [\n  'member.joined',\n  'layout.changed',\n]\nconst noop = () => {}\n\nexport interface RoomSessionOptions extends UserOptions, MakeRoomOptions {}\n\nexport interface RoomSession extends BaseRoomSession<RoomSession> {\n  new (opts: RoomSessionOptions): this\n}\n\n/**\n * A RoomSession allows you to start and control video sessions.\n *\n * For example, the following code joins a video session and listens for new\n * members joining:\n *\n * ```typescript\n * const roomSession = new SignalWire.Video.RoomSession({\n *   token: '<YourRoomToken>',\n *   rootElement: document.getElementById('myVideoElement'),\n *   audio: true,\n *   video: true,\n * })\n *\n * roomSession.on('member.joined', (e) => {\n *   console.log(`${e.member.name} joined`)\n * })\n *\n * roomSession.join({ receiveAudio: true, sendVideo: false })\n * ```\n */\nexport const RoomSession = function (roomOptions: RoomSessionOptions) {\n  const {\n    audio: audioFromConstructor = true,\n    video: videoFromConstructor = true,\n    iceServers,\n    rootElement,\n    applyLocalVideoOverlay = true,\n    mirrorLocalVideoOverlay = false,\n    stopCameraWhileMuted = true,\n    stopMicrophoneWhileMuted = true,\n    speakerId,\n    destinationNumber,\n    localStream,\n    watchMediaPackets,\n    watchMediaPacketsTimeout,\n    disableUdpIceServers = false,\n    ...userOptions\n  } = roomOptions\n\n  const deprecatedParams = ['audio', 'video']\n  deprecatedParams.forEach((param) => {\n    if (param in roomOptions) {\n      getLogger().warn(\n        `The '${param}' parameter on the RoomSession constructor is deprecated. Set it on the '.join()' function instead.`\n      )\n    }\n  })\n\n  // @ts-expect-error - true by default\n  const allowReattach = roomOptions?.reattach !== false\n\n  const { callIdKey } = sessionStorageManager(userOptions.token)\n  const reattachManager = {\n    joined: ({ call_id }: VideoRoomSubscribedEventParams) => {\n      if (allowReattach && callIdKey) {\n        getStorage()?.setItem(callIdKey, call_id)\n      }\n    },\n    init: () => {\n      if (allowReattach) {\n        room.on('room.subscribed', reattachManager.joined)\n      }\n      room.options.prevCallId = reattachManager.getPrevCallId()\n    },\n    destroy: () => {\n      if (!allowReattach) {\n        return\n      }\n\n      room.off('room.subscribed', reattachManager.joined)\n      if (callIdKey) {\n        getStorage()?.removeItem(callIdKey)\n      }\n    },\n    getPrevCallId: () => {\n      if (!allowReattach || !callIdKey) {\n        return\n      }\n\n      return getStorage()?.getItem(callIdKey) ?? undefined\n    },\n  }\n\n  const client = createClient<RoomSession>(userOptions)\n  const room = client.rooms.makeRoomObject({\n    // audio,\n    // video: video === true ? VIDEO_CONSTRAINTS : video,\n    negotiateAudio: true,\n    negotiateVideo: true,\n    iceServers,\n    rootElement,\n    applyLocalVideoOverlay,\n    mirrorLocalVideoOverlay,\n    stopCameraWhileMuted,\n    stopMicrophoneWhileMuted,\n    speakerId,\n    destinationNumber,\n    localStream,\n    watchMediaPackets,\n    watchMediaPacketsTimeout,\n    prevCallId: reattachManager.getPrevCallId(),\n    disableUdpIceServers,\n  })\n\n  // WebRTC connection left the room.\n  room.once('destroy', () => {\n    room.emit('room.left', { reason: room.leaveReason })\n\n    // Remove callId to reattach\n    reattachManager.destroy()\n    client.disconnect()\n  })\n\n  // @ts-expect-error\n  client.session.once('session.disconnected', () => {\n    room.destroy()\n  })\n\n  const join = (params?: BaseRoomSessionJoinParams) => {\n    return new Promise(async (resolve, reject) => {\n      try {\n        // @ts-expect-error\n        room.attachPreConnectWorkers()\n\n        await client.connect()\n\n        // Fallback to the constructor values for backwards compat.\n        const audio = params?.audio ?? audioFromConstructor\n        const video = params?.video ?? videoFromConstructor\n\n        // @ts-expect-error\n        const authState: VideoAuthorization = client._sessionAuthState\n        getLogger().debug('getJoinMediaParams authState?', authState)\n        if (authState && authState.type === 'video') {\n          const mediaOptions = getJoinMediaParams({\n            authState,\n            // constructor values override the send\n            sendAudio: Boolean(audio),\n            sendVideo: Boolean(video),\n            ...params,\n          })\n\n          if (!checkMediaParams(mediaOptions)) {\n            client.disconnect()\n            return reject(\n              new Error(\n                `Invalid arguments to join the room. The token used has join_as: '${\n                  authState.join_as\n                }'. \\n${JSON.stringify(params, null, 2)}\\n`\n              )\n            )\n          }\n          getLogger().debug('Set mediaOptions', mediaOptions)\n\n          /**\n           * audio and video might be objects with MediaStreamConstraints\n           * so if we must send media, we make sure to use the user's\n           * preferences.\n           * Note: params.sendAudio: `true` will override audio: `false` so\n           * we're using `||` instead of `??` for that reason.\n           */\n          // @ts-expect-error\n          room.updateMediaOptions({\n            audio: mediaOptions.mustSendAudio ? audio || true : false,\n            video: mediaOptions.mustSendVideo ? video || true : false,\n            negotiateAudio: mediaOptions.mustRecvAudio,\n            negotiateVideo: mediaOptions.mustRecvVideo,\n          })\n        }\n\n        room.once('room.subscribed', () => {\n          resolve(room)\n        })\n\n        // Hijack previous callId if present\n        reattachManager.init()\n\n        REQUIRED_EVENTS.forEach((event) => room.once(event, noop))\n\n        await room.join()\n      } catch (error) {\n        getLogger().error('RoomSession Join', error)\n        // Disconnect the underlay client in case of media/signaling errors\n        client.disconnect()\n\n        reject(error)\n      }\n    })\n  }\n\n  const interceptors = {\n    join,\n  } as const\n\n  return new Proxy<Omit<RoomSession, 'new'>>(room, {\n    get(target: RoomSession, prop: keyof RoomSession, receiver: any) {\n      if (prop in interceptors) {\n        // @ts-expect-error\n        return interceptors[prop]\n      }\n\n      if (!target.active && UNSAFE_PROP_ACCESS.includes(prop)) {\n        throw new Error(\n          `Tried to access the property/method \"${prop}\" before the room was connected. Please call roomSession.join() first.`\n        )\n      }\n\n      return Reflect.get(target, prop, receiver)\n    },\n  })\n  // For consistency with other constructors we'll make TS force the use of `new`\n} as unknown as { new (roomOptions: RoomSessionOptions): RoomSession }\n","import { getLogger } from '@signalwire/core'\nimport type { VideoAuthorization } from '@signalwire/core'\nimport type { BaseRoomSessionJoinParams } from './interfaces'\n\ntype GetJoinMediaParamsOptions = BaseRoomSessionJoinParams & {\n  authState: VideoAuthorization\n}\n/**\n * getJoinMediaParams returns whether the Join method must send/recv\n * audio and video.\n * Based on values on the Auth block (media allowed and join_as type)\n * it matches the user's preferences and return an object that tells\n * if the negotiation has to include sendrecv/sendonly or recvonly\n * for audio and video.\n */\nexport const getJoinMediaParams = (options: GetJoinMediaParamsOptions) => {\n  const {\n    authState,\n    audio = true,\n    video = true,\n    sendAudio,\n    sendVideo,\n    receiveAudio,\n    receiveVideo,\n  } = options\n  getLogger().debug('getJoinMediaParams options', { ...options })\n  const { audio_allowed, video_allowed, join_as } = authState\n  // Fallback to 'member' in case of null/undefined\n  const joinAs = join_as ?? 'member'\n  const canSend = joinAs === 'member'\n\n  const canSendAudio = canSend && audio_allowed === 'both'\n  const canSendVideo = canSend && video_allowed === 'both'\n  const canReceiveAudio = audio_allowed !== 'none'\n  const canReceiveVideo = video_allowed !== 'none'\n\n  const reqToSendAudio = Boolean(sendAudio ?? audio)\n  const reqToSendVideo = Boolean(sendVideo ?? video)\n  const reqToReceiveAudio = Boolean(receiveAudio ?? audio)\n  const reqToReceiveVideo = Boolean(receiveVideo ?? video)\n\n  if (!canSendAudio && reqToSendAudio) {\n    getLogger().info(\n      'Not allowed to send audio on this room. Default values will be used.'\n    )\n  }\n  if (!canSendVideo && reqToSendVideo) {\n    getLogger().info(\n      'Not allowed to send video on this room. Default values will be used.'\n    )\n  }\n  if (!canReceiveAudio && reqToReceiveAudio) {\n    getLogger().info(\n      'Not allowed to receive video from the room. Default values will be used.'\n    )\n  }\n  if (!canReceiveVideo && reqToReceiveVideo) {\n    getLogger().info(\n      'Not allowed to receive video from the room. Default values will be used.'\n    )\n  }\n  return {\n    mustSendAudio: canSendAudio && reqToSendAudio,\n    mustSendVideo: canSendVideo && reqToSendVideo,\n    mustRecvAudio: canReceiveAudio && reqToReceiveAudio,\n    mustRecvVideo: canReceiveVideo && reqToReceiveVideo,\n  }\n}\n\nexport const checkMediaParams = (\n  options: Record<string, boolean | undefined>\n) => {\n  // At least one value must be true\n  return Object.values(options).some(Boolean)\n}\n","import { CreateRoomObjectOptions, createRoomObject } from './createRoomObject'\n\n/**\n * Using Video.joinRoom() you can automatically join a room.\n *\n * @example\n * With an HTMLDivElement with id=\"root\" in the DOM.\n * ```js\n * // <div id=\"root\"></div>\n *\n * try {\n *   const roomObj = await Video.joinRoom({\n *     token: '<YourJWT>',\n *     rootElementId: 'root',\n *   })\n *\n *   // You have joined the room..\n * } catch (error) {\n *   console.error('Error', error)\n * }\n * ```\n * @deprecated Use {@link RoomSession} instead.\n */\nexport const joinRoom = (roomOptions: CreateRoomObjectOptions) => {\n  return createRoomObject({\n    ...roomOptions,\n    autoJoin: true,\n  })\n}\n","import { stopStream } from './primitives';\nimport { getUserMedia } from './getUserMedia';\n/**\n * Prompts the user to grant permissions for the devices matching the specified set of constraints.\n * @param constraints an optional [MediaStreamConstraints](https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamConstraints)\n *                    object specifying requirements for the returned [MediaStream](https://developer.mozilla.org/en-US/docs/Web/API/MediaStream).\n *\n * @example\n * To only request audio permissions:\n *\n * ```typescript\n * await SignalWire.WebRTC.requestPermissions({audio: true, video: false})\n * ```\n *\n * @example\n * To request permissions for both audio and video, specifying constraints for the video:\n * ```typescript\n * const constraints = {\n *   audio: true,\n *   video: {\n *     width: { min: 1024, ideal: 1280, max: 1920 },\n *     height: { min: 576, ideal: 720, max: 1080 }\n *   }\n * }\n * await SignalWire.WebRTC.requestPermissions(constraints)\n * ```\n */\nexport const requestPermissions = async (constraints) => {\n    try {\n        const stream = await getUserMedia(constraints);\n        stopStream(stream);\n    }\n    catch (error) {\n        throw error;\n    }\n};\n//# sourceMappingURL=requestPermissions.js.map"],"names":["root","definition","this","noop","undefinedType","isIE","window","navigator","test","userAgent","logMethods","bindMethod","obj","methodName","method","bind","Function","prototype","call","e","apply","arguments","traceForIE","console","log","trace","replaceLoggingMethods","level","loggerName","i","length","methodFactory","debug","enableLoggingWhenConsoleArrives","defaultMethodFactory","undefined","realMethod","Logger","name","defaultLevel","factory","currentLevel","self","storageKey","getPersistedLevel","storedLevel","localStorage","ignore","cookie","document","location","indexOf","encodeURIComponent","exec","slice","levels","TRACE","DEBUG","INFO","WARN","ERROR","SILENT","getLevel","setLevel","persist","toUpperCase","levelNum","levelName","persistLevelIfPossible","setDefaultLevel","resetLevel","removeItem","clearPersistedLevel","enableAll","disableAll","initialLevel","defaultLogger","_loggersByName","getLogger","TypeError","logger","_log","noConflict","getLoggers","module","exports","getRandomValues","rnds8","Uint8Array","rng","crypto","Error","REGEX","byteToHex","push","toString","unsafeStringify","arr","offset","toLowerCase","DNS","URL","v35","version","hashfunc","generateUUID","value","namespace","buf","_namespace","str","unescape","bytes","charCodeAt","stringToBytes","uuid","validate","v","parseInt","parse","set","err","getOutputLength","inputLength8","safeAdd","x","y","lsw","md5cmn","q","a","b","s","t","num","cnt","md5ff","c","d","md5gg","md5hh","md5ii","msg","input","output","length32","hexTab","hex","charAt","md5ToHexEncodedArray","len","olda","oldb","oldc","oldd","wordsToMd5","length8","Uint32Array","bytesToWords","native","randomUUID","v4","options","rnds","random","f","z","ROTL","n","_typeof","Symbol","iterator","constructor","_defineProperty","key","arg","hint","prim","toPrimitive","res","String","toPropertyKey","Object","defineProperty","enumerable","configurable","writable","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","_objectSpread2","target","source","forEach","getOwnPropertyDescriptors","defineProperties","formatProdErrorMessage","code","K","H","Array","isArray","N","Math","ceil","M","j","pow","floor","W","T","$$observable","observable","randomString","substring","split","join","ActionTypes","INIT","REPLACE","PROBE_UNKNOWN_ACTION","createStore","reducer","preloadedState","enhancer","_ref2","currentReducer","currentState","currentListeners","nextListeners","isDispatching","ensureCanMutateNextListeners","getState","subscribe","listener","isSubscribed","index","splice","dispatch","action","proto","getPrototypeOf","isPlainObject","type","listeners","replaceReducer","nextReducer","_ref","outerSubscribe","observer","observeState","next","unsubscribe","combineReducers","reducers","reducerKeys","finalReducers","shapeAssertionError","finalReducerKeys","assertReducerShape","state","hasChanged","nextState","_i","_key","previousStateForKey","nextStateForKey","bindActionCreator","actionCreator","compose","_len","funcs","reduce","applyMiddleware","middlewares","store","_dispatch","middlewareAPI","chain","map","middleware","_objectSpread","actionCreators","boundActionCreators","createSymbol","CANCEL","CHANNEL_END_TYPE","IO","MATCH","MULTICAST","SAGA_ACTION","SELF_CANCELLATION","TASK","TASK_CANCEL","TERMINATE","SAGA_LOCATION","_extends","assign","hasOwnProperty","undef","notUndef","func","string","array","promise","p","then","it","throw","pattern","pat","symbol","every","channel","ch","take","close","stringableFunc","Boolean","multicast","kTrue","konst","identity","assignWithSymbols","flatMap","mapper","concat","remove","item","once","fn","called","kThrow","kReturn","done","makeIterator","thro","meta","return","isSagaIterator","logError","error","sagaStack","createEmptyArray","wrapSagaDispatch","shouldTerminate","shouldCancel","shouldComplete","createAllStyleChildCallbacks","shape","parentCallback","completed","totalCount","completedCount","results","childCallbacks","chCbAtKey","isErr","cancel","getMetaInfo","getLocation","instrumented","zeroBuffer","isEmpty","put","none","expanding","initialSize","limit","overflowAction","pushIndex","popIndex","flush","items","doubledLimit","ringBuffer","TAKE","PUT","ALL","CALL","FORK","SELECT","CANCELLED","makeEffect","payload","combinator","detach","eff","detached","patternOrChannel","multicastPattern","warn","channel$1","getFnCallDescriptor","fnDescriptor","args","context","fork","_len3","_key3","spawn","_len4","_key4","select","selector","_len5","_key5","cancelled","queue","semaphore","task","suspend","release","asap","immediately","shift","patterns","some","matcher","predicate","_predicate","wildcard","matcherCreator","string$1","array$1","symbol$1","END","isEnd","buffer$1","closed","takers","cb","taker","eventChannel","buffer","chan","multicastChannel","currentTakers","nextTakers","ensureCanMutateNextTakers","stdChannel","RUNNING","ABORTED","DONE","resolvePromise","cancelPromise","_effectRunnerMap","current","nextSagaId","cancelSingleTask","taskToCancel","isRunning","effectRunnerMap","env","_ref3","_ref3$channel","maybe","takeCb","resolve","result","effects","_ref11","digestEffect","effectId","_ref12","response","childCbs","_ref4","_ref5","proc","_ref6","cpsCb","_ref7","_ref8","parent","taskIterator","resolved","createTaskIterator","getIteratorMetaInfo","child","addTask","isAborted","abort","taskOrTasks","_ref9","joinSingleTask","taskToJoin","joiner","joiners","_ref10","_ref13","_ref14","match","CANCELLED$1","data","_ref15","isCancelled","prop","_ref16","props","_ref17","formatLocation","fileName","lineNumber","sagaLocationAsString","sagaMeta","cancelledTasksAsString","cancelledTasks","crashedEffect","addSagaFrame","frame","clear","setCrashedEffect","effect","firstSaga","otherSagas","crashedEffectLocation","iterator$1","parentContext","parentEffectId","isRoot","cont","finalRunEffect","finalizeRunEffect","currCb","effectRunner","executingContext","mainTask","status","_task","taskResult","taskError","deferredEnd","cancelledDueToErrorTasks","create","onAbort","tasks","getTasks","cancelAll","forkQueue","end","onError","reject","id","setContext","toPromise","def","Promise","newTask","label","effectSettled","sagaMonitor","effectRejected","effectResolved","effectTriggered","effectCancelled","runSaga","saga","_ref$channel","_ref$context","effectMiddlewares","_ref$onError","rootSagaStarted","actionDispatched","runEffect","sagaMiddlewareFactory","_temp","boundRunSaga","excluded","sourceKeys","_objectWithoutPropertiesLoose","sagaMiddleware","run","has","prefix","Events","EE","addListener","emitter","event","evt","_events","_eventsCount","clearEvent","EventEmitter","__proto__","eventNames","events","names","handlers","l","ee","listenerCount","emit","a1","a2","a3","a4","a5","removeListener","on","removeAllListeners","off","prefixed","__defProp","__defProps","__getOwnPropDesc","__getOwnPropDescs","__getOwnPropNames","getOwnPropertyNames","__getOwnPropSymbols","__hasOwnProp","__propIsEnum","propertyIsEnumerable","__defNormalProp","__spreadValues","__spreadProps","__objRest","exclude","__export","all2","get","__copyProps","to","from","except","desc","__reExport","mod","secondTarget","__publicField","LOCAL_EVENT_PREFIX","SYNTHETIC_EVENT_PREFIX","PRODUCT_PREFIX_PUBSUB","originalFactory","logLevel","rawMethod","unshift","Date","toISOString","userLogger","defaultLoggerLevel","debugOptions","getLoggerInstance","wsTraffic","logWsTraffic","shouldStringify","JSON","stringify","info","Proxy","receiver","Reflect","UPPERCASE_REGEX","WEBRTC_EVENT_TYPES","isWebrtcEventType","eventType","includes","whitelistCodeRegex","parseResponse","nodeId","node_id","nestedResult","jsonrpc","DEFAULT_OPTIONS","propsToUpdateValue","toExternalJSON","__sw_symbol","__sw_proxy","entries","fromSnakeToCamelCase","endsWith","isTimestampProperty","timestamp","date","isNaN","getTime","toDateObject","part","fc","trim","remainingChars","substr","toInternalAction","event_type","params","vertoRPC","extendComponent","klass","methods","stripNamespacePrefix","regex","RegExp","replace","PROTOCOL_PATTERN","timeoutPromise","time","exception","timer","race","_resolve","setTimeout","finally","clearTimeout","WITH_CUSTOM_EVENT_NAMES","CLIENT_SIDE_EVENT_NAMES","validateEventsToSubscribe","valid","internalEvent","eventParts","cleanupEventNamespace","isSyntheticEvent","isLocalEvent","isSessionEvent","find","withCustomName","startsWith","Set","isSATAuth","makeRPCRequest","_a","makeRPCResponse","DEFAULT_CONNECT_VERSION","major","minor","revision","UNIFIED_CONNECT_VERSION","RPCConnect","event_acks","RPCReauthenticate","authentication","tmpMap","destinationNumber","remoteCallerName","remoteCallerNumber","callerName","callerNumber","filterVertoParams","dialogParams","buildVertoRPCMessage","VertoInvite","VertoBye","VertoModify","VertoInfo","VertoAnswer","VertoSubscribe","VertoPong","VertoResult","actions_exports","authErrorAction","authExpiringAction","authSuccessAction","createAction","destroyAction","getCustomSagaActionType","initAction","makeCustomSagaAction","reauthAction","sessionDisconnectedAction","sessionForceCloseAction","sessionReconnectingAction","socketMessageAction","toolkit_exports","prepareAction","prepared","configureStore","redux_star","composeWithDevTools","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","IS_PRODUCTION","curriedGetDefaultMiddleware","devTools","enhancers","rootReducer2","baseProto","finalMiddleware","middlewareEnhancer","finalCompose","compose2","storeEnhancers","formatCustomSagaAction","executeReducerBuilderCallback","builderCallback","actionsMap","actionMatchers","defaultCaseReducer","builder","addCase","typeOrActionCreator","addMatcher","addDefaultCase","createDestroyableSlice","initialState","extraReducers","reducerNames","sliceCaseReducersByName","sliceCaseReducersByType","buildReducer","finalCaseReducers","mapOrBuilderCallback","getInitialState","finalActionMatchers","finalDefaultCaseReducer","caseReducers","reducer2","cr","previousState","caseReducer","createReducer","_reducer","reducerName","maybeReducerWithPrepare","prepareCallback","prepare","actions","createSlice","authorizingAction","sessionSlice","protocol","iceServers","authStatus","authState","authError","authCount","connected","_b","authorization","ice_servers","updateAuthState","sessionActions","sessionReducer","SW_SYMBOL","BaseSession","Map","for","host","sessionChannel","_host","checkWebSocketHost","_sessionChannel","_onSocketOpen","_onSocketError","_onSocketClose","_onSocketMessage","execute","connect","wsOpenHandler","_a2","_socket","removeEventListener","wsCloseHandler","wsErrorHandler","rpcConnectResult","_rpcConnectResult","relayProtocol","signature","connecting","readyState","closing","_status","idle","ready","token","WebSocketConstructor","CloseEventConstructor","_clearTimers","_removeSocketListeners","destroySocket","_clearCheckPingTimer","_createSocket","_addSocketListeners","addEventListener","async","_checkCurrentStatus","message","_requests","rpcRequest","_send","_executeTimeoutMs","_executeTimeoutError","catch","_executeConnectionClosed","_swConnectError","_closeConnection","_addToExecuteQueue","_connectParams","agent","connectVersion","project","_relayProtocolIsValid","topics","contexts","forceClose","authenticate","_flushExecuteQueue","reason","_clearPendingRequests","_reconnectTimer","size","decode","isJSONRPCRequest","isJSONRPCResponse","request","delete","parseRPCResponse","_pingHandler","_eventAcknowledgingHandler","_payload","encode","safeParseJson","persistSwAuthorizationState","_","send","_executeQueue","add","_checkPingTimer","_checkPingDelay","now","RPCEventAckResponse","BaseJWTSession","super","_checkTokenExpiration","reauthenticate","expiresAt","fabric_subscriber","expires_at","parsed","expiresIn","expired","_expiredDiffSeconds","jwt_token","prevProtocol","retrieveRelayProtocol","authorizationState","retrieveSwAuthorizationState","authorization_state","persistRelayProtocol","project_id","_checkTokenExpirationTimer","refreshTokenFn","onRefreshToken","_refreshTokenNotificationDiff","_checkTokenExpirationDelay","redux_exports","configureStore2","createCatchableSaga","createRestartableSaga","componentSlice","byId","upsert","cleanup","componentId","ids","componentActions","componentReducer","rootReducer","components","session","sagaHelpers_exports","defaultCatchHandler","errorHandler","isWebrtcEvent","isVideoEvent","isSwAuthorizationState","sessionChannelWatcher","swEventChannel","swEventWorker","broadcastParams","onSwAuthorizationState","sessionChannelWorkerCatchable","AuthError","setPrototypeOf","HttpError","initSessionSaga","initSession","sessionEmitter","userOptions","channels","customTasks","workers","call2","all","fork2","sessionStatusTask","sessionStatusWatcher","take2","disconnect","reauthenticateWorker","put2","sessionAuthErrorSaga","sessionSelectors_exports","getAuthError","getAuthState","getAuthStatus","getIceServers","getSession","sessionListeners","Component","customSagas","sessionKeys","instance","cacheMap","storeUnsubscribe","reduxKey","cacheKey","updatedValue","fnName","taskList","destroyer","getEventEmitter","SessionConstructor","runSagaMiddleware","createSagaMiddleware","getDefaultMiddleware","instanceMap","getAll","deleteAll","useInstanceMap","getSession2","useSession","setDebugOptions","rootSaga_default","executeActionWorker","onDone","onFail","requestId","RPCExecute","call3","SW_SYMBOL2","BaseComponent","eventEmitter","__uuid","_destroyer","eventName","sessionEventNames","getSubscriptions","destroy","detachWorkers","transformParams","transformResolve","transformReject","runWorker","worker","triggerCustomSaga","dispatchId","_customSagaTriggers","settleCustomSagaTrigger","kind","selectorFn","getStateProperty","param","_sessionAuthStatus","_sessionAuthState","_waitUntilSessionAuthorized","authStatus2","_workers","_setWorker","_attachWorker","_runningWorkers","BaseClient","BaseConsumer","resetLatestExecuteParams","_latestExecuteParams","shouldExecuteSubscribe","execParams","subscriptions","subscribeMethod","subscribeParams","event_channel","INTERNAL_MEMBER_UPDATABLE_PROPS","audio_muted","video_muted","deaf","visible","input_volume","output_volume","input_sensitivity","MEMBER_UPDATABLE_PROPS","componentSelectors_exports","getComponent","getComponentsById","getComponentsToCleanup","toCleanup","responses","errors","rooms_exports","RoomSessionMemberAPI","RoomSessionPlaybackAPI","RoomSessionRecordingAPI","RoomSessionStreamAPI","audioMuteMember","audioUnmuteMember","createRoomSessionMemberObject","createRoomSessionPlaybackObject","createRoomSessionRecordingObject","createRoomSessionStreamObject","deafMember","deleteMemberMeta","deleteMeta","demote","getLayouts","getMemberMeta","getMembers","getMeta","getPlaybacks","getRecordings","getStreams","hideVideoMuted","lock","play","promote","removeAllMembers","removeMember","setDeaf","setHideVideoMuted","setInputSensitivityMember","setInputVolumeMember","setLayout","setMemberMeta","setMemberPosition","setMeta","setOutputVolumeMember","setPositions","setPrioritizeHandraise","setRaisedHand","showVideoMuted","startRecording","startStream","undeafMember","unlock","updateMemberMeta","updateMeta","videoMuteMember","videoUnmuteMember","baseCodeTransform","createRoomMethod","room_session_id","roomSessionId","createRoomMemberMethod","memberId","rest","member_id","layouts","members","recordings","recordingInstances","recording","recordingInstance","setPayload","room_id","roomId","playbacks","playbackInstances","playback","playbackInstance","seekPosition","currentTimecode","seek_position","createRoomMetaMethod","streams","streamInstances","stream","streamInstance","enable","mediaAllowed","joinAudioMuted","joinVideoMuted","media_allowed","join_audio_muted","join_video_muted","raised","duration","startedAt","started_at","endedAt","ended_at","recording_id","url","volume","position","seekable","playback_id","timecode","abs","stream_id","member","callId","call_id","parentId","parent_id","requestedPosition","requested_position","currentPosition","current_position","audioMuted","videoMuted","inputVolume","outputVolume","inputSensitivity","talking","handraised","newPayload","chat_exports","BaseChatAPI","BaseChatConsumer","ChatMember","ChatMessage","applyCommonMethods","createBaseChatObject","getMemberState","getMembers2","getMessages","publish","setMemberState","toInternalChatChannels","list","isValidChannels","baseCodeTransform2","createChatMethod","createChatMemberMethod","messages","cursor","transformParamChannels","pubSub_exports","BasePubSubConsumer","PubSubMessage","createBasePubSubObject","pubSubWorker","client","channel3","restMessage","externalJSON","pubSubMessage","isPubSubEvent","sagaEffects.take","sagaEffects.fork","toInternalPubSubChannels","initWorker","_getChannelsParam","_channels","_setSubscribeParams","_getSubscribeParams","_getUnsubscribeParams","channelsParam","_checkMissingSubscriptions","eventNamesWithPrefix","updateToken","content","publishedAt","chatWorker","chatMessage","isChatEvent2","transformParamChannels2","baseCodeTransform3","targetClass","_client","_c","_d","memberPosition_exports","MEMBER_POSITION_COMPOUND_EVENTS","memberPositionWorker","memberUpdatedWorker","defaultDispatcher","memberPositionLayoutChangedWorker","memberList","dispatcher","processedMembers","layout","layers","layer","memberEventParams","mutateMemberCurrentPosition","updatedMemberEventParams","updated","memberUpdatedPayload","initializeMemberList","addToMemberList","action2","fork3","room_session","configureFullStack","configureJestStore","createMockedLogger","createSessionChannel","createSwEventChannel","rpcConnectResultVRT","wait","PROJECT_ID","TOKEN","fatal","jest","mockImplementation","ms","scopes","scope_id","resource","join_as","user_name","room","display_name","audio_allowed","video_allowed","urls","credential","credentialType","username","multicastChannel2","channel2","selectors","supportsMediaDevices","mediaDevices","getMediaDevicesApi","getSupportedConstraints","streamIsValid","MediaStream","supportsMediaOutput","HTMLMediaElement","setMediaElementSinkId","el","deviceId","setSinkId","stopStream","getTracks","stopTrack","track","stop","dispatchEvent","Event","PERMISSIONS_MAPPING","camera","microphone","speaker","_getMediaDeviceKindByName","enumerateDevices","enumerateDevicesByKind","filterByKind","devices","_error","checkPermissions","permissions","query","_legacyCheckPermissions","checkCameraPermissions","checkMicrophonePermissions","checkSpeakerPermissions","getUserMedia","constraints","audio","video","useTimeout","promises","_useTimeoutForGUM","constraint","getDisplayMedia","getDevicesWithPermissions","fullList","getDevices","_filterDevices","found","groupId","targets","checkDefault","excludeDefault","getSpeakerDevices","assureDeviceId","deviceLabel","_deviceInfoToMap","deviceInfo","TARGET_PERMISSIONS_MAP","DEFAULT_TARGETS","ALLOWED_TARGETS_MSG","CHECK_SUPPORT_MAP","createDeviceWatcher","permission","supported","unsupported","checkTargetPermissions","needPermissionsTarget","filteredTargets","unsupportedTargets","needPermissions","validateTargets","currentDevices","kinds","knownDevices","oldDevices","newDevices","changes","removals","updates","additions","newDevice","oldDevice","removed","added","_getDeviceListDiff","hasAddedDevices","hasRemovedDevices","hasUpdatedDevices","createSpeakerDeviceWatcher","isMediaStream","getSpeakerById","SDPUtils","localCName","generateIdentifier","splitLines","blob","line","splitSections","getDescription","sections","getMediaSections","matchPrefix","parseCandidate","parts","candidate","foundation","component","priority","ip","address","port","relatedAddress","relatedPort","tcpType","ufrag","usernameFragment","writeCandidate","sdp","parseIceOptions","parseRtpMap","payloadType","clockRate","numChannels","writeRtpMap","codec","pt","preferredPayloadType","parseExtmap","direction","uri","attributes","writeExtmap","headerExtension","preferredId","parseFmtp","kv","writeFmtp","parameters","parseRtcpFb","parameter","writeRtcpFb","lines","rtcpFeedback","fb","parseSsrcMedia","sp","ssrc","colon","attribute","parseSsrcGroup","semantics","ssrcs","getMid","mediaSection","mid","parseFingerprint","algorithm","getDtlsParameters","sessionpart","role","fingerprints","writeDtlsParameters","setupType","fp","parseCryptoLine","tag","cryptoSuite","keyParams","sessionParams","writeCryptoLine","writeCryptoKeyParams","parseCryptoKeyParams","keyMethod","keySalt","lifeTime","mkiValue","mkiLength","getCryptoParameters","getIceParameters","pwd","password","writeIceParameters","iceLite","parseRtpParameters","description","codecs","headerExtensions","fecMechanisms","rtcp","mline","profile","rtpmapline","fmtps","wildcardRtcpFb","existingFeedback","writeRtpDescription","caps","maxptime","extension","parseRtpEncodingParameters","encodingParameters","hasRed","hasUlpfec","primarySsrc","secondarySsrc","flows","apt","encParam","codecPayloadType","rtx","fec","mechanism","bandwidth","maxBitrate","parseRtcpParameters","rtcpParameters","remoteSsrc","cname","rsize","reducedSize","compound","mux","writeRtcpParameters","parseMsid","spec","planB","msidParts","parseSctpDescription","parseMLine","maxSizeLine","maxMessageSize","sctpPort","fmt","sctpMapLines","writeSctpDescription","media","sctp","generateSessionId","writeSessionBoilerplate","sessId","sessVer","sessUser","sessionId","getDirection","getKind","isRejected","parseOLine","sessionVersion","netType","addressType","isValidSDP","_isAudioLine","_isVideoLine","hasMediaSection","sdpStereoHack","endOfLine","sdpLines","opusIndex","findIndex","opusPayload","_getCodecPayloadType","fmtpLineIndex","_getUserMedia","getMediaConstraints","remoteSDP","optionsAudio","micId","micLabel","newMicId","exact","optionsVideo","camId","camLabel","newCamId","filterIceServers","servers","disableUdpIceServers","filterOutUdpUrls","transportParam","server","RTCPeer","_negotiating","_processingRemoteSDP","_restartingIce","_onIce","_onEndedTrackHandler","prevCallId","localStream","_localStream","rtcConfigPolyfill","config","watchMediaPacketsTimeout","remoteStream","_remoteStream","isOffer","isAnswer","isSimulcast","simulcast","isSfu","sfu","localVideoTrack","videoSender","_getSenderByKind","localAudioTrack","audioSender","remoteVideoTrack","videoReceiver","_getReceiverByKind","remoteAudioTrack","audioReceiver","hasAudioSender","hasVideoSender","hasAudioReceiver","hasVideoReceiver","rtcPeerConfig","bundlePolicy","sdpSemantics","localSdp","localDescription","remoteSdp","remoteDescription","hasIceServers","getConfiguration","stopTrackSender","sender","removeTrack","newTrack","replaceTrack","addTrack","getDeviceId","getSettings","getTrackSettings","getDeviceLabel","restartIceWithRelayOnly","iceTransportPolicy","newConfig","setConfiguration","restartIce","triggerResume","_resumeTimer","clearTimers","leaveReason","setState","_closeWSConnection","resetNeedResume","clearResumeTimer","watchMediaPackets","startWatchMediaPackets","stopWatchMediaPackets","_mediaWatcher","rtcPeer","previousAudioValue","previousVideoValue","clearTimer","meter","audioPacketsReceived","videoPacketsReceived","stats","getStats","audioTrackId","videoTrackId","report","trackIdentifier","packetsReceived","lastPacketReceivedTimestamp","connectionState","start","watchRTCPeerMediaPackets","newConstraints","getConstraints","screenShare","applyConstraints","getSenders","getReceivers","force","additionalDevice","getTransceivers","tr","offerOptions","voiceActivityDetection","_supportsAddTransceiver","offerToReceiveAudio","negotiateAudio","offerToReceiveVideo","negotiateVideo","offer","createOffer","_setLocalDescription","_setRemoteDescription","answer","createAnswer","_sdpReady","iceGatheringState","_iceTimeout","_onIceTimeout","maxIceGatheringTimeout","onRemoteBye","_rejectStartMethod","_resolveStartMethod","hangup","_setupRTCPeerConnection","RTCPeerConnection","_attachListeners","_retrieveLocalStream","hasLocalTracks","audioTracks","getAudioTracks","videoTracks","getVideoTracks","addTransceiver","audioTransceiverParams","videoTransceiverParams","sendEncodings","rid","active","scaleResolutionDownBy","Number","msStreamsNumber","addStream","_checkMediaToNegotiate","startNegotiation","detachAndStop","transceiver","_sdpIsValid","onLocalSDPReady","section","sdpHasValidCandidates","_forceNegotiation","iceGatheringTimeout","useStereo","googleMaxBitrate","googleMinBitrate","googleStartBitrate","max","min","sdpBitrateHack","setLocalDescription","localOffer","offerLines","offerAudioIndex","offerVideoIndex","answerLines","answerAudioIndex","answerVideoIndex","audioLines","videoLines","sdpMediaOrderHack","sessionDescr","setRemoteDescription","signalingState","emitMediaConnected","_connectionStateTimer","maxConnectionStateTimeout","clearConnectionStateTimer","iceConnectionState","_attachAudioTrackListener","_attachVideoTrackListener","clearWatchMediaPacketsTimer","_watchMediaPacketsTimer","mediaTrack","_detachAudioTrackListener","_detachVideoTrackListener","isWebrtcAction","vertoEventWorker","rtcPeerId","catchableWorker","sagaHelpers","jsonrpcId","callID","peer","getRTCPeerById","activeRTCPeer","onRemoteSdp","sagaEffects.put","sagaEffects.call","_getRPCMethod","onVertoBye","byeCause","cause","byeCauseCode","causeCode","redirectDestination","pongParams","__rest","mediaParams","applyMediaConstraints","setActiveRTCPeer","roomSubscribedWorker","clonedPayload","previewUrl","preview_url","transformPayload","Rooms","promoteDemoteWorker","sagaEffects.select","updateMediaOptions","_triggerNewRTCPeer","sessionAuthWorker","resume","AUDIO_CONSTRAINTS","echoCancellation","noiseSuppression","autoGainControl","AUDIO_CONSTRAINTS_SCREENSHARE","googAutoGainControl","VIDEO_CONSTRAINTS","width","ideal","height","aspectRatio","DEFAULT_CALL_OPTIONS","attach","userVariables","requestTimeout","autoApplyMediaParams","BaseConnection","gotEarly","doReinvite","prevState","rtcPeerMap","resuming","executeInvite","activeRTCPeerId","_checkDefaultMediaConstraints","_initPeer","trying","componentSelectors","pingSupported","reattaching","cameraId","cameraLabel","microphoneId","microphoneLabel","withAudio","withVideo","oldPeerId","appendRTCPeer","setLocalStream","prevAudioTracks","newAudioTracks","prevVideoTracks","newVideoTracks","updateStream","vertoExecute","_buildPeer","updateCamera","updateConstraints","updateMicrophone","manageSendersWithConstraints","stopOutboundAudio","stopOutboundVideo","attempt","newStream","oldConstraints","prevVideoTrack","prevAudioTrack","tracks","currentDirection","previous","runRTCPeerWorkers","workers.vertoEventWorker","workers.roomSubscribedWorker","workers.promoteDemoteWorker","invite","mungedSDP","_mungeSDP","_watchSessionAuth","executeUpdateMedia","executeAnswer","sessionAuthTask","workers.sessionAuthWorker","ssOpts","positions","dtmf","doReinviteWithRelayOnly","restoreOutboundAudio","restoreTrackSender","restoreOutboundVideo","_finalize","sdpRemoveLocalCandidates","renegotiateMediaParams","enableVideoParam","renegotiateMedia","sendOnly","disableVideoParam","recvOnly","addSDKPrefix","buildVideo","createElement","muted","autoplay","playsInline","waitForVideoReady","element","_getLocationStyles","top","left","makeLayoutChangedHandler","localOverlay","rootElement","myMemberId","myLayer","domElement","hide","style","overflow","_buildLayer","localVideo","srcObject","disablePictureInPicture","pointerEvents","objectFit","appendChild","mcuLayers","querySelector","innerHTML","setLocalOverlayMirror","hasVideo","enabled","setLocalOverlayMediaStream","opacity","cleanupElement","firstChild","removeChild","setVideoMediaTrack","setAudioMediaTrack","playsinline","audioSetSpeakerAction","VIDEO_SIZING_EVENTS","makeVideoElementSaga","applyLocalVideoOverlay","layerMap","videoEl","show","mirror","mirrored","transform","webkitTransform","layoutChangedHandler","hasVideoTrack","lastLayoutChanged","_processLayoutChanged","videoTask","videoElementSetupWorker","makeAudioElementSaga","speakerId","Audio","audioEl","getAudioEl","audioTask","audioElementSetupWorker","audioElementActionsWatcher","setSpeakerActionType","maxHeight","mcuWrapper","right","bottom","paddingWrapper","classList","videoElement","fixInLandscapeOrientation","debugDivElementId","samplingInterval","appendDebugInfo","containerElement","pEl","buildHtmlContent","videoWidth","videoHeight","debugElement","getElementById","paddingBottom","setInterval","statsElement","className","aspectRatioListener","contains","layersWrapper","display","relativeWrapper","margin","alignItems","justifyContent","HAVE_NOTHING","SCREENSHARE_AUDIO_CONSTRAINTS","RoomSessionScreenShareAPI","leave","audioMute","audioUnmute","videoMute","videoUnmute","setMicrophoneVolume","setInputVolume","setInputSensitivity","RoomSessionDeviceAPI","EXTERNAL_MEMBER_LIST_UPDATED_EVENT","SYNTHETIC_MEMBER_LIST_UPDATED_EVENT","toSyntheticEvent","letter","fromCamelToSnakeCase","getNamespacedEvent","toInternalEventName","MEMBER_LIST_EVENTS","isMemberListEvent","getUpdatedMembers","actionMembers","getMembersFromAction","values","membersListUpdatedWatcher","pubSubAction","memberListUpdatedWorker","shouldHandleMemberList","getMemberListEventsToSubscribe","eventBridgeHandler","initMemberListSubscriptions","childMemberJoinedWorker","row","videoStreamWorker","roomSession","videoRecordWorker","videoPlaybackWorker","videoWorker","sagaEffects.spawn","MemberPosition","isVideoOrCallEvent","videoMemberWorker","memberInstance","RoomSessionConnection","_screenShareList","_deviceList","_mirrored","_audioEl","mirrorLocalVideoOverlay","workers.videoWorker","screenShareList","deviceList","interactivityMode","attachPreConnectWorkers","workers.memberListUpdatedWorker","opts","startScreenShare","autoJoin","displayStream","recoverCall","memberCallId","workers.childMemberJoinedWorker","addCamera","addDevice","addMicrophone","roomDevice","updateSpeaker","prevId","sinkId","newId","prevSpeaker","newSpeaker","isSame","_attachSpeakerTrackListener","deviceWatcher","disconnectedSpeaker","device","payloadDeviceId","defaultSpeakers","getLayoutList","getMemberList","setMirrored","RoomSessionAPI","undeaf","setOutputVolume","setSpeakerVolume","videoManagerRoomsWorker","modPayload","rooms","videoManagerRoomWorker","videoManagerWorker","VideoManagerAPI","ClientAPI","_videoManager","_chat","_pubSub","makeRoomObject","makeRoomOptions","stopCameraWhileMuted","stopMicrophoneWhileMuted","m","chat","ChatNamespace","pubSub","PubSubNamespace","videoManager","manager","property","createVideoManagerObject","r","atob","o","fromCharCode","decodeURIComponent","header","getStorage","sessionStorage","sessionStorageManager","roomName","jwtPayload","jwtDecode","typ","authStateKey","protocolKey","callIdKey","SwCloseEvent","CloseEvent","wasClean","JWTSession","WebSocket","tokenTyp","decodedJwt","allowReattach","reattach","isVRT","isSAT","getItem","setItem","createClient","baseUserOptions","INTERCEPTED_METHODS","chatOptions","interceptors","_session","createInterceptor","PubSub","pubSubOptions","wsClientWorker","buildInboundCall","conversationWorker","conversation","isConversationEvent","handleEvent","callLeftWorker","cfRoomSession","callJoinWorker","subType","subPayload","callSegmentWorker","bootstrapAction","segmentRoutingRoomSessionId","segmentRoutingCallId","isSegmentEvent","suffix","updatedAction","lastLayoutEvent","callFabricWorker","cfRoomSessionConnection","isCallJoinedOrCallStateEvent","originCallId","origin_call_id","selfMember","IncomingCallManager","_buildCallObject","_executeReject","_pendingInvites","_handlers","_buildNotification","accept","details","setNotificationHandlers","pushNotification","websocket","handleIncomingInvite","incomingInvite","notification","handler","SATSession","jti","reauthResponse","PREVIOUS_CALLID_STORAGE_KEY","CallFabricRoomSessionConnection","_self","_member","_lastLayoutEvent","currentLayout","executeAction","extraParams","targetMember","buildVideoElement","makeLayoutHandler","processLayoutChanged","processVideoTrack","videoElementSetup","roomCurrentLayoutEvent","videoTrack","trackHandler","mirrorVideoHandler","memberVideoMutedHandler","destroyHander","Client","makeCallFabricObject","WSClient","wsClient","_incomingCallManager","executeVertoBye","clientApi","notifyIncomingInvite","connectAndbuildRoomSession","buildRoomSession","toURL","searchParams","pathname","handlePushNotification","decrypted","caller_id_name","caller_id_number","callee_id_name","callee_id_number","display_direction","executeVertoSubscribe","resultType","buildCallParams","sessid","incomingCallHandlers","offline","http","init","fetch","ok","errorResponse","json","errorMessage","parsedBody","createHttpClient","baseUrl","timeout","globalOptions","fetcher","path","headers","body","reqInit","getRequestInit","timerId","controller","AbortController","signal","getUrl","append","buildPaginatedResult","anotherPage","links","nextPage","prevPage","prev","firstPage","first","hasNext","hasPrev","makeQueryParamsUrls","queryParams","queryString","HTTPClient","httpClient","httpHost","Authorization","isGetAddressByIdParams","isGetAddressesResponse","displayName","pageSize","sortBy","sortOrder","URLSearchParams","queryUrl","deviceType","deviceToken","device_type","device_token","ConversationAPI","addressId","address_id","createdAt","created_at","lastMessageAt","last_message_at","metadata","sendMessage","text","getConversationMessages","DEFAULT_CHAT_MESSAGES_PAGE_SIZE","Conversation","callbacks","chatSubscriptions","subtype","chatCallbacks","conversation_id","callback","chatMessages","isValid","conversationMessages","onMessage","SignalWire","registerDevice","unregisterDevice","getSubscriberInfo","online","dial","getAddresses","getAddress","getConversations","joinConversation","getChatMessages","subscribeChatMessages","__httpClient","__wsClient","createRoomObject","roomOptions","rootElementId","roomObject","UNSAFE_PROP_ACCESS","REQUIRED_EVENTS","audioFromConstructor","videoFromConstructor","reattachManager","joined","getPrevCallId","mediaOptions","sendAudio","sendVideo","receiveAudio","receiveVideo","canSend","canSendAudio","canSendVideo","canReceiveAudio","canReceiveVideo","reqToSendAudio","reqToSendVideo","reqToReceiveAudio","reqToReceiveVideo","mustSendAudio","mustSendVideo","mustRecvAudio","mustRecvVideo","getJoinMediaParams","getMicrophoneAnalyzerMediaStream","audioContext","AudioContext","webkitAudioContext","analyser","createAnalyser","fftSize","minDecibels","maxDecibels","smoothingTimeConstant","createAnalyzer","rafId","createMediaStreamSource","startMetering","dataArray","frequencyBinCount","getByteFrequencyData","latestVol","final","requestAnimationFrame","cancelAnimationFrame"],"mappings":"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"}